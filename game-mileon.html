<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سباق المليون للفرق</title>
    <!-- تحميل Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- تحميل Font Awesome (لأيقونات وسائل المساعدة) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- خط Cairo و Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* إخفاء شريط التمرير */
        ::-webkit-scrollbar { display: none; }
        html { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- إعدادات أساسية وتأثيرات جديدة --- */
        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            /* خلفية جديدة أكثر دراماتيكية */
            background: linear-gradient(180deg, #111827 0%, #1e1b4b 50%, #111827 100%);
            user-select: none;
            overflow-y: auto; /* السماح بالتمرير إذا ضاقت الشاشة */
        }
        
        /* تأثيرات حركية (Animations) */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        /* (جديد) تأثير "نبض" الإطار للفريق الحالي */
        @keyframes pulse-border {
            0%, 100% { border-color: #fde047; box-shadow: 0 0 20px rgba(253, 224, 71, 0.5); }
            50% { border-color: #f59e0b; box-shadow: 0 0 35px rgba(245, 158, 11, 0.7); }
        }

        /* --- تصميم لوحة الفرق (محسن) --- */
        .team-panel {
            background-color: rgba(0, 0, 0, 0.4);
            border: 2px solid #3b0764; /* بنفسجي داكن */
            border-radius: 1rem;
            transition: all 0.3s ease-in-out;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        /* (محسن) الفريق الحالي يتوهج وينبض */
        .team-panel.current-team {
            transform: scale(1.03);
            animation: pulse-border 2s infinite;
        }
        
        /* --- تصميم منطقة اللعب (محسن) --- */

        /* (جديد) تصميم عداد الوقت الدائري */
        #timer-circle-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0.5rem auto 1rem; /* توسيط مع هوامش */
        }
        @media (min-width: 1024px) {
            #timer-circle-container {
                width: 220px;
                height: 220px;
            }
        }

        #timer-circle-svg {
            transform: rotate(-90deg); /* لتبدأ الدائرة من الأعلى */
            width: 100%;
            height: 100%;
        }

        #timer-circle-path {
            stroke: #f59e0b; /* لون برتقالي/ذهبي */
            stroke-width: 12;
            stroke-linecap: round;
            fill: none;
            transition: stroke-dashoffset 0.1s linear;
            filter: drop-shadow(0 0 0 rgba(245, 158, 11, 0.7)); /* إزالة الظل */
        }
        
        /* (جديد) نص العداد الضخم في المنتصف */
        #timer-circle-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 3.5rem; /* ضخم جداً */
            /* تدرج لوني ذهبي */
            background: linear-gradient(180deg, #fde047 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
            transition: all 0.3s ease;
        }
        @media (min-width: 1024px) {
            #timer-circle-text {
                font-size: 4.5rem;
            }
        }

        /* (جديد) حالة التجميد للعداد الدائري */
        #timer-circle-text.frozen {
            background: linear-gradient(180deg, #818cf8 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
        
        /* (جديد) غطاء التجميد */
        #freeze-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(59, 130, 246, 0.8); /* أزرق شبه شفاف */
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none; /* لا يعيق الضغط */
        }
        #freeze-overlay.visible {
            opacity: 1;
        }
        #freeze-overlay .fa-snowflake {
            font-size: 3.5rem;
        }
        #freeze-countdown-text {
            font-size: 3rem;
            font-weight: 700;
        }

        /* عداد الوقت القديم (مخفي) */
        #current-turn-timer, #freeze-countdown {
            display: none;
        }

        /* (محسن) صندوق السؤال */
        .question-box {
            background-color: rgba(30, 41, 59, 0.8);
            border: 2px solid #fde047;
            border-radius: 1.5rem;
            /* توهج ذهبي أقوى */
            box-shadow: 0 0 40px rgba(253, 224, 71, 0.4);
            backdrop-filter: blur(10px);
            font-size: 1.75rem; /* 28px */
        }
        @media (min-width: 768px) {
            .question-box {
                font-size: 2.25rem; /* 36px */
            }
        }

        /* (جديد) تصميم خيارات الإجابة الأيقوني */
        .option-button {
            background-color: rgba(17, 24, 39, 0.7); /* أزرق داكن/رمادي */
            border: 2px solid #4f46e5; /* نيلي */
            color: white;
            transition: all 0.3s ease-in-out;
            backdrop-filter: blur(5px);
            border-radius: 0.75rem; /* 12px */
            font-size: 1.25rem; /* 20px */
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .option-button:not(:disabled):hover {
            background-color: #312e81; /* نيلي أغمق */
            border-color: #c7d2fe; /* نيلي فاتح */
            transform: scale(1.03);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        .option-button.selected {
            background-color: #f59e0b;
            border-color: #fde047;
            transform: scale(1.03);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
        }
        /* (محسن) توهج عند الإجابة */
        .option-button.correct {
            background-color: #16a34a; /* أخضر */
            border-color: #86efac;
            animation: pulse 0.5s 2;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.7);
        }
        .option-button.incorrect {
            background-color: #dc2626; /* أحمر */
            border-color: #fca5a5;
            animation: shake 0.5s;
            box-shadow: 0 0 25px rgba(239, 68, 68, 0.7);
        }
        .option-button:disabled {
            opacity: 0.5;
        }
        .option-button.hidden-by-5050 {
            visibility: hidden;
        }

        /* --- تصميم سلم الجوائز (محسن) --- */
        .prize-ladder-container {
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border: 2px solid #3b0764;
            backdrop-filter: blur(8px);
        }
        .prize-item {
            color: #9ca3af;
            transition: all 0.3s ease-in-out;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            padding: 0.35rem 0.75rem;
            border-radius: 0.5rem;
            text-align: center; /* (جديد) توسيط */
            font-weight: 700;
        }
        /* (محسن) النقطة الآمنة */
        .prize-item.safe-point {
            background-color: rgba(49, 46, 129, 0.7); /* نيلي */
            color: #fde047; /* ذهبي */
        }
        /* (محسن) السؤال الحالي */
        .prize-item.current-prize {
            background-color: #f59e0b; /* برتقالي */
            color: #111827; /* أسود */
            font-size: 1.25rem; /* 20px */
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.6);
            border: 2px solid #fde047;
        }

        /* --- تصميم وسائل المساعدة (محسن) --- */
        .lifeline {
            background-color: rgba(0, 0, 0, 0.3);
            border: 2px solid #818cf8; /* نيلي فاتح */
            border-radius: 9999px;
            width: 45px;
            height: 45px;
            font-size: 1rem;
            color: white;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .lifeline:hover:not(:disabled) {
            background-color: #4f46e5;
            border-color: #fde047; /* ذهبي */
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(253, 224, 71, 0.5);
        }
        .lifeline:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            filter: grayscale(1);
        }
        
        /* (جديد) إخفاء زر إنهاء الدور */
        #pass-turn-button {
            display: none;
        }
        
        /* --- تصميم النوافذ المنبثقة (Modal) --- */
        #modal, #rules-modal, #round-modal, #history-modal { /* (جديد) إضافة مودال السجل */
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            transition: opacity 0.3s ease-in-out;
        }
        /* (جديد) تأثيرات الدخول */
        #modal:not(.hidden), #rules-modal:not(.hidden), #round-modal:not(.hidden), #history-modal:not(.hidden) {
            animation: fadeIn 0.3s ease-out;
        }
        #modal-content, #rules-modal-content, #round-modal-content, #history-modal-content { /* (جديد) إضافة محتوى مودال السجل */
            background: linear-gradient(180deg, #302b63 0%, #0f0c29 100%);
            border: 2px solid #fde047;
            box-shadow: 0 0 40px rgba(253, 224, 71, 0.3);
            border-radius: 1.5rem;
            transition: all 0.3s ease-in-out;
        }
        #modal:not(.hidden) #modal-content,
        #rules-modal:not(.hidden) #rules-modal-content,
        #round-modal:not(.hidden) #round-modal-content,
        #history-modal:not(.hidden) #history-modal-content {
            animation: zoomIn 0.3s ease-out;
        }
        
        /* أزرار المودال */
        .modal-button {
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            font-weight: 700;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .modal-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }
        
        /* زر الإيقاف المؤقت */
        #pause-button {
            transition: all 0.3s ease;
        }
        #pause-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(253, 224, 71, 0.5);
        }
    </style>
</head>
<body class="min-h-screen text-white p-4 flex items-center justify-center">

    <!-- شاشة البداية -->
    <div id="start-screen" class="text-center transition-opacity duration-500" style="animation: zoomIn 0.5s ease-out;">
        <!-- إضافة شعار المسابقة -->
        <img src="images/rhal.webp" alt="شعار المسابقة" class="w-48 h-48 mx-auto mb-6 object-contain">
        <h1 class="text-5xl md:text-6xl font-bold mb-4 text-yellow-300" style="text-shadow: 0 0 15px #fde047;">سباق المليون</h1>
        <h2 class="text-3xl md:text-4xl mb-8 text-gray-300" style="text-shadow: 0 2px 5px rgba(0,0,0,0.3);">تحدي الفرق والزمن</h2>
        
        <div class="max-w-md mx-auto space-y-4 mb-8">
            <input id="team-1-name-input" class="w-full p-3 rounded-lg bg-gray-900 text-white border-2 border-indigo-400 placeholder-gray-500 text-center focus:border-yellow-400 focus:ring-0" placeholder="اسم الفريق الأول" value="الفريق 1">
            <input id="team-2-name-input" class="w-full p-3 rounded-lg bg-gray-900 text-white border-2 border-indigo-400 placeholder-gray-500 text-center focus:border-yellow-400 focus:ring-0" placeholder="اسم الفريق الثاني" value="الفريق 2">
            <input id="team-3-name-input" class="w-full p-3 rounded-lg bg-gray-900 text-white border-2 border-indigo-400 placeholder-gray-500 text-center focus:border-yellow-400 focus:ring-0" placeholder="اسم الفريق الثالث" value="الفريق 3">
        </div>
        
        <!-- (جديد) مجموعة الأزرار -->
        <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
            <button id="start-button" class="w-full sm:w-auto px-10 py-4 bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold text-2xl rounded-full shadow-lg transition-transform duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-yellow-400/30">
                ابدأ السباق
            </button>
            <button id="show-rules-button" class="w-full sm:w-auto px-8 py-3 bg-transparent border-2 border-yellow-500 hover:bg-yellow-500/10 text-yellow-500 font-bold text-xl rounded-full shadow-lg transition-all duration-300 hover:scale-105">
                شرح المسابقة
            </button>
            <button id="show-history-button" class="w-full sm:w-auto px-8 py-3 bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold text-xl rounded-full shadow-lg transition-all duration-300 hover:scale-105 border-2 border-gray-600">
                <i class="fas fa-history"></i> السجل
            </button>
        </div>
    </div>

    <!-- (جديد) مودال سجل النتائج -->
    <div id="history-modal" class="fixed inset-0 w-full h-full flex items-center justify-center hidden z-50 p-4">
        <div id="history-modal-content" class="w-full max-w-4xl p-6 rounded-2xl shadow-xl text-center overflow-hidden flex flex-col max-h-[90vh]">
            <h2 class="text-3xl font-bold text-center text-yellow-300 mb-6" style="text-shadow: 0 0 10px #fde047;">سجل البطولات السابقة</h2>
            
            <div class="overflow-y-auto flex-grow mb-6 custom-scrollbar">
                <table class="w-full text-right border-collapse">
                    <thead>
                        <tr class="bg-indigo-900 text-yellow-300">
                            <th class="p-3 border-b border-gray-700">التاريخ</th>
                            <th class="p-3 border-b border-gray-700">الجولة</th>
                            <th class="p-3 border-b border-gray-700">النتائج (بالترتيب)</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body" class="text-sm">
                        <!-- سيتم ملء البيانات هنا -->
                    </tbody>
                </table>
                <p id="no-history-msg" class="text-gray-400 mt-8 hidden">لا يوجد سجلات سابقة.</p>
            </div>

            <div class="flex justify-center gap-4 mt-auto">
                <button id="clear-history-button" class="modal-button bg-red-700 hover:bg-red-600 text-white">
                    <i class="fas fa-trash-alt"></i> تصفير السجل
                </button>
                <button id="close-history-button" class="modal-button bg-gray-500 hover:bg-gray-400 text-white">
                    إغلاق
                </button>
            </div>
        </div>
    </div>


    <!-- شاشة اللعبة الرئيسية (مخفية افتراضياً) -->
    <div id="game-screen" class="hidden w-full max-w-screen-2xl mx-auto relative">
        
        <!-- زر الإيقاف المؤقت -->
        <button id="pause-button" class="absolute top-2 left-2 z-20 w-12 h-12 bg-yellow-500 text-gray-900 rounded-full flex items-center justify-center text-xl shadow-lg hover:bg-yellow-400 hidden">
            <i class="fas fa-pause"></i>
        </button>
        
        <div class="flex flex-col lg:flex-row gap-6">
            
            <!-- لوحة الفرق -->
            <div id="teams-panel" class="w-full lg:w-1/4 space-y-4">
                <!-- Team 1 Panel -->
                <div id="team-0-panel" class="team-panel p-4">
                    <h3 id="team-0-name" class="text-2xl font-bold text-center mb-2 truncate"></h3>
                    <div id="team-0-score" class="text-2xl font-bold text-green-400 text-center font-mono">0 ريال</div>
                    <div class="text-sm text-gray-400 text-center mt-2">الجولات: <span id="team-0-turns" class="font-bold">0</span></div>
                    <div class="text-sm text-gray-400 text-center">السؤال: <span id="team-0-level" class="font-bold">1</span></div>
                    <div class="text-sm text-gray-400 text-center mt-1">الوقت: <span id="team-0-time" class="font-mono font-bold">0.0s</span></div>
                    <!-- وسائل المساعدة للفريق -->
                    <div class="flex justify-center gap-3 mt-4">
                        <button id="team-0-lifeline-fiftyFifty" class="lifeline" title="50:50"><i class="fas fa-star-half-alt"></i></button>
                        <button id="team-0-lifeline-freeze" class="lifeline" title="تجميد العداد (20 ثانية)"><i class="fas fa-snowflake"></i></button>
                        <button id="team-0-lifeline-skip" class="lifeline" title="تخطي السؤال (+15 ثانية عقوبة)"><i class="fas fa-forward"></i></button>
                    </div>
                </div>
                <!-- Team 2 Panel -->
                <div id="team-1-panel" class="team-panel p-4">
                    <h3 id="team-1-name" class="text-2xl font-bold text-center mb-2 truncate"></h3>
                    <div id="team-1-score" class="text-2xl font-bold text-green-400 text-center font-mono">0 ريال</div>
                    <div class="text-sm text-gray-400 text-center mt-2">الجولات: <span id="team-1-turns" class="font-bold">0</span></div>
                    <div class="text-sm text-gray-400 text-center">السؤال: <span id="team-1-level" class="font-bold">1</span></div>
                    <div class="text-sm text-gray-400 text-center mt-1">الوقت: <span id="team-1-time" class="font-mono font-bold">0.0s</span></div>
                    <div class="flex justify-center gap-3 mt-4">
                        <button id="team-1-lifeline-fiftyFifty" class="lifeline" title="50:50"><i class="fas fa-star-half-alt"></i></button>
                        <button id="team-1-lifeline-freeze" class="lifeline" title="تجميد العداد (20 ثانية)"><i class="fas fa-snowflake"></i></button>
                        <button id="team-1-lifeline-skip" class="lifeline" title="تخطي السؤال (+15 ثانية عقوبة)"><i class="fas fa-forward"></i></button>
                    </div>
                </div>
                <!-- Team 3 Panel -->
                <div id="team-2-panel" class="team-panel p-4">
                    <h3 id="team-2-name" class="text-2xl font-bold text-center mb-2 truncate"></h3>
                    <div id="team-2-score" class="text-2xl font-bold text-green-400 text-center font-mono">0 ريال</div>
                    <div class="text-sm text-gray-400 text-center mt-2">الجولات: <span id="team-2-turns" class="font-bold">0</span></div>
                    <div class="text-sm text-gray-400 text-center">السؤال: <span id="team-2-level" class="font-bold">1</span></div>
                    <div class="text-sm text-gray-400 text-center mt-1">الوقت: <span id="team-2-time" class="font-mono font-bold">0.0s</span></div>
                    <div class="flex justify-center gap-3 mt-4">
                        <button id="team-2-lifeline-fiftyFifty" class="lifeline" title="50:50"><i class="fas fa-star-half-alt"></i></button>
                        <button id="team-2-lifeline-freeze" class="lifeline" title="تجميد العداد (20 ثانية)"><i class="fas fa-snowflake"></i></button>
                        <button id="team-2-lifeline-skip" class="lifeline" title="تخطي السؤال (+15 ثانية عقوبة)"><i class="fas fa-forward"></i></button>
                    </div>
                </div>
            </div>

            <!-- منطقة اللعب (السؤال والخيارات) -->
            <div class="w-full lg:w-1/2 flex flex-col">
                
                <!-- (جديد) عداد الوقت الدائري -->
                <div id="timer-circle-container">
                    <svg id="timer-circle-svg" viewBox="0 0 100 100">
                        <!-- الدائرة الخلفية (غير مكتملة) -->
                        <path d="M 50,50 m -44,0 a 44,44 0 1,1 88,0 a 44,44 0 1,1 -88,0" 
                              stroke="#374151" stroke-width="8" fill-opacity="0"></path>
                        <!-- دائرة التقدم -->
                        <path id="timer-circle-path"
                              d="M 50,50 m -44,0 a 44,44 0 1,1 88,0 a 44,44 0 1,1 -88,0"
                              stroke-dasharray="276.46" stroke-dashoffset="276.46"></path>
                    </svg>
                    <div id="timer-circle-text">0.0</div>
                    <!-- (جديد) غطاء التجميد -->
                    <div id="freeze-overlay" class="hidden">
                        <i class="fas fa-snowflake"></i>
                        <span id="freeze-countdown-text">20</span>
                    </div>
                </div>

                <!-- عداد الوقت القديم (مخفي) -->
                <div id="timer-container" class="text-center mb-4 flex items-center justify-center gap-4 hidden">
                    <div id="current-turn-timer" class="">0.0</div>
                    <div id="freeze-countdown" class="hidden text-blue-400">
                        <i class="fas fa-snowflake"></i> 20
                    </div>
                </div>
                
                <!-- صندوق السؤال -->
                <div class="question-box p-6 md:p-10 mb-6 flex-grow">
                    <h2 id="question-text" class="font-bold text-center h-full flex items-center justify-center">
                        ...
                    </h2>
                </div>
                
                <!-- الخيارات -->
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- سيتم ملء الخيارات هنا عبر جافاسكربت -->
                </div>
                
                <!-- زر الانسحاب/التمرير -->
                <div class="mt-6 text-center">
                    <button id="pass-turn-button" class="px-6 py-3 bg-red-700 hover:bg-red-600 text-white font-semibold rounded-full shadow-md transition-transform duration-300 hover:scale-105 hover:shadow-lg hover:shadow-red-500/30">
                        <i class="fas fa-flag"></i> إنهاء الدور (تثبيت الرصيد)
                    </button>
                </div>
            </div>

            <!-- سلم الجوائز -->
            <div class="w-full lg:w-1/4 prize-ladder-container p-4">
                <!-- إضافة الشعار هنا -->
                <img src="images/rhal.webp" alt="شعار المسابقة" class="w-24 h-24 mx-auto mb-2 object-contain">
                <h3 class="text-2xl font-bold text-yellow-300 text-center mb-4" style="text-shadow: 0 0 5px #fde047;">سلم الجوائز</h3>
                <ul id="prize-ladder" class="flex flex-col-reverse space-y-1 space-y-reverse text-lg">
                    <!-- سيتم ملء الجوائز هنا عبر جافاسكربت -->
                </ul>
            </div>

        </div>
    </div>

    <!-- شاشة النهاية (مخفية افتراضياً) -->
    <div id="end-screen" class="hidden text-center" style="animation: zoomIn 0.5s ease-out;">
        <h1 id="end-title" class="text-4xl md:text-5xl font-bold mb-4 text-yellow-300" style="text-shadow: 0 0 10px #fde047;"></h1>
        <p id="end-message" class="text-2xl mb-8 text-gray-200"></p>
        <div class="space-y-4 mb-8 max-w-lg mx-auto">
            <!-- النتائج النهائية تضاف هنا -->
            <div id="final-results-container" class="space-y-3"></div>
        </div>
        <!-- (جديد) زر كشف النتائج -->
        <button id="reveal-results-button" class="px-10 py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold text-2xl rounded-full shadow-lg transition-transform duration-300 hover:scale-105">
            <i class="fas fa-trophy"></i> اكشف النتائج
        </button>
        <button id="restart-button" class="hidden px-10 py-4 bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold text-2xl rounded-full shadow-lg transition-transform duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-yellow-400/30">
            العب مرة أخرى
        </button>
    </div>

    <!-- مودال (بديل للـ confirm و alert) -->
    <div id="modal" class="fixed inset-0 w-full h-full flex items-center justify-center hidden z-50">
        <!-- (تعديل) إضافة توسيط للنص -->
        <div id="modal-content" class="w-11/12 max-w-lg p-6 text-center">
            <!-- (جديد) عنوان المودال -->
            <h2 id="modal-title" class="hidden text-3xl font-bold text-yellow-300 mb-4" style="text-shadow: 0 0 10px #fde047;"></h2>
            <div id="modal-text" class="text-xl text-white mb-6"></div>
            <div id="modal-buttons" class="flex flex-wrap justify-center gap-4">
                <!-- أزرار المودال تضاف هنا -->
            </div>
        </div>
    </div>

    <!-- (جديد) مودال شرح المسابقة -->
    <div id="rules-modal" class="fixed inset-0 w-full h-full flex items-center justify-center hidden z-50 p-4">
        <div id="rules-modal-content" class="w-full max-w-2xl p-6 rounded-2xl shadow-xl max-h-[90vh] overflow-y-auto">
            
            <h2 class="text-3xl font-bold text-center text-yellow-300 mb-6" style="text-shadow: 0 0 10px #fde047;">قوانين سباق المليون</h2>
            
            <div class="space-y-4 text-gray-200 text-lg">
                <div>
                    <h3 class="text-xl font-bold text-yellow-400 mb-2">1. الهدف</h3>
                    <p>السباق لا ينتهي بوصول أول فريق! اللعبة تنتهي فقط عندما تصل <strong>جميع الفرق</strong> إلى المليون.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold text-yellow-400 mb-2">2. نظام الأدوار</h3>
                    <p>دورك يستمر طالما تجيب بشكل صحيح. ينتهي دورك (ويزيد "عداد الجولات" لديك +1) في حالتين:</p>
                    <ul class="list-disc list-inside pr-4 mt-2 space-y-1">
                        <li><strong>الخطأ:</strong> تعود لآخر نقطة آمنة (ويُهمل وقت الدور).</li>
                        <li><strong>الوصول لنقطة آمنة:</strong> يُحفظ وقتك وتنتقل للنقطة التالية.</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold text-yellow-400 mb-2">3. كيف تفوز؟ (نظام 50/50)</h3>
                    <p>الفائز هو صاحب <strong>أقل "نقاط عقوبة"</strong>. (الأقل هو الأفضل).</p>
                    <div class="bg-gray-800 p-4 rounded-lg text-center font-mono text-xl my-3 text-yellow-200" dir="ltr">
                        نقاطك = (مجموع الوقت) + (الجولة × 30)
                    </div>
                    <p>يجب أن تكون <strong>سريعاً</strong> (وقت قليل) و <strong>فعالاً</strong> (جولات قليلة / أخطاء أقل).</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold text-yellow-400 mb-2">4. وسائل المساعدة</h3>
                    <ul class="space-y-2">
                        <li class="flex items-center"><i class="fas fa-star-half-alt text-yellow-400 w-6 text-center"></i><strong class="mx-2">50/50:</strong> تحذف إجابتين.</li>
                        <li class="flex items-center"><i class="fas fa-snowflake text-blue-400 w-6 text-center"></i><strong class="mx-2">تجميد (20 ثانية):</strong> يوقف العداد (يمكنك الإجابة لإلغائه).</li>
                        <li class="flex items-center"><i class="fas fa-forward text-red-400 w-6 text-center"></i><strong class="mx-2">تخطي السؤال:</strong> يضيف <span class="font-bold text-red-400">15 نقطة (ثانية)</span> عقوبة على وقتك ويكمل العداد.</li>
                    </ul>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button id="close-rules-button" class="modal-button bg-yellow-500 hover:bg-yellow-400 text-gray-900">
                    فهمت (إغلاق)
                </button>
            </div>
        </div>
    </div>
    
    <!-- (جديد) مودال اختيار الجولة -->
    <div id="round-modal" class="fixed inset-0 w-full h-full flex items-center justify-center hidden z-50 p-4">
        <div id="round-modal-content" class="w-full max-w-lg p-6 rounded-2xl shadow-xl text-center">
            <h2 class="text-3xl font-bold text-center text-yellow-300 mb-6" style="text-shadow: 0 0 10px #fde047;">اختر الجولة (بنك الأسئلة)</h2>
            <p class="text-gray-300 mb-6">سيتم حفظ آخر جولة لعبتموها (ستظهر باللون الباهت).</p>
            <div id="round-selection-container" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <!-- أزرار اختيار الجولة تضاف هنا -->
            </div>
            <div class="mt-8 text-center flex justify-center gap-4">
                <button id="close-round-modal-button" class="modal-button bg-gray-500 hover:bg-gray-400 text-white px-6 py-2 rounded-lg">
                    إلغاء
                </button>
                <button onclick="window.location.reload()" class="modal-button bg-red-600 hover:bg-red-500 text-white px-6 py-2 rounded-lg">
                    خروج نهائي
                </button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- (تعديل) بنك الأسئلة - المجموعة 1 (القديمة) ---
            
            // المستوى السهل (30 سؤال)
            const EASY_QUESTIONS_SET1 = [
                { question: "أكبر كوكب في المجموعة الشمسية؟", options: ["أ: الأرض", "ب: المريخ", "ج: زحل", "د: المشتري"], answer: "د: المشتري" },
                { question: "عاصمة فرنسا؟", options: ["أ: باريس", "ب: لندن", "ج: برلين", "د: مدريد"], answer: "أ: باريس" },
                { question: "ما هي المادة الأساسية التي يصنع منها الزجاج؟", options: ["أ: الحديد", "ب: الرمل", "ج: الخشب", "د: البلاستيك"], answer: "ب: الرمل" },
                { question: "أي من التالي حيوان ثديي؟", options: ["أ: القرش", "ب: الدولفين", "ج: البطريق", "د: السلحفاة"], answer: "ب: الدولفين" },
                { question: "ما هي الدولة التي عاصمتها 'كييف'؟", options: ["أ: روسيا", "ب: أوكرانيا", "ج: بيلاروسيا", "د: بولندا"], answer: "ب: أوكرانيا" },
                // 5
                { question: "أي من هذه الدول ليست في أوروبا؟", options: ["أ: إيطاليا", "ب: تركيا", "ج: إسبانيا", "د: سويسرا"], answer: "ب: تركيا" },
                { question: "المعدن الأكثر وفرة في قشرة الأرض؟", options: ["أ: الذهب", "ب: الحديد", "ج: الألومنيوم", "د: النحاس"], answer: "ج: الألومنيوم" },
                { question: "اللون الناتج عن خلط الأحمر والأصفر؟", options: ["أ: الأخضر", "ب: البرتقالي", "ج: البنفسجي", "د: البني"], answer: "ب: البرتقالي" },
                { question: "وحدة قياس التيار الكهربائي؟", options: ["أ: فولت", "ب: أمبير", "ج: واط", "د: أوم"], answer: "ب: أمبير" },
                { question: "من اكتشف أمريكا عام 1492؟", options: ["أ: فرناندو ماجلان", "ب: كريستوفر كولومبوس", "ج: ليوناردو دافنشي", "د: فاسكو دا غاما"], answer: "ب: كريستوفر كولومبوس" },
                // 10
                { question: "الحيوان المعروف بـ 'سفينة الصحراء'؟", options: ["أ: الحصان", "ب: الجمل", "ج: البقرة", "د: الفيل"], answer: "ب: الجمل" },
                { question: "الكوكب الأحمر؟", options: ["أ: الأرض", "ب: المريخ", "ج: الزهرة", "د: زحل"], answer: "ب: المريخ" },
                { question: "أكبر محيط في العالم؟", options: ["أ: الأطلسي", "ب: الهادئ", "ج: الهندي", "د: المتجمد الشمالي"], answer: "ب: الهادئ" },
                { question: "أي من الأرقام عدد أولي؟", options: ["أ: 4", "ب: 9", "ج: 17", "د: 21"], answer: "ج: 17" },
                { question: "الحيوان الوطني للصين؟", options: ["أ: النمر", "ب: الباندا", "ج: التنين", "د: الفهد"], answer: "ب: الباندا" },
                // 15
                { question: "الغاز الذي نتنفسه؟", options: ["أ: الأكسجين", "ب: ثاني أكسيد الكربون", "ج: النيتروجين", "د: الهيليوم"], answer: "أ: الأكسجين" },
                { question: "ما هو أطول نهر في السعودية؟", options: ["أ: وادي الرمة", "ب: وادي حنيفة", "ج: وادي الدواسر", "د: وادي فاطمة"], answer: "أ: وادي الرمة" },
                { question: "ما هي الرياضة التي تستخدم فيها المضرب والكرة الصفراء؟", options: ["أ: كرة القدم", "ب: التنس", "ج: كرة السلة", "د: الجولف"], answer: "ب: التنس" },
                { question: "أكبر عضو في جسم الإنسان؟", options: ["أ: الكبد", "ب: الجلد", "ج: القلب", "د: المخ"], answer: "ب: الجلد" },
                { question: "العنصر الكيميائي الذي يرمز له بـ H؟", options: ["أ: الهيليوم", "ب: الهيدروجين", "ج: الحديد", "د: الهيدرا"], answer: "ب: الهيدروجين" },
                // 20
                { question: "أسرع حيوان بري؟", options: ["أ: الحصان", "ب: الفهد", "ج: الغزال", "د: الأسد"], answer: "ب: الفهد" },
                { question: "الدولة ذات أكبر عدد سكان؟", options: ["أ: الهند", "ب: الصين", "ج: الولايات المتحدة", "د: روسيا"], answer: "أ: الهند" },
                { question: "البحر الذي يفصل بين السعودية ومصر؟", options: ["أ: البحر الأحمر", "ب: البحر الأبيض", "ج: بحر العرب", "د: خليج عمان"], answer: "أ: البحر الأحمر" },
                { question: "أصغر كوكب من بين التالي؟", options: ["أ: عطارد", "ب: الزهرة", "ج: الأرض", "د: المريخ"], answer: "أ: عطارد" },
                { question: "ما هو الحيوان الذي ينام وعيناه مفتوحتان؟", options: ["أ: الأسد", "ب: الدولفين", "ج: القط", "د: الحصان"], answer: "ب: الدولفين" },
                // 25
                { question: "أصل القهوة؟", options: ["أ: البرازيل", "ب: إثيوبيا", "ج: اليمن", "د: كولومبيا"], answer: "ب: إثيوبيا" },
                { question: "أي من هذه الألوان أساسي؟", options: ["أ: البرتقالي", "ب: البنفسجي", "ج: الأحمر", "د: الأخضر"], answer: "ج: الأحمر" },
                { question: "من اكتشف الجاذبية؟", options: ["أ: نيوتن", "ب: أينشتاين", "ج: كوبرنيكوس", "د: غاليليو"], answer: "أ: نيوتن" },
                { question: "أي من هذه الدول في قارة أفريقيا؟", options: ["أ: كندا", "ب: نيجيريا", "ج: اليابان", "د: المكسيك"], answer: "ب: نيجيريا" },
                { question: "أكبر بحيرة من حيث المساحة؟", options: ["أ: بحيرة فيكتوريا", "ب: بحيرة تاهو", "ج: بحيرة ميشيغان", "د: بحيرة سوبيريور"], answer: "د: بحيرة سوبيريور" }
            ];
            
            const MEDIUM_QUESTIONS_SET1 = [
                { question: "ما هو الحيوان الذي يستخرج منه المسك؟", options: ["أ: الأسد", "ب: الغزال", "ج: الفيل", "د: الحوت"], answer: "ب: الغزال" }, 
                { question: "الكوكب صاحب أكبر عدد من الأقمار (المكتشفة)؟", options: ["أ: زحل", "ب: المشتري", "ج: أورانوس", "د: نبتون"], answer: "أ: زحل" },
                { question: "بداية الحرب العالمية الثانية؟", options: ["أ: 1935", "ب: 1939", "ج: 1941", "د: 1945"], answer: "ب: 1939" },
                { question: "ما هو الغاز المستخدم عادة في إطفاء الحرائق؟", options: ["أ: الأكسجين", "ب: الهيدروجين", "ج: ثاني أكسيد الكربون", "د: النيتروجين"], answer: "ج: ثاني أكسيد الكربون" },
                { question: "كم عدد حجرات القلب في جسم الإنسان السليم؟", options: ["أ: 2", "ب: 3", "ج: 4", "د: 5"], answer: "ج: 4" },
                // 5
                { question: "أول من صعد القمر؟", options: ["أ: نيل أرمسترونغ", "ب: يوري غاغارين", "ج: باز ألدرين", "د: مايكل كولينز"], answer: "أ: نيل أرمسترونغ" },
                { question: "الكتاب المقدس للديانة اليهودية؟", options: ["أ: الإنجيل", "ب: التوراة", "ج: القرآن", "د: الفيدا"], answer: "ب: التوراة" },
                { question: "أي من هذه الدول ليست عضوًا في الاتحاد الأوروبي؟", options: ["أ: فرنسا", "ب: النرويج", "ج: إيطاليا", "د: إسبانيا"], answer: "ب: النرويج" },
                { question: "ما هي الدولة التي تعتبر أكبر منتج للبن في العالم؟", options: ["أ: كولومبيا", "ب: فيتنام", "ج: البرازيل", "د: إثيوبيا"], answer: "ج: البرازيل" },
                { question: "ما هي الوحدة المستخدمة لقياس شدة الصوت؟", options: ["أ: فولت", "ب: ديسيبل", "ج: واط", "د: هرتز"], answer: "ب: ديسيبل" },
                // 10
                { question: "الغاز الأكثر وفرة في الغلاف الجوي؟", options: ["أ: الأكسجين", "ب: النيتروجين", "ج: ثاني أكسيد الكربون", "د: الهيليوم"], answer: "ب: النيتروجين" },
                { question: "أي البحيرات مالحة؟", options: ["أ: بحيرة فيكتوريا", "ب: البحر الميت", "ج: بحيرة سوبيريور", "د: بحيرة تانغانيقا"], answer: "ب: البحر الميت" },
                { question: "ما هي أعلى عاصمة في العالم؟", options: ["أ: لاباز (بوليفيا)", "ب: كيتو (الإكوادور)", "ج: بوغوتا (كولومبيا)", "د: أديس أبابا (إثيوبيا)"], answer: "أ: لاباز (بوليفيا)" },
                { question: "أكبر صحراء *حارة* في العالم؟", options: ["أ: صحراء غوبي", "ب: الصحراء الكبرى", "ج: صحراء كالاهاري", "د: صحراء أتاكاما"], answer: "ب: الصحراء الكبرى" }, 
                { question: "الدولة ذات أطول ساحل بحري؟", options: ["أ: كندا", "ب: أستراليا", "ج: البرازيل", "د: روسيا"], answer: "أ: كندا" },
                // 15
                { question: "العضو الذي يفرز الأنسولين؟", options: ["أ: الكبد", "ب: البنكرياس", "ج: الطحال", "د: المعدة"], answer: "ب: البنكرياس" },
                { question: "الحشرة الأكثر خطورة على الإنسان؟", options: ["أ: الفراشة", "ب: النحل", "ج: البعوض", "د: الخنفساء"], answer: "ج: البعوض" },
                { question: "من وضع قوانين الحركة الثلاثة؟", options: ["أ: أينشتاين", "ب: نيوتن", "ج: جاليليو", "د: هيغنز"], answer: "ب: نيوتن" },
                { question: "أي من هذه المدن ليست عاصمة دولة عربية؟", options: ["أ: الرياض", "ب: عمان", "ج: بغداد", "د: إسطنبول"], answer: "د: إسطنبول" },
                { question: "أي من الكائنات الحية التالية يتنفس عن طريق الجلد؟", options: ["أ: الضفدع", "ب: السمكة", "ج: السلحفاة", "د: الثعبان"], answer: "أ: الضفدع" },
                // 20
                { question: "العنصر الأكثر وفرة في جسم الإنسان؟", options: ["أ: الحديد", "ب: الكالسيوم", "ج: الأكسجين", "د: البوتاسيوم"], answer: "ج: الأكسجين" },
                { question: "ما هو الاسم القديم لمدينة إسطنبول؟", options: ["أ: القسطنطينية", "ب: بيزنطة", "ج: أنقرة", "د: نيقية"], answer: "أ: القسطنطينية" },
                { question: "أي كوكب عملاق غازي؟", options: ["أ: عطارد", "ب: المريخ", "ج: المشتري", "د: الزهرة"], answer: "ج: المشتري" },
                { question: "أصغر قارة في العالم؟", options: ["أ: آسيا", "ب: أفريقيا", "ج: أستراليا", "د: أوروبا"], answer: "ج: أستراليا" },
                { question: "ما هي الدولة التي نظمت كأس العالم 2022؟", options: ["أ: روسيا", "ب: البرازيل", "ج: قطر", "د: فرنسا"], answer: "ج: قطر" },
                // 25
                { question: "مكتشف الكهرباء (التجارب الأساسية)؟", options: ["أ: توماس إديسون", "ب: بنيامين فرانكلين", "ج: ألكسندر غراهام بيل", "د: نيكولا تسلا"], answer: "ب: بنيامين فرانكلين" },
                { question: "البحر بين السعودية وإيران؟", options: ["أ: البحر الأحمر", "ب: الخليج العربي", "ج: بحر العرب", "د: بحر قزوين"], answer: "ب: الخليج العربي" },
                { question: "الدولة ذات أطول عمر متوسط؟", options: ["أ: اليابان", "ب: الهند", "ج: مصر", "د: نيجيريا"], answer: "أ: اليابان" },
                { question: "صاحب نظرية النسبية؟", options: ["أ: نيوتن", "ب: أينشتاين", "ج: غاليليو", "د: ماكس بلانك"], answer: "ب: أينشتاين" },
                { question: "ما هو الاسم الذي كان يطلق على المحيط الأطلسي قديماً؟", options: ["أ: بحر الروم", "ب: بحر القلزم", "ج: بحر الظلمات", "د: البحر المحيط"], answer: "ج: بحر الظلمات" }
            ];

            const HARD_QUESTIONS_SET1 = [
                { question: "من هو العالم المسلم الذي اكتشف الدورة الدموية الصغرى؟", options: ["أ: ابن سينا", "ب: ابن النفيس", "ج: الرازي", "د: الزهراوي"], answer: "ب: ابن النفيس" },
                { question: "أول من وضع نموذج الذرة الحديث؟", options: ["أ: نيوتن", "ب: دالتون", "ج: بور", "د: رذرفورد"], answer: "ب: دالتون" },
                { question: "أعمق بحيرة في العالم؟", options: ["أ: بحيرة فيكتوريا", "ب: بحيرة بايكال", "ج: بحيرة تاهو", "د: بحيرة سوبيريور"], answer: "ب: بحيرة بايكال" },
                { question: "سقوط جدار برلين؟", options: ["أ: 1985", "ب: 1987", "ج: 1989", "د: 1991"], answer: "ج: 1989" },
                { question: "مؤسس الدولة العباسية؟", options: ["أ: هارون الرشيد", "ب: أبي العباس السفاح", "ج: المعتصم", "د: المأمون"], answer: "ب: أبي العباس السفاح" },
                // 5
                { question: "العنصر الكيميائي الذي رمزه 'Au'؟", options: ["أ: الفضة", "ب: الألومنيوم", "ج: الذهب", "د: الزنك"], answer: "ج: الذهب" },
                { question: "من هو القائد المسلم الذي فتح جزيرة صقلية؟", options: ["أ: طارق بن زياد", "ب: موسى بن نصير", "ج: أسد بن الفرات", "د: عقبة بن نافع"], answer: "ج: أسد بن الفرات" },
                { question: "في أي عام تأسست منظمة الأمم المتحدة؟", options: ["أ: 1944", "ب: 1945", "ج: 1946", "د: 1948"], answer: "ب: 1945" },
                { question: "أكبر كوكب قزم؟", options: ["أ: سيريس", "ب: بلوتو", "ج: هياومي", "د: إيريس"], answer: "د: إيريس" },
                { question: "أول دورة أولمبية حديثة؟", options: ["أ: باريس", "ب: أثينا", "ج: لندن", "د: روما"], answer: "ب: أثينا" },
                // 10
                { question: "ما هي العملة التي كانت متداولة في معظم دول الخليج قبل صدور العملات الوطنية؟", options: ["أ: الدينار الأموي", "ب: الروبية الخليجية", "ج: القرش الهاشمي", "د: الليرة العثمانية"], answer: "ب: الروبية الخليجية" },
                { question: "نهر يمر عبر روسيا؟", options: ["أ: نهر الفولغا", "ب: نهر النيل", "ج: نهر الميسيسيبي", "د: نهر الأمازون"], answer: "أ: نهر الفولغا" },
                { question: "ما هي أول جامعة تأسست في المملكة العربية السعودية؟", options: ["أ: جامعة الملك فيصل", "ب: جامعة الملك سعود", "ج: جامعة أم القرى", "د: الجامعة الإسلامية"], answer: "ب: جامعة الملك سعود" },
                { question: "من هو الروائي الفرنسي مؤلف رواية 'البؤساء'؟", options: ["أ: موليير", "ب: فيكتور هوجو", "ج: فولتير", "د: بلزاك"], answer: "ب: فيكتور هوجو" },
                { question: "من هو العالم المسلم الذي يُلقب بـ 'أبو الجبر'؟", options: ["أ: جابر بن حيان", "ب: الخوارزمي", "ج: البيروني", "د: الفارابي"], answer: "ب: الخوارزمي" }, 
                // 15
                { question: "ما هو العنصر الكيميائي الذي يُرمز له بالرمز (Hg)؟", options: ["أ: الفضة", "ب: الزئبق", "ج: الهيدروجين", "د: المغنيسيوم"], answer: "ب: الزئبق" },
                { question: "مكتشف البنسلين؟", options: ["أ: ألكسندر فليمنج", "ب: لويس باستور", "ج: إديسون", "د: ماركو بولو"], answer: "أ: ألكسندر فليمنج" },
                { question: "أي من هذه الدول ليست في أمريكا الجنوبية؟", options: ["أ: البرازيل", "ب: الأرجنتين", "ج: بيرو", "د: بنما"], answer: "د: بنما" },
                { question: "أكبر كوكب داخلي صخري؟", options: ["أ: عطارد", "ب: الزهرة", "ج: الأرض", "د: المريخ"], answer: "ج: الأرض" },
                { question: "ما هو العنصر الكيميائي الأكثر شيوعاً في الكون؟", options: ["أ: الأكسجين", "ب: الهيليوم", "ج: الهيدروجين", "د: الكربون"], answer: "ج: الهيدروجين" },
                // 20
                { question: "ما هي المدينة التي كانت عاصمة للدولة الأموية؟", options: ["أ: بغداد", "ب: دمشق", "ج: المدينة المنورة", "د: الكوفة"], answer: "ب: دمشق" },
                { question: "أول من رسم الخريطة الكونية للنجوم؟", options: ["أ: بطليموس", "ب: نيوتن", "ج: جاليليو", "د: كوبرنيكوس"], answer: "أ: بطليموس" },
                { question: "بحيرة على حدود أفريقية وآسيوية؟", options: ["أ: بحيرة تانا", "ب: بحيرة طبريا", "ج: بحيرة فيكتوريا", "د: البحر الميت"], answer: "د: البحر الميت" },
                { question: "من هي الملكة الفرعونية التي بنت معبد الدير البحري؟", options: ["أ: كليوباترا", "ب: نفرتيتي", "ج: حتشبسوت", "د: نفرتاري"], answer: "ج: حتشبسوت" },
                { question: "القارة المعروفة سابقًا بـ 'أرض النار'؟", options: ["أ: أمريكا الجنوبية", "ب: أستراليا", "ج: القارة القطبية الجنوبية", "د: أفريقيا"], answer: "أ: أمريكا الجنوبية" },
                // 25
                { question: "كم عدد فقرات العمود الفقري في جسم الإنسان؟", options: ["أ: 24", "ب: 33", "ج: 30", "د: 28"], answer: "ب: 33" },
                { question: "أي حدث جاء أولًا؟", options: ["أ: الثورة الفرنسية", "ب: الثورة الأمريكية", "ج: الحرب العالمية الأولى", "د: الحرب العالمية الثانية"], answer: "ب: الثورة الأمريكية" },
                { question: "أي من هذه العواصم على خط الاستواء؟", options: ["أ: نيروبي (كينيا)", "ب: القاهرة (مصر)", "ج: باريس (فرنسا)", "د: طوكيو (اليابان)"], answer: "أ: نيروبي (كينيا)" },
                { question: "أي دولة لا تطل على البحر؟", options: ["أ: السويد", "ب: سويسرا", "ج: إيطاليا", "د: النرويج"], answer: "ب: سويسرا" },
                { question: "الكوكب الحار (الأكثر سخونة)؟", options: ["أ: المريخ", "ب: الزهرة", "ج: عطارد", "د: المشتري"], answer: "ب: الزهرة" }
            ];

            // --- (جديد) بنك الأسئلة - المجموعة 2 (الجديدة) ---
            
            const EASY_QUESTIONS_SET2 = [
                { question: "ما هي أكبر قارة في العالم؟", options: ["أ: إفريقيا", "ب: آسيا", "ج: أوروبا", "د: أمريكا"], answer: "ب: آسيا" },
                { question: "ما هو الغاز الرئيسي في الغلاف الجوي للأرض؟", options: ["أ: الأكسجين", "ب: ثاني أكسيد الكربون", "ج: النيتروجين", "د: الهيدروجين"], answer: "ج: النيتروجين" },
                { question: "ما هو اسم الشركة المطورة لنظام التشغيل أندرويد؟", options: ["أ: مايكروسوفت", "ب: جوجل", "ج: أبل", "د: IBM"], answer: "ب: جوجل" },
                { question: "ما هو أقرب نجم إلى الأرض؟", options: ["أ: الشعرى اليمانية", "ب: الشمس", "ج: سهيل", "د: القطب"], answer: "ب: الشمس" },
                { question: " من الصحابي أصدق الأمة حياء؟", options: ["أ:  أبو بكر الصديق", "ب: علي بن أبي طالب", "ج: عثمان بن عفان", "د: عمر بن الخطاب"], answer: "ج: عثمان بن عفان" },
                // 5
                { question: "أي من هذه الدول تقع في قارة أوروبا؟", options: ["أ: مصر", "ب: ألمانيا", "ج: نيجيريا", "د: الهند"], answer: "ب: ألمانيا" },
                { question: "أي من هذه الألوان يندرج تحت الألوان الأساسية؟", options: ["أ: برتقالي", "ب: أزرق", "ج: أخضر", "د: بنفسجي"], answer: "ب: أزرق" },
                { question: "من هو أول رئيس للولايات المتحدة الأمريكية؟", options: ["أ: لينكولن", "ب: جورج واشنطن", "ج: روزفلت", "د: كينيدي"], answer: "ب: جورج واشنطن" },
                { question: "كم عدد حلقات شعار الألعاب الأولمبية؟", options: ["أ: 4", "ب: 5", "ج: 6", "د: 7"], answer: "ب: 5" },
                { question: "ما هي عاصمة لبنان؟", options: ["أ: دمشق", "ب: بيروت", "ج: عمان", "د: بغداد"], answer: "ب: بيروت" },
                // 10
                { question: "أي من هذه الدول تقع على خط الاستواء؟", options: ["أ: كينيا", "ب: مصر", "ج: فرنسا", "د: اليابان"], answer: "أ: كينيا" },
                { question: "ما هو الفيتامين الذي ينتجه الجسم عند التعرض لأشعة الشمس؟", options: ["أ: فيتامين C", "ب: فيتامين D", "ج: فيتامين A", "د: فيتامين B"], answer: "ب: فيتامين D" },
                { question: "أي من هذه القارات ليست مأهولة بالسكان بشكل رئيسي؟", options: ["أ: أفريقيا", "ب: أستراليا", "ج: أنتاركتيكا", "د: آسيا"], answer: "ج: أنتاركتيكا" },
                { question: "ما هو الطائر الذي يضع أكبر بيضة في العالم؟", options: ["أ: النسر", "ب: النعامة", "ج: البطريق", "د: الطاووس"], answer: "ب: النعامة" },
                { question: "أي من هذه الأعداد أولي؟", options: ["أ: 21", "ب: 31", "ج: 27", "د: 35"], answer: "ب: 31" },
                // 15
                { question: "أي من هذه الدول ليس لديها سواحل بحرية؟", options: ["أ: سويسرا", "ب: السويد", "ج: النرويج", "د: إيطاليا"], answer: "أ: سويسرا" },
                { question: "ما هو الجزء الملون في عين الإنسان؟", options: ["أ: القرنية", "ب: القزحية", "ج: الشبكية", "د: العدسة"], answer: "ب: القزحية" },
                { question: "أي من هذه الحيوانات يُعرف بأنه أكبر حيوان بري؟", options: ["أ: الحوت الأزرق", "ب: الفيل", "ج: الزرافة", "د: وحيد القرن"], answer: "ب: الفيل" },
                { question: "ما هي العملة الرسمية للمملكة المتحدة (بريطانيا)؟", options: ["أ: اليورو", "ب: الجنيه الإسترليني", "ج: الدولار", "د: الفرنك"], answer: "ب: الجنيه الإسترليني" },
                { question: "أي من هذه الدول تقع في شمال إفريقيا؟", options: ["أ: مصر", "ب: نيجيريا", "ج: كينيا", "د: إثيوبيا"], answer: "أ: مصر" },
                // 20
                { question: "أي من هذه الألوان هو لون ثانوي؟", options: ["أ: أحمر", "ب: أخضر", "ج: أزرق", "د: أصفر"], answer: "ب: أخضر" },
                { question: "ما هو أعلى جبل في العالم؟", options: ["أ: إيفرست", "ب: كليمنجارو", "ج: مونت بلانك", "د: أكونكاجوا"], answer: "أ: إيفرست" },
                { question: "أي من هذه الدول تتبع قارة أمريكا الجنوبية؟", options: ["أ: كندا", "ب: البرازيل", "ج: المكسيك", "د: الولايات المتحدة"], answer: "ب: البرازيل" },
                { question: "من هو العالم الذي اخترع المصباح الكهربائي؟", options: ["أ: تسلا", "ب: أينشتاين", "ج: إديسون", "د: جراهام بيل"], answer: "ج: إديسون" },
                { question: "من هو الصحابي الذي لُقب بـ 'سيف الله المسلول'؟", options: ["أ: عمر بن الخطاب", "ب: خالد بن الوليد", "ج: علي بن أبي طالب", "د: حمزة بن عبد المطلب"], answer: "ب: خالد بن الوليد" },
                // 25
                { question: "كم عدد أرجل العنكبوت؟", options: ["أ: 6", "ب: 8", "ج: 10", "د: 12"], answer: "ب: 8" },
                { question: "ما هي أكبر دولة في العالم من حيث المساحة؟", options: ["أ: الصين", "ب: الولايات المتحدة", "ج: روسيا", "د: كندا"], answer: "ج: روسيا" },
                { question: "ما هي وحدة قياس شدة الصوت؟", options: ["أ: الفولت", "ب: الديسيبل", "ج: الواط", "د: الهيرتز"], answer: "ب: الديسيبل" },
                { question: "أي من هذه الكواكب يُعرف بالكوكب العملاق؟", options: ["أ: عطارد", "ب: المشتري", "ج: المريخ", "د: الزهرة"], answer: "ب: المشتري" },
                { question: "أي من هذه القارات تحتوي على أكبر عدد من الدول؟", options: ["أ: آسيا", "ب: أفريقيا", "ج: أوروبا", "د: أمريكا"], answer: "ب: أفريقيا" }
            ];

            const MEDIUM_QUESTIONS_SET2 = [
                { question: "أي من هذه البحيرات تقع في إفريقيا؟", options: ["أ: بحيرة ميشيغان", "ب: بحيرة فيكتوريا", "ج: بحيرة بايكال", "د: بحيرة تاهو"], answer: "ب: بحيرة فيكتوريا" },
                { question: "أي من هذه الدول تملك أكبر احتياطي نفطي؟", options: ["أ: السعودية", "ب: كندا", "ج: الولايات المتحدة", "د: نيجيريا"], answer: "أ: السعودية" },
                { question: "ما هو أصغر محيط في العالم؟", options: ["أ: المحيط الأطلسي", "ب: المحيط الهندي", "ج: المحيط المتجمد الشمالي", "د: المحيط الهادئ"], answer: "ج: المحيط المتجمد الشمالي" },
                { question: "أي من هذه الدول تقع في قارة آسيا؟", options: ["أ: النرويج", "ب: اليابان", "ج: مصر", "د: كندا"], answer: "ب: اليابان" },
                { question: "أي من هذه الظواهر طبيعية تحدث عند تلاقي صفيحة أرضية مع أخرى؟", options: ["أ: الزلازل", "ب: الأعاصير", "ج: الفيضانات", "د: الجفاف"], answer: "أ: الزلازل" },
                // 5
                { question: "أي من هذه الدول أكبر مساحةً؟", options: ["أ: كندا", "ب: مصر", "ج: فرنسا", "د: إيطاليا"], answer: "أ: كندا" },
                { question: "ما حروف القلقلة؟", options: ["أ: ي، ر، م، ل، و، ن", "ب: ق، ط، ب، ج، د", "ج: خ، ص، ض، غ، ط، ق، ظ", "د: أ، ب، ج، د، هـ"], answer: "ب: ق، ط، ب، ج، د" },
                { question: "أي من هذه العناصر الكيميائية يُستخدم في تصنيع الزجاج؟", options: ["أ: السيليكون", "ب: الحديد", "ج: الذهب", "د: الفضة"], answer: "أ: السيليكون" },
                { question: "أي من هذه الدول تطل على البحر الأبيض المتوسط؟", options: ["أ: تركيا", "ب: بولندا", "ج: كازاخستان", "د: اليابان"], answer: "أ: تركيا" },
                { question: "ما هو أطول عظم في جسم الإنسان؟", options: ["أ: العضد", "ب: الفخذ", "ج: الساق", "د: الضلع"], answer: "ب: الفخذ" },
                // 10
                { question: "ما معنى اسم درويش؟", options: ["أ: الغني", "ب: الحكيم", "ج: الفقير", "د: الأمير"], answer: "ج: الفقير" },
                { question: "أي من هذه الظواهر الطبيعية يحدث بسبب حرارة الأرض؟", options: ["أ: الزلازل", "ب: البراكين", "ج: الأعاصير", "د: الفيضانات"], answer: "ب: البراكين" },
                { question: "أي من هذه البحيرات تقع في أمريكا الشمالية؟", options: ["أ: بحيرة تاهو", "ب: بحيرة فيكتوريا", "ج: بحيرة بايكال", "د: بحيرة كومو"], answer: "أ: بحيرة تاهو" },
                { question: "أي من هذه الدول تقع على خط الاستواء؟", options: ["أ: البرازيل", "ب: كندا", "ج: روسيا", "د: أيسلندا"], answer: "أ: البرازيل" },
                { question: "أي من هذه الظواهر تحدث بسبب دوران الأرض؟", options: ["أ: الليل والنهار", "ب: المد والجزر", "ج: الزلازل", "د: الفيضانات"], answer: "أ: الليل والنهار" },
                // 15
                { question: "ما هو أسرع كائن حي في الماء؟", options: ["أ: سمكة التونة", "ب: الدولفين", "ج: القرش الأبيض", "د: الأخطبوط"], answer: "أ: سمكة التونة" },
                { question: "أي من هذه القارات تحتوي على أكبر عدد من السكان المسلمين؟", options: ["أ: آسيا", "ب: أوروبا", "ج: أمريكا", "د: أفريقيا"], answer: "أ: آسيا" },
                { question: "أي من هذه الدول تعتبر جزيرة؟", options: ["أ: إيطاليا", "ب: أيسلندا", "ج: بولندا", "د: الهند"], answer: "ب: أيسلندا" },
                { question: "أي من هذه الدول تقع في قارة أوقيانوسيا؟", options: ["أ: أستراليا", "ب: كندا", "ج: مصر", "د: اليابان"], answer: "أ: أستراليا" },
                { question: "أي من هذه العناصر يُعد غازاً نبيلًا؟", options: ["أ: الأكسجين", "ب: الهيليوم", "ج: الهيدروجين", "د: الكربون"], answer: "ب: الهيليوم" },
                // 20
                { question: "ما هي عاصمة إندونيسيا؟", options: ["أ: كوالالمبور", "ب: جاكرتا", "ج: مانيلا", "د: بانكوك"], answer: "ب: جاكرتا" },
                { question: "أي من هذه الظواهر الطبيعية تحدث عند ارتفاع حرارة المحيطات؟", options: ["أ: الأعاصير", "ب: الزلازل", "ج: البراكين", "د: الانهيارات الأرضية"], answer: "أ: الأعاصير" },
                { question: "كم عدد أجنحة النحلة؟", options: ["أ: 2", "ب: 4", "ج: 6", "د: 8"], answer: "ب: 4" },
                { question: "أي من هذه الدول تطل على البحر الأحمر؟", options: ["أ: السعودية", "ب: المغرب", "ج: تركيا", "د: كندا"], answer: "أ: السعودية" },
                { question: "أي من هذه الظواهر تحدث بسبب ضغط الغلاف الجوي؟", options: ["أ: الرياح", "ب: الزلازل", "ج: البراكين", "د: الأعاصير"], answer: "أ: الرياح" },
                // 25
                { question: "ماذا يعني الاختصار 'WWW' في عناوين الإنترنت؟", options: ["أ: الشبكة العنكبوتية العالمية", "ب: شبكة المعلومات", "ج: الانترنت السريع", "د: التواصل العالمي"], answer: "أ: الشبكة العنكبوتية العالمية" },
                { question: "أي من هذه الدول تقع في أمريكا الجنوبية؟", options: ["أ: البرازيل", "ب: كندا", "ج: نيجيريا", "د: أستراليا"], answer: "أ: البرازيل" },
                { question: "كم دامت فترة الخلافة الراشدة؟", options: ["أ: 20 عاماً", "ب: 30 عاماً", "ج: 40 عاماً", "د: 50 عاماً"], answer: "ب: 30 عاماً" },
                { question: "ما هو المضيق الذي يفصل بين قارتي آسيا وأمريكا الشمالية؟", options: ["أ: مضيق هرمز", "ب: مضيق جبل طارق", "ج: مضيق بيرينغ", "د: مضيق البوسفور"], answer: "ج: مضيق بيرينغ" },
                { question: "أي من هذه الدول لا تقع في قارة آسيا؟", options: ["أ: الهند", "ب: اليابان", "ج: مصر", "د: الصين"], answer: "ج: مصر" }
            ];

            const HARD_QUESTIONS_SET2 = [
                { question: "أي من هذه الجبال تعد أعلى قمة في إفريقيا؟", options: ["أ: كليمنجارو", "ب: إيفرست", "ج: أكونكاجوا", "د: مونت بلانك"], answer: "أ: كليمنجارو" },
                { question: "كم يبلغ فرق التوقيت بين خط غرينتش ومكة المكرمة؟", options: ["أ: +2 ساعة", "ب: +3 ساعات", "ج: +4 ساعات", "د: +5 ساعات"], answer: "ب: +3 ساعات" },
                { question: "أي من هذه الظواهر الطبيعية يمكن أن تسبب موجات مدية كبيرة؟", options: ["أ: الأعاصير", "ب: الزلازل", "ج: البراكين", "د: الجفاف"], answer: "أ: الأعاصير" },
                { question: "أي من هذه الدول تقع بالكامل في نصف الكرة الشمالي؟", options: ["أ: البرازيل", "ب: النرويج", "ج: أستراليا", "د: جنوب أفريقيا"], answer: "ب: النرويج" },
                { question: "أي كوكب في مجموعتنا الشمسية 'يومه أطول من سنته' (يدور حول نفسه ببطء شديد)؟", options: ["أ: عطارد", "ب: المريخ", "ج: الزهرة", "د: نبتون"], answer: "ج: الزهرة" },
                // 5
                { question: "أي من هذه الدول تقع على مضيق جبل طارق؟", options: ["أ: المغرب", "ب: إيطاليا", "ج: تركيا", "د: مصر"], answer: "أ: المغرب" },
                { question: "أين يقع المقر الرئيسي لمحكمة العدل الدولية؟", options: ["أ: جنيف", "ب: نيويورك", "ج: لاهاي", "د: باريس"], answer: "ج: لاهاي" },
                { question: "أي دولة تملك أكبر احتياطي مؤكد من الغاز الطبيعي في العالم؟", options: ["أ: قطر", "ب: إيران", "ج: روسيا", "د: الولايات المتحدة"], answer: "ج: روسيا" },
                { question: "في أي عام هجري تم إعلان توحيد المملكة العربية السعودية؟", options: ["أ: 1351 هـ", "ب: 1319 هـ", "ج: 1344 هـ", "د: 1354 هـ"], answer: "أ: 1351 هـ" },
                { question: "في أي مدينة يقع المقر الرئيسي لمنظمة اليونسكو؟", options: ["أ: جنيف", "ب: باريس", "ج: نيويورك", "د: فيينا"], answer: "ب: باريس" },
                // 10
                { question: "من هو مؤلف معجم 'لسان العرب'؟", options: ["أ: ابن خلدون", "ب: ابن منظور", "ج: الفراهيدي", "د: الجوهري"], answer: "ب: ابن منظور" },
                { question: "أي من هذه القارات بها أكبر صحراء؟", options: ["أ: أفريقيا", "ب: آسيا", "ج: أمريكا", "د: أوروبا"], answer: "أ: أفريقيا" },
                { question: "أي من هذه الدول تقع في قارة أمريكا الشمالية؟", options: ["أ: المكسيك", "ب: الأرجنتين", "ج: كولومبيا", "د: البرازيل"], answer: "أ: المكسيك" },
                { question: "أي من هذه الدول ليس لديها حدود بحرية؟", options: ["أ: تشاد", "ب: نيجيريا", "ج: مصر", "د: كندا"], answer: "أ: تشاد" },
                { question: "كم عدد بحور الشعر؟", options: ["أ: 16 ", "ب: 12", "ج: 10", "د: 7"], answer: "أ: 16 " },
                // 15
                { question: "أي من هذه الأنهار يقع في آسيا؟", options: ["أ: نهر اليانغتسي", "ب: نهر الأمازون", "ج: نهر الميسيسيبي", "د: نهر النيل"], answer: "أ: نهر اليانغتسي" },
                { question: "أي من هذه الدول تقع على البحر الكاريبي؟", options: ["أ: كوبا", "ب: البرازيل", "ج: الأرجنتين", "د: كندا"], answer: "أ: كوبا" },
                { question: "أي من هذه الجبال تقع في أمريكا الجنوبية؟", options: ["أ: الأنديز", "ب: الألب", "ج: الهملايا", "د: الروكي"], answer: "أ: الأنديز" },
                { question: "أي من هذه البحيرات تقع في روسيا؟", options: ["أ: بحيرة بايكال", "ب: بحيرة فيكتوريا", "ج: بحيرة تاهو", "د: بحيرة ميشيغان"], answer: "أ: بحيرة بايكال" },
                { question: "أي من هذه الدول تمتلك أكبر عدد من البراكين النشطة؟", options: ["أ: اليابان", "ب: روسيا", "ج: الولايات المتحدة", "د: إيطاليا"], answer: "أ: اليابان" },
                // 20
                { question: "ما هو الجهاز المستخدم لقياس شدة الزلازل؟", options: ["أ: البارومتر", "ب: السيسموغراف", "ج: الثيرمومتر", "د: الأنيمومتر"], answer: "ب: السيسموغراف" },
                { question: "أي من هذه الدول لديها أكبر صحراء ملحية في العالم؟", options: ["أ: بوليفيا", "ب: السعودية", "ج: مصر", "د: أستراليا"], answer: "أ: بوليفيا" },
                { question: "ما هو اسم المضيق الذي يصل بين البحر الأحمر وخليج عدن؟", options: ["أ: مضيق هرمز", "ب: مضيق جبل طارق", "ج: مضيق باب المندب", "د: قناة السويس"], answer: "ج: مضيق باب المندب" },
                { question: "أي من هذه الدول تتشارك حدودًا مع فرنسا؟", options: ["أ: ألمانيا", "ب: النرويج", "ج: بولندا", "د: أيسلندا"], answer: "أ: ألمانيا" },
                { question: "أي من هذه الظواهر الطبيعية تُسبب تساقط الأمطار الغزيرة؟", options: ["أ: الأعاصير", "ب: الزلازل", "ج: البراكين", "د: الانهيارات الأرضية"], answer: "أ: الأعاصير" },
                // 25
                { question: "ما هي الدولة الأوروبية التي تُلقب بـ 'أرض الألف بحيرة'؟", options: ["أ: السويد", "ب: النرويج", "ج: فنلندا", "د: الدنمارك"], answer: "ج: فنلندا" },
                { question: "أي من هذه الأنهار يُعد أطول نهر في آسيا؟", options: ["أ: نهر اليانغتسي", "ب: نهر الميسيسيبي", "ج: نهر النيل", "د: نهر الأمازون"], answer: "أ: نهر اليانغتسي" },
                { question: "ما هي أكبر جزيرة في البحر الأبيض المتوسط؟", options: ["أ: قبرص", "ب: صقلية", "ج: كريت", "د: مالطا"], answer: "ب: صقلية" },
                { question: "ما هو العنصر المستخدم في صناعة أقلام الرصاص؟", options: ["أ: الرصاص", "ب: الجرافيت", "ج: الفحم", "د: الحديد"], answer: "ب: الجرافيت" },
                { question: "ما هي الدولة التي تشتهر بزراعة التوليب (الخزامى)؟", options: ["أ: فرنسا", "ب: هولندا", "ج: تركيا", "د: اليابان"], answer: "ب: هولندا" }
            ];

            
            // (تعديل) بناء 4 جولات (Ladders) - كل جولة تحتوي 3 سلالم (بنوك)
            const GAME_SETS = [
                // الجولة 1 (القديمة)
                [
                    // السلم 1.1 (للفريق أ)
                    [...EASY_QUESTIONS_SET1.slice(0, 5), ...MEDIUM_QUESTIONS_SET1.slice(0, 5), ...HARD_QUESTIONS_SET1.slice(0, 5)],
                    // السلم 1.2 (للفريق ب)
                    [...EASY_QUESTIONS_SET1.slice(5, 10), ...MEDIUM_QUESTIONS_SET1.slice(5, 10), ...HARD_QUESTIONS_SET1.slice(5, 10)],
                    // السلم 1.3 (للفريق ج)
                    [...EASY_QUESTIONS_SET1.slice(10, 15), ...MEDIUM_QUESTIONS_SET1.slice(10, 15), ...HARD_QUESTIONS_SET1.slice(10, 15)]
                ],
                // الجولة 2 (القديمة)
                [
                    // السلم 2.1 (للفريق أ)
                    [...EASY_QUESTIONS_SET1.slice(15, 20), ...MEDIUM_QUESTIONS_SET1.slice(15, 20), ...HARD_QUESTIONS_SET1.slice(15, 20)],
                    // السلم 2.2 (للفريق ب)
                    [...EASY_QUESTIONS_SET1.slice(20, 25), ...MEDIUM_QUESTIONS_SET1.slice(20, 25), ...HARD_QUESTIONS_SET1.slice(20, 25)],
                    // السلم 2.3 (للفريق ج)
                    [...EASY_QUESTIONS_SET1.slice(25, 30), ...MEDIUM_QUESTIONS_SET1.slice(25, 30), ...HARD_QUESTIONS_SET1.slice(25, 30)]
                ],
                // (جديد) الجولة 3
                [
                    [...EASY_QUESTIONS_SET2.slice(0, 5), ...MEDIUM_QUESTIONS_SET2.slice(0, 5), ...HARD_QUESTIONS_SET2.slice(0, 5)],
                    [...EASY_QUESTIONS_SET2.slice(5, 10), ...MEDIUM_QUESTIONS_SET2.slice(5, 10), ...HARD_QUESTIONS_SET2.slice(5, 10)],
                    [...EASY_QUESTIONS_SET2.slice(10, 15), ...MEDIUM_QUESTIONS_SET2.slice(10, 15), ...HARD_QUESTIONS_SET2.slice(10, 15)]
                ],
                // (جديد) الجولة 4
                [
                    [...EASY_QUESTIONS_SET2.slice(15, 20), ...MEDIUM_QUESTIONS_SET2.slice(15, 20), ...HARD_QUESTIONS_SET2.slice(15, 20)],
                    [...EASY_QUESTIONS_SET2.slice(20, 25), ...MEDIUM_QUESTIONS_SET2.slice(20, 25), ...HARD_QUESTIONS_SET2.slice(20, 25)],
                    [...EASY_QUESTIONS_SET2.slice(25, 30), ...MEDIUM_QUESTIONS_SET2.slice(25, 30), ...HARD_QUESTIONS_SET2.slice(25, 30)]
                ]
            ];

            const prizes = [
                "100", "200", "300", "500", "1,000",
                "2,000", "4,000", "8,000", "16,000", "32,000",
                "64,000", "125,000", "250,000", "500,000", "1,000,000"
            ];
            const prizeValues = prizes.map(p => parseInt(p.replace(/,/g, '')));
            // فهارس (index) المراحل الآمنة
            const safePoints = [4, 9, 14]; 
            // نقطة بداية الدور التالي بعد الوصول للمنطقة الآمنة
            const safePointStartLevels = { 4: 5, 9: 10, 14: 15 }; // (index 4 -> start at 5), (index 9 -> start at 10)
            
            // (جديد) عقوبة الجولة بالمللي ثانية
            const TURN_PENALTY_MS = 30000; // 30 ثانية

            // --- متغيرات حالة اللعبة ---
            let teams = [];
            let assignedQuestionBanks = []; // (تعديل) بنوك متعددة
            let currentTeamIndex = 0;
            let currentRound = 1;
            
            let currentTurnTimer = 0; // عداد الدور الحالي بالمللي ثانية
            let gameTimerInterval = null;
            
            let freezeTimerTimeout = null; 
            let freezeCountdownInterval = null;
            let isTimerFrozen = false; 
            let isLifelineFreezeActive = false; 
            
            let selectedOptionElement = null;
            let gameInProgress = false; 
            let teamsFinished = 0; 
            let showCorrectAnswerOnError = false; // متغير التحكم في إظهار الإجابة

            // --- عناصر الواجهة ---
            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const endScreen = document.getElementById('end-screen');
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            // (جديد) زر كشف النتائج
            const revealResultsButton = document.getElementById('reveal-results-button');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const prizeLadder = document.getElementById('prize-ladder');
            const passTurnButton = document.getElementById('pass-turn-button');
            
            // عناصر العداد الدائري
            const timerCircleText = document.getElementById('timer-circle-text');
            const timerCirclePath = document.getElementById('timer-circle-path');
            const timerPathLength = timerCirclePath.getTotalLength(); // 276.46
            const freezeOverlay = document.getElementById('freeze-overlay');
            const freezeCountdownText = document.getElementById('freeze-countdown-text');
            
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title'); // (جديد)
            const modalText = document.getElementById('modal-text');
            const modalButtons = document.getElementById('modal-buttons');
            const pauseButton = document.getElementById('pause-button');

            // (جديد) عناصر مودال القوانين
            const showRulesButton = document.getElementById('show-rules-button');
            const rulesModal = document.getElementById('rules-modal');
            const closeRulesButton = document.getElementById('close-rules-button');

            // (جديد) عناصر مودال اختيار الجولة
            const roundModal = document.getElementById('round-modal');
            const roundSelectionContainer = document.getElementById('round-selection-container');
            const closeRoundModalButton = document.getElementById('close-round-modal-button');

            // --- دوال اللعبة الأساسية ---

            // (تعديل) تغيير اسم الدالة
            function initializeGame(selectedRoundIndex) {
                // حفظ الجولة المختارة
                localStorage.setItem('millionaireLastRound', selectedRoundIndex);
                
                teams = [
                    // (جديد) إضافة نقاط العقوبة
                    { name: document.getElementById('team-1-name-input').value || "الفريق 1", totalTime: 0, questionsAnswered: 0, currentQuestionIndex: 0, lockedScore: 0, hasFinished: false, turnsTaken: 0, penaltyScore: 0, lifelines: { fiftyFifty: true, freeze: true, skip: true } },
                    { name: document.getElementById('team-2-name-input').value || "الفريق 2", totalTime: 0, questionsAnswered: 0, currentQuestionIndex: 0, lockedScore: 0, hasFinished: false, turnsTaken: 0, penaltyScore: 0, lifelines: { fiftyFifty: true, freeze: true, skip: true } },
                    { name: document.getElementById('team-3-name-input').value || "الفريق 3", totalTime: 0, questionsAnswered: 0, currentQuestionIndex: 0, lockedScore: 0, hasFinished: false, turnsTaken: 0, penaltyScore: 0, lifelines: { fiftyFifty: true, freeze: true, skip: true } }
                ];
                
                setupLifelineButtons(); 
                
                // (تعديل) توزيع البنوك الثلاثة عشوائياً على الفرق الثلاثة
                const setOfBanks = GAME_SETS[selectedRoundIndex];
                assignedQuestionBanks = [...setOfBanks].sort(() => Math.random() - 0.5);
                
                currentTeamIndex = 0;
                currentRound = 1;
                teamsFinished = 0;
                gameInProgress = false; 
                showCorrectAnswerOnError = false; // إعادة تعيين الخيار
                
                teams.forEach((team, index) => {
                    document.getElementById(`team-${index}-name`).textContent = team.name;
                    updateTeamPanel(index);
                });

                startScreen.classList.add('hidden');
                endScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                pauseButton.classList.remove('hidden'); 
                
                buildPrizeLadder();
                updateAllLifelineUI();
                
                showTurnStartModal();
            }

            function buildPrizeLadder() {
                prizeLadder.innerHTML = '';
                prizes.forEach((prize, index) => {
                    const li = document.createElement('li');
                    li.textContent = `${index + 1}: ${prize}`;
                    li.classList.add('prize-item', 'font-mono');
                    if (safePoints.includes(index)) {
                        li.classList.add('safe-point');
                    }
                    prizeLadder.appendChild(li);
                });
            }

            function showTurnStartModal() {
                let attempts = 0; 
                while (teams[currentTeamIndex].hasFinished && attempts < 4) {
                    currentTeamIndex = (currentTeamIndex + 1) % 3;
                    if (currentTeamIndex === 0) currentRound++;
                    attempts++;
                }

                if (teamsFinished === 3) {
                    endGame(false); // (تعديل) استدعاء مع forced=false
                    return;
                }

                const team = teams[currentTeamIndex];
                
                // (تعديل) استخدام كائن لتنسيق أفضل
                showModal(
                    {
                        title: `جولة ${currentRound} - الدور على:`,
                        text: `<strong class="block text-4xl text-yellow-300 my-4">${team.name}</strong>ستبدأ من السؤال ${team.currentQuestionIndex + 1}`
                    },
                    [{ text: "ابدأ العداد!", action: startTurn, class: "bg-green-500 hover:bg-green-400 modal-button" }]
                );
                
                document.querySelectorAll('.team-panel').forEach((panel, index) => {
                    panel.classList.toggle('current-team', index === currentTeamIndex);
                });
                
                updateAllLifelineUI(true); 
            }

            function startTurn() {
                hideModal();
                loadQuestion();
                startTimer();
                gameInProgress = true;
                isTimerFrozen = false;
                isLifelineFreezeActive = false;
                // passTurnButton.disabled = false; // الزر مخفي
                timerCircleText.classList.remove('frozen');
                updateAllLifelineUI(); 
            }

            function loadQuestion() {
                selectedOptionElement = null;
                optionsContainer.innerHTML = '';
                
                const team = teams[currentTeamIndex];
                const qIndex = team.currentQuestionIndex;
                // (تعديل) استخدام البنك الخاص بالفريق
                const currentBank = assignedQuestionBanks[currentTeamIndex];

                if (qIndex >= currentBank.length) {
                    return;
                }

                const q = currentBank[qIndex];
                questionText.textContent = q.question;

                q.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.classList.add('option-button', 'w-full', 'text-right', 'p-4', 'font-semibold', 'shadow-md');
                    button.dataset.option = option;
                    button.onclick = () => selectOption(button);
                    optionsContainer.appendChild(button);
                });
                
                updatePrizeLadderUI(qIndex);
            }

            function updatePrizeLadderUI(qIndex) {
                document.querySelectorAll('#prize-ladder .prize-item').forEach((item, index) => {
                    item.classList.toggle('current-prize', index === qIndex);
                });
            }

            function selectOption(button) {
                if (!gameInProgress || selectedOptionElement) {
                    if (!isLifelineFreezeActive) return;
                }

                if (isLifelineFreezeActive) {
                    clearTimeout(freezeTimerTimeout);
                    clearInterval(freezeCountdownInterval);
                    freezeOverlay.classList.add('hidden');
                    freezeOverlay.classList.remove('visible');
                    isLifelineFreezeActive = false;
                    timerCircleText.classList.remove('frozen');
                }

                optionsContainer.querySelectorAll('.option-button').forEach(btn => btn.disabled = true);
                // passTurnButton.disabled = true; // الزر مخفي
                gameInProgress = false; 
                
                selectedOptionElement = button;
                selectedOptionElement.classList.add('selected');
                
                setTimeout(confirmAnswer, 1000); 
            }

            function confirmAnswer() {
                if (!selectedOptionElement) return;

                const team = teams[currentTeamIndex];
                const qIndex = team.currentQuestionIndex;
                // (تعديل) استخدام البنك الخاص بالفريق
                const currentBank = assignedQuestionBanks[currentTeamIndex];
                const selectedAnswer = selectedOptionElement.dataset.option;
                const correctAnswer = currentBank[qIndex].answer;

                if (selectedAnswer === correctAnswer) {
                    selectedOptionElement.classList.remove('selected');
                    selectedOptionElement.classList.add('correct');
                    
                    team.questionsAnswered++;
                    
                    if (safePoints.includes(qIndex)) {
                        team.lockedScore = prizeValues[qIndex];
                        team.currentQuestionIndex = safePointStartLevels[qIndex]; 
                        
                        if (qIndex === 14) { 
                            team.hasFinished = true; 
                            teamsFinished++;
                        }
                        setTimeout(() => endTurn(false), 1500);
                    } else {
                        team.currentQuestionIndex++;
                        setTimeout(() => {
                            loadQuestion();
                            // passTurnButton.disabled = false; // الزر مخفي
                            gameInProgress = true; 
                        }, 1500);
                    }
                } else {
                    selectedOptionElement.classList.remove('selected');
                    selectedOptionElement.classList.add('incorrect');
                    
                    if (showCorrectAnswerOnError) {
                        optionsContainer.querySelectorAll('.option-button').forEach(btn => {
                            if (btn.dataset.option === currentBank[qIndex].answer) {
                                btn.classList.add('correct');
                            }
                        });
                    }
                    
                    team.currentQuestionIndex = getLastSafePointStartIndex(qIndex);
                    setTimeout(() => endTurn(true), 2000);
                }
            }

            function passTurn() {
                // هذه الدالة لن تُستدعى لأن الزر مخفي
                if (!gameInProgress || isTimerFrozen || isLifelineFreezeActive) return;
                return;
            }
            
            function endTurn(isError) {
                stopTimer(); 
                
                clearTimeout(freezeTimerTimeout);
                clearInterval(freezeCountdownInterval);
                freezeOverlay.classList.add('hidden');
                freezeOverlay.classList.remove('visible');
                isLifelineFreezeActive = false;
                
                isTimerFrozen = false; 
                gameInProgress = false;
                // passTurnButton.disabled = true; // الزر مخفي
                
                const team = teams[currentTeamIndex];
                
                if (!isError) { 
                    team.totalTime += currentTurnTimer;
                }
                
                team.turnsTaken++; 
                
                updateTeamPanel(currentTeamIndex);
                
                if (teamsFinished === 3) {
                    endGame(false); // (تعديل) استدعاء مع forced=false
                    return;
                }
                
                const nextTeamIndex = (currentTeamIndex + 1) % 3;
                if (nextTeamIndex === 0) { 
                    currentRound++;
                }

                currentTeamIndex = nextTeamIndex;
                showTurnStartModal(); 
            }

            function getLastSafePointStartIndex(failedAtIndex) {
                if (failedAtIndex >= 10) return 10; 
                if (failedAtIndex >= 5) return 5; 
                return 0; 
            }
            
            function getLastSafePointValue(currentIndex) {
                if (currentIndex >= 10) return prizeValues[9];
                if (currentIndex >= 5) return prizeValues[4];
                return 0;
            }

            function updateTeamPanel(index) {
                const team = teams[index];
                document.getElementById(`team-${index}-score`).textContent = `${team.lockedScore.toLocaleString()} ريال`;
                document.getElementById(`team-${index}-turns`).textContent = team.turnsTaken; 
                document.getElementById(`team-${index}-level`).textContent = team.hasFinished ? "أنهى" : (team.currentQuestionIndex + 1);
                document.getElementById(`team-${index}-time`).textContent = (team.totalTime / 1000).toFixed(1) + 's';
            }

            // (تعديل) دالة إنشاء كرت النتيجة (للتأثير الدرامي)
            function createResultCard(team, rank) {
                const card = document.createElement('div');
                // (جديد) إضافة كلاسات للأنيميشن
                let cardClasses = 'text-lg p-4 rounded-lg transition-all duration-500 transform scale-90 opacity-0';
                
                if (rank === 1) {
                    cardClasses += ' bg-yellow-600 border-2 border-yellow-300 shadow-2xl shadow-yellow-400/50';
                } else if (rank === 2) {
                    cardClasses += ' bg-gray-600 border border-gray-500';
                } else {
                    cardClasses += ' bg-gray-800 border border-gray-700 opacity-80';
                }
                card.className = cardClasses;

                let statsHTML = `
                    الرصيد: <span class="font-bold ${team.lockedScore > 0 ? 'text-green-400' : 'text-white'} font-mono">${team.lockedScore.toLocaleString()} ريال</span> | 
                    الوقت: <span class="font-mono">${(team.totalTime / 1000).toFixed(1)}s</span> |
                    الجولات: <span class="font-mono">${team.turnsTaken}</span>
                    <br><span class="${rank === 1 ? 'text-white' : 'text-yellow-300'} font-bold">★ النقاط النهائية: ${team.penaltyScore.toFixed(1)}</span>
                `;

                card.innerHTML = `<strong class="text-3xl">${rank}. ${team.name}</strong><br>${statsHTML}`;
                
                // (جديد) أنيميشن الظهور
                setTimeout(() => {
                    card.classList.remove('scale-90', 'opacity-0');
                    card.classList.add('scale-100', 'opacity-100');
                }, 100);
                
                return card;
            }


            // (تعديل) دالة إنهاء اللعبة (لإضافة زر الكشف)
            function endGame(forced = false) { // (تعديل) إضافة بارامتر
                gameScreen.classList.add('hidden');
                endScreen.classList.remove('hidden');
                pauseButton.classList.add('hidden'); 
                
                const endTitle = document.getElementById('end-title');
                const endMessage = document.getElementById('end-message');
                const resultsContainer = document.getElementById('final-results-container');
                const restartBtn = document.getElementById('restart-button');
                const revealBtn = document.getElementById('reveal-results-button'); // (جديد)

                // (جديد) إخفاء العناصر
                resultsContainer.innerHTML = '';
                resultsContainer.classList.add('hidden');
                restartBtn.classList.add('hidden');
                revealBtn.classList.remove('hidden'); // (جديد) إظهار زر الكشف
                
                endTitle.textContent = "انتهى السباق!";
                
                // (جديد) رسالة مخصصة
                if (forced) {
                    endMessage.textContent = "تم إنهاء السباق يدوياً. اضغط لكشف النتائج...";
                } else {
                    endMessage.textContent = "الجميع وصل لخط النهاية! اضغط لكشف النتائج...";
                }

                // (جديد) حساب نقاط العقوبة
                teams.forEach(team => {
                    const timeInSeconds = team.totalTime / 1000;
                    const turnPenaltyInSeconds = team.turnsTaken * (TURN_PENALTY_MS / 1000); 
                    team.penaltyScore = timeInSeconds + turnPenaltyInSeconds;
                });
                
                // لا يتم الفرز أو العرض هنا، بل عند الضغط على الزر
            }
            
            // (جديد) دالة كشف النتائج
            function revealResults() {
                const endTitle = document.getElementById('end-title');
                const endMessage = document.getElementById('end-message');
                const resultsContainer = document.getElementById('final-results-container');
                const restartBtn = document.getElementById('restart-button');
                const revealBtn = document.getElementById('reveal-results-button');

                // إخفاء زر الكشف
                revealBtn.classList.add('hidden');
                
                // (تعديل) فرز الفرق بناءً على الرصيد الآمن أولاً، ثم نقاط العقوبة
                const sortedTeams = teams.sort((a, b) => {
                    // 1. الفرز بالرصيد الآمن (الأعلى أولاً)
                    if (b.lockedScore !== a.lockedScore) {
                        return b.lockedScore - a.lockedScore;
                    }
                    // 2. إذا تساوى الرصيد، الفرز بنقاط العقوبة (الأقل أولاً)
                    return a.penaltyScore - b.penaltyScore;
                });
                
                // (جديد) حفظ النتيجة في السجل
                saveGameToHistory(sortedTeams);
                
                // إظهار النتائج لجميع الفرق (من الأخير للأول)
                resultsContainer.classList.remove('hidden');
                resultsContainer.innerHTML = ''; // مسح النتائج السابقة لضمان الترتيب الصحيح

                // نمر على الفرق عكسياً (من الأخير للأول) لجدولة الظهور
                // لكننا نستخدم forEach عادي ونحسب التأخير بناءً على الترتيب
                
                // نريد أن يظهر المركز الأخير أولاً (تأخير قليل)
                // والمركز الأول آخراً (تأخير كبير)
                
                // بما أننا نستخدم prepend، فإن آخر عنصر يتم إضافته سيظهر في أعلى القائمة
                // لذا يجب أن نضيف المركز الأخير، ثم الذي قبله... وأخيراً المركز الأول
                
                // الترتيب الزمني للتنفيذ (setTimeout callbacks):
                // 1. المركز الأخير (Rank N) -> prepend -> القائمة: [N]
                // 2. المركز قبل الأخير (Rank N-1) -> prepend -> القائمة: [N-1, N]
                // ...
                // 3. المركز الأول (Rank 1) -> prepend -> القائمة: [1, ..., N]

                const totalTeams = sortedTeams.length;

                for (let i = totalTeams - 1; i >= 0; i--) {
                    const team = sortedTeams[i];
                    const rank = i + 1;
                    
                    // حساب التأخير:
                    // المركز الأخير (i = total-1) -> ترتيب الظهور 0 -> تأخير 500ms
                    // المركز الأول (i = 0) -> ترتيب الظهور total-1 -> تأخير max
                    
                    const appearOrder = (totalTeams - 1) - i; // 0 للأخير، يتزايد كلما صعدنا للمركز الأول
                    const delay = 500 + (appearOrder * 1500);

                    setTimeout(() => {
                        if (rank === 1) {
                            endTitle.textContent = "الفريق الفائز هو!";
                            endMessage.textContent = team.name;
                            restartBtn.classList.remove('hidden'); // إظهار زر إعادة اللعب مع الفائز
                        } else {
                            endMessage.textContent = `في المركز ${rank}...`;
                        }
                        
                        resultsContainer.prepend(createResultCard(team, rank));
                    }, delay);
                }
            }


            // --- دوال العداد ---
            function startTimer() {
                currentTurnTimer = 0;
                timerCircleText.textContent = "0.0";
                timerCircleText.classList.remove('frozen');
                
                const totalDuration = 15000; // 15 ثانية للدورة الكاملة
                timerCirclePath.style.strokeDashoffset = timerPathLength;
                
                gameTimerInterval = setInterval(() => {
                    if (!isTimerFrozen && !isLifelineFreezeActive) {
                        currentTurnTimer += 100;
                        timerCircleText.textContent = (currentTurnTimer / 1000).toFixed(1);
                        
                        // تحديث الدائرة (تكتمل كل 15 ثانية)
                        const cycleTime = currentTurnTimer % totalDuration;
                        const progress = cycleTime / totalDuration;
                        const offset = timerPathLength - (progress * timerPathLength);
                        timerCirclePath.style.strokeDashoffset = offset;
                    }
                }, 100);
            }

            function stopTimer() {
                clearInterval(gameTimerInterval);
                gameTimerInterval = null; 
            }

            // --- دوال الإيقاف المؤقت والإعدادات ---

            function showPauseModal() {
                if (gameScreen.classList.contains('hidden') || (!gameTimerInterval && !isLifelineFreezeActive)) return; 
                
                isTimerFrozen = true; 
                timerCircleText.classList.add('frozen'); 
                
                // (تعديل) إزالة العنوان من هنا
                let adminHTML = `
                    <p class="text-lg mb-2">تغيير الدور (سيؤدي لإنهاء الدور الحالي):</p>
                    <div class="flex flex-wrap justify-center gap-2 mb-6">
                `;
                
                teams.forEach((team, index) => {
                    if (team.hasFinished) return; 
                    adminHTML += `
                        <button onclick="window.forceChangeTurn(${index})" class="px-4 py-2 text-sm ${index === currentTeamIndex ? 'bg-gray-500' : 'bg-blue-600 hover:bg-blue-500'} rounded-full modal-button" ${index === currentTeamIndex ? 'disabled' : ''}>
                            ${team.name}
                        </button>
                    `;
                });
                adminHTML += '</div>';

                adminHTML += '<p class="text-lg mb-2">إعادة تفعيل وسائل المساعدة:</p>';
                adminHTML += '<div class="space-y-3">';

                teams.forEach((team, index) => {
                    adminHTML += `<div class="p-2 bg-gray-900 rounded-lg">`;
                    adminHTML += `<p class="font-semibold text-yellow-400">${team.name}:</p>`;
                    adminHTML += `<div class="flex justify-center gap-2 mt-1">`;
                    
                    adminHTML += `
                        <button onclick="window.resetLifeline(${index}, 'fiftyFifty', this)" class="px-3 py-1 text-xs ${team.lifelines.fiftyFifty ? 'bg-gray-500' : 'bg-green-600 hover:bg-green-500'} rounded-full modal-button" ${team.lifelines.fiftyFifty ? 'disabled' : ''}>
                            50:50 ${team.lifelines.fiftyFifty ? '✓' : '↻'}
                        </button>
                        <button onclick="window.resetLifeline(${index}, 'freeze', this)" class="px-3 py-1 text-xs ${team.lifelines.freeze ? 'bg-gray-500' : 'bg-green-600 hover:bg-green-500'} rounded-full modal-button" ${team.lifelines.freeze ? 'disabled' : ''}>
                            <i class="fas fa-snowflake"></i> ${team.lifelines.freeze ? '✓' : '↻'}
                        </button>
                        <button onclick="window.resetLifeline(${index}, 'skip', this)" class="px-3 py-1 text-xs ${team.lifelines.skip ? 'bg-gray-500' : 'bg-green-600 hover:bg-green-500'} rounded-full modal-button" ${team.lifelines.skip ? 'disabled' : ''}>
                            <i class="fas fa-forward"></i> ${team.lifelines.skip ? '✓' : '↻'}
                        </button>
                    `;
                    
                    adminHTML += `</div></div>`;
                });

                adminHTML += '</div>';

                // إضافة خيار إظهار الإجابة الصحيحة
                adminHTML += '<p class="text-lg mb-2 mt-6">إعدادات اللعبة:</p>';
                adminHTML += '<div class="p-2 bg-gray-900 rounded-lg">';
                adminHTML += '<div class="flex justify-between items-center">';
                adminHTML += '<p class="font-semibold text-yellow-400">إظهار الإجابة الصحيحة عند الخطأ:</p>';
                adminHTML += `
                    <button onclick="window.toggleShowCorrectAnswer(this)" class="px-4 py-1 text-sm ${showCorrectAnswerOnError ? 'bg-green-600 hover:bg-green-500' : 'bg-red-600 hover:bg-red-500'} rounded-full modal-button">
                        ${showCorrectAnswerOnError ? 'مُفعّل' : 'مُعطّل'}
                    </button>
                `;
                adminHTML += '</div></div>';

                // (تعديل) إضافة أزرار التحكم
                adminHTML += '<div class="mt-6 border-t border-gray-700 pt-4 space-y-3">';
                
                // (جديد) زر إعادة الدور
                adminHTML += `
                    <button onclick="window.confirmRestartTurn()" class="w-full px-4 py-2 text-lg bg-blue-700 hover:bg-blue-600 rounded-full modal-button">
                        <i class="fas fa-history"></i> إعادة الدور الحالي
                    </button>
                `;
                
                // (جديد) زر إنهاء السباق
                adminHTML += `
                    <button onclick="window.confirmForceEndGame()" class="w-full px-4 py-2 text-lg bg-purple-700 hover:bg-purple-600 rounded-full modal-button">
                        <i class="fas fa-flag-checkered"></i> إنهاء السباق (بالنتائج الحالية)
                    </button>
                `;
                
                // (تعديل الاسم) زر الخروج للقائمة الرئيسية
                adminHTML += `
                    <button onclick="window.confirmRestartGame()" class="w-full px-4 py-2 text-lg bg-red-700 hover:bg-red-600 rounded-full modal-button">
                        <i class="fas fa-sign-out-alt"></i> الخروج للقائمة الرئيسية
                    </button>
                `;
                adminHTML += '</div>';


                const buttons = [
                    { text: "استئناف اللعبة", action: resumeGame, class: "bg-yellow-500 hover:bg-yellow-400 modal-button" }
                ];

                // (تعديل) استدعاء showModal مع كائن
                showModal({
                    title: "اللعبة متوقفة (إعدادات)",
                    text: adminHTML
                }, buttons);
            }

            function resumeGame() {
                hideModal();
                isTimerFrozen = false; 
                if (gameTimerInterval) {
                    updateAllLifelineUI();
                    if (!isLifelineFreezeActive) {
                         timerCircleText.classList.remove('frozen');
                    }
                }
            }

            // (جديد) دالة لتأكيد إعادة الدور
            window.confirmRestartTurn = function() {
                // إخفاء مودال الإعدادات أولاً
                hideModal();
                
                showModal(
                    "هل أنت متأكد من إعادة الدور الحالي؟<br><small>(سيبدأ عداد هذا الفريق من الصفر)</small>",
                    [
                        { 
                            text: "نعم، أعد الدور", 
                            action: window.restartCurrentTurn, 
                            class: "bg-blue-600 hover:bg-blue-500 modal-button" 
                        },
                        { 
                            text: "إلغاء", 
                            action: showPauseModal, // العودة إلى قائمة الإعدادات
                            class: "bg-gray-500 hover:bg-gray-400 modal-button" 
                        }
                    ]
                );
            }

            // (جديد) دالة لإعادة الدور الحالي
            window.restartCurrentTurn = function() {
                hideModal();
                // إيقاف أي مؤقتات جارية
                stopTimer();
                clearTimeout(freezeTimerTimeout);
                clearInterval(freezeCountdownInterval);

                // إعادة تعيين حالات التجميد والعداد
                isTimerFrozen = false;
                isLifelineFreezeActive = false;
                gameInProgress = false;
                currentTurnTimer = 0; // تصفير العداد
                
                // إظهار مودال بدء الدور *لنفس الفريق*
                showTurnStartModal();
            }

            // دالة لتأكيد إعادة المسابقة (الخروج)
            window.confirmRestartGame = function() {
                // إخفاء مودال الإعدادات أولاً
                hideModal();
                
                showModal(
                    "هل أنت متأكد من الخروج للقائمة الرئيسية؟<br><small>(سيتم فقدان التقدم الحالي بالكامل)</small>",
                    [
                        { 
                            text: "نعم، اخرج", 
                            action: () => { 
                                hideModal(); 
                                // إخفاء شاشة اللعبة وإظهار شاشة البداية
                                gameScreen.classList.add('hidden');
                                pauseButton.classList.add('hidden');
                                startScreen.classList.remove('hidden');
                                // (مهم) إيقاف أي مؤقتات جارية
                                stopTimer();
                                clearTimeout(freezeTimerTimeout);
                                clearInterval(freezeCountdownInterval);
                            }, 
                            class: "bg-red-600 hover:bg-red-500 modal-button" 
                        },
                        { 
                            text: "إلغاء", 
                            action: showPauseModal, // العودة إلى قائمة الإعدادات
                            class: "bg-gray-500 hover:bg-gray-400 modal-button" 
                        }
                    ]
                );
            }
            
            // (جديد) دالة لتأكيد الإنهاء الفوري
            window.confirmForceEndGame = function() {
                // إخفاء مودال الإعدادات أولاً
                hideModal();
                
                showModal(
                    "هل أنت متأكد من إنهاء السباق الآن؟<br><small>(سيتم إعلان الفائز حسب الرصيد الحالي والنقاط)</small>",
                    [
                        { 
                            text: "نعم، أنهِ السباق", 
                            action: window.forceEndGame, 
                            class: "bg-purple-600 hover:bg-purple-500 modal-button" 
                        },
                        { 
                            text: "إلغاء", 
                            action: showPauseModal, // العودة إلى قائمة الإعدادات
                            class: "bg-gray-500 hover:bg-gray-400 modal-button" 
                        }
                    ]
                );
            }

            // (جديد) دالة للإنهاء الفوري
            window.forceEndGame = function() {
                hideModal();
                // إيقاف أي مؤقتات جارية
                stopTimer();
                clearTimeout(freezeTimerTimeout);
                clearInterval(freezeCountdownInterval);

                // إعادة تعيين حالات التجميد والعداد
                isTimerFrozen = false;
                isLifelineFreezeActive = false;
                gameInProgress = false;

                // استدعاء دالة إنهاء اللعبة مع وضع "الإجبار"
                endGame(true);
            }

            window.forceChangeTurn = function(newIndex) {
                if (!gameTimerInterval && !isLifelineFreezeActive) return; 

                stopTimer(); 
                
                clearTimeout(freezeTimerTimeout);
                clearInterval(freezeCountdownInterval);
                freezeOverlay.classList.add('hidden');
                freezeOverlay.classList.remove('visible');
                isLifelineFreezeActive = false;
                
                currentTurnTimer = 0; 
                isTimerFrozen = false;
                gameInProgress = false; 
                
                const originalTeam = teams[currentTeamIndex]; 
                const originalIndex = currentTeamIndex; // (إصلاح) تخزين الفهرس الأصلي
                
                originalTeam.turnsTaken++; 
                originalTeam.currentQuestionIndex = getLastSafePointStartIndex(originalTeam.currentQuestionIndex);
                updateTeamPanel(currentTeamIndex); 
                
                document.getElementById(`team-${currentTeamIndex}-panel`).classList.remove('current-team');
                
                currentTeamIndex = newIndex;
                
                // (إصلاح) زيادة الجولة فقط إذا كان الدور الأصلي هو الأخير في الدورة
                if (originalIndex === 2 && newIndex !== 2) {
                     currentRound++; 
                }
                
                hideModal();
                updateAllLifelineUI(); 
                showTurnStartModal(); 
            }

            window.resetLifeline = function(teamIndex, type, buttonElement) {
                teams[teamIndex].lifelines[type] = true;
                
                buttonElement.disabled = true;
                buttonElement.textContent = buttonElement.textContent.replace('↻', '✓');
                buttonElement.classList.remove('bg-green-600', 'hover:bg-green-500');
                buttonElement.classList.add('bg-gray-500');
                
                updateAllLifelineUI();
            }

            // دالة لتفعيل/تعطيل خيار إظهار الإجابة
            window.toggleShowCorrectAnswer = function(buttonElement) {
                showCorrectAnswerOnError = !showCorrectAnswerOnError;
                
                if (showCorrectAnswerOnError) {
                    buttonElement.textContent = 'مُفعّل';
                    buttonElement.classList.remove('bg-red-600', 'hover:bg-red-500');
                    buttonElement.classList.add('bg-green-600', 'hover:bg-green-500');
                } else {
                    buttonElement.textContent = 'مُعطّل';
                    buttonElement.classList.remove('bg-green-600', 'hover:bg-green-500');
                    buttonElement.classList.add('bg-red-600', 'hover:bg-red-500');
                }
            }


            // --- دوال وسائل المساعدة ---
            
            function updateAllLifelineUI(forceDisable = false) {
                teams.forEach((team, index) => {
                    const isCurrent = (index === currentTeamIndex);
                    
                    const fiftyFiftyBtn = document.getElementById(`team-${index}-lifeline-fiftyFifty`);
                    const freezeBtn = document.getElementById(`team-${index}-lifeline-freeze`);
                    const skipBtn = document.getElementById(`team-${index}-lifeline-skip`);
                    
                    const shouldBeDisabled = forceDisable || !isCurrent || !gameInProgress || isTimerFrozen;
                    
                    fiftyFiftyBtn.disabled = shouldBeDisabled || !team.lifelines.fiftyFifty;
                    freezeBtn.disabled = shouldBeDisabled || !team.lifelines.freeze || isLifelineFreezeActive;
                    skipBtn.disabled = shouldBeDisabled || !team.lifelines.skip;
                });
            }

            function useLifeline(type) {
                const team = teams[currentTeamIndex];
                if (!gameInProgress || isTimerFrozen || !team.lifelines[type]) return;
                if (isLifelineFreezeActive && type !== 'fiftyFifty') return;
                if (type === 'freeze' && isLifelineFreezeActive) return;

                team.lifelines[type] = false; 
                
                if (type === 'fiftyFifty') {
                    // (تعديل) استخدام البنك الخاص بالفريق
                    const currentBank = assignedQuestionBanks[currentTeamIndex];
                    const correctAnswer = currentBank[team.currentQuestionIndex].answer;
                    const incorrectOptions = [];
                    
                    optionsContainer.querySelectorAll('.option-button').forEach(btn => {
                        if (btn.dataset.option !== correctAnswer) {
                            incorrectOptions.push(btn);
                        }
                    });
                    incorrectOptions.sort(() => Math.random() - 0.5);
                    incorrectOptions[0].classList.add('hidden-by-5050'); 
                    incorrectOptions[1].classList.add('hidden-by-5050');
                } 
                else if (type === 'freeze') {
                    isLifelineFreezeActive = true; 
                    
                    let freezeSeconds = 20;
                    freezeOverlay.classList.remove('hidden');
                    freezeOverlay.classList.add('visible');
                    freezeCountdownText.textContent = freezeSeconds;

                    clearInterval(freezeCountdownInterval); 
                    clearTimeout(freezeTimerTimeout); 

                    freezeCountdownInterval = setInterval(() => {
                        if (!isTimerFrozen) { 
                            freezeSeconds--;
                        }
                        freezeCountdownText.textContent = freezeSeconds;
                        if (freezeSeconds <= 0) {
                            clearInterval(freezeCountdownInterval);
                        }
                    }, 1000);

                    freezeTimerTimeout = setTimeout(() => {
                        clearInterval(freezeCountdownInterval); 
                        freezeOverlay.classList.add('hidden');
                        freezeOverlay.classList.remove('visible');
                        if (isLifelineFreezeActive && gameTimerInterval) { 
                            isLifelineFreezeActive = false;
                        }
                    }, 20000); 
                } 
                else if (type === 'skip') {
                    // (تم التعديل) إضافة 15 ثانية فقط
                    team.totalTime += 15000;
                    // (تم التعديل) عدم تصفير العداد
                    // currentTurnTimer = 0; 
                    
                    const qIndex = team.currentQuestionIndex;
                    
                    // (تم التعديل) التحقق من النقطة الآمنة
                    if (safePoints.includes(qIndex)) {
                        team.lockedScore = prizeValues[qIndex];
                        team.currentQuestionIndex = safePointStartLevels[qIndex]; 
                        
                        if (qIndex === 14) { 
                            team.hasFinished = true;
                            teamsFinished++;
                        }
                        endTurn(false); // إنهاء الدور
                    } else {
                        team.currentQuestionIndex++;
                        loadQuestion(); // الانتقال للسؤال التالي
                    }
                    
                    updateTeamPanel(currentTeamIndex); 
                }
                
                updateAllLifelineUI(); 
            }
            
            function setupLifelineButtons() {
                document.getElementById(`team-0-lifeline-fiftyFifty`).onclick = () => { if (0 === currentTeamIndex) useLifeline('fiftyFifty'); };
                document.getElementById(`team-0-lifeline-freeze`).onclick = () => { if (0 === currentTeamIndex) useLifeline('freeze'); };
                document.getElementById(`team-0-lifeline-skip`).onclick = () => { if (0 === currentTeamIndex) useLifeline('skip'); };
                
                document.getElementById(`team-1-lifeline-fiftyFifty`).onclick = () => { if (1 === currentTeamIndex) useLifeline('fiftyFifty'); };
                document.getElementById(`team-1-lifeline-freeze`).onclick = () => { if (1 === currentTeamIndex) useLifeline('freeze'); };
                document.getElementById(`team-1-lifeline-skip`).onclick = () => { if (1 === currentTeamIndex) useLifeline('skip'); };
                
                document.getElementById(`team-2-lifeline-fiftyFifty`).onclick = () => { if (2 === currentTeamIndex) useLifeline('fiftyFifty'); };
                document.getElementById(`team-2-lifeline-freeze`).onclick = () => { if (2 === currentTeamIndex) useLifeline('freeze'); };
                document.getElementById(`team-2-lifeline-skip`).onclick = () => { if (2 === currentTeamIndex) useLifeline('skip'); };
            }

            // --- دوال المودال ---
            function showModal(content, buttons) { // (تعديل) اسم المتغير
                if (isLifelineFreezeActive && (typeof content !== 'object' || !content.title || !content.title.includes('اللعبة متوقفة'))) { // (تعديل)
                    clearTimeout(freezeTimerTimeout);
                    clearInterval(freezeCountdownInterval);
                    freezeOverlay.classList.add('hidden');
                    freezeOverlay.classList.remove('visible');
                    isLifelineFreezeActive = false;
                    timerCircleText.classList.remove('frozen');
                }
                
                // (جديد) التحقق من نوع المحتوى
                if (typeof content === 'string') {
                    modalTitle.classList.add('hidden'); // إخفاء العنوان
                    modalTitle.innerHTML = '';
                    modalText.innerHTML = content;
                } else if (typeof content === 'object' && content !== null) {
                    // هذا لكائن { title, text }
                    if (content.title) {
                        modalTitle.innerHTML = content.title;
                        modalTitle.classList.remove('hidden');
                    } else {
                        modalTitle.classList.add('hidden');
                        modalTitle.innerHTML = '';
                    }
                    modalText.innerHTML = content.text || '';
                }
                
                modalButtons.innerHTML = '';
                
                if (buttons && buttons.length > 0) {
                    buttons.forEach(buttonInfo => {
                        const button = document.createElement('button');
                        button.textContent = buttonInfo.text;
                        button.className = `${buttonInfo.class}`;
                        button.onclick = buttonInfo.action;
                        modalButtons.appendChild(button);
                    });
                }
                
                modal.classList.remove('hidden');
            }

            function hideModal() {
                modal.classList.add('hidden');
            }

            // (جديد) دالة إظهار مودال اختيار الجولة
            function showRoundSelectionModal() {
                const lastUsedRound = parseInt(localStorage.getItem('millionaireLastRound') || '-1');
                roundSelectionContainer.innerHTML = ''; // مسح الأزرار القديمة

                // (تعديل) عرض 4 جولات
                for (let i = 0; i < GAME_SETS.length; i++) {
                    const button = document.createElement('button');
                    button.textContent = `الجولة ${i + 1}`;
                    button.dataset.index = i;
                    button.className = `p-4 font-bold text-lg rounded-lg transition-all duration-300 modal-button`;
                    
                    if (i === lastUsedRound) {
                        button.classList.add('bg-gray-600', 'opacity-70', 'cursor-not-allowed');
                        button.title = "لُعبت آخر مرة";
                        button.disabled = true; 
                    } else {
                        button.classList.add('bg-indigo-600', 'hover:bg-indigo-500');
                    }
                    
                    button.onclick = () => {
                        roundModal.classList.add('hidden');
                        initializeGame(i); // بدء اللعبة بالجولة المختارة
                    };
                    roundSelectionContainer.appendChild(button);
                }
                
                roundModal.classList.remove('hidden');
            }

            // --- ربط الأحداث ---
            // (تعديل) زر البدء يفتح مودال اختيار الجولة
            startButton.onclick = showRoundSelectionModal; 
            restartButton.onclick = showRoundSelectionModal; // زر إعادة اللعب يفتح اختيار الجولة أيضاً
            revealResultsButton.onclick = revealResults; // (جديد) ربط زر كشف النتائج
            
            passTurnButton.onclick = passTurn;
            pauseButton.onclick = showPauseModal;
            
            // (جديد) ربط أحداث مودال القوانين
            showRulesButton.onclick = () => {
                rulesModal.classList.remove('hidden');
            };

            closeRulesButton.onclick = () => {
                rulesModal.classList.add('hidden');
            };
            rulesModal.onclick = (e) => {
                if (e.target === rulesModal) {
                    rulesModal.classList.add('hidden');
                }
            };
            
            // (جديد) ربط أحداث مودال الجولات
            closeRoundModalButton.onclick = () => {
                roundModal.classList.add('hidden');
            };
            roundModal.onclick = (e) => {
                if (e.target === roundModal) {
                    roundModal.classList.add('hidden');
                }
            };

            // --- (جديد) منطق سجل التاريخ ---
            const historyModal = document.getElementById('history-modal');
            const showHistoryButton = document.getElementById('show-history-button');
            const closeHistoryButton = document.getElementById('close-history-button');
            const clearHistoryButton = document.getElementById('clear-history-button');
            const historyTableBody = document.getElementById('history-table-body');
            const noHistoryMsg = document.getElementById('no-history-msg');

            function saveGameToHistory(sortedTeams) {
                const now = new Date();
                const dateString = now.toLocaleDateString('ar-EG') + ' ' + now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
                
                // التأكد من عدم الحفظ المكرر (إذا ضغط المستخدم زر الكشف مرتين)
                // نستخدم "مفتاح فريد" للجلسة الحالية
                const sessionKey = sessionStorage.getItem('currentGameSessionKey');
                if (!sessionKey) {
                    sessionStorage.setItem('currentGameSessionKey', Date.now().toString());
                } else {
                     // تحقق إذا كانت هذه الجلسة محفوظة مسبقاً في آخر سجل
                     const lastHistory = JSON.parse(localStorage.getItem('millionaireHistory') || '[]');
                     if (lastHistory.length > 0 && lastHistory[0].sessionKey === sessionKey) {
                         return; // تم الحفظ مسبقاً
                     }
                }

                const gameRecord = {
                    sessionKey: sessionStorage.getItem('currentGameSessionKey'),
                    date: dateString,
                    round: (parseInt(localStorage.getItem('millionaireLastRound') || '0') + 1),
                    teams: sortedTeams.map((t, index) => ({
                        rank: index + 1,
                        name: t.name,
                        score: t.lockedScore,
                        time: (t.totalTime / 1000).toFixed(1),
                        turns: t.turnsTaken,
                        penalty: t.penaltyScore.toFixed(1)
                    }))
                };

                const history = JSON.parse(localStorage.getItem('millionaireHistory') || '[]');
                history.unshift(gameRecord); // إضافة في البداية
                localStorage.setItem('millionaireHistory', JSON.stringify(history));
            }

            function showHistory() {
                const history = JSON.parse(localStorage.getItem('millionaireHistory') || '[]');
                historyTableBody.innerHTML = '';

                if (history.length === 0) {
                    noHistoryMsg.classList.remove('hidden');
                } else {
                    noHistoryMsg.classList.add('hidden');
                    history.forEach(record => {
                        const tr = document.createElement('tr');
                        tr.className = "hover:bg-indigo-800 transition-colors border-b border-gray-700";
                        
                        // بناء قائمة الفرق
                        let teamsHTML = '<div class="flex flex-wrap gap-2 justify-center">';
                        record.teams.forEach(team => {
                            let rankColor = 'text-gray-300';
                            let borderColor = 'border-gray-600';
                            
                            if (team.rank === 1) {
                                rankColor = 'text-yellow-300';
                                borderColor = 'border-yellow-500';
                            } else if (team.rank === 2) {
                                rankColor = 'text-gray-200';
                                borderColor = 'border-gray-400';
                            } else if (team.rank === 3) {
                                rankColor = 'text-orange-300';
                                borderColor = 'border-orange-500';
                            }

                            teamsHTML += `
                                <div class="p-2 border rounded-lg ${borderColor} bg-gray-900/50 min-w-[120px] text-center">
                                    <div class="font-bold ${rankColor} text-sm mb-1">#${team.rank} ${team.name}</div>
                                    <div class="text-xs text-green-400 font-mono">${team.score.toLocaleString()}</div>
                                    <div class="text-[10px] text-gray-400 mt-1">
                                        (${team.time}s | ${team.turns}ج | -${team.penalty})
                                    </div>
                                </div>
                            `;
                        });
                        teamsHTML += '</div>';

                        tr.innerHTML = `
                            <td class="p-3 text-gray-300 whitespace-nowrap">${record.date}</td>
                            <td class="p-3 text-center text-yellow-500 font-bold">${record.round}</td>
                            <td class="p-3">
                                ${teamsHTML}
                            </td>
                        `;
                        historyTableBody.appendChild(tr);
                    });
                }
                historyModal.classList.remove('hidden');
            }

            function clearHistory() {
                if (confirm('هل أنت متأكد من مسح جميع السجلات؟ لا يمكن التراجع.')) {
                    localStorage.removeItem('millionaireHistory');
                    showHistory(); // تحديث العرض
                }
            }

            // ربط الأحداث
            showHistoryButton.onclick = showHistory;
            closeHistoryButton.onclick = () => historyModal.classList.add('hidden');
            clearHistoryButton.onclick = clearHistory;
            historyModal.onclick = (e) => {
                if (e.target === historyModal) historyModal.classList.add('hidden');
            };

            // عند بدء لعبة جديدة، نجدد مفتاح الجلسة
            const originalInitializeGame = initializeGame;
            initializeGame = function(selectedRoundIndex) {
                sessionStorage.setItem('currentGameSessionKey', Date.now().toString());
                originalInitializeGame(selectedRoundIndex);
            };


            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    e.preventDefault(); 

                    const isPauseModalOpen = !modal.classList.contains('hidden') && modalText.innerHTML.includes('تغيير الدور'); 
                    const isRulesModalOpen = !rulesModal.classList.contains('hidden');
                    const isRoundModalOpen = !roundModal.classList.contains('hidden'); // (جديد)
                    const isHistoryModalOpen = !historyModal.classList.contains('hidden');

                    if (isPauseModalOpen) {
                        resumeGame();
                    } else if (isRulesModalOpen) { 
                        rulesModal.classList.add('hidden');
                    } else if (isHistoryModalOpen) {
                        historyModal.classList.add('hidden');
                    } else if (isRoundModalOpen) { // (جديد)
                        roundModal.classList.add('hidden');
                    } else if (modal.classList.contains('hidden') && !gameScreen.classList.contains('hidden') && (gameTimerInterval || isLifelineFreezeActive)) {
                        showPauseModal();
                    }
                }
            });
        });
    </script>
</body>
</html>