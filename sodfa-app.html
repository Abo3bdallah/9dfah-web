<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚Ø±Ø¹Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ù…ÙƒØªØ¨Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„ÙØ§Øª Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar { display: none; }
        html { -ms-overflow-style: none; scrollbar-width: none; }

        /* Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø®Ø· Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ù…Ù† Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø£Ù„ÙˆØ§Ù† Ø²Ø¬Ø§Ø¬ÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø©) */
        .gradient-bg {
            background: linear-gradient(135deg, #00b5b5, #e07d51, #ffce18);
            /* ** Ø¥ØµÙ„Ø§Ø­ 1: Ø¥Ø¶Ø§ÙØ© min-h-screen Ù‡Ù†Ø§ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ** */
            min-height: 100vh; 
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card-hover {
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            color: #fff;
        }

        /* Ù…ØªØºÙŠØ±Ø§Øª CSS Ù„Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ ÙÙŠ Ø§Ù„Ø£Ø­Ø¬Ø§Ù… */
        :root {
            --pointer-size: 20px; 
            --name-display-width: 60vw; 
            --name-display-height: 20vh; 
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ */
        .wheel-container {
            position: relative;
            width: min(80vw, 80vh);
            height: min(80vw, 80vh);
            margin: 0 auto;
            overflow: visible;
        }
        
        .wheel {
            width: 100%; 
            height: 100%; 
            border-radius: 50%;
            transition: transform ease-out;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            cursor: grab; 
        }
        .wheel:active {
            cursor: grabbing;
        }

        .pin-pointer {
            position: absolute;
            top: 50%;
            left: 100%; 
            transform: translate(-100%, -50%); 
            z-index: 100;
            pointer-events: none;
            width: 0;
            height: 0;
            border-top: 14px solid transparent;
            border-bottom: 14px solid transparent;
            border-right: 26px solid #ef4444;
            box-shadow: none;
            transition: transform 0.1s ease;
        }

        /* Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ØµØ±ÙŠ Ù„ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„ØªÙˆÙ‚Ù Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© (Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…) */
        .winning-pin {
            position: absolute;
            top: 50%; 
            left: 100%;
            transform: translate(-115%, -50%); 
            width: 0;
            height: 0;
            background-color: transparent;
            border: 0;
            border-radius: 50%;
            z-index: 101; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…Ø¤Ø´Ø± Ù„ÙŠÙƒÙˆÙ† ÙˆØ§Ø¶Ø­Ø§Ù‹ */
            pointer-events: none;
            box-shadow: none;
        }

        /* Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²ÙŠØ© Ù„Ù„Ù…Ø¤Ø´Ø± */
        .wobble {
            animation: none;
            transform-origin: center center; 
        }

        @keyframes wobbleAnim {
            from { transform: translate(-100%, -50%) rotate(-6deg); }
            to { transform: translate(-100%, -50%) rotate(6deg); }
        }
        
        @keyframes numberPulse {
            0% { transform: scale(1) translateY(0); text-shadow: 0 0 10px rgba(255, 255, 255, 0.4); }
            40% { transform: scale(1.12) translateY(-4px); text-shadow: 0 0 16px rgba(255, 255, 255, 0.7); }
            100% { transform: scale(1) translateY(0); text-shadow: 0 0 6px rgba(0, 0, 0, 0.6); }
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù†Ø±Ø¯ */
        .dice-wrapper { perspective: 800px; display: flex; justify-content: center; align-items: center; gap: 20px; }
        
        /* ØºÙ„Ø§Ù Ù„Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù‚ÙØ²ÙŠØ© */
        .dice-anim-wrapper {
            position: relative;
            width: 100px; height: 100px;
        }
        .dice-anim-wrapper.jumping {
            animation: diceJump 1.5s ease-out forwards;
        }

        @keyframes diceJump {
            0% { transform: translateY(0); }
            20% { transform: translateY(-150px) scale(1.1); } /* Ù‚ÙØ²Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ */
            40% { transform: translateY(0); } /* Ù‡Ø¨ÙˆØ· */
            50% { transform: translateY(-30px); } /* Ø§Ø±ØªØ¯Ø§Ø¯ Ø¨Ø³ÙŠØ· */
            60% { transform: translateY(0); }
            70% { transform: translateY(-10px); } /* Ø§Ø±ØªØ¯Ø§Ø¯ Ø£Ø®ÙŠØ± */
            100% { transform: translateY(0); }
        }

        .dice-container { width: 100px; height: 100px; position: relative; transform-style: preserve-3d; transition: transform 1.5s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .dice-face {
            position: absolute; width: 100%; height: 100%; background: linear-gradient(145deg, #ffffff, #f0f0f0); border: 1px solid #ddd;
            display: flex; align-items: center; justify-content: center; border-radius: 4px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.05); font-size: 3rem; font-weight: bold; color: #333;
            backface-visibility: hidden; /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¸Ù‡Ø± */
        }
        /* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·/Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù„ØªØ¨Ø¯Ùˆ Ù…Ø­ÙÙˆØ±Ø© */
        .dice-face {
             text-shadow: 1px 1px 0 #fff, -1px -1px 0 rgba(0,0,0,0.1);
        }

        .dice-face.one { transform: rotateY(0deg) translateZ(50px); }
        .dice-face.two { transform: rotateX(-90deg) translateZ(50px); } /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚ */
        .dice-face.three { transform: rotateY(90deg) translateZ(50px); }
        .dice-face.four { transform: rotateY(-90deg) translateZ(50px); }
        .dice-face.five { transform: rotateX(90deg) translateZ(50px); } /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚ */
        .dice-face.six { transform: rotateY(180deg) translateZ(50px); }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
        .coin-container { 
            perspective: 1200px; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px; /* Ù…Ø³Ø§Ø­Ø© ÙƒØ§ÙÙŠØ© Ù„Ù„Ø¯ÙˆØ±Ø§Ù† */
        }
        .coin {
            width: 200px; 
            height: 200px; 
            position: relative; 
            transform-style: preserve-3d;
            transition: transform 3s cubic-bezier(0.15, 0.25, 0.25, 1); /* Ø­Ø±ÙƒØ© Ø£ÙƒØ«Ø± Ø³Ù„Ø§Ø³Ø© */
        }
        
        /* Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        .coin-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            backface-visibility: hidden; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¨ØµØ±ÙŠ */
        }

        /* Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ */
        .coin-front-face {
            transform: translateZ(10px); /* ØªÙ‚Ø¯ÙŠÙ… Ù„Ù„Ø£Ù…Ø§Ù… */
            background-color: #fcd34d; /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ */
            box-shadow: inset 0 0 15px rgba(0,0,0,0.2);
            z-index: 2;
            border: 1px solid #f8a241; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ */
        }
        .coin-front-face img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        /* Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ */
        .coin-back-face {
            transform: rotateY(180deg) translateZ(10px); /* ØªØ¯ÙˆÙŠØ± ÙˆØ¯ÙØ¹ Ù„Ù„Ø®Ù„Ù (Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¬Ø¨Ø© Ù„Ø£Ù†Ù‡Ø§ Ø¯Ø§Ø±Øª) */
            background-color: #fcd34d; /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ */
            box-shadow: inset 0 0 15px rgba(0,0,0,0.2);
            z-index: 2;
            border: 1px solid #f8a241; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ */
        }
        .coin-back-face img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        /* Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø­Ø§ÙØ© (Edge) */
        .coin-edge-layer {
            background: #f8a241;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            /* Ù„Ø§ Ù†Ø­ØªØ§Ø¬ backface-visibility Ù‡Ù†Ø§ Ù„Ø£Ù†Ù†Ø§ Ù†Ø±ÙŠØ¯ Ø±Ø¤ÙŠØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ */
            backface-visibility: visible; 
            border: 1px solid rgba(0,0,0,0.1); /* Ø­Ø¯ÙˆØ¯ Ø®ÙÙŠÙØ© Ù„Ù„ÙˆØ§Ù‚Ø¹ÙŠØ© */
        }
        
        /* Ø­Ø±ÙƒØ© Ø§Ù„Ø±Ù…ÙŠ Ù„Ù„Ø£Ø¹Ù„Ù‰ (Toss) Ù…Ø¹ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© */
        @keyframes coinToss {
            0% { 
                transform: translateY(0) scale(1); 
                animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000); /* Ease Out Cubic (Decelerate) */
            }
            50% { 
                transform: translateY(-200px) scale(1.3); /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙˆØ§Ù„ØªÙƒØ¨ÙŠØ± Ù„Ø¹Ø¯Ù… Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
                animation-timing-function: cubic-bezier(0.550, 0.055, 0.675, 0.190); /* Ease In Cubic (Accelerate) */
            }
            100% { 
                transform: translateY(0) scale(1); 
            }
        }

        .toss-animation {
            animation: coinToss 1s forwards; /* Ø§Ù„Ù…Ø¯Ø© Ø³ØªØ­Ø¯Ø¯ Ø¹Ø¨Ø± JS */
        }
        
        /* Ø­Ø±ÙƒØ© Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ù‚ÙˆØ· (Bounce) */
        @keyframes coinBounce {
            0% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            65% { transform: translateY(0); }
            80% { transform: translateY(-15px); }
            100% { transform: translateY(0); }
        }
        
        .bounce-anim {
            animation: coinBounce 0.4s cubic-bezier(0.215, 0.610, 0.355, 1.000);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ù†ÙˆØ§ÙØ° Ø§Ù„ÙØ±Ù‚ (Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡) */
        .team-red { background-color: rgba(220, 38, 38, 0.3); border-color: #dc2626; } 
        .team-blue { background-color: rgba(37, 99, 235, 0.3); border-color: #2563eb; }
        .team-green { background-color: rgba(16, 185, 129, 0.3); border-color: #10b981; }
        .team-yellow { background-color: rgba(251, 191, 36, 0.3); border-color: #fca51f; }
        .team-purple { background-color: rgba(168, 85, 247, 0.3); border-color: #a855f7; }
        .team-orange { background-color: rgba(249, 115, 22, 0.3); border-color: #f97316; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© ÙÙŠ ÙˆØ¶Ø¹ Glass */
        .options-modal .modal-content textarea, .options-modal .modal-content input[type="number"] {
            color: #1f2937; 
            background-color: rgba(255, 255, 255, 0.8); 
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
        .text-gradient {
            background-image: linear-gradient(to right, #ffffff, rgba(255, 255, 255, 0.7));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .options-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center; z-index: 1500; opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .options-modal.visible { opacity: 1; pointer-events: auto; }
        .options-modal .modal-content {
            background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); color: #fff; padding: 2rem; border-radius: 20px;
            width: 90%; max-width: 500px; text-align: right; transform: translateY(-20px); transition: transform 0.3s ease;
            max-height: 90vh; overflow-y: auto;
        }
        .options-modal.visible .modal-content { transform: translateY(0); }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù†ØªØ§Ø¦Ø¬ */
        .result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            z-index: 2000; 
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            color: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 300px;
            animation: popupShow 0.5s ease-out forwards;
        }
        @keyframes popupShow {
            0% { transform: translate(-50%, -50%) scale(0) rotate(180deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1) rotate(0deg); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù‚ØµØ§ØµØ§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ù„ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© Ø¹Ù„Ù‰ Ù…ÙƒØªØ¨Ø©) */
        .confetti-container {
            display: none; 
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .large-number-circle {
            width: min(70vw, 60vh);
            height: min(70vw, 60vh);
            display: flex; align-items: center; justify-content: center; border-radius: 50%;
            background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.8), rgba(148, 163, 184, 0.15));
            border: 3px solid rgba(148, 163, 184, 0.8);
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.65), 0 0 35px rgba(96, 165, 250, 0.4);
            backdrop-filter: blur(10px);
            margin: 0 auto;
            transition: width 0.3s ease, height 0.3s ease, box-shadow 0.2s ease, transform 0.2s ease;
        }
        .large-number-circle span {
            font-size: min(35vw, 30vh);
            font-weight: bold;
            color: #0f172a;
            text-shadow: 0 3px 10px rgba(15, 23, 42, 0.6);
            /* animation: numberPulse 0.4s ease-out;  <-- Removed default to control via JS */
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø§Ù„Ø±Ù‚Ù… */
        .number-animation {
            animation: numberPulse 0.1s ease-out;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ÙØ²Ø© Ù„Ù„Ø±Ù‚Ù… Ø§Ù„ÙØ§Ø¦Ø² (Pop) */
        @keyframes popNumber {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); text-shadow: 0 0 30px rgba(79, 70, 229, 0.8); }
            100% { transform: scale(1); }
        }
        .pop-number {
            animation: popNumber 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            color: #4f46e5 !important;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¦Ø² (Ù…Ø³ØªØ·ÙŠÙ„) */
        .large-name-display {
            width: min(90vw, 800px);
            min-height: min(40vh, 300px);
            margin: 0 auto; padding: 2rem; display: flex; flex-direction: column;
            align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-radius: 20px; text-align: center; transition: all 0.3s ease;
            overflow-x: auto;
            position: relative; /* Added for absolute positioning of children */
        }
        .large-name-display p {
            font-size: 1.8rem;
            font-weight: 900;
            color: #fff;
            margin-bottom: 0; /* Removed margin as it's now absolute */
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.1));
            padding: 0.5rem 2.5rem;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: absolute; /* Fixed position relative to container */
            top: 2rem; /* Spacing from top */
            z-index: 10;
        }
        .large-name-display span {
            font-size: min(15vw, 6rem); font-weight: 800; color: white; max-width: 100%; padding: 0.2em 1rem;
            line-height: 1.5;
            white-space: nowrap; overflow: visible; text-overflow: clip; /* Changed to prevent cutting off shadows/letters */
            transition: transform 0.1s ease, filter 0.1s ease;
            text-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: inline-block; /* Helps with alignment */
            margin-top: 3rem; /* Space for the absolute positioned title */
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶Ø¨Ø§Ø¨ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        .blur-text {
            filter: blur(2px);
            transform: scale(0.95);
            opacity: 0.8;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ÙÙˆØ² */
        @keyframes popName {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); text-shadow: 0 0 20px rgba(255, 255, 255, 0.8); }
            100% { transform: scale(1); }
        }
        .pop-name {
            animation: popName 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            color: #ffffff !important;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª */
        .name-item.selected {
            background-color: #fff;
            color: #333;
            border-color: #4f46e5;
            box-shadow: 0 0 15px rgba(79, 70, 229, 0.5);
            transform: scale(1.05);
        }
        .custom-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);
            display: flex; justify-content: center; align-items: center; z-index: 2000; 
        }
        .custom-modal .modal-content {
            background: white; padding: 2rem; border-radius: 10px; max-width: 400px; width: 90%;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø®ØµØµØ© */
        /* Ù„Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙÙ‚Ø· */
        @media (min-width: 1024px) {
            .team-layout-2 {
                /* ÙØ±ÙŠÙ‚Ø§Ù†: Ù…Ø³ØªØ·ÙŠÙ„Ø§Ù† ÙƒØ¨ÙŠØ±Ø§Ù† Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶Ù‡Ù…Ø§ */
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                grid-auto-rows: 1fr;
                gap: 1rem;
            }
            .team-layout-3 {
                /* Ø«Ù„Ø§Ø«Ø© ÙØ±Ù‚: Ø«Ù„Ø§Ø« Ù…Ø³ØªØ·ÙŠÙ„Ø§Øª Ø¨Ø§Ù„Ø·ÙˆÙ„ Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶Ù‡Ø§ */
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                grid-auto-flow: column;
            }
            .team-layout-4 {
                /* Ø£Ø±Ø¨Ø¹Ø© ÙØ±Ù‚: 2x2 Ø´Ø¨ÙƒØ© */
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(2, 1fr);
                gap: 1rem; 
            }
            .team-layout-5 {
                /* Ø®Ù…Ø³Ø© ÙØ±Ù‚: 3 ÙÙˆÙ‚ Ùˆ 2 ØªØ­Øª (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Flexbox Ù„Ù„Ø§Ù„ØªÙØ§Ù) */
                display: flex;
                flex-wrap: wrap;
            }
            .team-layout-5 > div {
                flex: 1 1 30%; 
                min-width: 200px;
            }
            .team-layout-6 {
                /* Ø³ØªØ© ÙØ±Ù‚: 3 ÙÙˆÙ‚ Ùˆ 3 ØªØ­Øª */
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(2, 1fr);
                gap: 1rem;
            }
        }
        @media (max-width: 1023px) {
            #teamsContainer > div {
                min-width: 256px; 
                width: 256px;
                flex-shrink: 0;
            }
            .team-column {
                height: auto !important;
                min-height: 16rem;
                max-height: none !important;
                overflow-y: visible !important;
                padding-top: 1rem;
                padding-bottom: 1rem;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .large-name-display span {
                white-space: normal !important;
                word-wrap: break-word;
                display: block; 
                line-height: 1.3;
            }
            .large-name-display {
                height: auto; 
                min-height: 40vh;
            }
        }

        @media (min-width: 1024px) {
            #teamsContainer.team-layout-3 .team-column,
            #teamsContainer.team-layout-2 .team-column {
                height: auto;
                min-height: 24rem;
                max-height: 80vh;
            }
            #teamsContainer.team-layout-4 .team-column {
                display: grid;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                grid-auto-rows: auto;
                gap: 0.5rem;
                overflow-y: auto;
                align-content: flex-start;
            }
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø­Ø°Ù (âœ•) Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .remove-btn {
            @apply text-red-300 hover:text-red-100 text-sm p-1 rounded-full w-6 h-6 flex items-center justify-center;
            font-size: 1rem;
            line-height: 1; /* Ù„Ø¶Ù…Ø§Ù† ØªÙ…Ø±ÙƒØ² "âœ•" */
            font-weight: bold;
        }
        /* ------------------------------------------------------------- */
        /* Ù†Ù…Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø±Ø¯ Ø§Ù„ØµØºÙŠØ± (Ù…Ø­ØªÙØ¸ Ø¨Ù‡ Ù„Ù„Ù†Ø±Ø¯) */
        /* ------------------------------------------------------------- */
        
        /* ØªØ¶ÙŠÙŠÙ‚ Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© */
        #diceCountRadios {
            max-width: 200px !important; 
        }

        .radio-inputs {
            /* ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…Ø· Ù„Ù„Ù†Ø±Ø¯ ÙÙ‚Ø· Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² */
            position: relative;
            display: flex;
            flex-wrap: wrap;
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.1); 
            box-sizing: border-box;
            box-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.15), 
                inset 0 0 10px rgba(255, 255, 255, 0.1);
            padding: 0.5rem;
            width: 100%; 
            max-width: 450px; 
            margin-right: auto;
            margin-left: auto;
            font-size: 14px;
            gap: 0.5rem;
        }

        .radio-inputs .radio { flex: 1 1 auto; text-align: center; position: relative; }
        .radio-inputs .radio input { display: none; }
        .radio-inputs .radio .name {
            display: flex; cursor: pointer; align-items: center; justify-content: center;
            border-radius: 0.7rem; border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 0.7rem 0; color: #ffffff; font-weight: 500; font-family: inherit;
            background: rgba(255, 255, 255, 0.15); 
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1); transition: all 0.2s ease; overflow: hidden;
        }
        .radio-inputs .radio input:checked + .name {
            background: linear-gradient(145deg, #00b5b5, #e07d51); 
            color: white; font-weight: 600; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
            box-shadow:
                inset 2px 2px 5px rgba(0, 0, 0, 0.3),
                inset -2px -2px 5px rgba(255, 255, 255, 0.1),
                0 0 15px rgba(255, 206, 24, 0.6); 
            transform: translateY(1px); 
        }

        /* ------------------------------------------------------------- */
        /* Ù†Ù…Ø· Ø£Ø²Ø±Ø§Ø± Tabs Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ (gharsh11032000) */
        /* ------------------------------------------------------------- */

        .tabs-container {
            display: flex;
            gap: 8px;
            justify-content: center; /* Ù„ØªÙ…Ø±ÙƒØ² Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
            flex-wrap: wrap; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ù„ØªÙØ§Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
            max-width: 450px;
            margin: 0 auto;
        }
        
        /* ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„ØªÙƒÙˆÙ† Ø£ØµØºØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© */
        .tab-group {
            flex-grow: 1;
            flex-shrink: 0;
            min-width: 38px; /* Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¹Ø±Ø¶ */
        }

        .tab-group input {
            appearance: none;
        }

        .tab-group label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%; /* Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø²Ø± ÙŠÙ…Ù„Ø£ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù€ tab-group */
            height: 48px;
            line-height: 1.6;
            /* ØªØµÙ…ÙŠÙ… Ø²Ø¬Ø§Ø¬ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
            border: 1px solid rgba(255, 255, 255, 0.5); 
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            position: relative;
            background-color: rgba(255, 255, 255, 0.15); /* Ø®Ù„ÙÙŠØ© Ø²Ø¬Ø§Ø¬ÙŠØ© */
            color: #ffffff; /* Ù„ÙˆÙ† Ù†Øµ Ø£Ø¨ÙŠØ¶ Ù„ØªØ¨Ø§ÙŠÙ† ÙˆØ§Ø¶Ø­ */
            transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© Ø§Ù„ØªÙŠ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ */
        .tab-group label::after, .tab-group label::before {
            content: none !important;
        }
        
        .tab-group label:hover {
            border-color: #00b5b5; /* Ù„ÙˆÙ† Ø§Ù„ØªÙˆÙ‡Ø¬ */
            color: #00b5b5; /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        }

        .tab-group input:checked + label {
            /* Ù„ÙˆÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ¯: Ù…ØªØ¯Ø±Ø¬ Ø¨ÙŠÙ† Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø¨Ø­Ø±ÙŠ ÙˆØ§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„Ø®ÙÙŠÙ) */
            background: linear-gradient(145deg, #00b5b5, #e07d51); 
            border-color: transparent;
            color: #ffffff;
            scale: 1.1;
            /* Ø¸Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
            box-shadow: 
                0rem 6px 13px rgba(0, 181, 181, 0.3), /* Ø¸Ù„ ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù„ÙˆÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
                0rem 24px 24px rgba(0, 181, 181, 0.2),
                0px 0px 15px 0px rgba(255, 206, 24, 0.6); /* ØªÙˆÙ‡Ø¬ Ø®Ø§Ø±Ø¬ÙŠ */
        }

        /* *************** Ù†Ù‡Ø§ÙŠØ© ØªÙ†Ø³ÙŠÙ‚Ø§Øª Tabs *************** */

        /* ØªÙ†Ø³ÙŠÙ‚ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„ØªØ¨Ø¯Ùˆ Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© */
        .options-modal .modal-content select {
            color: #1f2937;
            background-color: rgba(255, 255, 255, 0.9); 
            border: 1px solid rgba(255, 255, 255, 0.5);
            appearance: auto;
            -webkit-appearance: auto;
            -moz-appearance: auto;
            padding-left: 1rem;
        }
        .options-modal .modal-content select option {
             color: #1f2937;
        }
    </style>
</head>
<!-- ** Ø¥ØµÙ„Ø§Ø­ 1: Ø¥Ø²Ø§Ù„Ø© flex items-center justify-content-center Ù…Ù† body ** -->
<body class="gradient-bg p-4">
    <div class="max-w-6xl mx-auto w-full">
        <button
            id="backToMainBtn"
            type="button"
            onclick="showSection('main-menu')"
            class="hidden fixed top-4 right-4 z-50 w-11 h-11 rounded-full bg-white/20 hover:bg-white/40 border border-white/60 shadow-lg flex items-center justify-center backdrop-blur"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </button>
        <!-- Main Menu Section -->
        <div id="main-menu" class="section">
            <div class="text-center mb-12">
                <h1 class="text-6xl font-bold mb-2 text-gradient"> ØµÙØ¯ÙØ© 6x</h1>
                <p class="text-white/80 text-2xl font-medium">Ø£Ø­Ù…Ø¯ Ø§Ù„Ø°Ø¨ÙŠØ§Ù†ÙŠ</p>
            </div>
            
            <div id="main-menu-links" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <a id="link-wheel" class="glass-card card-hover rounded-2xl p-8 text-center cursor-pointer" data-section="wheel">
                    <img src="https://i.postimg.cc/d1GgydPZ/image.png" alt="Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸" class="w-20 h-20 mx-auto mb-4">
                    <h2 class="text-2xl font-bold">Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h2>
                    <p class="text-white/80 mt-2">Ù‚Ù… Ø¨ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± ÙØ§Ø¦Ø²</p>
                </a>
                
                <a id="link-numbers" class="glass-card card-hover rounded-2xl p-8 text-center cursor-pointer" data-section="numbers">
                    <img src="https://i.postimg.cc/hPZZhMz3/image.png" alt="Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…" class="w-20 h-20 mx-auto mb-4">
                    <h2 class="text-2xl font-bold">Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</h2>
                    <p class="text-white/80 mt-2">Ø§Ø®ØªØ± Ø±Ù‚Ù…Ù‹Ø§ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ù…Ù† 1 Ø¥Ù„Ù‰ Ù…Ø§ ØªØ±ÙŠØ¯</p>
                </a>
                
                <a id="link-names" class="glass-card card-hover rounded-2xl p-8 text-center cursor-pointer" data-section="names">
                    <img src="https://i.postimg.cc/RVPVP3qn/image.png" alt="Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡" class="w-20 h-20 mx-auto mb-4">
                    <h2 class="text-2xl font-bold">Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h2>
                    <p class="text-white/80 mt-2">Ù…Ø®ØµØµ Ù„Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø©</p>
                </a>
                
                <a id="link-dice" class="glass-card card-hover rounded-2xl p-8 text-center cursor-pointer" data-section="dice">
                    <img src="https://i.postimg.cc/3xdrzKDf/image.png" alt="Ø§Ù„Ù†Ø±Ø¯" class="w-20 h-20 mx-auto mb-4">
                    <h2 class="text-2xl font-bold">Ø§Ù„Ù†Ø±Ø¯</h2>
                    <p class="text-white/80 mt-2">Ù‚Ø±Ø¹Ø© Ø³Ø±ÙŠØ¹Ø© Ù…Ù† 1 Ø§Ù„Ù‰ 24</p>
                </a>
                
                <a id="link-coin" class="glass-card card-hover rounded-2xl p-8 text-center cursor-pointer" data-section="coin">
                    <img src="https://i.postimg.cc/0jJ3CXQc/image.png" alt="Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©" class="w-20 h-20 mx-auto mb-4">
                    <h2 class="text-2xl font-bold">Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©</h2>
                    <p class="text-white/80 mt-2">ØµÙˆØ±Ø© Ø£Ùˆ ÙƒØªØ§Ø¨Ø©</p>
                </a>
                
                <a id="link-drag-and-drop" class="glass-card card-hover rounded-2xl p-8 text-center cursor-pointer" data-section="drag-and-drop">
                    <img src="https://i.postimg.cc/yx1sjBHP/image.png" alt="ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡" class="w-20 h-20 mx-auto mb-4">
                    <h2 class="text-2xl font-bold">ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h2>
                    <p class="text-white/80 mt-2">Ù‚Ù… Ø¨ÙØ±Ø² Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ù‚ÙˆØ§Ø¦Ù… "Ø£Ø³Ù‡Ù„ Ø·Ø±ÙŠÙ‚Ø© Ù„Ù„ØªÙ‚Ø³ÙŠÙ…"</p>
                </a>
            </div>
        </div>

        <!-- Wheel Section -->
        <div id="wheel-section" class="section hidden flex flex-col justify-center items-center min-h-screen pt-8 pb-10">
            
            <div class="flex flex-col items-center justify-center w-full max-w-full">
                <div id="wheel-container" class="wheel-container fullscreen-wheel-container" style="--size: min(84vw, 84vh);"> 
                    <canvas id="wheelCanvas" class="wheel fullscreen-wheel" width="320" height="320"></canvas>
                     <!-- Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ (CSS Triangle) -->
                     <div id="wheelPointer" class="pin-pointer"></div>
                     <!-- Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ù„Ù„ÙÙˆØ² -->
                     <div class="winning-pin"></div>
                </div>
                <div class="text-center mt-8">
                    <button id="spinWheelButton" onclick="spinWheel()" class="bg-white/30 text-white px-8 py-3 rounded-lg font-bold hover:bg-white/50 transition-all">
                        ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø©
                    </button>
                    <button onclick="toggleWheelOptionsModal()" class="bg-white/30 text-white px-8 py-3 rounded-lg font-bold hover:bg-white/50 transition-all mr-4">
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                    </button>
                </div>
            </div>

            <!-- Modal for Wheel Options -->
            <div id="wheelOptionsModal" class="options-modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white text-2xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h3>
                        <button onclick="toggleWheelOptionsModal()" class="text-white/80 hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="flex flex-col items-center gap-4 mb-4 text-white">
                        <div class="w-full flex flex-col items-start justify-start gap-3">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showWheelPopup" checked class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveWheelSettings()">
                                <label for="showWheelPopup" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©</label>
                            </div>
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showWheelConfetti" checked class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveWheelSettings()">
                                <label for="showWheelConfetti" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø­ØªÙØ§Ù„ (Ù‚ØµØ§ØµØ§Øª)</label>
                            </div>
                        </div>
                        <div class="w-full glass-card rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-sm font-semibold">Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¹Ø¬Ù„Ø©</span>
                                <button type="button" onclick="toggleWheelColorsPanel()" class="bg-white/20 text-xs text-white px-3 py-1 rounded-lg hover:bg-white/30 transition">
                                    ØªØ®ØµÙŠØµ Ø§Ù„Ø¹Ø¬Ù„Ø©
                                </button>
                            </div>
                            <div id="wheelColorsPanel" class="w-full flex flex-col gap-3 hidden">
                                <div id="wheelColorsList" class="flex flex-wrap gap-2"></div>
                                <div class="flex items-center gap-2">
                                    <button type="button" onclick="handleAddWheelColorClick()" class="w-8 h-8 rounded-full border-2 border-dashed border-white flex items-center justify-center text-lg leading-none">
                                        +
                                    </button>
                                    <span class="text-xs text-white/80">Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ† Ø¬Ø¯ÙŠØ¯</span>
                                </div>
                                <div id="wheelColorAddArea" class="mt-2 hidden">
                                    <div class="text-xs text-white/80 mb-2">Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©:</div>
                                    <div id="wheelPresetColorsContainer" class="flex flex-wrap gap-2 mb-3"></div>
                                    <div class="text-xs text-white/80 mb-1">Ø£Ùˆ Ø§Ø®ØªØ± Ù„ÙˆÙ†Ø§Ù‹ Ø¨Ù†ÙØ³Ùƒ:</div>
                                    <div class="flex items-center gap-2">
                                        <input type="color" id="wheelCustomColorInput" class="w-10 h-10 p-0 border-0 rounded-lg">
                                        <button type="button" onclick="addCustomWheelColor()" class="bg-white/30 text-xs text-white px-3 py-1 rounded-lg hover:bg-white/50">
                                            Ø¥Ø¶Ø§ÙØ©
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2 mb-4">
                        <textarea id="wheelOptionsTextarea" placeholder="Ø£Ø¯Ø®Ù„ Ø®ÙŠØ§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© (ÙƒÙ„ Ø®ÙŠØ§Ø± ÙÙŠ Ø³Ø·Ø±)" class="flex-1 px-4 py-2 rounded-lg border-0 bg-white/50 text-gray-800"></textarea>
                    </div>
                    <button onclick="addWheelOption()" class="w-full bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
                    <div id="wheelOptions" class="space-y-2 max-h-40 overflow-y-auto mt-4"></div>
                </div>
            </div>
        </div>

        <!-- Numbers Section -->
        <div id="numbers-section" class="section hidden flex flex-col justify-center items-center min-h-screen pt-8 pb-10">

            <div class="flex flex-col items-center justify-center w-full max-w-full">
                <div id="numberResult" class="text-center">
                    <div id="numberDisplayContainer" class="large-number-circle">
                        <span id="selectedNumber">ØŸ</span>
                    </div>
                </div>
                
                <div class="text-center mt-12 flex flex-col items-center gap-6 w-full px-4">
                    <div class="flex gap-4 w-full max-w-xl">
                        <button id="generateNumberButton" onclick="generateRandomNumber()" class="bg-white/30 text-white px-8 py-3 rounded-lg font-bold hover:bg-white/50 transition-all flex-1">
                            Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                        </button>
                        <button onclick="toggleNumberOptionsModal()" class="bg-white/30 text-white px-8 py-3 rounded-lg font-bold hover:bg-white/50 transition-all flex-shrink-0">
                            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                        </button>
                    </div>
                    <div class="glass-card rounded-xl p-4 w-full max-w-xl text-right">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-white font-semibold text-sm">Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙŠ Ø¸Ù‡Ø±Øª</h4>
                            <button type="button" onclick="clearNumberHistory()" class="text-xs bg-white/20 text-white px-3 py-1 rounded-lg hover:bg-white/30">
                                Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                            </button>
                        </div>
                        <div id="numberHistoryContainer" class="min-h-[40px] max-h-32 overflow-y-auto text-white/90 text-sm">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Modal for Number Options -->
            <div id="numberOptionsModal" class="options-modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white text-2xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø®ÙŠØ§Ø±Ø§Øª Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</h3>
                        <button onclick="toggleNumberOptionsModal()" class="text-white/80 hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="glass-card rounded-lg p-6 mb-6">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-white mb-2">Ù…Ù†:</label>
                                <input type="number" id="minNumber" value="1" class="w-full px-4 py-2 rounded-lg bg-white/50 text-gray-800" onchange="saveNumberSettings()">
                            </div>
                            <div>
                                <label class="block text-white mb-2">Ø¥Ù„Ù‰:</label>
                                <input type="number" id="maxNumber" value="100" class="w-full px-4 py-2 rounded-lg bg-white/50 text-gray-800" onchange="saveNumberSettings()">
                            </div>
                        </div>
                        <div class="w-full flex items-center gap-2 mb-4 text-white">
                            <label class="flex-1 text-sm">Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù† (Ø«Ø§Ù†ÙŠØ©):</label>
                            <input type="range" id="numberDuration" value="5" min="3" max="15" class="flex-1 h-2 bg-white/80 rounded-lg appearance-none cursor-pointer" onchange="saveNumberSettings()">
                            <span id="numberDurationValue" class="w-10 text-right">5</span>
                        </div>
                        <div class="w-full flex flex-col items-start justify-start gap-3">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showNumberPopup" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveNumberSettings()">
                                <label for="showNumberPopup" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©</label>
                            </div>
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showNumberConfetti" checked class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveNumberSettings()">
                                <label for="showNumberConfetti" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø­ØªÙØ§Ù„ (Ù‚ØµØ§ØµØ§Øª)</label>
                            </div>
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="avoidNumberRepeats" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveNumberSettings()">
                                <label for="avoidNumberRepeats" class="text-sm text-white">Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø­ØªÙ‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label>
                            </div>
                        </div>
                    </div>
                    <button onclick="toggleNumberOptionsModal()" class="w-full bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                </div>
            </div>
        </div>

        <!-- Names Section -->
        <div id="names-section" class="section hidden flex flex-col justify-center items-center min-h-screen pt-8 pb-10">
            
            <div class="flex flex-col items-center justify-center w-full max-w-full">
                <div id="nameResult" class="text-center overflow-x-auto w-full"> <!-- ÙˆØ³Ù… w-full Ù…Ù‡Ù… Ù‡Ù†Ø§ -->
                    <!-- Name Display Rectangle (Modified to large-name-display) -->
                    <div id="nameDisplayContainer" class="large-name-display">
                        <p class="text-white/90">ğŸ† Ø§Ù„ÙØ§Ø¦Ø²</p>
                        <span id="selectedName" class="text-white max-w-full">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯</span>
                    </div>
                </div>
                
                <div class="text-center mt-12 flex flex-col gap-4">
                    <div class="flex gap-4 w-full">
                        <button id="selectNameButton" onclick="selectRandomName()" class="bg-white/30 text-white px-8 py-3 rounded-lg font-bold hover:bg-white/50 transition-all flex-1 shadow-lg border border-white/20">
                            Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                        </button>
                        <button onclick="toggleNameOptionsModal()" class="bg-white/30 text-white px-4 py-3 rounded-lg font-bold hover:bg-white/50 transition-all flex-shrink-0 shadow-lg border border-white/20" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">
                            âš™ï¸
                        </button>
                    </div>
                    
                    <div class="flex gap-4 w-full">
                         <button id="removeWinnerBtn" onclick="removeCurrentWinner()" class="bg-red-500/30 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-500/50 transition-all flex-1 shadow-lg border border-white/20 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙØ§Ø¦Ø²
                        </button>
                        <button onclick="toggleHistoryModal()" class="bg-blue-500/30 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-500/50 transition-all flex-1 shadow-lg border border-white/20">
                            ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal for Name Options -->
            <div id="nameOptionsModal" class="options-modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white text-2xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø®ÙŠØ§Ø±Ø§Øª Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h3>
                        <button onclick="toggleNameOptionsModal()" class="text-white/80 hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="flex flex-col items-center gap-4 mb-4 text-white">

                        <div class="w-full flex items-center gap-2">
                            <label class="flex-1 text-sm">Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù† (Ø«Ø§Ù†ÙŠØ©):</label>
                            <input type="range" id="nameDuration" value="5" min="3" max="15" class="flex-1 h-2 bg-white/80 rounded-lg appearance-none cursor-pointer" onchange="saveNameSettings()">
                            <span id="nameDurationValueModal" class="w-10 text-right">5</span>
                        </div>
                        <div class="w-full flex flex-col items-start justify-start gap-3">
                            <!-- Ø®ÙŠØ§Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ -->
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="dynamicNameDuration" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveNameSettings(); toggleNameDurationSlider()">
                                <label for="dynamicNameDuration" class="text-sm text-white">ÙˆÙ‚Øª Ø¯ÙˆØ±Ø§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ)</label>
                            </div>
                            <!-- Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø¥Ù‚ØµØ§Ø¡ Ø§Ù„ÙØ§Ø¦Ø² ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="autoRemoveName" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveNameSettings()">
                                <label for="autoRemoveName" class="text-sm text-white">Ø¥Ù‚ØµØ§Ø¡ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¦Ø² ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</label>
                            </div>
                            <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
                             <div class="flex items-center gap-3">
                                <input type="checkbox" id="showNamePopup" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveNameSettings()">
                                <label for="showNamePopup" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©</label>
                            </div>
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showNameConfetti" checked class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveNameSettings()">
                                <label for="showNameConfetti" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø­ØªÙØ§Ù„ (Ù‚ØµØ§ØµØ§Øª)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card rounded-lg p-6 mb-6">
                        <h3 class="text-white font-bold mb-4">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡:</h3>
                        <div class="flex gap-2 mb-4">
                            <textarea id="namesTextarea" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø© (ÙƒÙ„ Ø§Ø³Ù… ÙÙŠ Ø³Ø·Ø±)" class="flex-1 px-4 py-2 rounded-lg border-0 bg-white/50 text-gray-800"></textarea>
                        </div>
                        <div class="flex gap-2 mb-4 w-full">
                             <button onclick="addNamesFromTextarea()" class="bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50 flex-1">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
                             <label for="importFile" class="bg-blue-500/30 text-white px-4 py-2 rounded-lg hover:bg-blue-500/50 cursor-pointer text-center transition-all border border-white/20 flex-1 flex items-center justify-center gap-2">
                                <span>ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ (Excel/Txt)</span>
                                <input type="file" id="importFile" accept=".txt,.csv,.xlsx,.xls" class="hidden" onchange="importNamesFile(this)">
                            </label>
                        </div>
                        <div id="namesList" class="space-y-2 max-h-40 overflow-y-auto mt-4"></div>
                        <button onclick="clearNames()" class="w-full mt-4 bg-white/30 text-white py-2 rounded-lg hover:bg-white/50">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                    </div>
                    <button onclick="toggleNameOptionsModal()" class="w-full bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50">Ø¥ØºÙ„Ø§Ù‚ ÙˆØ­ÙØ¸</button>
                </div>
            </div>
        </div>

        <!-- Dice Section -->
        <div id="dice-section" class="section hidden flex flex-col justify-center items-center min-h-screen pt-8 pb-10">
            <div class="glass-card rounded-2xl p-8 w-full max-w-xl">
                <h1 class="text-3xl font-bold text-white mb-6 text-center">
                    <img src="https://i.postimg.cc/3xdrzKDf/image.png" alt="Ø§Ù„Ù†Ø±Ø¯" class="inline-block h-8 w-8 ml-2">
                    Ø§Ù„Ù†Ø±Ø¯
                </h1>
                <div class="max-w-md mx-auto text-center">
                    
                    <div class="dice-wrapper">
                        <div id="diceContainer" class="flex justify-center gap-4 mb-6"></div>
                    </div>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª -->
                    <div class="text-center mt-12 flex gap-4">
                        <button id="rollDiceButton" onclick="rollDice()" class="bg-white/30 text-white px-8 py-3 rounded-lg font-bold hover:bg-white/50 transition-all flex-1">
                            Ø±Ù…ÙŠ Ø§Ù„Ù†Ø±Ø¯
                        </button>
                        <button onclick="toggleDiceOptionsModal()" class="bg-white/30 text-white px-4 py-3 rounded-lg font-bold hover:bg-white/50 transition-all flex-shrink-0" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">
                            âš™ï¸
                        </button>
                        <button onclick="toggleDiceHistoryModal()" class="bg-blue-500/30 text-white px-4 py-3 rounded-lg font-bold hover:bg-blue-500/50 transition-all flex-shrink-0" title="Ø§Ù„Ø³Ø¬Ù„">
                            ğŸ“œ
                        </button>
                    </div>

                    <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø±Ø¯ -->
                    <div class="mt-6 mb-6">
                        <label class="block text-white font-semibold mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø±Ø¯:</label>
                        <div class="radio-inputs max-w-xs" id="diceCountRadios">
                            <label class="radio">
                                <input type="radio" name="dice-count" value="1" onclick="handleDiceCountChange()">
                                <span class="name">1</span>
                            </label>
                            <label class="radio">
                                <input type="radio" name="dice-count" value="2" onclick="handleDiceCountChange()">
                                <span class="name">2</span>
                            </label>
                            <label class="radio">
                                <input type="radio" name="dice-count" value="3" onclick="handleDiceCountChange()">
                                <span class="name">3</span>
                            </label>
                        </div>
                    </div>

                    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
                    <div class="mt-6">
                        <div id="diceResultDisplay" class="text-white text-2xl font-bold mb-4 min-h-[40px]"></div>
                    </div>
                </div>
            </div>

            <!-- Modal for Dice Options -->
            <div id="diceOptionsModal" class="options-modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white text-2xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†Ø±Ø¯</h3>
                        <button onclick="toggleDiceOptionsModal()" class="text-white/80 hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="glass-card rounded-lg p-6 mb-6">
                        <div class="w-full flex flex-col items-start justify-start gap-3">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showDicePopup" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveDiceSettings()">
                                <label for="showDicePopup" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©</label>
                            </div>
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showDiceConfetti" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveDiceSettings()">
                                <label for="showDiceConfetti" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø­ØªÙØ§Ù„ (Ù‚ØµØ§ØµØ§Øª)</label>
                            </div>
                        </div>
                    </div>
                    <button onclick="toggleDiceOptionsModal()" class="w-full bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                </div>
            </div>

            <!-- Modal for Dice History -->
            <div id="diceHistoryModal" class="options-modal">
                <div class="modal-content" style="max-width: 400px;">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white text-2xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ø±Ù…ÙŠØ§Øª</h3>
                        <button onclick="toggleDiceHistoryModal()" class="text-white/80 hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="glass-card rounded-lg p-4 mb-4">
                        <div id="diceHistoryContainer" class="space-y-2 max-h-60 overflow-y-auto flex flex-col gap-2">
                            <p class="text-white/50 text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        </div>
                    </div>
                    
                    <button onclick="clearDiceHistory()" class="w-full bg-red-500/30 text-white px-4 py-2 rounded-lg hover:bg-red-500/50 mb-2">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
                    <button onclick="toggleDiceHistoryModal()" class="w-full bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            </div>
        </div>

        <!-- Coin Section -->
        <div id="coin-section" class="section hidden flex flex-col justify-center items-center min-h-screen pt-8 pb-10">
            <div class="glass-card rounded-2xl p-8 text-center w-full max-w-xl">
                <h1 class="text-3xl font-bold text-white mb-6">
                    <img src="https://i.postimg.cc/0jJ3CXQc/image.png" alt="Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©" class="inline-block h-8 w-8 ml-2">
                    Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©
                </h1>
                <div class="max-w-md mx-auto">
                    <div class="mb-6 coin-container">
                        <div id="coin-toss-wrapper" style="transform-style: preserve-3d;">
                            <div id="coin" class="coin mx-auto"></div>
                        </div>
                    </div>

                    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙˆØ±ÙŠØ© -->
                    <div class="flex justify-center gap-8 mb-8 text-white">
                        <div class="text-center bg-white/10 px-6 py-2 rounded-lg backdrop-blur-sm border border-white/20">
                            <div class="text-sm opacity-80 mb-1">ØµÙˆØ±Ø©</div>
                            <div id="headsCount" class="text-2xl font-bold">0</div>
                        </div>
                        <div class="text-center bg-white/10 px-6 py-2 rounded-lg backdrop-blur-sm border border-white/20">
                            <div class="text-sm opacity-80 mb-1">ÙƒØªØ§Ø¨Ø©</div>
                            <div id="tailsCount" class="text-2xl font-bold">0</div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-8 flex flex-col gap-4">
                        <div class="flex gap-4 w-full">
                            <button id="flipCoinButton" onclick="flipCoin()" class="bg-white/30 text-white px-8 py-3 rounded-lg font-bold hover:bg-white/50 transition-all flex-1 shadow-lg border border-white/20">
                                Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©
                            </button>
                            <button onclick="toggleCoinOptionsModal()" class="bg-white/30 text-white px-4 py-3 rounded-lg font-bold hover:bg-white/50 transition-all flex-shrink-0 shadow-lg border border-white/20" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">
                                âš™ï¸
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal for Coin Options -->
            <div id="coinOptionsModal" class="options-modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white text-2xl font-bold">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø©</h3>
                        <button onclick="toggleCoinOptionsModal()" class="text-white/80 hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="glass-card rounded-lg p-6 mb-6">
                        <div class="w-full flex flex-col items-start justify-start gap-3">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showCoinPopup" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveCoinSettings()">
                                <label for="showCoinPopup" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©</label>
                            </div>
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="showCoinConfetti" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="saveCoinSettings()">
                                <label for="showCoinConfetti" class="text-sm text-white">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø­ØªÙØ§Ù„ (Ù‚ØµØ§ØµØ§Øª)</label>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="toggleCoinHistoryModal()" class="w-full bg-blue-500/30 text-white px-4 py-3 rounded-lg font-bold hover:bg-blue-500/50 transition-all shadow-lg border border-white/20 mb-4 flex items-center justify-center gap-2">
                        <span class="text-xl">ğŸ“œ</span>
                        Ø³Ø¬Ù„ Ø§Ù„Ø±Ù…ÙŠØ§Øª
                    </button>

                    <button onclick="toggleCoinOptionsModal()" class="w-full bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            </div>
        </div>
        
        <!-- Drag and Drop Section -->
        <div id="drag-and-drop-section" class="section hidden">
             <div class="glass-card rounded-2xl p-8">
                <h1 class="text-3xl font-bold text-white mb-6 text-center">
                    <img src="https://i.postimg.cc/yx1sjBHP/image.png" alt="ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡" class="inline-block h-8 w-8 ml-2">
                    ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
                </h1>
                <div class="max-w-6xl mx-auto">
                    <!-- Team Selection Section -->
                    <!-- ** ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… flex-col Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ ÙˆØ¶Ø¨Ø· Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ ** -->
                    <div class="glass-card rounded-xl shadow-lg p-6 mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4">
                        
                        <!-- Ø­Ø§ÙˆÙŠØ© Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ (Ù…Ø¹ Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„) -->
                        <div class="flex flex-col sm:flex-row justify-start sm:items-center w-full md:w-auto gap-4 flex-wrap">
                            <label class="text-lg font-semibold text-white flex-shrink-0">Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚:</label>
                            <!-- ** ØªØ·Ø¨ÙŠÙ‚ Ù†Ù…Ø· Tabs Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§ ** -->
                            <div class="tabs-container" id="teamCountRadios">
                                <!-- ØªÙ… Ø­Ø°Ù Ø§Ù„Ø®ÙŠØ§Ø± 1 -->
                                <div class="tab-group">
                                    <input type="radio" id="team_2" name="team-count" value="2" onclick="handleTeamCountChange()">
                                    <label for="team_2">2</label>
                                </div>
                                <div class="tab-group">
                                    <input type="radio" id="team_3" name="team-count" value="3" onclick="handleTeamCountChange()">
                                    <label for="team_3">3</label>
                                </div>
                                <div class="tab-group">
                                    <input type="radio" id="team_4" name="team-count" value="4" onclick="handleTeamCountChange()">
                                    <label for="team_4">4</label>
                                </div>
                                <div class="tab-group">
                                    <input type="radio" id="team_5" name="team-count" value="5" onclick="handleTeamCountChange()">
                                    <label for="team_5">5</label>
                                </div>
                                <div class="tab-group">
                                    <input type="radio" id="team_6" name="team-count" value="6" onclick="handleTeamCountChange()">
                                    <label for="team_6">6</label>
                                </div>
                            </div>
                            <!-- Ù†Ù‡Ø§ÙŠØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
                        </div>
                         
                         <!-- Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¯Ø§Ø¦Ù…Ø§ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„/Ø§Ù„ÙŠÙ…ÙŠÙ†) -->
                        <button
                            id="exportTeamsBtn"
                            onclick="exportTeamsToCSV()"
                            class="bg-white/30 hover:bg-white/50 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center justify-center w-full md:w-auto flex-shrink-0"
                        >
                             â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV
                        </button>
                    </div>

                    <!-- Add Name Section -->
                    <div class="glass-card rounded-xl shadow-lg p-6 mb-8">
                        <div class="space-y-4">
                            <div class="border-t border-white/30 pt-4">
                                <label class="block text-sm font-medium text-white mb-2">Ø£Ø¶Ù Ø¹Ø¯Ø© Ø£Ø³Ù…Ø§Ø¡ (Ø§Ø³Ù… ÙÙŠ ÙƒÙ„ Ø³Ø·Ø± Ø£Ùˆ Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„):</label>
                                <div class="flex flex-col sm:flex-row gap-4">
                                    <textarea
                                        id="multipleNamesInput"
                                        placeholder="Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…&#10;Ø®Ø§Ù„Ø¯ ÙÙŠØµÙ„"
                                        rows="4"
                                        class="flex-1 w-full px-4 py-3 border-2 border-white/30 rounded-lg focus:border-white focus:outline-none text-lg resize-none bg-white/20 text-gray-800 placeholder-white/70"
                                    ></textarea>
                                    <button
                                        id="addMultipleBtn"
                                        class="w-full sm:w-auto bg-white/30 hover:bg-white/50 text-white px-6 py-3 rounded-lg font-semibold transition-colors self-start"
                                    >
                                        â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lists Container -->
                    <div class="flex flex-col lg:flex-row gap-4">
                        <!-- Unorganized Names -->
                        <div class="lg:w-64 w-full flex-shrink-0">
                            <div class="glass-card rounded-xl shadow-lg p-4 h-full">
                                <div class="flex justify-between items-center mb-4 flex-wrap">
                                    <h2 class="text-lg font-bold text-white flex items-center">
                                        ğŸ“ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø©
                                    </h2>
                                    <div class="flex gap-2">
                                        <button
                                            id="randomDistributeBtn"
                                            class="bg-white/30 hover:bg-white/50 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors"
                                        >
                                            ğŸ² ØªÙˆØ²ÙŠØ¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                                        </button>
                                        <button
                                            id="clearAllBtn"
                                            class="bg-white/30 hover:bg-white/50 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors"
                                        >
                                            ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                                        </button>
                                        <button
                                            id="resetAllBtn"
                                            class="bg-white/30 hover:bg-white/50 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors"
                                        >
                                            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
                                        </button>
                                    </div>
                                </div>
                                <div
                                    id="unorganized"
                                    class="h-48 lg:h-96 p-3 border-2 border-dashed border-white/30 rounded-lg bg-white/10 overflow-y-auto"
                                >
                                    <!-- Names will be added here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Teams Container (Optimized for Mobile Horizontal Scroll) -->
                        <div id="teamsContainer" class="flex-1 flex flex-nowrap lg:flex-wrap overflow-x-auto gap-4 py-4">
                            <!-- Teams will be generated here -->
                        </div>
                    </div>

                    <!-- Statistics -->
                    <div class="mt-8 glass-card rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-white mb-4">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
                        <div id="statisticsContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                            <!-- Statistics will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØªØ®Ø²ÙŠÙ† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø±ÙˆÙ„ ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡
        let wheelOptions = ['Ø§Ù„Ø®ÙŠØ§Ø± 1', 'Ø§Ù„Ø®ÙŠØ§Ø± 2', 'Ø§Ù„Ø®ÙŠØ§Ø± 3', 'Ø§Ù„Ø®ÙŠØ§Ø± 4'];
        let wheelBaseColors = [];
        const wheelPresetColors = [
            '#ef4444',
            '#3b82f6',
            '#22c55e',
            '#f59e0b',
            '#f97316',
            '#a855f7',
            '#ec4899',
            '#14b8a6',
            '#f472b6',
            '#818cf8'
        ];
        let names = []; // Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
        let winnersHistory = []; // Ø³Ø¬Ù„ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†
        let currentSection = 'main-menu'; // Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…ØªØµÙØ­
        
        let isSpinning = false;
        
        let nameCounter = 0; // Ù„Ø¶Ù…Ø§Ù† Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
        let currentTeamCount = 4;
        // ** Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 1: ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ **
        let currentDiceCount = 2; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø±Ø¯
        let selectedNameId = null;
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ù„Ù„Ø³Ø­Ø¨
        let isDragging = false;
        let lastAngle = 0;
        let currentRotation = 0;
        let lastTime = 0;
        let velocity = 0;
        let currentWinningIndex = null;

        // ** Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ®Ø²ÙŠÙ† Intervals **
        let numberInterval = null; // Ù„Ù€ generateRandomNumber
        let nameInterval = null;   // Ù„Ù€ selectRandomName
        
        function getSecureRandomInt(max) {
            if (max <= 0) return 0;
            if (window.crypto && window.crypto.getRandomValues) {
                const array = new Uint32Array(1);
                window.crypto.getRandomValues(array);
                return array[0] % max;
            }
            return Math.floor(Math.random() * max);
        }
        
        // **Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ØµØ­Ø­Ø© Ù„Ù„ÙØ±Ù‚:** (Ø£Ø­Ù…Ø±ØŒ Ø£Ø²Ø±Ù‚ØŒ Ø£Ø®Ø¶Ø±ØŒ Ø£ØµÙØ±ØŒ Ø¨Ù†ÙØ³Ø¬ÙŠØŒ Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ)
        const teamConfigs = [
            { id: 1, name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±', color: 'red', emoji: 'ğŸ”´', bgClass: 'team-red' },
            { id: 2, name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚', color: 'blue', emoji: 'ğŸ”µ', bgClass: 'team-blue' },
            { id: 3, name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø®Ø¶Ø±', color: 'green', emoji: 'ğŸŸ¢', bgClass: 'team-green' },
            { id: 4, name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ØµÙØ±', color: 'yellow', emoji: 'ğŸŸ¡', bgClass: 'team-yellow' },
            { id: 5, name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ', color: 'purple', emoji: 'ğŸŸ£', bgClass: 'team-purple' },
            { id: 6, name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ', color: 'orange', emoji: 'ğŸŸ ', bgClass: 'team-orange' }
        ];

        // ** Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ **
        let customTeamNames = {};
        
        // ==========================================================
        //         Ø¯ÙˆÙ‘Ø§Ù„ Ø§Ù„ØµÙˆØª (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ØµÙˆØ§Øª ÙˆØ§Ù‚Ø¹ÙŠØ© Ù…Ù† Ù…Ù„ÙØ§Øª)
        // ==========================================================
        
        const sounds = {
            // ØµÙˆØª ØªÙƒØªÙƒØ© / Ø¯ÙˆØ±Ø§Ù† (Ù…Ù† GitHub)
            spin: new Audio("https://github.com/Abo3bdallah/my-saond/raw/refs/heads/main/%D8%B5%D9%88%D8%AA-%D8%A7%D9%84%D8%B9%D8%AC%D9%84%D8%A9.mp3"),
            // ØµÙˆØª Ø§Ù„ÙÙˆØ² (ØªÙ… Ø¥Ù„ØºØ§Ø¤Ù‡ - Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Cheer Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù†Ù‡)
            win: new Audio(""), 
            // ØµÙˆØª Ø§Ù„Ù†Ù‚Ø± / Ø§Ù„ØªÙŠÙƒ Ø§Ù„Ø³Ø±ÙŠØ¹ (ÙŠØ³ØªØ®Ø¯Ù… Ù„Ø¹Ø¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ - Ù†Ø±Ø¯.m4a)
            // ** ØªÙ… ØªØºÙŠÙŠØ± click Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØª number Ù„Ø¶Ù…Ø§Ù† ØµÙˆØª Ø¹Ø¯ Ù…Ø³ØªÙ…Ø± **
            click: new Audio(""),
            // ØµÙˆØª Ø¹Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… (Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯)
            number: new Audio("https://github.com/Abo3bdallah/my-saond/raw/refs/heads/main/%D8%B5%D9%88%D8%AA%20%D8%A7%D9%84%D8%A7%D8%B1%D9%82%D8%A7%D9%852%20.mp3"),
            // ØµÙˆØª Ø§Ø­ØªÙØ§Ù„ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯) - ÙŠØ³ØªØ®Ø¯Ù… ÙƒØµÙˆØª ÙÙˆØ² Ø¨ØµØ±ÙŠ
            cheer: new Audio("https://github.com/Abo3bdallah/my-saond/raw/refs/heads/main/%D8%B5%D9%88%D8%AA%20%D9%81%D9%88%D8%B2.mp3.mp3"),
            // ** Ø¬Ø¯ÙŠØ¯: ØµÙˆØª Ø§Ù„Ù…ÙØ±Ù‚Ø¹Ø§Øª/Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø± **
            confetti_pop: new Audio("https://github.com/Abo3bdallah/my-saond/raw/refs/heads/main/%D9%85%D9%81%D8%B1%D9%82%D8%B9%D8%A7%D8%AA%201.m4a"),
            // ØµÙˆØª Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø© (Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯)
            coin: new Audio("https://github.com/Abo3bdallah/my-saond/raw/refs/heads/main/%D8%B5%D9%88%D8%AA%20%D8%B9%D9%85%D9%84%D8%A9.mp3"),
            // ØµÙˆØª Ø±Ù…ÙŠ Ø§Ù„Ù†Ø±Ø¯ (Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯)
            dice: new Audio("https://github.com/Abo3bdallah/my-saond/raw/refs/heads/main/%D9%86%D8%B1%D8%AF%D9%8A%203.m4a"), 
            // ØµÙˆØª Ø£Ø®Ø° Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯)
            take_name: new Audio("https://github.com/Abo3bdallah/my-saond/raw/refs/heads/main/%D8%B5%D9%88%D8%AA%20%D8%A7%D8%AE%D8%B0.mp3"),
            // ØµÙˆØª ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯)
            put_name: new Audio("https://github.com/Abo3bdallah/my-saond/raw/refs/heads/main/%D8%B5%D9%88%D8%AA%20%D9%88%D8%B6%D8%B9.mp3"),
            // ØµÙˆØª Ø®Ø·Ø£/ØªÙ†Ø¨ÙŠÙ‡ (Pixabay)
            error: new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_249df9c4d9.mp3")
        };
        
        // ** ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Ù† ÙˆØ§Ù„Ø¹Ù…Ù„Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… **
        sounds.spin.loop = true; 
        sounds.coin.loop = true; 
        sounds.number.loop = true;
        // ** ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„ØµÙˆØª Ø§Ù„Ø¹Ø¯ ÙÙŠ Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (click) **
        sounds.click.loop = true;

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ÙˆÙ„Ø¯
        let audioCtx = null;
        
        // Ø¯Ø§Ù„Ø© Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„ØµÙˆØªÙŠ (ÙŠØ¬Ø¨ Ø£Ù† ØªØ³ØªØ¯Ø¹Ù‰ Ø¨Ø¹Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
        function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ ØµÙˆØª ØªÙƒØ© Ø±Ù‚Ù…ÙŠ (Digital Tick)
        // rate: Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø³Ø±Ø¹Ø© (1 = Ø³Ø±ÙŠØ¹/Ø¹Ø§Ø¯ÙŠØŒ Ø£Ù‚Ù„ = Ø£Ø¨Ø·Ø£/Ø£ØºÙ„Ø¸)
        function playDigitalTick(rate = 1) {
            initAudioContext();
            if (!audioCtx) return;

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØª (Triangle ÙŠØ¹Ø·ÙŠ ØµÙˆØª Ù†Ø§Ø¹Ù… ÙˆÙ†Ù‚ÙŠ ÙŠØ´Ø¨Ù‡ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©)
            osc.type = 'triangle'; 
            
            // ØªØºÙŠÙŠØ± Ø§Ù„ØªØ±Ø¯Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø±Ø¹Ø© (Ù…Ø­Ø§ÙƒØ§Ø© ØªØ¨Ø§Ø·Ø¤ Ø§Ù„Ù…Ø­Ø±Ùƒ)
            // Ø§Ù„ØªØ±Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ 600HzØŒ ÙŠÙ†Ø®ÙØ¶ Ù…Ø¹ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø³Ø±Ø¹Ø©
            const frequency = 400 + (400 * rate); 
            osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            
            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø³Ø±ÙŠØ¹ ÙÙŠ Ø§Ù„ØªØ±Ø¯Ø¯ (Chirp effect) Ù„Ø¬Ø¹Ù„Ù‡ ÙŠØ´Ø¨Ù‡ "Ø§Ù„ØªÙƒØ©"
            osc.frequency.exponentialRampToValueAtTime(frequency * 0.1, audioCtx.currentTime + 0.05);

            // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØª (Envelope) - Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.06);
        }

        // ** Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: ØªÙˆÙ„ÙŠØ¯ ØµÙˆØª ØªØ¯Ø­Ø±Ø¬ Ø§Ù„Ù†Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© (Roll) - Ù…Ø­Ø³Ù† Ù„ÙŠÙƒÙˆÙ† Ø£Ù†Ù‚Ù‰ ÙˆØ£ÙˆØ¶Ø­ **
        function playDiceRolling() {
            initAudioContext();
            if (!audioCtx) return;
            
            const t = audioCtx.currentTime;
            const duration = 1.2; 
            
            const impactCount = 8; // Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø±ØªØ·Ø§Ù…Ø§Øª
            
            for (let i = 0; i < impactCount; i++) {
                // ØªÙˆÙ‚ÙŠØª Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ø¹ ØªØ¨Ø§Ø¹Ø¯ ÙŠØ²ÙŠØ¯ ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹
                const time = t + (Math.random() * 0.1) + (i * 0.15); 
                if (time > t + duration) break;

                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆØ¬Ø© Ù…Ø«Ù„Ø«Ø© (Triangle) Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Sine Ù„ÙŠÙƒÙˆÙ† Ø§Ù„ØµÙˆØª "Ø£Ù‚Ø³Ù‰" ÙˆØ£Ù‚Ù„ ÙƒØªÙ…Ø©
                osc.type = 'triangle';
                
                // Ø±ÙØ¹ Ø§Ù„ØªØ±Ø¯Ø¯ Ù„ÙŠØ¨Ø¯Ùˆ Ø§Ù„Ù†Ø±Ø¯ Ø£ØµØºØ± ÙˆØ£ØµÙ„Ø¨ (Ø¨Ù„Ø§Ø³ØªÙŠÙƒ Ø¹Ù„Ù‰ Ø®Ø´Ø¨)
                // ÙŠØ¨Ø¯Ø£ Ù…Ù† ~400Hz ÙˆÙŠÙ†Ø²Ù„ Ù„Ù€ ~100Hz
                osc.frequency.setValueAtTime(350 + Math.random() * 100, time);
                osc.frequency.exponentialRampToValueAtTime(80, time + 0.08);
                
                // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØª (Envelope)
                const vol = (1 - (i/impactCount)) * (0.4 + Math.random() * 0.2);
                
                gain.gain.setValueAtTime(0, time);
                gain.gain.linearRampToValueAtTime(vol, time + 0.005); // Ù‡Ø¬ÙˆÙ… Ø£Ø³Ø±Ø¹ Ù„ØµÙˆØª "ØªÙƒØ©"
                gain.gain.exponentialRampToValueAtTime(0.01, time + 0.08); 
                
                osc.start(time);
                osc.stop(time + 0.1);
            }
        }

        // ** Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: ØªÙˆÙ„ÙŠØ¯ ØµÙˆØª Ø§Ø±ØªØ·Ø§Ù… Ø§Ù„Ù†Ø±Ø¯ Ø¨Ø§Ù„Ø£Ø±Ø¶ (Final Hit) - ÙˆØ§Ø¶Ø­ **
        function playDiceHit() {
            initAudioContext();
            if (!audioCtx) return;
            
            const t = audioCtx.currentTime;
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            // Ù…ÙˆØ¬Ø© Ù…Ø«Ù„Ø«Ø© Ù„ØµÙˆØª ÙˆØ§Ø¶Ø­
            osc.type = 'triangle';
            
            // Ø¶Ø±Ø¨Ø© Ù‚ÙˆÙŠØ© ÙˆÙˆØ§Ø¶Ø­Ø©
            osc.frequency.setValueAtTime(450, t);
            osc.frequency.exponentialRampToValueAtTime(60, t + 0.12);
            
            gain.gain.setValueAtTime(0, t);
            gain.gain.linearRampToValueAtTime(0.6, t + 0.005);
            gain.gain.exponentialRampToValueAtTime(0.01, t + 0.15);
            
            osc.start(t);
            osc.stop(t + 0.2);
        }

        // Ù…ØªØºÙŠØ± Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù…Ø¯Ø© ØµÙˆØª Ø§Ù„ØªØ´Ø¬ÙŠØ¹
        let cheerTimeout = null;

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ´ØºÙŠÙ„ Ø£ÙŠ ØµÙˆØª Ø¨Ø³Ø±Ø¹Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·Ù‡
        function playSound(type) {
             const sound = sounds[type];
             if (sound && sound.src.length > 0) { 
                 // ** Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªÙŠ ØªØªÙƒØ±Ø± Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¢Ø®Ø± **
                 const isLoopingSound = (type === 'spin' || type === 'coin' || type === 'number' || type === 'click');
                 
                 if (isLoopingSound) {
                    sound.currentTime = 0;
                 }
                 
                 // Ø¥ÙŠÙ‚Ø§Ù Ø£ØµÙˆØ§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Ù† ÙˆØ§Ù„ØªÙƒØªÙƒØ© Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ø£ØµÙˆØ§Øª Ø£Ø®Ø±Ù‰
                 if (type === 'error' || type === 'cheer' || type === 'take_name' || type === 'put_name' || type === 'dice' || type === 'confetti_pop') {
                     sounds.spin.pause();
                     sounds.coin.pause();
                     sounds.number.pause();
                     sounds.click.pause();
                 }
                 
                 sound.play().catch(e => console.error("Error playing sound:", type, e)); 
                 
                 // ** ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯Ø© ØµÙˆØª Ø§Ù„ØªØ´Ø¬ÙŠØ¹ Ø¨Ù€ 3 Ø«ÙˆØ§Ù†Ù ÙÙ‚Ø· **
                 if (type === 'cheer') {
                     if (cheerTimeout) clearTimeout(cheerTimeout);
                     cheerTimeout = setTimeout(() => {
                         stopCheerSound();
                     }, 3000);
                 }
             }
        }
        
        // ** Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®Ø§ØµØ© **
        function stopSpinSound() {
            sounds.spin.pause();
            sounds.spin.currentTime = 0;
        }

        function stopCoinSound() {
            sounds.coin.pause();
            sounds.coin.currentTime = 0;
        }

        function stopNumberSound() {
            sounds.number.pause();
            sounds.number.currentTime = 0;
        }
        
        // ** Ø¯Ø§Ù„Ø© Ø¥ÙŠÙ‚Ø§Ù ØµÙˆØª Ø¹Ø¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ **
        function stopNameTickSound() {
            sounds.click.pause();
            sounds.click.currentTime = 0;
        }

        function stopCheerSound() {
            sounds.cheer.pause();
            sounds.cheer.currentTime = 0;
        }

        // ==========================================================
        //         Ø¯Ø§Ù„Ø© Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø´Ø·Ø© (Ø¬Ø¯ÙŠØ¯)
        // ==========================================================
        function stopAllActivities() {
            // 1. Ø¥ÙŠÙ‚Ø§Ù Ø£ØµÙˆØ§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Ù† ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
            stopSpinSound();
            stopCoinSound();
            stopNumberSound();
            stopNameTickSound();
            stopCheerSound();

            // 2. Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¯ÙˆØ§Ø±Ø© Ù„Ù„Ø¹Ø¬Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
            if (isSpinning) {
                // Ø¥ÙŠÙ‚Ø§Ù Ø£Ù†Ù…ÙŠØ´Ù† JS Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¹Ù…Ù„
                if (wheelAnimationId) {
                    cancelAnimationFrame(wheelAnimationId);
                    wheelAnimationId = null;
                }
                
                const wheel = document.getElementById('wheelCanvas');
                if (wheel) {
                    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø±ÙƒØ© Ø¹Ø¨Ø± Ø¥Ø²Ø§Ù„Ø© transition (Ø§Ø­ØªÙŠØ§Ø·)
                    wheel.style.transition = 'none';
                    // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø­Ø±ÙƒØ© Ø¨ØµØ±ÙŠØ§Ù‹
                    const style = window.getComputedStyle(wheel);
                    wheel.style.transform = style.transform;
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
                    document.getElementById('spinWheelButton').disabled = false;
                    document.getElementById('wheelPointer').classList.remove('wobble');
                    isSpinning = false;
                    wheel.removeEventListener('transitionend', handleSpinEnd);
                }
            }

            // 3. Ø¥ÙŠÙ‚Ø§Ù Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡
            if (numberInterval !== null) {
                clearTimeout(numberInterval); // Ø§Ø³ØªØ®Ø¯Ø§Ù… clearTimeout Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† clearInterval
                numberInterval = null;
                document.getElementById('generateNumberButton').disabled = false;
                stopNumberSound(); // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª
            }

            if (nameInterval !== null) {
                clearTimeout(nameInterval); // ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ clearTimeout
                nameInterval = null;
                document.getElementById('selectNameButton').disabled = false;
                stopNameTickSound(); // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª
            }

            // 4. Ø¥ÙŠÙ‚Ø§Ù Ø­Ø±ÙƒØ© Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©
            const coin = document.getElementById('coin');
            if (coin) {
                coin.style.transition = 'none';
                coin.style.transform = coin.style.transform;
                document.getElementById('flipCoinButton').disabled = false;
            }

            // 5. Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
            closeResultPopup();
        }
        
        // ==========================================================
        //         Ø¯ÙˆÙ‘Ø§Ù„ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ (localStorage)
        // ==========================================================
        
        // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø£ÙŠ Ù‚ÙŠÙ…Ø© ÙÙŠ localStorage
        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.error("Error saving to localStorage", e);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ù‚ÙŠÙ…Ø© Ù…Ù† localStorage
        function loadFromLocalStorage(key, defaultValue) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error("Error loading from localStorage", e);
                return defaultValue;
            }
        }
        
        // ----------------- Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ -----------------
        function saveWheelSettings() {
            saveToLocalStorage('wheelOptions', wheelOptions);
            const settings = {
                showPopup: document.getElementById('showWheelPopup').checked,
                showConfetti: document.getElementById('showWheelConfetti').checked,
                colors: wheelBaseColors
            };
            saveToLocalStorage('wheelSettings', settings);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸
        function loadWheelSettings() {
            wheelOptions = loadFromLocalStorage('wheelOptions', ['Ø§Ù„Ø®ÙŠØ§Ø± 1', 'Ø§Ù„Ø®ÙŠØ§Ø± 2', 'Ø§Ù„Ø®ÙŠØ§Ø± 3', 'Ø§Ù„Ø®ÙŠØ§Ø± 4']);
            const settings = loadFromLocalStorage('wheelSettings', {
                showPopup: true,
                showConfetti: true,
                colors: null
            });
            const showWheelPopupCheckbox = document.getElementById('showWheelPopup');
            const showWheelConfettiCheckbox = document.getElementById('showWheelConfetti');
            if (showWheelPopupCheckbox) showWheelPopupCheckbox.checked = settings.showPopup;
            if (showWheelConfettiCheckbox) showWheelConfettiCheckbox.checked = settings.showConfetti;
            if (Array.isArray(settings.colors) && settings.colors.length > 0) {
                wheelBaseColors = settings.colors;
            } else {
                wheelBaseColors = wheelPresetColors.slice(0, 5);
            }
            renderWheelColors();
        }
        
        // ----------------- Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -----------------
        function saveNumberSettings() {
            const settings = {
                min: document.getElementById('minNumber').value,
                max: document.getElementById('maxNumber').value,
                duration: document.getElementById('numberDuration').value,
                showPopup: document.getElementById('showNumberPopup').checked,
                showConfetti: document.getElementById('showNumberConfetti').checked,
                avoidRepeats: document.getElementById('avoidNumberRepeats') ? document.getElementById('avoidNumberRepeats').checked : false
            };
            saveToLocalStorage('numberSettings', settings);
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        function loadNumberSettings() {
            // ** ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: showPopup: false, showConfetti: true **
            const settings = loadFromLocalStorage('numberSettings', {
                min: 1, max: 100, duration: 5, showPopup: false, showConfetti: true, avoidRepeats: false 
            });
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ… Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('minNumber').value = settings.min;
            document.getElementById('maxNumber').value = settings.max;
            document.getElementById('numberDuration').value = settings.duration;
            document.getElementById('numberDurationValue').textContent = settings.duration;
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const showPopupCheckbox = document.getElementById('showNumberPopup');
            const showConfettiCheckbox = document.getElementById('showNumberConfetti');
            const avoidRepeatsCheckbox = document.getElementById('avoidNumberRepeats');
            if (showPopupCheckbox) showPopupCheckbox.checked = settings.showPopup;
            if (showConfettiCheckbox) showConfettiCheckbox.checked = settings.showConfetti;
            if (avoidRepeatsCheckbox) avoidRepeatsCheckbox.checked = settings.avoidRepeats;
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø´Ø±ÙŠØ· ØªÙ…Ø±ÙŠØ± Ø§Ù„ÙˆÙ‚Øª
        function toggleNameDurationSlider() {
            const isDynamic = document.getElementById('dynamicNameDuration').checked;
            const slider = document.getElementById('nameDuration');
            const label = slider.previousElementSibling;
            const valueSpan = document.getElementById('nameDurationValueModal');
            
            if (isDynamic) {
                slider.disabled = true;
                slider.classList.add('opacity-50', 'cursor-not-allowed');
                label.classList.add('opacity-50');
                valueSpan.classList.add('opacity-50');
                valueSpan.textContent = 'ØŸØŸ';
            } else {
                slider.disabled = false;
                slider.classList.remove('opacity-50', 'cursor-not-allowed');
                label.classList.remove('opacity-50');
                valueSpan.classList.remove('opacity-50');
                valueSpan.textContent = slider.value;
            }
        }

        // ----------------- Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ -----------------
        function saveNameSettings() {
            // Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            saveToLocalStorage('namesList', names);
            // Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†
            saveToLocalStorage('winnersHistory', winnersHistory);
            
            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
            const settings = {
                duration: document.getElementById('nameDuration').value,
                dynamicDuration: document.getElementById('dynamicNameDuration').checked, // ** Ø¬Ø¯ÙŠØ¯ **
                autoRemoveName: document.getElementById('autoRemoveName').checked,
                showPopup: document.getElementById('showNamePopup').checked,
                showConfetti: document.getElementById('showNameConfetti').checked,
            };
            saveToLocalStorage('nameSettings', settings);
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
        function loadNameSettings() {
            names = loadFromLocalStorage('namesList', []); // ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            winnersHistory = loadFromLocalStorage('winnersHistory', []); // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†
            
            // ** ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: showPopup: false, showConfetti: true **
            const settings = loadFromLocalStorage('nameSettings', {
                duration: 5, dynamicDuration: false, autoRemoveName: false, showPopup: false, showConfetti: true
            });
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ… Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('nameDuration').value = settings.duration;
            document.getElementById('nameDurationValueModal').textContent = settings.duration;
            
            // ** ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ **
            const dynamicDurationCheckbox = document.getElementById('dynamicNameDuration');
            if (dynamicDurationCheckbox) {
                dynamicDurationCheckbox.checked = settings.dynamicDuration || false;
                toggleNameDurationSlider(); // ØªØ·Ø¨ÙŠÙ‚ Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            }

            document.getElementById('autoRemoveName').checked = settings.autoRemoveName; // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const showPopupCheckbox = document.getElementById('showNamePopup');
            const showConfettiCheckbox = document.getElementById('showNameConfetti');
            if (showPopupCheckbox) showPopupCheckbox.checked = settings.showPopup;
            if (showConfettiCheckbox) showConfettiCheckbox.checked = settings.showConfetti;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙØ§Ø±ØºØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ø£Ø¶Ù Ø£Ø³Ù…Ø§Ø¡ Ø¹ÙŠÙ†Ø© Ù„ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
            if (names.length === 0) {
                 names = ['Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…', 'Ø®Ø§Ù„Ø¯ ÙÙŠØµÙ„', 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', 'Ø³Ø§Ù„Ù… Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡'];
                 saveNameSettings(); // Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹ÙŠÙ†Ø©
            }
        }
        
        // ----------------- Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø±Ø¯ ÙˆØ§Ù„Ø¹Ù…Ù„Ø© -----------------
        
        // ** Ø¯ÙˆØ§Ù„ Ø­ÙØ¸ ÙˆØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© **
        function saveDiceSettings() {
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ø¯Ø¯
            const checkedRadio = document.querySelector('#diceCountRadios input:checked');
            const diceCount = checkedRadio ? checkedRadio.value : '2';

            const settings = {
                count: diceCount,
                showPopup: document.getElementById('showDicePopup').checked,
                showConfetti: document.getElementById('showDiceConfetti').checked
            };
            saveToLocalStorage('diceSettings', settings);
        }
        
        function loadDiceSettings() {
            const settings = loadFromLocalStorage('diceSettings', {
                count: 2, showPopup: false, showConfetti: false // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ù†Ø±Ø¯Ø§Ù†
            });
            
            // ** Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 2: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø±Ø¯ Ù‡Ù†Ø§ **
            currentDiceCount = parseInt(settings.count) || 2; 

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ
            const diceRadio = document.querySelector(`#diceCountRadios input[value="${settings.count}"]`);
            if (diceRadio) {
                diceRadio.checked = true;
            } else {
                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø©
                document.querySelector('#diceCountRadios input[value="2"]').checked = true;
                currentDiceCount = 2;
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            const showPopupCheckbox = document.getElementById('showDicePopup');
            const showConfettiCheckbox = document.getElementById('showDiceConfetti');

            if (showPopupCheckbox) showPopupCheckbox.checked = settings.showPopup;
            if (showConfettiCheckbox) showConfettiCheckbox.checked = settings.showConfetti;
        }

        // ** Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© **
        function saveCoinSettings() {
            const settings = {
                // duration: document.getElementById('coinDuration').value, // ØªÙ…Øª Ø¥Ø²Ø§Ù„ØªÙ‡ Ù„Ø£Ù†Ù‡ Ø£ØµØ¨Ø­ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
                showPopup: document.getElementById('showCoinPopup').checked,
                showConfetti: document.getElementById('showCoinConfetti').checked,
            };
            saveToLocalStorage('coinSettings', settings);
            
            // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            saveToLocalStorage('coinHistory', coinHistory);
            saveToLocalStorage('coinStats', { heads: headsCount, tails: tailsCount });
        }

        // ** Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© **
        function loadCoinSettings() {
             const settings = loadFromLocalStorage('coinSettings', {
                showPopup: false, showConfetti: false // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            });

            // document.getElementById('coinDuration').value = settings.duration || 3; // ØªÙ…Øª Ø¥Ø²Ø§Ù„ØªÙ‡
            // document.getElementById('coinDurationValue').textContent = settings.duration || 3; // ØªÙ…Øª Ø¥Ø²Ø§Ù„ØªÙ‡
            document.getElementById('showCoinPopup').checked = settings.showPopup;
            document.getElementById('showCoinConfetti').checked = settings.showConfetti;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            coinHistory = loadFromLocalStorage('coinHistory', []);
            const stats = loadFromLocalStorage('coinStats', { heads: 0, tails: 0 });
            headsCount = stats.heads;
            tailsCount = stats.tails;
            
            updateCoinStats();
            renderCoinHistory();
        }
        
        // ----------------- Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª (Ø§Ù„ÙØ±Ù‚) -----------------
        
        // Ø¯Ø§Ù„Ø© Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ ÙˆØ­ÙØ¸Ù‡Ø§
        function saveDragAndDropState() {
            // ** Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© **
            const unorganizedContainer = document.getElementById('unorganized');
            if (!unorganizedContainer) return; 
            
            const state = {};
            // ** Ø§Ù„Ø¥ØµÙ„Ø§Ø­: ØªÙ‡ÙŠØ¦Ø© state.names Ù‡Ù†Ø§ Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ **
            state.names = {};
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
            const checkedRadio = document.querySelector('#teamCountRadios input:checked');
            state.teamCount = checkedRadio ? checkedRadio.value : 4;

            // ** Ø­ÙØ¸ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø®ØµØµØ© **
            state.customTeamNames = customTeamNames; 
            
            const allContainers = document.querySelectorAll('#unorganized, [id^="team"]');
            
            // Ù†Ø¶Ù…Ù† Ù‡Ù†Ø§ Ø£Ù† allContainers ØªØ­ØªÙˆÙŠ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± DOM Ù…ÙˆØ¬ÙˆØ¯Ø©
            allContainers.forEach(container => {
                const containerId = container.id;
                state.names[containerId] = [];
                Array.from(container.children).forEach(nameItem => {
                    const name = nameItem.querySelector('span')?.textContent || nameItem.textContent.trim();
                    const id = nameItem.id; // Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø±Ù Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³Ù…
                    if (name && id) {
                        state.names[containerId].push({ id, name });
                    }
                });
            });
            
            // Ø­ÙØ¸ Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø§Ø¯ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª
            state.nameCounter = nameCounter; 
            
            saveToLocalStorage('dragAndDropState', state);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ù‚
        function loadDragAndDropState() {
            // ** Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© - Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡ ÙÙŠ onload **
            const dragDropSection = document.getElementById('drag-and-drop-section');
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‚Ø³Ù… Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª Ù…Ø±Ø¦ÙŠØ§Ù‹ Ø£Ùˆ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµØ§Ù…Øª Ù„Ù„Ù‚ÙŠÙ…
            if (!dragDropSection || dragDropSection.classList.contains('hidden')) {
                 const state = loadFromLocalStorage('dragAndDropState', { teamCount: 4, names: {}, customTeamNames: {}, nameCounter: 0 });
                 currentTeamCount = parseInt(state.teamCount) || 4;
                 customTeamNames = state.customTeamNames || {};
                 nameCounter = state.nameCounter || 0;
                 return;
            }

            const defaultState = {
                teamCount: 4,
                names: {
                    unorganized: [{ id: 'name-1', name: 'Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…' }, { id: 'name-2', name: 'Ø®Ø§Ù„Ø¯ ÙÙŠØµÙ„' }],
                    team1: [], team2: [], team3: [], team4: []
                },
                nameCounter: 2,
                customTeamNames: {}
            };
            
            const state = loadFromLocalStorage('dragAndDropState', defaultState);
            
            // 1. ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ (Ø§Ù„Ø¢Ù† Ù…Ù† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ)
            currentTeamCount = parseInt(state.teamCount);
            
            // ** Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„ØµØ­ÙŠØ­ **
            const radioInput = document.querySelector(`#teamCountRadios input[value="${currentTeamCount}"]`);
            if (radioInput) {
                radioInput.checked = true;
            } else {
                 // ** Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²Ù†Ø© 1 Ø£Ùˆ ØºÙŠØ± ØµØ§Ù„Ø­Ø©ØŒ Ù†Ø³ØªØ®Ø¯Ù… 4 ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© **
                 currentTeamCount = 4; 
                 const defaultRadio = document.querySelector(`#teamCountRadios input[value="4"]`);
                 if (defaultRadio) {
                    defaultRadio.checked = true;
                 }
            }
            // ---------------------------------------------
            
            // 2. ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
            nameCounter = state.nameCounter || 0;
            
            // ** 3. ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø®ØµØµØ© **
            customTeamNames = state.customTeamNames || {};

            // 4. Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙØ±Ù‚ Ø«Ù… Ù…Ù„Ø¡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ - Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù„Ø§ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¹Ù…Ù„ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù…
            const unorganizedContainer = document.getElementById('unorganized');
            if (unorganizedContainer) {
                 // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ù‚Ù… Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙØ±Ù‚ ÙˆÙ…Ù„Ø¡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
                 generateTeams(); 

                 // Ù…Ù„Ø¡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                 Object.keys(state.names).forEach(containerId => {
                     const container = document.getElementById(containerId);
                     if (container) {
                         state.names[containerId].forEach(nameObj => {
                             const nameElement = createNameElement(nameObj.name, nameObj.id.split('-')[1]); 
                             nameElement.id = nameObj.id; 
                             container.appendChild(nameElement);
                         });
                     }
                 });
                 updateStatistics();
            }

        }
        
        
        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ¯Ø¹Ù… Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ ---
        
        // Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ¥Ø®ÙØ§Ø¦Ù‡Ø§
        function showSection(sectionName, pushState = true) {
            
            // ** Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ù‚Ø¨Ù„ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ **
            stopAllActivities();

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentSection = sectionName;

            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            const sectionId = sectionName === 'main-menu' ? 'main-menu' : sectionName + '-section';
            const sectionElement = document.getElementById(sectionId);
            
            const backBtn = document.getElementById('backToMainBtn');
            if (backBtn) {
                if (sectionName === 'main-menu') {
                    backBtn.classList.add('hidden');
                } else {
                    backBtn.classList.remove('hidden');
                }
            }

            if (sectionElement) {
                sectionElement.classList.remove('hidden');
                
                // 1. Ø¥Ø¯Ø§Ø±Ø© Ø³Ø¬Ù„ Ø§Ù„Ù…ØªØµÙØ­ (History API)
                if (pushState) {
                    // Ù†Ø­ØªØ§Ø¬ ÙÙ‚Ø· Ù„ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø¬Ù„ØŒ Ù„ÙŠØ³ Ø´Ø±Ø·Ù‹Ø§ ØªØºÙŠÙŠØ± Ø§Ù„Ù€ URL ÙØ¹Ù„ÙŠÙ‹Ø§
                    history.pushState({ section: sectionName }, '', `#${sectionName}`);
                }
                
                // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„ÙŠÙ‡Ø§
                if (sectionName === 'wheel') {
                    loadWheelSettings();
                    
                    const canvas = document.getElementById('wheelCanvas');
                    const container = document.getElementById('wheel-container');
                    
                    const ratio = window.devicePixelRatio || 1;
                    canvas.width = container.offsetWidth * ratio;
                    canvas.height = container.offsetHeight * ratio;
                    canvas.getContext('2d').scale(ratio, ratio);

                    updateWheel();
                    window.onresize = () => {
                        const canvas = document.getElementById('wheelCanvas');
                        const container = document.getElementById('wheel-container');
                        
                        const resizeRatio = window.devicePixelRatio || 1;
                        canvas.width = container.offsetWidth * resizeRatio;
                        canvas.height = container.offsetHeight * resizeRatio;
                        canvas.getContext('2d').scale(resizeRatio, resizeRatio);
                        
                        updateWheel();
                    };
                    setupWheelDrag();
                } else if (sectionName === 'dice') {
                    loadDiceSettings(); // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø±Ø¯
                    // ** Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 3: Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ù‡Ù†Ø§ **
                    updateDiceContainer();
                } else if (sectionName === 'names') {
                    loadNameSettings(); // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
                    updateNamesList();
                    updateNameDisplaySize(false);
                } else if (sectionName === 'numbers') {
                    loadNumberSettings(); // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
                } else if (sectionName === 'coin') {
                    loadCoinSettings(); // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø©
                } else if (sectionName === 'drag-and-drop') {
                    // ** Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ **
                    loadDragAndDropState();
                    setupDragAndDropEventListeners();
                } else {
                    window.onresize = null; // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªÙ…Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ Ù†ÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø¹Ø¬Ù„Ø©
                    removeWheelDrag(); // ØªØ¹Ø·ÙŠÙ„ Ø³Ø­Ø¨ Ø§Ù„Ø¹Ø¬Ù„Ø©
                }
            }
        }
        
        // 2. Ù…Ø³ØªÙ…Ø¹ Ù„Ø­Ø¯Ø« Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­/Ø§Ù„Ø¬ÙˆØ§Ù„
        window.addEventListener('popstate', function(event) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø­Ø§Ù„Ø© Ù…Ø­ÙÙˆØ¸Ø©
            if (event.state && event.state.section) {
                // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸ ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø© Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ© Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø³Ø¬Ù„
                showSection(event.state.section, false); 
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø­Ø§Ù„Ø©ØŒ Ø§ÙØªØ±Ø¶ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø£Ùˆ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„)
                // Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø£Ù†Ù†Ø§ Ù†Ø¯ÙØ¹ Ø¯Ø§Ø¦Ù…Ù‹Ø§ 'main-menu' ÙƒØ­Ø§Ù„Ø© Ø£ÙˆÙ„ÙŠØ©ØŒ ÙØ¥Ù† Ù‡Ø°Ø§ Ø¹Ø§Ø¯Ø©Ù‹ Ù„Ù† ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡ Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.
                showSection('main-menu', false); 
            }
        });


        // ** Ø¯Ø§Ù„Ø© ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© **
        function toggleDiceOptionsModal() {
            document.getElementById('diceOptionsModal').classList.toggle('visible');
        }

        // ** Ø¯Ø§Ù„Ø© ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø±Ø¯ **
        function toggleDiceHistoryModal() {
            const modal = document.getElementById('diceHistoryModal');
            if (modal) {
                if (modal.classList.contains('visible')) {
                    modal.classList.remove('visible');
                } else {
                    renderDiceHistory();
                    modal.classList.add('visible');
                }
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø±Ø¯ Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function handleDiceCountChange(isInput = false) {
            
            let selectedCount;
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ø¯Ø¯
            const checkedRadio = document.querySelector('#diceCountRadios input:checked');
            selectedCount = checkedRadio ? parseInt(checkedRadio.value) : 2; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 2
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentDiceCount = selectedCount; 
            
            // ÙŠØ¬Ø¨ Ø£Ù† Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª ÙÙ‚Ø· Ø¥Ø°Ø§ ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø¹Ø¯
            updateDiceContainer();
            saveDiceSettings();
        }

        // ** Ø¯Ø§Ù„Ø© ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© **
        function toggleCoinOptionsModal() {
            document.getElementById('coinOptionsModal').classList.toggle('visible');
        }

        
        // Ø¯ÙˆØ§Ù„ ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function toggleWheelOptionsModal() {
            document.getElementById('wheelOptionsModal').classList.toggle('visible');
        }
        
        function toggleNumberOptionsModal() {
            document.getElementById('numberOptionsModal').classList.toggle('visible');
        }

        function toggleNameOptionsModal() {
            document.getElementById('nameOptionsModal').classList.toggle('visible');
        }

        // --- Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ ---

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø³Ø­Ø¨
        function setupWheelDrag() {
            const wheel = document.getElementById('wheelCanvas');
            wheel.addEventListener('mousedown', startDrag);
            wheel.addEventListener('touchstart', startDrag, { passive: true });
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ¹Ø·ÙŠÙ„ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø³Ø­Ø¨
        function removeWheelDrag() {
            const wheel = document.getElementById('wheelCanvas');
            wheel.removeEventListener('mousedown', startDrag);
            wheel.removeEventListener('touchstart', startDrag);
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø­Ø¯ÙˆØ« Ù…Ø´Ø§ÙƒÙ„
            window.removeEventListener('mousemove', onDrag);
            window.removeEventListener('mouseup', endDrag);
            window.removeEventListener('touchmove', onDrag);
            window.removeEventListener('touchend', endDrag);
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù…Ù† Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø§ÙˆØ³/Ø§Ù„Ù„Ù…Ø³
        function getAngle(x, y) {
            const rect = document.getElementById('wheelCanvas').getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            return Math.atan2(y - centerY, x - centerX) * (180 / Math.PI);
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø­Ø¨
        function startDrag(event) {
            if (isSpinning) return;
            isDragging = true;
            document.getElementById('spinWheelButton').disabled = true; // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨

            const clientX = event.clientX || event.touches[0].clientX;
            const clientY = event.clientY || event.touches[0].clientY;

            lastAngle = getAngle(clientX, clientY);
            lastTime = Date.now();
            velocity = 0;

            window.addEventListener('mousemove', onDrag);
            window.addEventListener('mouseup', endDrag);
            window.addEventListener('touchmove', onDrag);
            window.addEventListener('touchend', endDrag);
        }

        // Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨
        function onDrag(event) {
            if (!isDragging || isSpinning) return;
            
            const clientX = event.clientX || event.touches[0].clientX;
            const clientY = event.clientY || event.touches[0].clientY;
            
            const currentAngle = getAngle(clientX, clientY);
            let deltaAngle = currentAngle - lastAngle;

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ù† 360 Ø¥Ù„Ù‰ 0 Ø£Ùˆ Ø§Ù„Ø¹ÙƒØ³ (Ù„Ø¶Ù…Ø§Ù† ØªØ¯ÙˆÙŠØ± Ø³Ù„Ø³)
            if (deltaAngle > 180) {
                deltaAngle -= 360;
            } else if (deltaAngle < -180) {
                deltaAngle += 360;
            }

            const currentTime = Date.now();
            const deltaTime = currentTime - lastTime;
            
            currentRotation += deltaAngle;
            
            // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø¹Ø¬Ù„Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
            const wheel = document.getElementById('wheelCanvas');
            wheel.style.transition = 'none';
            wheel.style.transform = `rotate(${currentRotation}deg)`;

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© Ù„Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            if (deltaTime > 0) {
                velocity = deltaAngle / deltaTime;
            }
            
            lastAngle = currentAngle;
            lastTime = currentTime;
        }

        // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø­Ø¨
        function endDrag() {
            if (!isDragging) return;
            isDragging = false;
            
            window.removeEventListener('mousemove', onDrag);
            window.removeEventListener('mouseup', endDrag);
            window.removeEventListener('touchmove', onDrag);
            window.removeEventListener('touchend', endDrag);
            
            // ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø±ÙƒØ© Ø³Ø±ÙŠØ¹Ø© Ø¨Ù…Ø§ ÙŠÙƒÙÙŠ Ù„ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø©
            const flickThreshold = 0.02; // Ø¹ØªØ¨Ø© Ø§Ù„Ø³Ø±Ø¹Ø© (Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø§Øª/Ù…ÙŠÙ„ÙŠ Ø«Ø§Ù†ÙŠØ©)

            if (Math.abs(velocity) > flickThreshold) {
                // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                spinWheel(true, velocity);
            } else {
                // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯
                document.getElementById('spinWheelButton').disabled = false;
            }
        }


        function renderWheelColors() {
            const list = document.getElementById('wheelColorsList');
            if (list) {
                list.innerHTML = '';
                wheelBaseColors.forEach(color => {
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'w-8 h-8 rounded-full border-2 border-white/80 shadow';
                    button.style.backgroundColor = color;
                    list.appendChild(button);
                });
            }
            const presetContainer = document.getElementById('wheelPresetColorsContainer');
            if (presetContainer) {
                presetContainer.innerHTML = '';
                const remaining = wheelPresetColors.filter(color => !wheelBaseColors.includes(color));
                remaining.forEach(color => {
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'w-8 h-8 rounded-full border border-white/60';
                    button.style.backgroundColor = color;
                    button.onclick = function () {
                        addWheelColor(color);
                    };
                    presetContainer.appendChild(button);
                });
            }
        }

        function toggleWheelColorsPanel() {
            const panel = document.getElementById('wheelColorsPanel');
            if (!panel) return;
            panel.classList.toggle('hidden');
        }

        function handleAddWheelColorClick() {
            const area = document.getElementById('wheelColorAddArea');
            if (!area) return;
            area.classList.toggle('hidden');
        }

        function addWheelColor(color) {
            if (!color) return;
            if (!wheelBaseColors.includes(color)) {
                wheelBaseColors.push(color);
                renderWheelColors();
                updateWheel();
                saveWheelSettings();
            }
        }

        function addCustomWheelColor() {
            const input = document.getElementById('wheelCustomColorInput');
            if (!input) return;
            const color = input.value;
            if (color) {
                addWheelColor(color);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø±Ø³Ù… Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        function updateWheel() {
            const canvas = document.getElementById('wheelCanvas');
            const ctx = canvas.getContext('2d');
            
            // 2. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ² ÙˆÙ†ØµÙ Ø§Ù„Ù‚Ø·Ø± Ø¨Ø¹Ø¯ ØªØ·Ø¨ÙŠÙ‚ scale
            const ratio = window.devicePixelRatio || 1;
            const centerX = canvas.width / (2 * ratio);
            const centerY = canvas.height / (2 * ratio);
            const radius = Math.min(centerX, centerY);

            const sections = wheelOptions.length;
            
            if (sections === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }
            
            const anglePerSection = (2 * Math.PI) / sections;
            const baseColors = wheelBaseColors.length > 0 ? wheelBaseColors : wheelPresetColors;

            const sectorColors = [];
            let colorIndex = 0;
            for (let i = 0; i < sections; i++) {
                for (let attempt = 0; attempt < baseColors.length; attempt++) {
                    const color = baseColors[colorIndex];
                    colorIndex = (colorIndex + 1) % baseColors.length;
                    if (i === 0 || color !== sectorColors[i - 1]) {
                        sectorColors[i] = color;
                        break;
                    }
                }
            }
            if (sections > 1 && sectorColors[sections - 1] === sectorColors[0]) {
                for (let j = 0; j < baseColors.length; j++) {
                    const candidate = baseColors[j];
                    if (candidate !== sectorColors[sections - 2] && candidate !== sectorColors[0]) {
                        sectorColors[sections - 1] = candidate;
                        break;
                    }
                }
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            wheelOptions.forEach((option, index) => {
                // ** Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„Ø£ÙˆÙ„ (index 0) Ø¹Ù†Ø¯ Ø²Ø§ÙˆÙŠØ© 270 Ø¯Ø±Ø¬Ø© Ù„ÙŠØ¹Ù…Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ **
                //  Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø³Ù… Ù…Ù† Ø²Ø§ÙˆÙŠØ© 270 Ø¯Ø±Ø¬Ø© ($\frac{3\pi}{2}$) ÙˆÙ†Ù…Ø´ÙŠ ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø© (Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø²Ø§ÙˆÙŠØ©)
                //  Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ¨Ø¯Ø£ Ù…Ù† 270 Ø¯Ø±Ø¬Ø© ÙˆÙŠØ²ÙŠØ¯ØŒ Ù…Ù…Ø§ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„Ø£ÙˆÙ„ ÙŠØºØ·ÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
                const startAngle = (index * anglePerSection) - (Math.PI / 2); // ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø© 12 (Ø²Ø§ÙˆÙŠØ© 270)
                const endAngle = ((index + 1) * anglePerSection) - (Math.PI / 2);
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                
                ctx.fillStyle = sectorColors[index % sectorColors.length];
                ctx.fill();
                
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.9)';
                ctx.lineWidth = 0.6;
                ctx.stroke();

                // Ø±Ø³Ù… Ø§Ù„Ù†Øµ
                ctx.save();
                ctx.translate(centerX, centerY);
                const textAngle = startAngle + anglePerSection / 2;
                ctx.rotate(textAngle);
                
                ctx.fillStyle = 'white'; // Ù„ÙˆÙ† Ù†Øµ Ø£Ø¨ÙŠØ¶ ÙˆØ§Ø¶Ø­
                ctx.font = 'bold 20px Cairo'; // Ø®Ø· Ø£ÙƒØ¨Ø± ÙˆØ£ÙƒØ«Ø± Ø¬Ø±Ø£Ø©
                
                /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªÙ…Ø±ÙƒØ² Ø§Ù„Ù†Øµ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø¸Ù„ --- */
                ctx.textAlign = 'center'; // ØªÙ…Ø±ÙƒØ² Ø§Ù„Ø®Ø· ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
                ctx.textBaseline = 'middle';
                
                ctx.shadowColor = 'rgba(0, 0, 0, 0.6)';
                ctx.shadowBlur = 1;
                /* ------------------------------------- */

                
                let displayText = option;
                // ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø¯ÙŠØ¯ Ù…Ø±ÙƒØ² Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ (Ù†ØµÙ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ©)
                const textPosition = Math.round(radius * 0.65); 
                const maxTextWidth = radius * 0.8;
                
                // Ù‚ÙŠØ§Ø³ Ø§Ù„Ù†Øµ ÙˆØ¶Ø¨Ø·Ù‡ (Ø¥Ø¶Ø§ÙØ© .. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·ÙˆÙŠÙ„Ø§Ù‹ Ø¬Ø¯Ø§Ù‹)
                if (ctx.measureText(displayText).width > maxTextWidth) {
                    let tempText = '';
                    for (let i = 0; i < option.length; i++) {
                        if (ctx.measureText(tempText + option[i] + '..').width < maxTextWidth) {
                            tempText += option[i];
                        } else {
                            break;
                        }
                    }
                    displayText = tempText + '..';
                }

                // 3. ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ù€ Math.round Ù„Ù…Ù†Ø¹ Ø§Ù„ØºØ¨Ø§Ø´Ø©
                const x = Math.round(textPosition);
                const y = Math.round(0);

                ctx.fillText(displayText, x, y);
                
                ctx.restore();
            });
            
            updateWheelOptionsList();
            
            // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø«Ø§Ø¨Øª (ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©: offsetWidth)
            const pointer = document.getElementById('wheelPointer');
            const container = document.getElementById('wheel-container');
            if (pointer && container) {
                pointer.style.top = '50%';
                pointer.style.left = '100%';
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
        function updateWheelOptionsList() {
            const container = document.getElementById('wheelOptions');
            if (!container) return;
            container.innerHTML = '';
            wheelOptions.forEach((option, index) => {
                const div = document.createElement('div');
                // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø¯Ø§ÙƒÙ† Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆØ¶ÙˆØ­ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                div.className = 'flex justify-between items-center bg-white/50 rounded px-3 py-2'; 
                div.innerHTML = `<span class="text-gray-900">${option}</span>
                                <button onclick="removeWheelOption(${index})" class="text-red-600 hover:text-red-800">âœ•</button>`;
                container.appendChild(div);
            });
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ø¬Ù„Ø©
        function addWheelOption() {
            const textarea = document.getElementById('wheelOptionsTextarea');
            const newNames = textarea.value.split('\n').map(name => name.trim()).filter(name => name.length > 0);
            if (newNames.length > 0) {
                // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø°ÙƒÙŠ
                SmartSuggestions.add(newNames);

                // ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
                const uniqueNewNames = newNames.filter(name => !wheelOptions.includes(name));
                if (uniqueNewNames.length > 0) {
                    wheelOptions = wheelOptions.concat(uniqueNewNames);
                    textarea.value = '';
                    updateWheel();
                    saveWheelSettings(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« **
                } else {
                     playSound('error');
                     showConfettiPopup('ØªÙ†Ø¨ÙŠÙ‡', 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ø¹Ø¬Ù„Ø©.', null, null, false, true);
                }
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø²Ø§Ù„Ø© Ø®ÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¹Ø¬Ù„Ø©
        function removeWheelOption(index) {
            if (wheelOptions.length > 2) {
                wheelOptions.splice(index, 1);
                updateWheel();
                saveWheelSettings(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« **
            } else {
                 playSound('error');
                 showConfettiPopup('Ø®Ø·Ø£', 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø®ÙŠØ§Ø±Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙÙŠ Ø§Ù„Ø¹Ø¬Ù„Ø©.', null, null, false, true);
            }
        }

        // Ù…ØªØºÙŠØ± Ù„Ù…Ø¹Ø±Ù Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø¬Ù„Ø© (Ù„Ù„Ø¥ÙŠÙ‚Ø§Ù)
        let wheelAnimationId = null;

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ³Ù‡ÙŠÙ„ (Easing Function) Ù„Ù…Ø­Ø§ÙƒØ§Ø© cubic-bezier(0.17, 0.67, 0.12, 0.99)
        // Ù‡Ø°Ù‡ Ø¯Ø§Ù„Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© (easeOutQuart) ØªØ¹Ø·ÙŠ Ù†ØªÙŠØ¬Ø© Ù…Ø´Ø§Ø¨Ù‡Ø© Ø¬Ø¯Ø§Ù‹
        function easeOutQuart(x) {
            return 1 - Math.pow(1 - x, 4);
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© (ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„ØªÙ‚Ø¨Ù„ Ø³Ø±Ø¹Ø© Ø§Ù„Ø³Ø­Ø¨)
        function spinWheel(isFlick = false, flickVelocity = 0) {
            if (isSpinning) return;
            if (wheelOptions.length < 2) {
                 playSound('error');
                 showConfettiPopup('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙÙŠ Ø§Ù„Ø¹Ø¬Ù„Ø©.', null, null, false, true);
                 return;
            }
            
            isSpinning = true;
            document.getElementById('spinWheelButton').disabled = true;
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ÙˆÙ„Ø¯
            initAudioContext();
            
            const wheel = document.getElementById('wheelCanvas');
            // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ø£Ù†Ù†Ø§ Ø³Ù†Ø³ØªØ®Ø¯Ù… JS
            wheel.removeEventListener('transitionend', handleSpinEnd);
            
            document.getElementById('wheelPointer').classList.add('wobble');

            // Ø¥Ø²Ø§Ù„Ø© playSound('spin') Ù„Ø£Ù†Ù†Ø§ Ø³Ù†ÙˆÙ„Ø¯ Ø§Ù„ØµÙˆØª ÙŠØ¯ÙˆÙŠÙ‹Ø§
            // playSound('spin'); 

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const style = window.getComputedStyle(wheel);
            const matrix = new DOMMatrix(style.transform);
            const rotationRad = Math.atan2(matrix.b, matrix.a);
            let currentRotationDeg = rotationRad * (180 / Math.PI);
            if (currentRotationDeg < 0) currentRotationDeg += 360;
            
            // ØªØ­Ø¯ÙŠØ« currentRotation Ø§Ù„Ø¹Ø§Ù… Ù„ÙŠÙƒÙˆÙ† Ù…ØªÙˆØ§ÙÙ‚Ø§Ù‹ Ù…Ø¹ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¹Ø¬Ù„Ø© Ù‚Ø¯ Ø¯Ø§Ø±Øª Ø³Ø§Ø¨Ù‚Ø§Ù‹ØŒ Ù†Ø­ØªØ§Ø¬ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ©
            // Ù„ÙƒÙ† Ù„Ù„ØªØ¨Ø³ÙŠØ·ØŒ Ø³Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù…ØµÙÙˆÙØ© ÙˆÙ†Ø¶ÙŠÙ Ø¹Ù„ÙŠÙ‡Ø§
            // Ù…Ù„Ø§Ø­Ø¸Ø©: currentRotation Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù‚Ø¯ ØªÙƒÙˆÙ† Ø£Ø¯Ù‚
            
            const sections = wheelOptions.length;
            const anglePerSection = 360 / sections;

            let spinDuration;
            let baseTurns;

            if (isFlick) {
                const absVel = Math.abs(flickVelocity);
                const minVel = 0.002;
                const maxVel = 0.03;
                if (absVel < minVel) {
                    isSpinning = false;
                    document.getElementById('spinWheelButton').disabled = false;
                    document.getElementById('wheelPointer').classList.remove('wobble');
                    stopSpinSound();
                    return;
                }
                const ratio = Math.min(1, Math.max(0, (absVel - minVel) / (maxVel - minVel)));
                const threshold = 0.5;
                if (ratio <= threshold) {
                    const local = ratio / threshold;
                    const minDurationSec = 2.0;
                    const maxDurationSec = 3.0;
                    const minTurns = 5;
                    const maxTurns = 8;
                    const durationSec = minDurationSec + local * (maxDurationSec - minDurationSec);
                    spinDuration = Math.round(durationSec * 1000);
                    baseTurns = Math.round(minTurns + local * (maxTurns - minTurns));
                } else {
                    const local = (ratio - threshold) / (1 - threshold);
                    const minDurationSec = 3.5;
                    const maxDurationSec = 6.0;
                    const minTurns = 9;
                    const maxTurns = 14;
                    const durationSec = minDurationSec + local * (maxDurationSec - minDurationSec);
                    spinDuration = Math.round(durationSec * 1000);
                    baseTurns = Math.round(minTurns + local * (maxTurns - minTurns));
                }
            } else {
                const minDurationSec = 2.5;
                const maxDurationSec = 6.0;
                const durationSec = minDurationSec + Math.random() * (maxDurationSec - minDurationSec);
                spinDuration = Math.round(durationSec * 1000);
                const minTurns = 7;
                const maxTurns = 13;
                baseTurns = Math.floor(Math.random() * (maxTurns - minTurns + 1)) + minTurns;
            }

            const winningIndex = getSecureRandomInt(sections);
            currentWinningIndex = winningIndex;

            const waCenter = (winningIndex + 0.5) * anglePerSection;
            const halfSection = anglePerSection / 2;
            const edgeMargin = Math.min(halfSection * 0.3, 5);
            const randomFactor = Math.random() * 2 - 1;
            const offsetInSection = randomFactor * (halfSection - edgeMargin);
            const waRandom = waCenter + offsetInSection;
            const nrTarget = (90 - waRandom + 360) % 360;

            let currentNorm = currentRotation % 360;
            if (currentNorm < 0) currentNorm += 360;
            const deltaToTarget = (nrTarget - currentNorm + 360) % 360;

            // Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©
            const targetRotation = currentRotation + baseTurns * 360 + deltaToTarget;
            const startRotation = currentRotation;
            const totalChange = targetRotation - startRotation;
            
            // ØªØ¹Ø·ÙŠÙ„ Transition CSS Ù„Ø£Ù†Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… JS
            wheel.style.transition = 'none';

            let startTime = null;
            let lastSoundAngle = startRotation;

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / spinDuration, 1);
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ³Ù‡ÙŠÙ„
                const easedProgress = easeOutQuart(progress);
                const currentAngle = startRotation + (totalChange * easedProgress);
                
                wheel.style.transform = `rotate(${currentAngle}deg)`;
                
                // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØª Ø§Ù„Ø¬Ø¯ÙŠØ¯ ---
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø¯Ø±Ø¬Ø© Ù„ÙƒÙ„ Ù…ÙŠÙ„ÙŠ Ø«Ø§Ù†ÙŠØ© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹) Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø¯Ø© Ø§Ù„ØµÙˆØª
                // Ù†Ø´ØªÙ‚ Ø§Ù„Ø³Ø±Ø¹Ø© Ù…Ù† Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ³Ù‡ÙŠÙ„: derivative of easeOutQuart is 4 * (1-x)^3
                // Ø§Ù„Ø³Ø±Ø¹Ø© Ø¹Ù†Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø­Ø¸Ø© = totalChange * derivative / spinDuration
                const remainingRatio = 1 - progress;
                const derivative = 4 * Math.pow(remainingRatio, 3);
                const currentSpeed = (totalChange * derivative) / spinDuration; // degrees per ms
                
                // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø¹Ø¨ÙˆØ± "ÙˆØªØ¯" (ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…)
                // ÙƒÙ„ Ù‚Ø³Ù… ÙŠÙ…Ø«Ù„ "ÙˆØªØ¯"
                if (Math.abs(currentAngle - lastSoundAngle) >= anglePerSection) {
                    // Ù…Ø¹Ø¯Ù„ Ø§Ù„ØµÙˆØª ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø±Ø¹Ø© (ÙƒÙ„Ù…Ø§ ÙƒØ§Ù†Øª Ø£Ø³Ø±Ø¹ØŒ ÙƒØ§Ù† Ø§Ù„ØµÙˆØª Ø£Ø­Ø¯)
                    // currentSpeed ÙŠØªØ±Ø§ÙˆØ­ Ø¹Ø§Ø¯Ø© Ø¨ÙŠÙ† 0 Ùˆ 2
                    let rate = currentSpeed * 2; 
                    if (rate < 0.2) rate = 0.2; // Ø­Ø¯ Ø£Ø¯Ù†Ù‰
                    if (rate > 2.0) rate = 2.0; // Ø­Ø¯ Ø£Ù‚ØµÙ‰
                    
                    playDigitalTick(rate);
                    lastSoundAngle = currentAngle;
                }
                
                if (progress < 1) {
                    wheelAnimationId = requestAnimationFrame(animate);
                } else {
                    currentRotation = targetRotation;
                    wheelAnimationId = null;
                    handleSpinEnd();
                }
            }
            
            wheelAnimationId = requestAnimationFrame(animate);
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø¯Ø« Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø­Ø±ÙƒØ© (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„ØµØ­ÙŠØ­)
        function handleSpinEnd() {
            const pointer = document.getElementById('wheelPointer');
            if (pointer) pointer.classList.remove('wobble');

            stopSpinSound();

            const canvas = document.getElementById('wheelCanvas');
            let finalIndex = 0;

            if (wheelOptions.length === 0) {
                isSpinning = false;
                document.getElementById('spinWheelButton').disabled = false;
                if (canvas) canvas.removeEventListener('transitionend', handleSpinEnd);
                return;
            }

            if (typeof currentWinningIndex === 'number' && currentWinningIndex >= 0 && currentWinningIndex < wheelOptions.length) {
                finalIndex = currentWinningIndex;
            } else if (canvas) {
                const style = window.getComputedStyle(canvas);
                const matrix = new DOMMatrix(style.transform);
                const rotation = Math.atan2(matrix.b, matrix.a) * (180 / Math.PI);
                let normalizedRotation = (rotation + 360) % 360;
                const anglePerSection = 360 / wheelOptions.length;
                const pointerAngle = 360;
                let winningAngle = (pointerAngle - normalizedRotation + 360) % 360;
                finalIndex = Math.floor(winningAngle / anglePerSection);
                if (finalIndex < 0) finalIndex = 0;
                if (finalIndex >= wheelOptions.length) finalIndex = wheelOptions.length - 1;
            }

            const selectedOption = wheelOptions[finalIndex];

            const showPopup = document.getElementById('showWheelPopup').checked;
            const showConfetti = document.getElementById('showWheelConfetti').checked;

            if (showPopup || showConfetti) {
                showConfettiPopup(`Ø§Ù„Ù†ØªÙŠØ¬Ø©`, `ÙØ§Ø²: ${selectedOption}`, selectedOption, 'removeWinningOption', showConfetti, showPopup);
            }

            isSpinning = false;
            document.getElementById('spinWheelButton').disabled = false;
            if (canvas) canvas.removeEventListener('transitionend', handleSpinEnd);
            currentWinningIndex = null;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø² Ù…Ù† Ø§Ù„Ø¹Ø¬Ù„Ø©
        function removeWinningOption(winningName) {
            const index = wheelOptions.indexOf(winningName);
            if (index > -1 && wheelOptions.length > 2) {
                wheelOptions.splice(index, 1);
                updateWheel();
                saveWheelSettings(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù **
                closeResultPopup();
            } else if (wheelOptions.length <= 2) {
                 playSound('error');
                 showConfettiPopup('Ø®Ø·Ø£', 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£Ø®ÙŠØ±ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø®ÙŠØ§Ø±Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.', null, null, false, true);
            }
        }

        // --- Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ---
        
        let usedNumbers = [];

        // Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        function generateRandomNumber() {
            if (numberInterval !== null) return; // Ù…Ù†Ø¹ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬

            const min = parseInt(document.getElementById('minNumber').value);
            const max = parseInt(document.getElementById('maxNumber').value);
            const showPopup = document.getElementById('showNumberPopup').checked;
            const showConfetti = document.getElementById('showNumberConfetti').checked;
            const avoidRepeatsCheckbox = document.getElementById('avoidNumberRepeats');
            const avoidRepeats = avoidRepeatsCheckbox ? avoidRepeatsCheckbox.checked : false;
            
            if (min >= max || isNaN(min) || isNaN(max)) {
                playSound('error');
                showConfettiPopup('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£Ø¯Ù†Ù‰ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰.', null, null, false, true);
                return;
            }

            if (avoidRepeats) {
                const rangeSize = max - min + 1;
                const usedInRange = usedNumbers.filter(n => n >= min && n <= max).length;
                if (usedInRange >= rangeSize) {
                    playSound('error');
                    showConfettiPopup('ØªÙ†Ø¨ÙŠÙ‡', 'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¯Ù‰. Ù‚Ù… Ø¨ØªØºÙŠÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ùˆ Ø¥ÙŠÙ‚Ø§Ù Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±.', null, null, false, true);
                    return;
                }
            }
            
            document.getElementById('generateNumberButton').disabled = true;
            const numberElement = document.getElementById('selectedNumber');
            numberElement.classList.remove('pop-number'); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ÙØ²Ø©
            
            const duration = parseInt(document.getElementById('numberDuration').value) * 1000;
            let startTime = Date.now();
            
            // Ø¥ÙŠÙ‚Ø§Ù ØµÙˆØª Ø§Ù„ØªÙƒØªÙƒØ© Ø§Ù„Ø³Ø§Ø¨Ù‚
            stopNumberSound();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ÙˆÙ„Ø¯
            initAudioContext();
            
            // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© (Recursive) Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„ØªØ¨Ø§Ø·Ø¤
            const tick = () => {
                const now = Date.now();
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // 1. Ø§Ù„ØªØ¨Ø§Ø·Ø¤ Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ (Easing): Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ£Ø®ÙŠØ± Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª
                const currentDelay = 50 + (300 * Math.pow(progress, 2)); 

                // 4. ØªØ²Ø§Ù…Ù† Ø§Ù„ØµÙˆØª: ØªØºÙŠÙŠØ± Ù†ØºÙ…Ø© Ø§Ù„ØµÙˆØª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø±Ø¹Ø©
                // ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯ Ø§Ù„ØªØ£Ø®ÙŠØ± (Ø£Ø¨Ø·Ø£)ØŒ Ù‚Ù„ Ø§Ù„Ù€ Rate (Ø£ØºÙ„Ø¸)
                let rate = 50 / currentDelay; 
                playDigitalTick(rate); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙƒØ© Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                const randomNumValue = Math.floor(Math.random() * (max - min + 1)) + min;
                numberElement.textContent = randomNumValue;
                
                // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ø§Ù„Ø¨Ø³ÙŠØ·
                numberElement.classList.remove('number-animation');
                void numberElement.offsetWidth; // Force reflow
                numberElement.classList.add('number-animation');

                if (elapsed < duration) {
                    numberInterval = setTimeout(tick, currentDelay);
                } else {
                    // Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                    numberInterval = null; 
                    stopNumberSound();
                    
                    let finalNumber;
                    if (avoidRepeats) {
                        const rangeSize = max - min + 1;
                        const available = [];
                        for (let n = min; n <= max; n++) {
                            if (!usedNumbers.includes(n)) {
                                available.push(n);
                            }
                        }
                        if (available.length === 0) {
                            playSound('error');
                            showConfettiPopup('ØªÙ†Ø¨ÙŠÙ‡', 'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù….', null, null, false, true);
                            document.getElementById('generateNumberButton').disabled = false;
                            return;
                        }
                        const randomIndex = getSecureRandomInt(available.length);
                        finalNumber = available[randomIndex];
                    } else {
                        finalNumber = Math.floor(Math.random() * (max - min + 1)) + min;
                    }
                    
                    numberElement.textContent = finalNumber;
                    usedNumbers.push(finalNumber);
                    updateNumberHistory();
                    
                    // 3. ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ÙØ²Ø© Ù„Ù„Ø±Ù‚Ù… Ø§Ù„ÙØ§Ø¦Ø² (Final Pop)
                    numberElement.classList.remove('number-animation');
                    void numberElement.offsetWidth;
                    numberElement.classList.add('pop-number');
                    
                    if (showPopup || showConfetti) {
                        showConfettiPopup('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙØ§Ø¦Ø²', `${finalNumber}`, null, null, showConfetti, showPopup);
                    }
                    
                    document.getElementById('generateNumberButton').disabled = false;
                }
            };
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù„Ù‚Ø©
            numberInterval = setTimeout(tick, 50);
        }

        function updateNumberHistory() {
            const container = document.getElementById('numberHistoryContainer');
            if (!container) return;
            container.innerHTML = '';
            if (!usedNumbers.length) {
                const placeholder = document.createElement('div');
                placeholder.className = 'text-white/50 text-xs';
                placeholder.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£Ø±Ù‚Ø§Ù… Ø¨Ø¹Ø¯';
                container.appendChild(placeholder);
                return;
            }
            const sorted = usedNumbers.slice().sort((a, b) => a - b);
            const wrap = document.createElement('div');
            wrap.className = 'flex flex-wrap gap-2';
            sorted.forEach(num => {
                const badge = document.createElement('span');
                badge.className = 'px-3 py-1 rounded-full text-xs bg-white/15 text-white border border-white/30 shadow-sm';
                badge.textContent = num;
                wrap.appendChild(badge);
            });
            container.appendChild(wrap);
        }

        function clearNumberHistory() {
            usedNumbers = [];
            updateNumberHistory();
        }

        // ----------------- Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø°ÙƒÙŠ -----------------
        const SmartSuggestions = {
            history: [],
            maxItems: 500,
            storageKey: 'sodfa_smart_history',

            init() {
                this.history = loadFromLocalStorage(this.storageKey, []);
            },

            add(items) {
                // items is array of strings
                const newItems = items.filter(item => !this.history.includes(item));
                if (newItems.length > 0) {
                    // Add to beginning
                    this.history = [...newItems, ...this.history].slice(0, this.maxItems);
                    saveToLocalStorage(this.storageKey, this.history);
                }
            },

            get(query) {
                if (!query) return [];
                const lowerQuery = query.toLowerCase();
                return this.history.filter(item => item.toLowerCase().includes(lowerQuery)).slice(0, 5);
            }
        };

        // Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ø­Ù‚Ù„ Ù…Ø¹ÙŠÙ†
        function setupSmartSuggestions(textareaId) {
            const textarea = document.getElementById(textareaId);
            if (!textarea) return;

            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ù†Ø³Ø¨ÙŠØ© Ù„ØªÙ…ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            if (textarea.parentElement) {
                 textarea.parentElement.style.position = 'relative';
            }

            const box = document.createElement('div');
            box.className = 'hidden absolute left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-xl z-50 overflow-hidden mt-1';
            box.style.top = '100%'; // Ø£Ø³ÙÙ„ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©
            box.style.maxHeight = '150px';
            box.style.overflowY = 'auto';

            textarea.parentElement.appendChild(box);

            textarea.addEventListener('input', () => {
                const cursorStart = textarea.selectionStart;
                const text = textarea.value;
                // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                const lastNewline = text.lastIndexOf('\n', cursorStart - 1);
                const nextNewline = text.indexOf('\n', cursorStart);
                const start = lastNewline + 1;
                const end = nextNewline === -1 ? text.length : nextNewline;
                
                const currentLine = text.substring(start, cursorStart); // Ø§Ù„Ù†Øµ Ø­ØªÙ‰ Ø§Ù„Ù…Ø¤Ø´Ø±

                if (currentLine.trim().length < 1) {
                    box.classList.add('hidden');
                    return;
                }

                const suggestions = SmartSuggestions.get(currentLine.trim());
                if (suggestions.length > 0) {
                    box.innerHTML = '';
                    suggestions.forEach(suggestion => {
                        const div = document.createElement('div');
                        div.className = 'px-4 py-2 hover:bg-blue-50 cursor-pointer text-gray-800 border-b border-gray-100 last:border-0 text-right';
                        div.textContent = suggestion;
                        div.onclick = () => {
                            // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­
                            const before = text.substring(0, start);
                            const after = text.substring(end);
                            textarea.value = before + suggestion + after;
                            box.classList.add('hidden');
                            textarea.focus();
                        };
                        box.appendChild(div);
                    });
                    box.classList.remove('hidden');
                } else {
                    box.classList.add('hidden');
                }
            });

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ØªØ±ÙƒÙŠØ² (Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†Ù‚Ø±)
            textarea.addEventListener('blur', () => {
                setTimeout(() => box.classList.add('hidden'), 200);
            });
        }

        // --- Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ---

        // Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (ØªØ³ØªØ®Ø¯Ù… Ù…Ù† Textarea ÙˆÙ…Ù† Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯)
        function addNames(newNamesArray) {
            if (newNamesArray.length > 0) {
                // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø°ÙƒÙŠ
                SmartSuggestions.add(newNamesArray);

                // ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø±
                const uniqueNewNames = newNamesArray.filter(name => !names.includes(name));
                
                if (uniqueNewNames.length > 0) {
                    names = names.concat(uniqueNewNames);
                    updateNamesList();
                    saveNameSettings();
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙƒØ¨ÙŠØ±Ø§Ù‹ØŒ Ù†Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    if (uniqueNewNames.length > 10) {
                        showConfettiPopup('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©', `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${uniqueNewNames.length} Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­.`, null, null, false, true);
                    }
                } else {
                     playSound('error');
                     showConfettiPopup('ØªÙ†Ø¨ÙŠÙ‡', 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„.', null, null, false, true);
                }
            }
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ù…Ù„Ù
        function importNamesFile(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            const extension = file.name.split('.').pop().toLowerCase();

            reader.onload = function(e) {
                let content = e.target.result;
                let newNames = [];

                try {
                    if (extension === 'xlsx' || extension === 'xls') {
                        const data = new Uint8Array(content);
                        const workbook = XLSX.read(data, {type: 'array'});
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆØ±Ù‚Ø© Ø¥Ù„Ù‰ JSON (Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ§Øª)
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                        // Ø¯Ù…Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙÙŠ Ù…ØµÙÙˆÙØ© ÙˆØ§Ø­Ø¯Ø© ÙˆØªÙ†Ø¸ÙŠÙÙ‡Ø§
                        newNames = jsonData.flat().map(n => String(n).trim()).filter(n => n.length > 0);
                    } else {
                        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙŠØ© Ùˆ CSV
                        // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø·Ø± Ø£Ùˆ Ø§Ù„ÙÙˆØ§ØµÙ„
                        newNames = content.split(/[\r\n,]+/).map(n => n.trim()).filter(n => n.length > 0);
                    }

                    addNames(newNames);
                    
                } catch (error) {
                    console.error(error);
                    playSound('error');
                    showConfettiPopup('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØµÙŠØºØ©.', null, null, false, true);
                }
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¯Ø®Ù„ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                input.value = '';
            };

            if (extension === 'xlsx' || extension === 'xls') {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsText(file);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†ØµÙŠØ©
        function addNamesFromTextarea() {
            const textarea = document.getElementById('namesTextarea');
            const newNames = textarea.value.split('\n').map(name => name.trim()).filter(name => name.length > 0);
            
            if (newNames.length > 0) {
                addNames(newNames);
                textarea.value = '';
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© (Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø£Ø¯Ø§Ø¡)
        function updateNamesList() {
            const container = document.getElementById('namesList');
            if (!container) return;
            container.innerHTML = '';
            
            // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡: Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 100 Ø§Ø³Ù… ÙÙ‚Ø· Ù„ØªØ¬Ù†Ø¨ ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø·ÙˆÙŠÙ„Ø©
            const displayLimit = 100;
            const namesToShow = names.slice(0, displayLimit);
            
            namesToShow.forEach((name, index) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-white/50 rounded px-3 py-2'; 
                div.innerHTML = `<span class="text-gray-900">${name}</span>
                                <button onclick="removeNameFromList('${name}', false)" class="text-red-600 hover:text-red-800">âœ•</button>`;
                container.appendChild(div);
            });

            if (names.length > displayLimit) {
                const moreDiv = document.createElement('div');
                moreDiv.className = 'text-center text-white/70 text-sm py-2';
                moreDiv.textContent = `... ÙˆÙ‡Ù†Ø§Ùƒ ${names.length - displayLimit} Ø§Ø³Ù… Ø¢Ø®Ø± (Ù…Ø®ÙÙŠØ© Ù„Ù„Ø³Ø±Ø¹Ø©)`;
                container.appendChild(moreDiv);
            }
            
            if (names.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'text-center text-white/50 py-4';
                emptyDiv.textContent = 'Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©';
                container.appendChild(emptyDiv);
            }
        }
        
        // ** Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ­Ø¯Ø© (ØªÙ‚Ø¨Ù„ Ø§Ù„Ø§Ø³Ù… Ù…Ø¨Ø§Ø´Ø±Ø©) **
        function removeNameFromList(nameToRemove, silent = true) {
            const index = names.indexOf(nameToRemove);
            
            if (index > -1 && names.length > 1) { 
                names.splice(index, 1);
                updateNamesList();
                saveNameSettings();
                if (!silent) closeResultPopup();
                return true;
            } else if (names.length <= 1) {
                 playSound('error');
                 if (!silent) showConfettiPopup('Ø®Ø·Ø£', 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø§Ø³Ù…ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ù‚Ù‰ Ø§Ø³Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.', null, null, false, true);
                 return false;
            }
            return false;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¦Ø² Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function removeWinningName(winningName) {
             removeNameFromList(winningName, false);
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
        function clearNames() {
             showConfirmModal('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ØŸ', () => {
                names = [];
                updateNamesList();
                saveNameSettings(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø­ **
                const nameElement = document.getElementById('selectedName');
                nameElement.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯';
                adjustFontSize(nameElement); // Ø¶Ø¨Ø· Ø§Ù„Ø­Ø¬Ù… Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
        function adjustFontSize(element) {
            const length = element.textContent.length;
            const isMobile = window.innerWidth <= 768;
            let size;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (ØªØµØºÙŠØ±Ù‡ Ø¨Ø´ÙƒÙ„ Ø®Ø§Øµ)
            if (element.textContent.includes('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯') || element.textContent.includes('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯')) {
                element.style.fontSize = isMobile ? '2rem' : '3rem';
                return;
            }
            
            if (isMobile) {
                // Ù„Ù„Ø¬ÙˆØ§Ù„: Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ù„ØªÙØ§Ù Ù…Ø¹ Ø®Ø· Ø£ÙƒØ¨Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹
                if (length <= 10) {
                    size = 'min(15vw, 4rem)';
                } else {
                    size = 'min(10vw, 2.5rem)';
                }
            } else {
                // Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±: Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø± Ø§Ù„ÙˆØ§Ø­Ø¯ Ù…Ø¹ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚ØµÙˆÙ‰
                if (length <= 6) {
                    size = 'min(18vw, 8rem)'; // Increased from 15vw/6rem
                } else if (length <= 12) {
                    size = 'min(14vw, 5.5rem)'; // Increased from 12vw/4.5rem
                } else if (length <= 20) {
                    size = 'min(10vw, 3.5rem)'; // Increased from 8vw/3rem
                } else {
                    size = 'min(6vw, 2.5rem)'; // Increased from 5vw/2rem
                }
            }
            
            element.style.fontSize = size;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        function selectRandomName() {
            if (nameInterval !== null) return; // Ù…Ù†Ø¹ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬

            if (names.length === 0) {
                playSound('error');
                showConfettiPopup('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹.', null, null, false, true);
                return;
            }
            
            const autoRemove = document.getElementById('autoRemoveName').checked;
            
            if (autoRemove && names.length <= 1) {
                playSound('error');
                showConfettiPopup('Ø®Ø·Ø£', 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ù‚ØµØ§Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ù‚Ù‰ Ø§Ø³Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.', null, null, false, true);
                return;
            }

            document.getElementById('selectNameButton').disabled = true;
            const nameElement = document.getElementById('selectedName');
            const showPopup = document.getElementById('showNamePopup').checked;
            const showConfetti = document.getElementById('showNameConfetti').checked;

            let duration = parseInt(document.getElementById('nameDuration').value) * 1000;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø®ÙŠØ§Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
            const isDynamicDuration = document.getElementById('dynamicNameDuration') ? document.getElementById('dynamicNameDuration').checked : false;
            if (isDynamicDuration) {
                // ÙˆÙ‚Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 3 Ùˆ 15 Ø«Ø§Ù†ÙŠØ© (3000 - 15000 Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)
                duration = Math.floor(Math.random() * (15000 - 3000 + 1)) + 3000;
            }
            const startTime = Date.now();
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØµÙˆØª Ø³Ø§Ø¨Ù‚
            stopNameTickSound();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„Ø§Ø³Ø§Øª ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¹Ù†ØµØ±
            nameElement.classList.remove('pop-name');
            nameElement.classList.add('blur-text');
            
            const tick = () => {
                const now = Date.now();
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø¯Ù… (ØªØ³Ø§Ø±Ø¹ Ø³Ù„Ø¨ÙŠ - ÙŠØ¨Ø¯Ø£ Ø³Ø±ÙŠØ¹Ø§Ù‹ ÙˆÙŠØªØ¨Ø§Ø·Ø£)
                // ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 50ms ÙˆÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ ~400ms
                const currentDelay = 50 + (350 * Math.pow(progress, 3));
                
                // Ø­Ø³Ø§Ø¨ Ø³Ø±Ø¹Ø© Ø§Ù„ØµÙˆØª (1.0 -> ~0.2)
                let rate = 50 / currentDelay;
                if (rate < 0.2) rate = 0.2;
                
                // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªÙƒØ© Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„Ø³Ø±Ø¹Ø©
                playDigitalTick(rate);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…
                const randomName = names[Math.floor(Math.random() * names.length)];
                nameElement.textContent = randomName;
                adjustFontSize(nameElement); // Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
                
                if (progress < 1) {
                    // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
                    nameInterval = setTimeout(tick, currentDelay);
                } else {
                    // Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                    nameInterval = null;
                    
                    // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                    const finalName = names[Math.floor(Math.random() * names.length)];
                    nameElement.textContent = finalName;
                    adjustFontSize(nameElement); // Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù„Ù„Ø§Ø³Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„
                    addToHistory(finalName);
                    
                    // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø­Ø°Ù Ø§Ù„ÙØ§Ø¦Ø²
                    const removeWinnerBtn = document.getElementById('removeWinnerBtn');
                    if (removeWinnerBtn) {
                        removeWinnerBtn.disabled = false;
                        // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø²Ø± Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„ÙŠÙ‡
                        removeWinnerBtn.dataset.currentWinner = finalName;
                    }
                    
                    // Ø¥Ø²Ø§Ù„Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶Ø¨Ø§Ø¨ÙŠØ© ÙˆØ¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±
                    nameElement.classList.remove('blur-text');
                    
                    // ÙØ±Ø¶ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±Ø³Ù… (Reflow) Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù…Ù† Ø¬Ø¯ÙŠØ¯
                    void nameElement.offsetWidth; 
                    nameElement.classList.add('pop-name');
                    
                    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ÙÙˆØ² (Cheer)
                    playSound('cheer');
                    setTimeout(() => stopCheerSound(), 3000); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ

                    // ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø£Ù… Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙŠØ¯ÙˆÙŠ
                    const deleteCallback = autoRemove ? null : 'removeWinningName';

                    if (showPopup || showConfetti) {
                        // ØªØ£Ø®ÙŠØ± Ù‚Ù„ÙŠÙ„ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø±Ø¤ÙŠØ© Ø§Ù„Ø§Ø³Ù… ÙˆØªØ£Ø«ÙŠØ± Ø§Ù„Ù€ pop Ù‚Ø¨Ù„ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
                        setTimeout(() => {
                            showConfettiPopup('Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¦Ø²', `${finalName}`, finalName, deleteCallback, showConfetti, showPopup);
                        }, 600);
                    }
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ù‚ØµØ§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ØŒ Ù†Ø­Ø°Ù Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
                    if (autoRemove) {
                        removeNameFromList(finalName);
                    }

                    document.getElementById('selectNameButton').disabled = false;
                }
            };
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
            nameInterval = setTimeout(tick, 50);
        }

        // ----------------- Ø¯ÙˆØ§Ù„ Ø³Ø¬Ù„ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† -----------------
        
        function addToHistory(name) {
            const timestamp = new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
            winnersHistory.unshift({ name: name, time: timestamp }); // Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            
            // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 50 ÙØ§Ø¦Ø² ÙÙ‚Ø·
            if (winnersHistory.length > 50) {
                winnersHistory.pop();
            }
            
            saveNameSettings(); // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„
        }
        
        function removeCurrentWinner() {
            const removeBtn = document.getElementById('removeWinnerBtn');
            const winnerName = removeBtn.dataset.currentWinner;
            
            if (winnerName) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
                const removed = removeNameFromList(winnerName, false);
                if (removed) {
                    removeBtn.disabled = true;
                    removeBtn.dataset.currentWinner = '';
                    // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ù„ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø°Ù
                    removeBtn.innerHTML = 'âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù';
                    setTimeout(() => {
                        removeBtn.innerHTML = 'ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙØ§Ø¦Ø²';
                    }, 2000);
                }
            }
        }
        
        function toggleHistoryModal() {
            const modal = document.getElementById('historyModal');
            if (modal) {
                if (modal.classList.contains('visible')) {
                    modal.classList.remove('visible');
                } else {
                    renderHistoryList();
                    modal.classList.add('visible');
                }
            }
        }
        
        function renderHistoryList() {
            const listContainer = document.getElementById('historyList');
            if (!listContainer) return;
            
            listContainer.innerHTML = '';
            
            if (winnersHistory.length === 0) {
                listContainer.innerHTML = '<p class="text-white/50 text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                return;
            }
            
            winnersHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-white/20 p-2 rounded hover:bg-white/30 transition-colors';
                div.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="text-white/60 text-sm font-mono">${index + 1}.</span>
                        <span class="text-white font-bold">${item.name}</span>
                    </div>
                    <span class="text-white/50 text-xs bg-black/20 px-2 py-1 rounded">${item.time}</span>
                `;
                listContainer.appendChild(div);
            });
        }
        
        function clearHistory() {
            if (winnersHistory.length === 0) return;
            
            showConfirmModal('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†ØŸ', () => {
                winnersHistory = [];
                saveNameSettings();
                renderHistoryList();
            });
        }

        // --- Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„Ù†Ø±Ø¯ ---
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø±Ø¯
        function updateDiceContainer() {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… currentDiceCount Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©
            const count = parseInt(currentDiceCount);
            const container = document.getElementById('diceContainer');
            if (!container) return;
            container.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                // Ø¥Ù†Ø´Ø§Ø¡ ØºÙ„Ø§Ù Ù„Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù‚ÙØ²ÙŠØ©
                const wrapper = document.createElement('div');
                wrapper.className = 'dice-anim-wrapper';
                wrapper.id = `dice-wrapper-${i}`;

                const dice = document.createElement('div');
                dice.className = 'dice-container';
                dice.id = `dice-${i}`;
                
                for(let j=1; j<=6; j++) {
                    const face = document.createElement('div');
                    face.className = `dice-face ${getFaceClass(j)}`;
                    face.textContent = j;
                    dice.appendChild(face);
                }

                wrapper.appendChild(dice);
                container.appendChild(wrapper);
            }
            saveDiceSettings(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« **
        }
        
        function getFaceClass(value) {
            switch(value) {
                case 1: return 'one';
                case 2: return 'two';
                case 3: return 'three';
                case 4: return 'four';
                case 5: return 'five';
                case 6: return 'six';
                default: return 'one';
            }
        }
        
        let diceHistory = [];

        // Ø¯Ø§Ù„Ø© Ù„Ø±Ù…ÙŠ Ø§Ù„Ù†Ø±Ø¯
        function rollDice() {
            document.getElementById('rollDiceButton').disabled = true;
            
            // ** Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 4: ØªØ¹Ø·ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØºÙŠÙŠØ± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† **
            document.querySelectorAll('#diceCountRadios input').forEach(radio => radio.disabled = true);
            
            const diceElements = document.querySelectorAll('.dice-container');
            const diceCount = diceElements.length;
            let finishedDice = 0;
            
            const showPopup = document.getElementById('showDicePopup').checked;
            const showConfetti = document.getElementById('showDiceConfetti').checked;

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            const resultDiv = document.getElementById('diceResultDisplay');
            if (resultDiv) resultDiv.textContent = '';

            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø±Ù…ÙŠ Ø§Ù„Ù†Ø±Ø¯ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
            playDiceRolling(); // ** ØªØ­Ø¯ÙŠØ«: Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØª Ø§Ù„Ø¯Ø­Ø±Ø¬Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² **
            
            diceElements.forEach((dice) => {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø±ÙƒØ©
                dice.style.transition = 'none';
                dice.style.transform = 'rotateX(0deg) rotateY(0deg) rotateZ(0deg)'; // Ø¥Ø¹Ø§Ø¯Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ØµÙØ±ÙŠ Ø¨Ø´ÙƒÙ„ Ù…Ø¤Ù‚Øª
                
                // ØªÙØ¹ÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ù‚ÙØ² Ø¹Ù„Ù‰ Ø§Ù„ØºÙ„Ø§Ù
                const wrapper = dice.parentElement;
                if (wrapper && wrapper.classList.contains('dice-anim-wrapper')) {
                    wrapper.classList.remove('jumping');
                    void wrapper.offsetWidth; // Force reflow
                    wrapper.classList.add('jumping');
                }

                dice.offsetHeight; // Force reflow for dice

                const finalValue = Math.floor(Math.random() * 6) + 1;
                
                // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ø¹Ù†ØµØ± Ù†ÙØ³Ù‡ Ù„Ø¥ØµÙ„Ø§Ø­ Ø®Ø·Ø£ Ø§Ù„Ø­Ø³Ø§Ø¨
                dice.dataset.value = finalValue;

                // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù„ÙØ§Øª Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø­Ø±ÙƒØ© Ø£ÙƒØ«Ø± Ø¥Ø«Ø§Ø±Ø©
                const baseRotX = (Math.floor(Math.random() * 8) + 8) * 360;
                const baseRotY = (Math.floor(Math.random() * 8) + 8) * 360;
                const baseRotZ = (Math.floor(Math.random() * 4) + 2) * 360; // Ø¯ÙˆØ±Ø§Ù† Ø¥Ø¶Ø§ÙÙŠ Ø­ÙˆÙ„ Ø§Ù„Ù…Ø­ÙˆØ± Z
                
                let rotX = 0;
                let rotY = 0;

                switch(finalValue) {
                    case 1: rotX = 0; rotY = 0; break;
                    case 2: rotX = 90; rotY = 0; break;
                    case 3: rotX = 0; rotY = -90; break;
                    case 4: rotX = 0; rotY = 90; break;
                    case 5: rotX = -90; rotY = 0; break;
                    case 6: rotX = 0; rotY = 180; break;
                }

                const finalX = baseRotX + rotX;
                const finalY = baseRotY + rotY;
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© ØªÙˆÙ‚ÙŠØª (easing) Ù…Ø±Ù†Ø© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡
                dice.style.transition = 'transform 1.5s cubic-bezier(0.15, 0.9, 0.35, 1.05)';
                dice.style.transform = `rotateX(${finalX}deg) rotateY(${finalY}deg) rotateZ(${baseRotZ}deg)`;
                
                dice.addEventListener('transitionend', () => {
                    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ø±ØªØ·Ø§Ù… Ø®ÙÙŠÙ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                    playDiceHit(); // ** ØªØ­Ø¯ÙŠØ«: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ **

                    finishedDice++;
                    if (finishedDice === diceCount) {
                        
                        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®Ø²Ù†Ø©
                        const totalResult = Array.from(document.querySelectorAll('.dice-container')).reduce((sum, d) => {
                            return sum + parseInt(d.dataset.value || 0);
                        }, 0);
                        
                        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
                        if (resultDiv) {
                            resultDiv.textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${totalResult}`;
                            resultDiv.classList.add('pop-number'); // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø­Ø±ÙƒÙŠ
                            setTimeout(() => resultDiv.classList.remove('pop-number'), 500);
                        }

                        // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„
                        updateDiceHistory(totalResult, diceCount);
                        
                        if (showPopup || showConfetti) { 
                            showConfettiPopup('Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ø±Ø¯', `Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${totalResult}`, null, null, showConfetti, showPopup);
                        }
                        document.getElementById('rollDiceButton').disabled = false;
                         // ** Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 4: Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ **
                        document.querySelectorAll('#diceCountRadios input').forEach(radio => radio.disabled = false);
                    }
                }, { once: true });
            });
        }

        function updateDiceHistory(total, count) {
            const timestamp = new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
            diceHistory.unshift({ total: total, count: count, time: timestamp });
            if (diceHistory.length > 10) diceHistory.pop();
            renderDiceHistory();
        }

        function renderDiceHistory() {
            const container = document.getElementById('diceHistoryContainer');
            if (!container) return;
            container.innerHTML = '';
            
            if (diceHistory.length === 0) {
                container.innerHTML = '<p class="text-white/50 text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                return;
            }
            
            diceHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-white/20 p-2 rounded hover:bg-white/30 transition-colors';
                div.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="text-white/60 text-sm font-mono">${index + 1}.</span>
                        <span class="text-white font-bold">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${item.total}</span>
                        <span class="text-white/60 text-xs">(${item.count} Ù†Ø±Ø¯)</span>
                    </div>
                    <span class="text-white/50 text-xs bg-black/20 px-2 py-1 rounded">${item.time}</span>
                `;
                container.appendChild(div);
            });
        }

        function clearDiceHistory() {
            diceHistory = [];
            renderDiceHistory();
        }
        

        // --- Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø© ---

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„Ø© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ (Ù…Ø­Ø³Ù†Ø©)
        function initCoin3D() {
            const coin = document.getElementById('coin');
            if (!coin) return;
            
            coin.innerHTML = ''; 
            
            // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ù…Ø§ÙƒØ© Ù„ØªÙƒÙˆÙ† Ø£ÙˆØ¶Ø­
            const thickness = 20; 
            const fragment = document.createDocumentFragment();

            // 1. Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ
            const front = document.createElement('div');
            front.className = 'coin-layer coin-front-face';
            front.innerHTML = '<img src="https://i.postimg.cc/0jJ3CXQc/image.png" alt="ÙˆØ¬Ù‡ Ø§Ù„ØµÙˆØ±Ø©">';
            fragment.appendChild(front);

            // 2. Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ
            const back = document.createElement('div');
            back.className = 'coin-layer coin-back-face';
            back.innerHTML = '<img src="https://i.postimg.cc/hhWYZ8Qg/image.png" alt="ÙˆØ¬Ù‡ Ø§Ù„ÙƒØªØ§Ø¨Ø©">';
            fragment.appendChild(back);

            // 3. Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø­Ø§ÙØ© (Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ø³Ù…Ø§ÙƒØ©)
            // Ù†ÙˆØ²Ø¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø¨ÙŠÙ† -10px Ùˆ +10px (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ translateZ Ù„Ù„ÙˆØ¬Ù‡ÙŠÙ†)
            const step = 20 / thickness; // 20px Ù‡ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„ÙˆØ¬Ù‡ÙŠÙ† (10 - (-10) Ù†Ø¸Ø±ÙŠØ§Ù‹)
            // Ù„ÙƒÙ† Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„ÙˆØ¬Ù‡ÙŠÙ† Ø¹Ù†Ø¯ +10 (ÙˆØ§Ø­Ø¯ Ù…Ù‚Ù„ÙˆØ¨)ØŒ Ø³Ù†Ù…Ù„Ø£ Ø§Ù„ÙØ±Ø§Øº Ø¨ÙŠÙ†Ù‡Ù…Ø§
            
            for (let i = 0; i < thickness; i++) {
                const layer = document.createElement('div');
                layer.className = 'coin-layer coin-edge-layer';
                
                // ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ù„Ù„Ø­Ø§ÙØ©
                // Ù†Ø³ØªØ®Ø¯Ù… Ø£Ù„ÙˆØ§Ù†Ø§Ù‹ Ù…Ø®ØªÙ„ÙØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¥Ø¹Ø·Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ù…Ø¹Ø¯Ù†ÙŠ
                const isEven = i % 2 === 0;
                layer.style.background = isEven ? '#f8a241' : '#d68b35'; 
                
                // Ø§Ù„Ø­ÙŠÙ„Ø© Ù‡Ù†Ø§: ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆØ± Z
                // Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ Ø¹Ù†Ø¯ +10
                // Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ Ø¹Ù†Ø¯ +10 (Ù„ÙƒÙ† Ù…Ù‚Ù„ÙˆØ¨ØŒ ÙŠØ¹Ù†ÙŠ ÙƒØ£Ù†Ù‡ Ø¹Ù†Ø¯ -10 Ù…Ù† ÙˆØ¬Ù‡Ø© Ù†Ø¸Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯)
                // Ù„Ø°Ø§ Ù†ÙˆØ²Ø¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù…Ù† -9 Ø¥Ù„Ù‰ +9
                const z = -9 + (i * (18 / thickness)); 
                
                layer.style.transform = `translateZ(${z}px)`;
                fragment.appendChild(layer);
            }

            coin.appendChild(fragment);
        }

        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.addEventListener('DOMContentLoaded', initCoin3D);
        document.addEventListener('DOMContentLoaded', setupCoinGestures);
        if (document.readyState === 'complete') {
            initCoin3D();
            setupCoinGestures();
        }

        // ** Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥ÙŠÙ…Ø§Ø¡Ø§Øª Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ø¹Ù…Ù„Ø© (Ø³Ø­Ø¨ Ù„Ù„Ø£Ø¹Ù„Ù‰) **
        function setupCoinGestures() {
            const container = document.querySelector('.coin-container');
            const wrapper = document.getElementById('coin-toss-wrapper');
            if (!container || !wrapper) return;

            let startY = 0;
            let currentY = 0;
            let isDragging = false;

            // Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø£Ø«Ù†Ø§Ø¡ Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©
            container.style.touchAction = 'none'; 

            container.addEventListener('touchstart', (e) => {
                if (document.getElementById('flipCoinButton').disabled) return;
                startY = e.touches[0].clientY;
                isDragging = true;
                wrapper.style.transition = 'none'; // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø³Ù„Ø³ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨ Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ©
            }, { passive: false });

            container.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentY = e.touches[0].clientY;
                const deltaY = currentY - startY;

                // Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ø¨Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ø£Ø¹Ù„Ù‰ (Ù‚ÙŠÙ… Ø³Ø§Ù„Ø¨Ø©)
                if (deltaY < 0) {
                    e.preventDefault(); // Ù…Ù†Ø¹ Ø³Ø­Ø¨ Ø§Ù„ØµÙØ­Ø©
                    // Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§ÙˆÙ…Ø© ÙƒÙ„Ù…Ø§ Ø³Ø­Ø¨Ù†Ø§ Ø£ÙƒØ«Ø± (Damping)
                    const resistance = 1 + (Math.abs(deltaY) / 300);
                    const translateY = deltaY / resistance;
                    wrapper.style.transform = `translateY(${translateY}px)`;
                }
            }, { passive: false });

            container.addEventListener('touchend', (e) => {
                if (!isDragging) return;
                isDragging = false;
                
                const deltaY = currentY - startY;
                
                if (deltaY < -80) {
                    wrapper.style.transition = 'transform 0.2s ease-out';
                    wrapper.style.transform = 'translateY(0)';
                    flipCoin();
                } else {
                    wrapper.style.transition = 'transform 0.3s ease-out';
                    wrapper.style.transform = 'translateY(0)';
                }
            });
        }

        // ØªÙˆÙ„ÙŠØ¯ ØµÙˆØª Ø±Ù†ÙŠÙ† Ø§Ù„Ø¹Ù…Ù„Ø© (Ping)
        function playCoinFlipSound() {
            initAudioContext();
            if (!audioCtx) return;
            const t = audioCtx.currentTime;

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(2800, t);
            osc.frequency.exponentialRampToValueAtTime(1200, t + 0.3);

            gain.gain.setValueAtTime(0, t);
            gain.gain.linearRampToValueAtTime(0.3, t + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.01, t + 0.4);

            osc.start(t);
            osc.stop(t + 0.4);
        }

        // ØªÙˆÙ„ÙŠØ¯ ØµÙˆØª Ø§Ø±ØªØ·Ø§Ù… Ø§Ù„Ø¹Ù…Ù„Ø© (Hit & Wobble)
        function playCoinHitSound() {
            initAudioContext();
            if (!audioCtx) return;
            const t = audioCtx.currentTime;

            // Ø§Ø±ØªØ·Ø§Ù…
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(1000, t);
            
            gain.gain.setValueAtTime(0, t);
            gain.gain.linearRampToValueAtTime(0.4, t + 0.005);
            gain.gain.exponentialRampToValueAtTime(0.01, t + 0.15);
            
            osc.start(t);
            osc.stop(t + 0.15);

            // Ø§Ù‡ØªØ²Ø§Ø² (Rattle)
            for (let i = 0; i < 4; i++) {
                const rt = t + 0.08 + (i * 0.06);
                const rOsc = audioCtx.createOscillator();
                const rGain = audioCtx.createGain();
                rOsc.connect(rGain);
                rGain.connect(audioCtx.destination);
                
                rOsc.type = 'sine';
                rOsc.frequency.setValueAtTime(900 + (Math.random() * 200), rt);
                
                const vol = 0.15 / (i + 1);
                rGain.gain.setValueAtTime(0, rt);
                rGain.gain.linearRampToValueAtTime(vol, rt + 0.005);
                rGain.gain.exponentialRampToValueAtTime(0.01, rt + 0.05);
                
                rOsc.start(rt);
                rOsc.stop(rt + 0.05);
            }
        }

        // Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØ®Ø²ÙŠÙ† Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„Ø©
        let coinHistory = [];
        let headsCount = 0;
        let tailsCount = 0;

        // Ø¯Ø§Ù„Ø© Ù„Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø© (Ù…Ø­Ø¯Ø«Ø©)
        function flipCoin() {
            const showPopup = document.getElementById('showCoinPopup').checked;
            const showConfetti = document.getElementById('showCoinConfetti').checked;

            document.getElementById('flipCoinButton').disabled = true;
            const coin = document.getElementById('coin');
            const coinWrapper = document.getElementById('coin-toss-wrapper');
            
            // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
            if (coin.children.length === 0) initCoin3D();

            const result = Math.random() < 0.5 ? 'ØµÙˆØ±Ø©' : 'ÙƒØªØ§Ø¨Ø©';
            
            // ÙˆÙ‚Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø¨ÙŠÙ† 2 Ùˆ 3.5 Ø«ÙˆØ§Ù†ÙŠ ÙƒÙ…Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const duration = 2 + Math.random() * 1.5;
            
            // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­ÙˆØ± Y (ÙŠÙ…ÙŠÙ†-ÙŠØ³Ø§Ø±)
            // ØªÙ… ØªÙ‚Ù„ÙŠÙ„ Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ù…Ù† 3 Ø¥Ù„Ù‰ 2 Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ¬Ø¹Ù„Ù‡Ø§ Ø£Ù‚Ù„ Ø¥Ø²Ø¹Ø§Ø¬Ø§Ù‹
            const totalRotations = Math.floor(duration * 2) + Math.floor(Math.random() * 3) + 2;

            const finalRotation = (result === 'ØµÙˆØ±Ø©' ? 0 : 180) + (totalRotations * 360);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¹ Ù…ÙŠÙ„Ø§Ù† Ø«Ø§Ø¨Øª Ù„Ù„Ù…Ø­ÙˆØ± X Ù„Ø¥Ø¹Ø·Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ (Tilted Spin)
            coin.style.transition = 'none';
            coin.style.transform = `rotateX(10deg) rotateZ(-5deg) rotateY(0deg)`;
            coin.classList.remove('wobble-anim');
            
            if (coinWrapper) {
                coinWrapper.classList.remove('toss-animation');
                coinWrapper.classList.remove('bounce-anim');
                coinWrapper.style.animation = 'none';
                coinWrapper.style.transform = 'translateY(0)';
                coinWrapper.offsetHeight; // Trigger reflow
            }
            
            coin.offsetHeight; // Trigger reflow
            
            playCoinFlipSound(); // ØµÙˆØª Ø¬Ø¯ÙŠØ¯

            // Ø¨Ø¯Ø¡ Ø­Ø±ÙƒØ© Ø§Ù„Ø±Ù…ÙŠ (Toss)
            if (coinWrapper) {
                // Ù†Ø¶Ø¨Ø· Ù…Ø¯Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ø±Ù…ÙŠ Ù„ØªÙƒÙˆÙ† Ù…ØªØ²Ø§Ù…Ù†Ø© Ù…Ø¹ Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
                // Ù†Ø³ØªØ®Ø¯Ù… linear Ù„Ø£Ù† Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©) Ù…Ø­Ø¯Ø¯ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ keyframes
                coinWrapper.style.animation = `coinToss ${duration}s linear forwards`;
            }

            // Ø¨Ø¯Ø¡ Ø­Ø±ÙƒØ© Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†Ø­Ù†Ù‰ "Ease Out Quint" Ù„Ø¯ÙˆØ±Ø§Ù† Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØªØ¨Ø§Ø·Ø¤ ØªØ¯Ø±ÙŠØ¬ÙŠ Ø­ØªÙ‰ Ø§Ù„ØªÙˆÙ‚Ù
            // Ù†Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠÙ„Ø§Ù† (rotateX Ùˆ rotateZ) Ø·ÙˆØ§Ù„ ÙØªØ±Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
            coin.style.transition = `transform ${duration}s cubic-bezier(0.23, 1, 0.32, 1)`;
            coin.style.transform = `rotateX(10deg) rotateZ(-5deg) rotateY(${finalRotation}deg)`;
            
            coin.addEventListener('transitionend', () => {
                playCoinHitSound(); // ØµÙˆØª Ø§Ø±ØªØ·Ø§Ù…
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯ Ù„Ù„Ø­Ø§ÙˆÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªØ¯Ø§Ø®Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª
                if (coinWrapper) {
                    coinWrapper.style.animation = 'none';
                    coinWrapper.style.transform = 'translateY(0)';
                    coinWrapper.offsetHeight; // Force reflow
                    
                    coinWrapper.classList.add('bounce-anim');
                    setTimeout(() => {
                        coinWrapper.classList.remove('bounce-anim');
                        coinWrapper.style.transform = 'translateY(0)';
                    }, 400);
                } else {
                     coin.classList.add('wobble-anim');
                }

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                addToCoinHistory(result);

                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                if (showPopup || showConfetti) { 
                    setTimeout(() => {
                        showConfettiPopup('Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¹Ù…Ù„Ø©', `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${result}`, null, null, showConfetti, showPopup);
                        document.getElementById('flipCoinButton').disabled = false;
                    }, 600);
                } else {
                    document.getElementById('flipCoinButton').disabled = false;
                }
            }, { once: true });
        }

        // Ø¯ÙˆØ§Ù„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function addToCoinHistory(result) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            coinHistory.unshift({ result, time: timeString }); // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø£Ø¹Ù„Ù‰
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
            if (result === 'ØµÙˆØ±Ø©') headsCount++;
            else tailsCount++;
            
            updateCoinStats();
            renderCoinHistory();
            saveCoinSettings(); // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„
        }

        function updateCoinStats() {
            const headsEl = document.getElementById('headsCount');
            const tailsEl = document.getElementById('tailsCount');
            if (headsEl) headsEl.textContent = headsCount;
            if (tailsEl) tailsEl.textContent = tailsCount;
        }

        function renderCoinHistory() {
            const list = document.getElementById('coinHistoryList');
            if (!list) return;
            
            if (coinHistory.length === 0) {
                list.innerHTML = '<p class="text-white/50 text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                return;
            }

            list.innerHTML = '';
            coinHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-white/10 p-2 rounded border border-white/10 animate-fade-in';
                
                // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù†ØªÙŠØ¬Ø©
                const colorClass = item.result === 'ØµÙˆØ±Ø©' ? 'text-yellow-300' : 'text-blue-300';
                
                div.innerHTML = `
                    <span class="font-bold ${colorClass}">${item.result}</span>
                    <span class="text-xs text-white/60 dir-ltr">${item.time}</span>
                `;
                list.appendChild(div);
            });
        }

        function clearCoinHistory() {
            coinHistory = [];
            headsCount = 0;
            tailsCount = 0;
            updateCoinStats();
            renderCoinHistory();
            saveCoinSettings();
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            toggleCoinHistoryModal();
            
            // Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
            playSound('click');
        }

        function toggleCoinHistoryModal() {
            const modal = document.getElementById('coinHistoryModal');
            modal.classList.toggle('visible');
            if (modal.classList.contains('visible')) {
                renderCoinHistory();
            }
        }
        
        // --- Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª ---

        // ** Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØµØ¯ÙŠØ± Ø§Ù„ÙØ±Ù‚ Ø¥Ù„Ù‰ Ù…Ù„Ù CSV (Ø¥ÙƒØ³Ù„) **
        function exportTeamsToCSV() {
            // ** ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ÙØ§ØµÙ„ Ø¥Ù„Ù‰ ÙØ§ØµÙ„Ø© Ù…Ù†Ù‚ÙˆØ·Ø© (;) Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø£ÙØ¶Ù„ Ù…Ø¹ Excel Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© **
            const separator = ';'; 
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // Ø¥Ø¶Ø§ÙØ© UTF-8 BOM Ù„Ø¯Ø¹Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©

            // 1. Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ù…ØµÙÙˆÙØ© Ø«Ù†Ø§Ø¦ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ÙØ±ÙŠÙ‚)
            const teamData = [];
            let maxNamesPerTeam = 0;

            const containers = {};

            // Ø£. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±Ù‚ (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†)
            containers['unorganized'] = { name: 'ØºÙŠØ± Ù…Ø±ØªØ¨', names: [] };
            // ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… teamConfigs Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ currentTeamCount
            const activeTeamConfigs = teamConfigs.slice(0, currentTeamCount);
            
            for (let i = 0; i < currentTeamCount; i++) {
                const config = teamConfigs[i];
                const teamId = `team${config.id}`;
                const teamName = customTeamNames[teamId] || config.name;
                containers[teamId] = { name: teamName, names: [] };
            }

            // Ø¨. Ù…Ù„Ø¡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
            Object.keys(containers).forEach(containerId => {
                const containerElement = document.getElementById(containerId);
                if (containerElement) {
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø¹Ù†Ø§ØµØ± span Ø¯Ø§Ø®Ù„ name-item
                    const names = Array.from(containerElement.querySelectorAll('.name-item span')).map(span => span.textContent.trim());
                    containers[containerId].names = names;
                    if (names.length > maxNamesPerTeam) {
                        maxNamesPerTeam = names.length;
                    }
                }
            });

            // 2. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø£Ø³ (Header Row) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ CSV ØµØ­ÙŠØ­ (Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø§Øª ØªÙ†ØµÙŠØµ)
            const header = Object.values(containers).map(c => `"${c.name.replace(/"/g, '""')}"`).join(separator);
            csvContent += header + "\n";

            // 3. Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙÙˆÙ (Data Rows) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            for (let i = 0; i < maxNamesPerTeam; i++) {
                const row = Object.keys(containers).map(containerId => {
                    const name = containers[containerId].names[i] || "";
                    // ØªØºÙ„ÙŠÙ Ø§Ù„Ø§Ø³Ù… Ø¨Ø¹Ù„Ø§Ù…ØªÙŠ ØªÙ†ØµÙŠØµ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙÙˆØ§ØµÙ„ Ø£Ùˆ Ù…Ø³Ø§ÙØ§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙÙŠ Excel
                    return `"${name.replace(/"/g, '""')}"`; 
                }).join(separator);
                csvContent += row + "\n";
            }

            // 4. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            
            // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
            
            link.setAttribute("download", `Teams_Export_${dateStr}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // ** Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ **
        function renameTeam(teamId) {
            const teamConfig = teamConfigs.find(c => `team${c.id}` === teamId);
            const currentName = customTeamNames[teamId] || teamConfig.name;
            
            // Ù†Ø³ØªØ®Ø¯Ù… window.prompt Ù„Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø§ÙØ°Ø© Ø¨Ø³ÙŠØ·Ø©)
            const newName = prompt(`ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ (${teamConfig.emoji}):`, currentName);
            
            if (newName && newName.trim() !== '' && newName.trim() !== currentName) {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙˆØ­ÙØ¸Ù‡
                customTeamNames[teamId] = newName.trim();
                saveDragAndDropState();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙØ±Ù‚ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø·Ù„ÙˆØ¨ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©)
                loadDragAndDropState();
            }
        }
        
        // ** Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© **
        function handleTeamCountChange() {
            
            let selectedCount;
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ø¯Ø¯ (Ù†Ø³ØªØ®Ø¯Ù… teamCountRadios)
            const checkedRadio = document.querySelector('#teamCountRadios input:checked');
            // ** Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 2: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø±Ø§Ø¡Ø© Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 4 **
            selectedCount = checkedRadio ? parseInt(checkedRadio.value) : 4; 
            
            // ** Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 3: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù‡Ùˆ 2 **
            if (selectedCount < 2) {
                selectedCount = 2;
                // ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ "2" Ø¥Ø°Ø§ Ø­Ø¯Ø« Ø®Ø·Ø£ 
                const defaultRadio = document.querySelector(`#teamCountRadios input[value="2"]`);
                 if (defaultRadio) {
                    defaultRadio.checked = true;
                 }
            }
            
            currentTeamCount = selectedCount;
            generateTeams();
            saveDragAndDropState(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ **
            updateStatistics();
        }

        function setupDragAndDropEventListeners() {
            document.getElementById('addMultipleBtn').addEventListener('click', addMultipleNames);
            
            document.addEventListener('click', function(e) {
                if (e.target && e.target.id === 'clearAllBtn') {
                    clearAllNames(); // ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
                } else if (e.target && e.target.id === 'randomDistributeBtn') {
                    randomDistribute();
                } else if (e.target && e.target.classList.contains('remove-btn')) {
                    const nameElement = e.target.closest('.name-item');
                    if (nameElement) {
                         removeName(nameElement.id);
                    }
                } else if (e.target && e.target.id === 'resetAllBtn') {
                    resetAllTeams(); // ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
                }
            });

            const droppableAreas = document.querySelectorAll('#unorganized, #teamsContainer > div > div');
            droppableAreas.forEach(area => {
                area.addEventListener('click', handleDropByClick);
            });
        }
        
        function generateTeams() {
            const container = document.getElementById('teamsContainer');
            const statsContainer = document.getElementById('statisticsContainer');
            if (!container || !statsContainer) return;
            
            const unorganizedArea = document.getElementById('unorganized');
            // Ù†Ù‚Ù„ ÙƒÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¥Ù„Ù‰ ØºÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø© Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙØ±Ù‚
            document.querySelectorAll('#teamsContainer .name-item').forEach(item => {
                unorganizedArea.appendChild(item);
            });
            
            container.innerHTML = '';
            statsContainer.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            
            // ** 1. ØªØ·Ø¨ÙŠÙ‚ ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ø®ØµØµØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ (Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±) **
            // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            container.classList.remove('lg:grid', 'lg:grid-cols-2', 'xl:grid-cols-4', 'team-layout-2', 'team-layout-3', 'team-layout-4', 'team-layout-5', 'team-layout-6', 'lg:flex-wrap');

            // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚
            switch(currentTeamCount) {
                case 2:
                    // ÙØ±ÙŠÙ‚Ø§Ù†: Ù…Ø³ØªØ·ÙŠÙ„Ø§Ù† ÙƒØ¨ÙŠØ±Ø§Ù† ÙÙˆÙ‚ Ø¨Ø¹Ø¶Ù‡Ù…Ø§ (Grid 1x2)
                    container.classList.add('lg:grid', 'team-layout-2');
                    break;
                case 3:
                    // Ø«Ù„Ø§Ø«Ø© ÙØ±Ù‚: Ø«Ù„Ø§Ø« Ù…Ø³ØªØ·ÙŠÙ„Ø§Øª Ø¨Ø§Ù„Ø·ÙˆÙ„ Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶Ù‡Ø§ (Grid 3x1)
                    container.classList.add('lg:grid', 'team-layout-3');
                    break;
                case 4:
                    // Ø£Ø±Ø¨Ø¹Ø© ÙØ±Ù‚: 2x2 Ø´Ø¨ÙƒØ©
                    container.classList.add('lg:grid', 'team-layout-4');
                    break;
                case 5:
                    // Ø®Ù…Ø³Ø© ÙØ±Ù‚: 3 ÙÙˆÙ‚ Ùˆ 2 ØªØ­Øª (Flexbox wrap) - Ù†Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§ Flexbox Ø§Ù„Ù…Ø®ØµØµ
                    container.classList.add('lg:flex-wrap', 'team-layout-5');
                    break;
                case 6:
                    // Ø³ØªØ© ÙØ±Ù‚: 3 ÙÙˆÙ‚ Ùˆ 3 ØªØ­Øª (Grid 3x2)
                    container.classList.add('lg:grid', 'team-layout-6');
                    break;
                default:
                    // Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ (Flexbox)
                    container.classList.add('lg:flex-wrap'); // Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù„ØªÙØ§Ù ÙƒØ§Ø­ØªÙŠØ§Ø·ÙŠ
                    break;
            }
            // ----------------------------------------------------------------------------------

            for (let i = 0; i < currentTeamCount; i++) {
                const config = teamConfigs[i];
                const teamDiv = document.createElement('div');
                const teamId = `team${config.id}`;
                const teamName = customTeamNames[teamId] || config.name; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØµØµ Ø¥Ù† ÙˆØ¬Ø¯
                
                // ** 2. ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„ÙŠØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯ **
                // Ø¥Ø²Ø§Ù„Ø© w-64 Ù„ØªÙ…ÙƒÙŠÙ† Grid/Flex Ù…Ù† Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
                teamDiv.className = `glass-card rounded-xl shadow-lg p-4`; 
                // Ø¥Ø¶Ø§ÙØ© flex-shrink-0 ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ
                if (window.innerWidth < 1024) {
                    teamDiv.classList.add('w-64', 'flex-shrink-0'); 
                }

                teamDiv.innerHTML = `
                    <h2 class="text-lg font-bold text-white mb-4 flex items-center justify-between">
                        <span class="flex items-center">
                            ${config.emoji} <span id="teamName-${teamId}" class="mr-2">${teamName}</span>
                        </span>
                        <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù„Ù… Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… -->
                        <button onclick="renameTeam('${teamId}')" class="text-white/80 hover:text-white transition-colors p-1 rounded-full hover:bg-white/20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                            </svg>
                        </button>
                    </h2>
                    <div id="${teamId}" class="team-column h-64 lg:h-96 p-3 border-2 border-dashed rounded-lg overflow-y-auto ${config.bgClass}"></div>
                `;
                container.appendChild(teamDiv);
                
                const teamArea = teamDiv.querySelector(`#${teamId}`);
                teamArea.addEventListener('dragover', allowDrop);
                teamArea.addEventListener('drop', drop);
                teamArea.addEventListener('dragleave', (e) => {
                    if (!teamArea.contains(e.relatedTarget)) {
                        teamArea.classList.remove('drag-over');
                    }
                });
                teamArea.addEventListener('click', handleDropByClick);
            }
            // ----------------------------------------------------------------------------------


            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (ØºÙŠØ± Ù…Ø±ØªØ¨)
            const unorganizedStats = document.createElement('div');
            unorganizedStats.className = 'text-center p-4 bg-white/20 rounded-lg';
            unorganizedStats.innerHTML = `<div class="text-2xl font-bold text-white" id="unorganizedCount">0</div>
                                          <div class="text-sm text-white/80">ØºÙŠØ± Ù…Ø±ØªØ¨</div>`;
            statsContainer.appendChild(unorganizedStats);

            // Ø¥Ø¶Ø§ÙØ© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙØ±Ù‚
            for (let i = 0; i < currentTeamCount; i++) {
                const config = teamConfigs[i];
                const teamId = `team${config.id}`;
                const teamName = customTeamNames[teamId] || config.name; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØµØµ Ø¥Ù† ÙˆØ¬Ø¯

                const teamStats = document.createElement('div');
                teamStats.className = 'text-center p-4 bg-white/20 rounded-lg';
                teamStats.innerHTML = `<div class="text-2xl font-bold text-white" id="${teamId}Count">0</div>
                                          <div class="text-sm text-white/80">${teamName}</div>`;
                statsContainer.appendChild(teamStats);
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…Ù†Ø·Ù‚Ø© ØºÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨ Ù„Ø¯ÙŠÙ‡Ø§ Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
            const unorganizedAreaNew = document.getElementById('unorganized');
            unorganizedAreaNew.addEventListener('dragover', allowDrop);
            unorganizedAreaNew.addEventListener('drop', drop);
            unorganizedAreaNew.addEventListener('dragleave', (e) => {
                if (!unorganizedAreaNew.contains(e.relatedTarget)) {
                    unorganizedAreaNew.classList.remove('drag-over');
                }
            });
            unorganizedAreaNew.addEventListener('click', handleDropByClick);
            
        }
        
        function addMultipleNames() {
            const textarea = document.getElementById('multipleNamesInput');
            const text = textarea.value.trim();
            if (text === '') return;
            
            let namesToAdd = [];
            const lines = text.split('\n');
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine) {
                    if (trimmedLine.includes(',')) {
                        trimmedLine.split(',').forEach(name => {
                            const trimmedName = name.trim();
                            if (trimmedName) namesToAdd.push(trimmedName);
                        });
                    } else {
                        namesToAdd.push(trimmedLine);
                    }
                }
            });
            
            // ** ØªØ­Ø³ÙŠÙ†: ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ù…Ù†Ø¹ Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ **
            const existingNames = Array.from(document.querySelectorAll('#unorganized .name-item, #teamsContainer .name-item'))
                                    .map(item => item.querySelector('span')?.textContent || item.textContent.trim());
            
            const uniqueNewNames = [...new Set(namesToAdd.filter(name => !existingNames.includes(name)))];
            
            if (uniqueNewNames.length === 0) {
                 playSound('error');
                 showConfettiPopup('ØªÙ†Ø¨ÙŠÙ‡', 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ ØºÙŠØ± ØµØ§Ù„Ø­Ø©.', null, null, false, true);
                 return;
            }

            // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø°ÙƒÙŠ
            SmartSuggestions.add(uniqueNewNames);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±ÙŠØ¯Ø©
            const unorganizedArea = document.getElementById('unorganized');
            uniqueNewNames.forEach(name => {
                nameCounter++;
                const nameElement = createNameElement(name, nameCounter);
                unorganizedArea.appendChild(nameElement);
            });
            
            textarea.value = '';
            updateStatistics();
            saveDragAndDropState(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© **
        }
        
        function createNameElement(name, id) {
            const div = document.createElement('div');
            // ** ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø±Ù Ù„ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù€ id Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ **
            div.id = `name-${id}`; 
            div.className = 'name-item bg-white/20 text-white border-2 border-white/30 rounded-lg p-3 mb-2 cursor-pointer shadow-sm';
            div.draggable = true;
            div.innerHTML = `<div class="flex justify-between items-center"><span class="font-medium">${name}</span>
                             <button class="text-red-300 hover:text-red-100 text-sm remove-btn">âœ•</button></div>`;
            div.addEventListener('dragstart', drag);
            div.addEventListener('click', handleNameClick);
            return div;
        }

        function handleNameClick(e) {
            if (e.target.closest('.remove-btn')) {
                return;
            }
            e.stopPropagation();
            
            const selectedName = document.querySelector('.name-item.selected');
            if (selectedName) {
                selectedName.classList.remove('selected');
                if (selectedName.id === e.currentTarget.id) {
                    selectedNameId = null;
                    return;
                }
            }
            e.currentTarget.classList.add('selected');
            selectedNameId = e.currentTarget.id;
        }

        function handleDropByClick(e) {
            // ** ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… **
             if (e.target.closest('button') && e.target.closest('button').getAttribute('onclick')?.includes('renameTeam')) {
                return;
            }

            const selectedName = document.getElementById(selectedNameId);
            if (selectedName) {
                const targetContainer = e.target.closest('#unorganized, [id^="team"]');
                if (targetContainer) {
                    // ØªØ´ØºÙŠÙ„ ØµÙˆØª ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø³Ù…
                    playSound('put_name');
                    targetContainer.appendChild(selectedName);
                    selectedName.classList.remove('selected');
                    selectedNameId = null;
                    updateStatistics();
                    saveDragAndDropState(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ù‚Ù„ **
                }
            }
        }
        
        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
            event.target.classList.add('dragging');
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø£Ø®Ø° Ø§Ù„Ø§Ø³Ù…
            playSound('take_name');
        }

        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function drop(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            if (draggedElement) {
                // ØªØ´ØºÙŠÙ„ ØµÙˆØª ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø³Ù…
                playSound('put_name');
                event.currentTarget.appendChild(draggedElement);
                draggedElement.classList.remove('dragging');
            }
            event.currentTarget.classList.remove('drag-over');
            updateStatistics();
            saveDragAndDropState(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ù‚Ù„ **
        }

        function removeName(nameId) {
            const element = document.getElementById(nameId);
            if (element) {
                showConfirmModal('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…ØŸ', () => {
                    element.remove();
                    updateStatistics();
                    saveDragAndDropState(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù **
                });
            }
        }
        
        function updateStatistics() {
            const unorganizedElement = document.getElementById('unorganizedCount');
            if (unorganizedElement) {
                unorganizedElement.textContent = document.getElementById('unorganized').children.length;
            }
            for (let i = 1; i <= currentTeamCount; i++) {
                const teamElement = document.getElementById(`team${i}Count`);
                const teamContainer = document.getElementById(`team${i}`);
                if (teamElement && teamContainer) {
                    teamElement.textContent = teamContainer.children.length;
                }
            }
        }
        
        // ** ØªÙ… Ø¥Ø²Ø§Ù„Ø© addSampleNames Ù„Ø£Ù† ÙˆØ¸ÙŠÙØ© loadDragAndDropState ØªÙ‚ÙˆÙ… Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© **
        
        function clearAllNames() {
            showConfirmModal('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ØŸ', () => {
                document.getElementById('unorganized').innerHTML = '';
                document.querySelectorAll('#teamsContainer .name-item').forEach(item => item.remove());
                updateStatistics();
                saveDragAndDropState(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø­ **
            });
        }
        
        function resetAllTeams() {
            // ** ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†Ø­ÙˆÙŠ Ù‡Ù†Ø§: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‚ÙˆØ³ Ø§Ù„Ø²Ø§Ø¦Ø¯ ) **
            showConfirmModal('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆÙ†Ù‚Ù„Ù‡Ø§ ÙƒÙ„Ù‡Ø§ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø©ØŸ', () => {
                const unorganizedArea = document.getElementById('unorganized');
                const teamItems = document.querySelectorAll('#teamsContainer .name-item');
                teamItems.forEach(item => unorganizedArea.appendChild(item));
                updateStatistics();
                saveDragAndDropState(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø· **
            });
        }

        function randomDistribute() {
            const allNames = Array.from(document.querySelectorAll('#unorganized .name-item, #teamsContainer .name-item'));
            if (allNames.length === 0) {
                 playSound('error');
                 showConfettiPopup('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„ØªÙˆØ²ÙŠØ¹.', null, null, false, true);
                 return;
            }
            
            showConfirmModal(`Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙˆØ²ÙŠØ¹ ${allNames.length} Ø§Ø³Ù… Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¹Ù„Ù‰ ${currentTeamCount} ÙØ±Ù‚ØŸ`, () => {
                const unorganizedArea = document.getElementById('unorganized');
                // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ ØºÙŠØ± Ù…Ø±ØªØ¨ Ø£ÙˆÙ„Ø§Ù‹
                allNames.forEach(nameElement => unorganizedArea.appendChild(nameElement));
                
                const shuffledNames = [...allNames].sort(() => Math.random() - 0.5);
                shuffledNames.forEach((nameElement, index) => {
                    const teamIndex = (index % currentTeamCount) + 1;
                    const teamContainer = document.getElementById(`team${teamIndex}`);
                    teamContainer.appendChild(nameElement);
                });
                updateStatistics();
                saveDragAndDropState(); // ** Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ²ÙŠØ¹ **
            });
        }

        // --- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø© (Popup / Confetti) ---
        
        // ** Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø·Ù„Ø§Ù‚ Ù‚ØµØ§ØµØ§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙƒØªØ¨Ø© **
        function createConfetti() {
            
            // Ø£Ù„ÙˆØ§Ù† Ù…Ø¨Ù‡Ø¬Ø©
            const colors = ['#00b5b5', '#e07d51', '#ffce18', '#FF6B6B', '#4ECDC4'];
            
            // Ø¥Ø·Ù„Ø§Ù‚ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± ÙˆØ§Ù„ÙŠÙ…ÙŠÙ† Ù…Ø¹ Ø¬Ø§Ø°Ø¨ÙŠØ© Ø®ÙÙŠÙØ©
            confetti({
                particleCount: 500,
                angle: 60,
                spread: 55,
                origin: { x: 0 },
                colors: colors
            });
            confetti({
                particleCount: 500,
                angle: 120,
                spread: 55,
                origin: { x: 1 },
                colors: colors
            });
        }
        
        function showConfettiPopup(title, message, winningName = null, deleteCallback = null, triggerConfetti = false, showPopup = true) {
            const existingPopup = document.querySelector('.result-popup');
            if (existingPopup) { existingPopup.remove(); }

            if (triggerConfetti) { 
                createConfetti(); 
                // ** ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù…ÙØ±Ù‚Ø¹Ø§Øª Ù‡Ù†Ø§ **
                playSound('confetti_pop'); 
            }
            if (!showPopup) { return; }

            // ** ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù…ÙØ¹Ù„Ø© **
            playSound('cheer');

            const popup = document.createElement('div');
            popup.className = 'result-popup';
            
            let deleteButton = '';
            if (winningName && deleteCallback) {
                 deleteButton = `<button onclick="window['${deleteCallback}']('${winningName}')" class="bg-red-500/80 hover:bg-red-500 text-white font-bold px-4 py-2 rounded-lg transition-colors mt-4">
                                     ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙØ§Ø¦Ø²
                                 </button>`;
            }

            popup.innerHTML = `<div class="text-4xl mb-4">ğŸ‰</div><div class="text-2xl font-bold mb-2">${title}</div>
                               <div class="text-3xl font-bold mb-4">${message}</div>
                               <button onclick="closeResultPopup()" class="bg-white/20 px-6 py-2 rounded-lg hover:bg-white/30 transition-all">Ø¥ØºÙ„Ø§Ù‚</button>
                               ${deleteButton}`;
            document.body.appendChild(popup);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø§ÙØ°Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø­Ø°Ù
            if (!deleteCallback) {
                setTimeout(() => { closeResultPopup(); }, 5000);
            }
        }
        
        function closeResultPopup() {
            // ** Ø¥ÙŠÙ‚Ø§Ù ØµÙˆØª Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ø³ØªÙ…Ø±Ø§Ø±Ù‡ Ø¨Ø¹Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© **
            stopCheerSound();

            const popup = document.querySelector('.result-popup');
            if (popup) {
                popup.style.animation = 'popupShow 0.3s ease-in reverse';
                setTimeout(() => { popup.remove(); }, 300);
            }
        }

        function showConfirmModal(message, onConfirm) {
            const existingModal = document.querySelector('.custom-modal');
            if (existingModal) { existingModal.remove(); }

            const modal = document.createElement('div');
            modal.className = 'custom-modal';
            modal.innerHTML = `<div class="modal-content"><p class="text-xl font-medium text-gray-800 mb-6">${message}</p>
                               <div class="flex justify-center gap-4"><button id="confirmBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded">ØªØ£ÙƒÙŠØ¯</button>
                               <button id="cancelBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded">Ø¥Ù„ØºØ§Ø¡</button></div></div>`;
            document.body.appendChild(modal);

            document.getElementById('confirmBtn').onclick = () => { onConfirm(); modal.remove(); };
            document.getElementById('cancelBtn').onclick = () => { modal.remove(); };
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Event Listeners)
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ù‡Ù†Ø§ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©)
        window.onload = function() {
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø°ÙƒÙŠ
            if (typeof SmartSuggestions !== 'undefined') {
                SmartSuggestions.init();
                setupSmartSuggestions('namesTextarea');
                setupSmartSuggestions('wheelOptionsTextarea');
                setupSmartSuggestions('multipleNamesInput');
            }

            // ** Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù‚Ø± Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© showSection **
            document.querySelectorAll('#main-menu-links a').forEach(link => {
                link.addEventListener('click', (e) => {
                    const sectionName = e.currentTarget.getAttribute('data-section');
                    if (sectionName) {
                        showSection(sectionName);
                    }
                });
            });
            // ----------------------------------------------------------------------------------

            // ** Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù‡Ù†Ø§ Ù„Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¯ÙˆØ§Ù„ **
            document.getElementById('wheelOptionsTextarea').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); addWheelOption(); }
            });

            document.getElementById('namesTextarea').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); addNamesFromTextarea(); }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ÙŠÙ† Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±
            const sliders = [
                { id: 'numberDuration', span: 'numberDurationValue', save: 'saveNumberSettings' }, 
                { id: 'nameDuration', span: 'nameDurationValueModal', save: 'saveNameSettings' },
                { id: 'coinDuration', span: 'coinDurationValue', save: 'saveCoinSettings' }
            ];
            
            sliders.forEach(s => {
                const slider = document.getElementById(s.id);
                const span = document.getElementById(s.span);
                if (slider && span) slider.addEventListener('input', () => { 
                    span.textContent = slider.value; 
                    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ø±ÙŠÙƒ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
                    window[s.save]();
                });
            });
            
            // ******************** Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø£Ø­Ø¯Ø§Ø« ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù… ********************
            
            // Ù‚Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Name Display Size)
            const autoRemoveNameCheckbox = document.getElementById('autoRemoveName'); // Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯

            if (autoRemoveNameCheckbox) {
                autoRemoveNameCheckbox.addEventListener('change', saveNameSettings);
            }
            
            // Ø§Ù„Ø¹Ù…Ù„Ø©
            const showCoinPopupCheckbox = document.getElementById('showCoinPopup');
            const showCoinConfettiCheckbox = document.getElementById('showCoinConfetti');
            if (showCoinPopupCheckbox) showCoinPopupCheckbox.addEventListener('change', saveCoinSettings);
            if (showCoinConfettiCheckbox) showCoinConfettiCheckbox.addEventListener('change', saveCoinSettings);
            
            // ******************** Ù†Ù‡Ø§ÙŠØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø£Ø­Ø¯Ø§Ø« ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù… ********************

            // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
            loadWheelSettings();
            loadNameSettings();
            loadNumberSettings();
            loadDiceSettings(); // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØ­Ù…Ù‘Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù‡Ù†Ø§
            loadCoinSettings();
            
            // ** Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©: ØªÙ‡ÙŠØ¦Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ **
            // Ù†Ø³ØªØ®Ø¯Ù… loadDragAndDropState ÙÙ‚Ø· Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† localStorage ÙˆØªØ­Ø¯ÙŠØ¯ Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ.
            // Ù‡Ø°Ø§ ÙŠÙ…Ù†Ø¹ Ø®Ø·Ø£ "Cannot set properties of undefined" Ù„Ø£Ù†Ù‡ Ù„Ø§ ÙŠØ­Ø§ÙˆÙ„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ù†Ø§ØµØ± DOM ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©.
            loadDragAndDropState(); 
            
            // ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©
            // Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù„Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ÙŠ
            const nameElement = document.getElementById('selectedName');
            if(nameElement) adjustFontSize(nameElement);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ø³Ø¬Ù„ (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
            history.replaceState({ section: 'main-menu' }, '', '#main-menu');
            showSection('main-menu', false); // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        };
    </script>
    <!-- History Modal -->
    <div id="historyModal" class="options-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-white text-2xl font-bold">Ø³Ø¬Ù„ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</h3>
                <button onclick="toggleHistoryModal()" class="text-white/80 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="glass-card rounded-lg p-4 mb-4">
                <div id="historyList" class="space-y-2 max-h-60 overflow-y-auto">
                    <!-- History items will be here -->
                    <p class="text-white/50 text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
            </div>
            
            <button onclick="clearHistory()" class="w-full bg-red-500/30 text-white px-4 py-2 rounded-lg hover:bg-red-500/50 mb-2">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            <button onclick="toggleHistoryModal()" class="w-full bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    <!-- Coin History Modal -->
    <div id="coinHistoryModal" class="options-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-white text-2xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ø±Ù…ÙŠØ§Øª</h3>
                <button onclick="toggleCoinHistoryModal()" class="text-white/80 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="glass-card rounded-lg p-4 mb-4">
                <div class="flex justify-between text-white/80 text-sm mb-2 border-b border-white/10 pb-2">
                    <span>Ø§Ù„Ù†ØªÙŠØ¬Ø©</span>
                    <span>Ø§Ù„ÙˆÙ‚Øª</span>
                </div>
                <div id="coinHistoryList" class="space-y-2 max-h-60 overflow-y-auto">
                    <!-- History items will be here -->
                    <p class="text-white/50 text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
            </div>
            
            <button onclick="clearCoinHistory()" class="w-full bg-red-500/30 text-white px-4 py-2 rounded-lg hover:bg-red-500/50 mb-2">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            <button onclick="toggleCoinHistoryModal()" class="w-full bg-white/30 text-white px-4 py-2 rounded-lg hover:bg-white/50">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
</body>
</html>

