<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script>
        // هذا الكود يتحقق إذا كان الزائر قادماً من رابط فيرسل المجاني
        if (window.location.hostname.includes('.vercel.app')) {
            // يقوم فوراً بتحويله إلى رابط موقعك الجديد مع الحفاظ على الصفحة التي كان يزورها
            window.location.replace("https://www.tryabqar.com" + window.location.pathname);
        }
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>منصة عبقر | مسابقات تفاعلية وألعاب اجتماعية للمجموعات</title>
    
    <meta name="description" content="منصة عبقر هي وجهتك الأولى للمسابقات التفاعلية والألعاب الجماعية. نقدم أدوات للمقدمين، ألعاب ذكاء، ومسابقات ترفيهية وتعليمية تناسب الجوال والشاشات الكبيرة.">
    <meta name="keywords" content="مسابقات, ألعاب تفاعلية, منصة عبقر, مسابقات ثقافية, ألعاب جماعية, أدوات المقدم, فعاليات, ترفيه, السعودية">
    <meta name="author" content="أحمد بن إبراهيم الذبياني">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.tryabqar.com/">
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "منصة عبقر",
      "url": "https://www.tryabqar.com/",
      "alternateName": ["Abqar", "عبقر"],
      "description": "منصة سعودية للمسابقات التفاعلية والألعاب الجماعية",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://www.tryabqar.com/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "منصة عبقر",
      "applicationCategory": "GameApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "SAR"
      },
      "image": "https://www.tryabqar.com/images/og-card.jpg",
      "author": {
          "@type": "Person",
          "name": "أحمد بن إبراهيم الذبياني"
      }
    }
    </script>
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.tryabqar.com/">
    <meta property="og:title" content="منصة عبقر | اصنع المتعة في فعالياتك">
    <meta property="og:description" content="جرب أحدث الألعاب الجماعية والمسابقات التفاعلية. منصة عبقر تغنيك عن الورقة والقلم!">
    <meta property="og:image" content="https://www.tryabqar.com/images/og-card.jpg">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://www.tryabqar.com/">
    <meta name="twitter:title" content="منصة عبقر | مسابقات وألعاب تفاعلية">
    <meta name="twitter:description" content="منصة سعودية للمسابقات والألعاب الجماعية.">
    <meta name="twitter:image" content="https://www.tryabqar.com/images/og-card.jpg">
    
    <link rel="icon" type="image/jpeg" href="images/favicon.jpg">
    <link rel="apple-touch-icon" href="images/favicon.jpg">
    
    <!-- تحميل مكتبة Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    
    <!-- تحميل مكتبة Tailwind CSS أولاً -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. إضافة إعدادات Tailwind لتفعيل الوضع الليلي عبر "class" -->
    <script>
        tailwind.config = {
            darkMode: 'class', // أو 'media'
            theme: {
                extend: {
                    // (جديد) إضافة الأنيميشن الخاص بالعنوان
                    animation: {
                        'gradient-animation': 'gradient-animation 3s ease infinite',
                    },
                    keyframes: {
                        'gradient-animation': {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        },
                        // (إصلاح) تم نقل تعريفات الحركة إلى <style>
                    }
                }
            }
        }
    </script>
    
    <!-- 3. إضافة سكربت لمنع "وميض" التحويل بين الأوضاع (FOUC) -->
    <script>
        // هذا السكربت يعمل قبل تحميل الصفحة
        // يفحص التفضيل المحفوظ (localStorage).
        // الوضع التلقائي (إذا لم يوجد تفضيل محفوظ) هو النهاري.
        if (localStorage.theme === 'dark') {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>

    <!-- تحميل خط "تجواب" من جوجل -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- (جديد) Google Analytics - تم إعادته -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X3CFQ7QJ6R"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      // (إصلاح) تم حذف القوس الإضافي من هنا
      gtag('config', 'G-X3CFQ7QJ6R');
    </script>
    
    <style>
        /* تطبيق الخط المخصص على كامل الصفحة */
        body {
            font-family: 'Tajawal', sans-serif;
            font-weight: 400; /* وزن خفيف للنصوص */
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* تحسين التباين في العناوين */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 800; /* وزن عريض جداً للعناوين */
            letter-spacing: -0.025em; /* تباعد أحرف أضيق قليلاً للمظهر العصري */
        }

        /* إخفاء شريط التمرير (Scrollbar) */
        ::-webkit-scrollbar {
            display: none;
        }
        html {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
            overscroll-behavior-y: none;
        }
        
        /* 4. إعداد الصفحات للانتقال الناعم (Fade Transition) */
        .page {
            display: none; /* إخفاء كل الصفحات افتراضياً */
            flex-direction: column;
            opacity: 0; /* البدء بشفافية كاملة */
            transition: opacity 0.3s ease-out; /* تحديد مدة وسلاسة الانتقال */
        }

        /* 5. إضافة أنيميشن للتدرج اللوني للعنوان (تم نقله إلى tailwind.config) */
        /* .gradient-animate ... */
        
        /* كلاس لإخفاء العناصر */
        .hidden {
            display: none;
        }
        
        /* (جديد) كلاس لصفحات التطبيق المدمج (iframe) */
        .page-iframe-container {
            padding: 0 !important; 
            overflow: hidden; /* إخفاء أي scrollbars */
        }
        
        /* (جديد) إصلاح نهائي لـ iframe ليملأ الشاشة */
        .page-iframe-container main {
            position: relative;
            flex: 1 1 0%; /* السماح بالتمدد */
        }
        .page-iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* (جديد) إخفاء أيقونات المفضلة (النجمة) افتراضياً */
        .favorite-btn {
            display: none;
        }
        /* (جديد) إظهار النجوم فقط للمستخدمين المسجلين (يتم التحكم به عبر JS) */
        .user-logged-in .favorite-btn {
            display: flex; /* أو 'block' حسب الحاجة */
        }
        
        /* (جديد) تنسيق النجمة الممتلئة */
        .favorite-btn.favorited {
            color: #facc15; /* لون النجمة الممتلئة (أصفر) */
        }


        /* --- (جديد) خلفية متدرجة دوارة --- */
        .animated-gradient-background {
            position: relative;
            z-index: 0; /* (إصلاح) إنشاء سياق تكديس جديد لمنع اختفاء الخلفية في وضع ملئ الشاشة */
            /* (إصلاح) تم حذف height: 100vh و overflow: hidden للسماح بالـ scroll */
        }

        .animated-gradient-background::before,
        .animated-gradient-background::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                #caf3ff,
                #ffe1cc
            );
            z-index: -1;
            pointer-events: none; 
        }

        /* --- الوضع الداكن --- */
        .dark .animated-gradient-background {
            /* (تعديل) خلفية داكنة جداً كأساس */
            background: #020617; /* slate-950 */
        }
        
        .dark .animated-gradient-background::before,
        .dark .animated-gradient-background::after {
             background: linear-gradient(
                to bottom,
                #172554,
                #020617
            );
            opacity: 1;
            filter: none;
        }
        
        /* (جديد) إصلاح لـ z-index للأزرار العائمة لتكون فوق الخلفية */
        #btn-open-sidebar, #theme-toggle {
            position: fixed;
            z-index: 50; /* التأكد من أنها فوق الخلفية */
        }

        /* (إصلاح) تم نقل تعريفات الحركة هنا لتعمل بشكل صحيح */
        @keyframes rotate {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        @keyframes rotate-reverse {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotate(-360deg);
            }
        }
        /* 6. (جديد) أنيميشن الانتقال الناعم بين الوضع الليلي والنهاري */
        /* نطبقه على body وجميع العناصر بداخله */
        body, body * {
            transition-property: background-color, border-color, color, fill, stroke, box-shadow;
            transition-duration: 300ms; /* مدة الانتقال: 0.3 ثانية (سرعة مثالية) */
            transition-timing-function: ease-in-out;
        }

        /* استثناء هام: نستثني القائمة الجانبية والشرائح من هذا الانتقال العام */
        /* لأن لديها أنيميشن خاص للحركة (transform) لا نريد تخريبه */
        #sidebar-menu, .transform, .transition-transform {
            transition-property: transform, background-color, border-color, color;
        }
/* رفع البطاقات والأزرار فوق الخلفية وتطبيق تأثير الزجاج */
    .app-card, 
    #btn-tools, 
    #btn-competitions, 
    #btn-games {
        position: relative; /* ضروري لعمل الـ z-index */
        z-index: 10;        /* رقم أعلى من الخلفية */
        cursor: pointer;
        
        /* تأثير الزجاج (Glassmorphism) - عودة للأبيض للوضوح */
        background: rgba(255, 255, 255, 0.85); /* أبيض شبه شفاف */
        backdrop-filter: blur(12px); /* تمويه الخلفية */
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.6); /* حدود مضيئة */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* ظل ناعم */
        
        /* التفاعل والحركة */
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                    box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    background-color 0.3s ease;
    }

    /* (جديد) تخصيص ألوان البطاقات حسب الطلب (الوضع الفاتح) مع حدود بنفسجية فخمة */
    #btn-competitions {
        background: #F0FDF4 !important; /* نعناعي فاتح */
        border: 1px solid rgba(76, 29, 149, 0.4) !important; /* بنفسجي غامق أرق وأكثر شفافية */
    }
    
    #btn-tools {
        background: #F0F6FF !important; /* أزرق فاتح */
        border: 1px solid rgba(76, 29, 149, 0.4) !important; /* بنفسجي غامق أرق وأكثر شفافية */
    }
    
    #btn-games {
        background: #FFF5F5 !important; /* وردي فاتح */
        border: 1px solid rgba(76, 29, 149, 0.4) !important; /* بنفسجي غامق أرق وأكثر شفافية */
    }

    /* تأثير الوضع الليلي للبطاقات */
    .dark .app-card, 
    .dark #btn-tools, 
    .dark #btn-competitions, 
    .dark #btn-games {
        background: rgba(30, 41, 59, 0.85) !important; /* slate-800 with high opacity - إعادة توحيد اللون في الوضع الداكن */
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }

    /* تأثير التحويم (Hover) - تكبير وإضاءة */
    .app-card:hover, 
    #btn-tools:hover, 
    #btn-competitions:hover, 
    #btn-games:hover {
        transform: translateY(-5px) scale(1.02); /* رفع وتكبير طفيف */
        border-color: rgba(76, 29, 149, 0.8) !important; /* تزداد سماكة/وضوح اللون عند التحويم فقط */
        box-shadow: 0 20px 25px -5px rgba(76, 29, 149, 0.2), 0 10px 10px -5px rgba(76, 29, 149, 0.1); /* ظل بنفسجي خفيف */
    }
    
    .dark .app-card:hover, 
    .dark #btn-tools:hover, 
    .dark #btn-competitions:hover, 
    .dark #btn-games:hover {
        background: rgba(39, 39, 42, 0.8);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
    }

    /* (جديد) زر تسجيل الدخول النابض لجذب الانتباه */
    @keyframes pulse-blue {
        0% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(37, 99, 235, 0); }
        100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
    }
    
    #btn-sidebar-login {
        animation: pulse-blue 2s infinite;
    }

    /* (جديد) إخفاء زر الخروج من التطبيقات وإظهاره عند التحويم */
    .btn-close-iframe {
        opacity: 1; /* ظاهر افتراضياً عند التحميل */
        transition: opacity 0.5s ease-in-out, background-color 0.2s, transform 0.1s;
    }

    /* كلاس للإخفاء التلقائي */
    .btn-close-iframe.fade-out {
        opacity: 0;
    }

    /* يظهر دائماً عند التحويم */
    .btn-close-iframe:hover {
        opacity: 1 !important;
    }

    /* (جديد) نفس سلوك الإخفاء لزر ملئ الشاشة عند تفعيله في التطبيقات */
    #fullscreen-toggle.fade-out-enabled {
        transition: opacity 0.5s ease-in-out, transform 0.1s;
        opacity: 1;
    }
    #fullscreen-toggle.fade-out-enabled.fade-out {
        opacity: 0;
    }
    #fullscreen-toggle.fade-out-enabled:hover {
        opacity: 1 !important;
    }
    /* زيادة مساحة النقر */
    #fullscreen-toggle.fade-out-enabled::after {
        content: '';
        position: absolute;
        top: -40px; left: -40px; right: -40px; bottom: -40px;
        z-index: -1;
    }

    /* زيادة مساحة النقر/التحويم لزر الخروج ليسهل الوصول إليه */
    .btn-close-iframe::after {
        content: '';
        position: absolute;
        top: -10px;   /* تم تقليل المساحة لتصبح معقولة */
        left: -10px;  /* تم تقليل المساحة */
        right: -10px; /* تم تقليل المساحة */
        bottom: -10px;/* تم تقليل المساحة */
        z-index: -1;
    }

    /* (Mobile UX) منع الانتقال والوميض على الجوال */
    @media (max-width: 768px) {
        .page {
            transition: none !important;
        }
    }

    </style>
</head>
<!-- (جديد) إضافة كلاس الخلفية المتحركة -->
<!-- (إصلاح) تم حذف ألوان الخلفية الثابتة (bg-zinc-*) لمنع التعارض -->
<body class="text-zinc-800 dark:text-zinc-200 min-h-screen 
             animated-gradient-background">

    <!-- شاشة التحميل (Loading Screen) لمنع الوميض -->
    <div id="app-loading-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 99999; background-color: #f4f4f5; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.8s ease-out;">
        <div style="font-size: 4rem; animation: spin-pulse 3s infinite ease-in-out;">🎲</div>
        <p style="margin-top: 1rem; font-family: 'Tajawal', sans-serif; font-size: 1.2rem; color: #52525b;">جاري التحميل...</p>
        <style>
            @keyframes spin-pulse { 
                0% { transform: rotate(0deg) scale(1); } 
                50% { transform: rotate(180deg) scale(1.2); } 
                100% { transform: rotate(360deg) scale(1); } 
            }
        </style>
        <script>
            // ضبط لون الخلفية فوراً حسب الوضع الليلي
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                const loader = document.getElementById('app-loading-screen');
                loader.style.backgroundColor = '#27272a'; // zinc-800
                loader.querySelector('p').style.color = '#e4e4e7'; // zinc-200
            }
        </script>
    </div>
    <script>
        // إخفاء الشاشة بعد اكتمال التحميل
        window.addEventListener('load', () => {
            const loader = document.getElementById('app-loading-screen');
            if (loader) {
                setTimeout(() => {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.remove(), 800);
                }, 500); // تأخير نصف ثانية لضمان استقرار التنسيقات
            }
        });
    </script>


    <!-- ======================= -->
    <!--  (جديد) زر القائمة الجانبية (الحساب)     -->
    <!-- (تعديل) إضافة "hidden" ليتم إخفاؤه افتراضياً قبل تسجيل الدخول -->
    <!-- ======================= -->
    <button id="btn-open-sidebar" class="fixed top-6 right-6 z-50 p-2 rounded-full bg-white/50 dark:bg-zinc-800/50 text-zinc-800 dark:text-zinc-200 shadow hover:bg-white/70 dark:hover:bg-zinc-800/70 transition-all active:scale-95 hidden">
        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
        </svg>
    </button>
    
    <!-- ======================= -->
    <!-- (جديد) غطاء الخلفية للقائمة الجانبية -->
    <!-- ======================= -->
    <div id="sidebar-overlay" class="fixed inset-0 z-[100] bg-black/50 opacity-0 transition-opacity duration-300 hidden"></div>

    <!-- ======================= -->
    <!-- (جديد) القائمة الجانبية للحساب -->
    <!-- ======================= -->
    <div id="sidebar-menu" class="fixed top-0 right-0 h-full w-80 max-w-full bg-white dark:bg-zinc-800 shadow-lg z-[101] 
                                transform translate-x-full transition-transform duration-300">
        
        <!-- رأس القائمة -->
        <div class="flex justify-between items-center p-4 border-b dark:border-zinc-700">
            <h2 class="text-xl font-bold">الحساب والإعدادات</h2>
            <button id="btn-close-sidebar" class="p-1 rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-700 transition-colors">
                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- محتوى القائمة (ديناميكي) -->
        <div class="p-4">
            
            <!-- 1. حالة تسجيل الخروج (أو الضيف) -->
            <div id="sidebar-logged-out" class="hidden">
                <p class="text-zinc-600 dark:text-zinc-400 mb-4">أهلاً بك في منصة عبقر. سجّل دخولك للوصول إلى ميزاتك.</p>
                <div class="flex flex-col gap-3">
                    <button id="btn-sidebar-login" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition active:scale-95 text-sm font-medium">تسجيل الدخول</button>
                    <button id="btn-sidebar-signup" class="w-full px-4 py-3 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition active:scale-95 text-sm font-medium">إنشاء حساب</button>
                </div>
            </div>

            <!-- 2. حالة تسجيل الدخول -->
            <div id="sidebar-logged-in" class="hidden">
                <!-- معلومات المستخدم -->
                <div class="mb-6 p-3 bg-zinc-100 dark:bg-zinc-700 rounded-lg">
                    <p class="text-sm text-zinc-500 dark:text-zinc-400">مرحباً بعودتك،</p>
                    <p id="sidebar-username" class="text-lg font-bold text-blue-600 dark:text-blue-400 truncate">...</p>
                </div>
                
                <!-- أزرار الإعدادات -->
                <nav class="flex flex-col gap-2">
                    <button id="btn-sidebar-settings" class="w-full flex items-center gap-3 px-4 py-3 bg-zinc-100 dark:bg-zinc-700 text-zinc-800 dark:text-zinc-200 rounded-lg hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065zM15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span>الإعدادات</span>
                    </button>
                    
                    <!-- (جديد) زر المفضلة -->
                    <button id="btn-sidebar-favorites" class="w-full flex items-center gap-3 px-4 py-3 bg-zinc-100 dark:bg-zinc-700 text-zinc-800 dark:text-zinc-200 rounded-lg hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.31h5.518a.562.562 0 01.31.988l-4.204 3.602a.563.563 0 00-.182.557l1.528 5.39a.562.562 0 01-.84.61l-4.725-3.32a.563.563 0 00-.652 0l-4.725 3.32a.562.562 0 01-.84-.61l1.528-5.39a.563.563 0 00-.182-.557l-4.204-3.602a.562.562 0 01.31-.988H8.88a.563.563 0 00.475-.31l2.125-5.111z" />
                        </svg>
                        <span>المفضلة</span>
                    </button>
                    
                    <!-- === ( هذا هو الزر الجديد الذي طلبته ) === -->
                    <button id="btn-sidebar-updates" class="w-full flex items-center gap-3 px-4 py-3 bg-zinc-100 dark:bg-zinc-700 text-zinc-800 dark:text-zinc-200 rounded-lg hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM18 12l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 18l-1.035.259a3.375 3.375 0 00-2.456 2.456L18 21.75l-.259-1.035a3.375 3.375 0 00-2.456-2.456L14.25 18l1.035-.259a3.375 3.375 0 002.456-2.456L18 12z" />
                        </svg>
                        <span>مزايا وتحديثات</span>
                    </button>
                    <!-- === ( نهاية الزر الجديد ) === -->

                    <!-- (جديد) زر التواصل -->
                    <a href="mailto:contact@tryabqar.com" class="w-full flex items-center gap-3 px-4 py-3 bg-zinc-100 dark:bg-zinc-700 text-zinc-800 dark:text-zinc-200 rounded-lg hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                        </svg>
                        <span>للتواصل والاقتراحات</span>
                    </a>

                    <hr class="dark:border-zinc-600 my-2">
                    
                    <button id="btn-sidebar-logout" class="w-full flex items-center gap-3 px-4 py-3 bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/80 transition-colors">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" />
                        </svg>
                        <span>تسجيل الخروج</span>
                    </button>
                </nav>
            </div>
        </div>
    </div>


    <!-- إضافة زر تبديل الوضع الليلي (عائم) - تم التغيير إلى zinc -->
    <!-- (تعديل) إضافة "hidden" ليتم إخفاؤه افتراضياً قبل تسجيل الدخول -->
    <button id="theme-toggle" class="fixed bottom-6 right-6 z-50 p-3 rounded-full bg-zinc-200 dark:bg-zinc-700 text-zinc-800 dark:text-zinc-200 shadow-lg transition-transform duration-100 active:scale-95 hidden">
        <!-- أيقونة القمر (تظهر في الوضع الفاتح) -->
        <svg id="theme-toggle-dark-icon" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0 1 18.25 15.75 9.75 9.75 0 0 1 8.25 6c0-1.33.267-2.595.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-6.248Z" />
        </svg>
        <!-- أيقونة الشمس (تظهر في الوضع الداكن) -->
        <img id="theme-toggle-light-icon" src="images/icon-sun.png" alt="شمس" class="h-6 w-6 object-contain">
    </button>

    <!-- (جديد) شعار بروفايل المصغر (أعلى اليسار) -->
    <div class="fixed top-6 left-6 z-50">
        <img src="images/PROF1.png" alt="شعار بروفايل" class="w-16 h-16 md:w-20 md:h-20 object-contain drop-shadow-lg hover:scale-110 transition-transform duration-300 cursor-pointer">
    </div>

    <!-- (جديد) زر ملئ الشاشة (أسفل اليسار) -->
    <button id="fullscreen-toggle" class="fixed bottom-6 left-6 z-50 p-3 rounded-full bg-zinc-200 dark:bg-zinc-700 text-zinc-800 dark:text-zinc-200 shadow-lg transition-transform duration-100 active:scale-95 hidden">
        <!-- أيقونة التكبير -->
        <svg id="fullscreen-icon-enter" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />
        </svg>
        <!-- أيقونة التصغير -->
        <svg id="fullscreen-icon-exit" class="h-6 w-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25" />
        </svg>
    </button>
    <!-- تم حذف أيقونة العصا السحرية -->


    <!-- ======================= -->
    <!--  شاشة الموافقة (تُستدعى الآن عند الضغط على الرابط)  -->
    <!-- (style="display: none;" لإخفائها افتراضياً) -->
    <!-- (إصلاح) تمت زيادة z-index إلى 120 ليظهر فوق شاشة الضيف -->
    <!-- ======================= -->
    <div id="terms-modal" class="fixed inset-0 z-[120] flex items-center justify-center bg-black bg-opacity-75 
                                opacity-0 transition-opacity duration-300" style="display: none;">
        <!-- تم إضافة كلاسات الوضع الليلي - تم التغيير إلى zinc -->
        <div class="bg-white rounded-xl shadow-2xl w-11/12 md:w-2/3 lg:w-1.2 max-w-3xl overflow-hidden 
                    dark:bg-zinc-800">
            <!-- رأس الشاشة -->
            <header class="bg-gradient-to-r from-blue-600 to-green-500 text-white p-6 text-center">
                <h2 class="text-2xl font-bold">سياسة الاستخدام والخصوصية لـ "منصة عبقر"</h2>
            </header>
            
            <!-- (جديد) محتوى السياسة (قابل للتمرير) -->
            <main class="p-6 md:p-8 max-h-[60vh] overflow-y-auto">
                
                <!-- (تحديث) تم استبدال المحتوى بالكامل -->
                <p>
                    مرحبًا بك في <strong>"منصة عبقر"</strong> المملوك لـ <strong>أحمد بن إبراهيم الذبياني</strong>.<br>
                    يُعد دخولك إلى الموقع، أو إنشاء حساب، أو استخدام أي من خدماته موافقة صريحة منك على الالتزام الكامل بجميع الشروط والأحكام الواردة أدناه.<br>
                    خصوصيتك تهمنا، لذا يُرجى قراءة هذه السياسة بعناية لفهم كيفية جمع واستخدام وحماية بياناتك.<br>
                    إذا لم تكن موافقًا على هذه الشروط، يُرجى التوقف فورًا عن استخدام الموقع وجميع خدماته.
                </p>

                                    <h2 class="text-xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-3 mt-6 dark:text-blue-400">1. البيانات التي نجمعها</h2>

                                    <p class="font-bold mb-2"><strong>أ. البيانات التي تقدمها طوعًا (بيانات الحساب):</strong></p>
                                    <ul class="list-disc pr-6 space-y-2 mb-4">
                                        <li>عند إنشاء حساب، نطلب منك: البريد الإلكتروني، اسم المستخدم، وكلمة المرور.</li>
                                        <li>يتم تخزين كلمة المرور بشكل مشفر وآمن، ولا يمكننا الاطلاع عليها ولكن انصحك أنا أحمد بشكل شخصي ان تسخدم كلمة مرور جديدة لا علاقة لها بالتي تستخدمها في ايميلك الشخصي.</li>
                                        <li>يتم استخدام البريد الإلكتروني لغرض المصادقة وتأكيد الهوية فقط (مثل إعادة تعيين كلمة المرور).</li>
                                    </ul>

                                    <p class="font-bold mb-2"><strong>ب. البيانات التي تنشئها أثناء الاستخدام (بيانات التخصيص):</strong></p>
                                    <ul class="list-disc pr-6 space-y-2 mb-4">
                                        <li>تخزين التفضيلات المرتبطة بحسابك، مثل قائمة "المفضلة".</li>
                                        <li>تمكين الوصول إلى اختياراتك المحفوظة من أي جهاز عند تسجيل الدخول.</li>
                                    </ul>

                                    <p class="font-bold mb-2"><strong>ج. بيانات الاستخدام التي نجمعها تلقائيًا (بيانات التحليلات):</strong></p>
                                    <ul class="list-disc pr-6 space-y-2 mb-4">
                                        <li>نستخدم خدمات تحليلية مثل Google Analytics لجمع معلومات مجهولة المصدر حول تفاعلك مع الموقع.</li>
                                        <li>تشمل: الصفحات التي تزورها في موقعنا، والوقت الذي تقضيه، ونوع المتصفح، بهدف تحسين الأداء وتجربة المستخدم.</li>
                                        <li>هذه البيانات لا ترتبط بهويتك الشخصية.</li>
                                    </ul>

                                    <h2 class="text-xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-3 mt-6 dark:text-blue-400">2. كيفية استخدام بياناتك</h2>
                                    <ul class="list-disc pr-6 space-y-2 mb-4">
                                       <li>تشغيل الخدمة: تسجيل الدخول، الحفاظ على الجلسة آمنة، وحفظ الإعدادات.</li>
                                       <li>تحسين الخدمة: تحليل بيانات الاستخدام المجهولة المصدر لتطوير ميزات جديدة وإصلاح الأخطاء.</li>
                                        <li>التواصل معك: إرسال إشعارات ضرورية متعلقة بالحساب (مثل تأكيد الحساب أو تغيير كلمة المرور).</li>
                                   </ul>
                                   <p>نحن لا نبيع أو نؤجر أو نشارك بياناتك الشخصية مع أي جهة خارجية لأغراض تسويقية.</p>

                                    <h2 class="text-xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-3 mt-6 dark:text-blue-400">3. ملفات تعريف الارتباط (Cookies)</h2>
                                    <ul class="list-disc pr-6 space-y-2 mb-4">
                                        <li>ملفات تعريف ارتباط أساسية: ضرورية لعمل الموقع، للحفاظ على حالة تسجيل دخولك عبر خدمة Supabase.</li>
                                        <li>ملفات تعريف ارتباط للتحليلات: تستخدمها خدمة Google Analytics لجمع بيانات الاستخدام المجهولة المصدر.</li>
                                    </ul>

                                    <h2 class="text-xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-3 mt-6 dark:text-blue-400">4. حقوقك وسياسة حذف البيانات</h2>
                                    <ul class="list-disc pr-6 space-y-2 mb-4">
                                        <li>يمكنك تعديل اسم المستخدم في أي وقت من "الإعدادات".</li>
                                        <li>يمكنك حذف حسابك نهائيًا في أي وقت من "الإعدادات".</li>
                                        <li>عند حذف الحساب، سيتم حذف جميع بياناتك الشخصية وبيانات التخصيص بشكل دائم ولا يمكن التراجع عن ذلك.</li>
                                    </ul>

                                    <h2 class="text-xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-3 mt-6 dark:text-blue-400">5. الملكية الفكرية (الاستخدام المحظور)</h2>
                <p>جميع المحتويات، الأكواد المصدرية، التصاميم، الرسومات، الشعارات، والنصوص، وواجهات المستخدم، والأفكار المضمنة في "منصة عبقر" وتطبيقاتها (بما في ذلك على سبيل المثال لا الحصر: "صدفة"، "صناديق الأسئلة"، "حروف رحال"، "ريموت"، "خزنة ربان"، "حرب البحار"، "الترتيب العاشر"، "فكر تربح"، "مين الملقوف"، "مافيا")  هي ملكية فكرية حصرية لـ <strong>أحمد بن إبراهيم الذبياني</strong> ومحميّة بموجب قوانين حقوق النشر والعلامات التجارية.</p>
                <p>يُحظر تمامًا:</p>
                                    <ul class="list-disc pr-6 space-y-2 mb-4">
                                        <li>نسخ أو تعديل أو توزيع أو بيع أو تأجير أو إعادة نشر أي جزء من الأكواد أو المحتوى.</li>
                                        <li>تحليل أو تفكيك أو إجراء هندسة عكسية لأي جزء من برمجيات الموقع.</li>
                                        <li>استغلال الخدمات لأغراض تجارية أو لإنشاء منتج منافس.</li>
                                        <li>إزالة أو إخفاء أي إشعارات متعلقة بحقوق النشر أو العلامات التجارية.</li>
                                    </ul>

                                    <h2 class="text-xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-3 mt-6 dark:text-blue-400">6. ترخيص الاستخدام</h2>
                                   <p>يُمنح المستخدم (المسجل أو الضيف) ترخيصًا محدودًا، شخصيًا، غير حصري، غير قابل للتحويل، وقابلًا للإلغاء لاستخدام الخدمات لأغراض شخصية وغير تجارية فقط، وفقًا لشروط هذه الاتفاقية.</p>

                                    <h2 class="text-xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-3 mt-6 dark:text-blue-400">7. تعديل الشروط</h2>
                                   <p>يحتفظ المالك بالحق في تعديل أو تحديث هذه الشروط في أي وقت. سيتم نشر النسخة المحدثة على الموقع، ويُعتبر استمرارك في استخدام الخدمات بعد التحديث قبولًا صريحًا منك بالشروط المعدلة.</p>

                                    <h2 class="text-xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-3 mt-6 dark:text-blue-400">8. التواصل</h2>
                                    <p>للاستفسارات حول هذه السياسة، يُرجى التواصل عبر البريد الإلكتروني:<br>
                                    <a href="mailto:contact@tryabqar.com" class="text-blue-600 hover:underline dark:text-blue-400">contact@tryabqar.com</a></p>
                
            </main>

            <!-- (تعديل) هذا الزر يغلق النافذة ويؤشر على الموافقة -->
            <footer class="bg-zinc-100 p-6 text-center dark:bg-zinc-700">
                <button id="btn-accept-terms" class="w-full md:w-auto bg-green-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-green-700 transition-all duration-100 shadow-lg active:scale-95">
                    أوافق على الشروط وأرغب في المتابعة
                </button>
            </footer>
        </div>
    </div>
    
    
    <!-- ======================= -->
    <!--  شاشة المصادقة (Auth)  -->
    <!-- (تعديل) ستظهر هذه الشاشة افتراضياً الآن -->
    <!-- ======================= -->
    <div id="auth-modal" class="fixed inset-0 z-[100] flex items-center justify-center" style="display: none;">
        <!-- (إصلاح) تم حذف ألوان الخلفية من هنا لتظهر الخلفية المتحركة -->
        <div class="bg-white rounded-xl shadow-2xl w-11/12 max-w-md overflow-hidden 
                    dark:bg-zinc-800">
            <!-- رأس الشاشة -->
            <header class="bg-zinc-100 p-5 text-center relative dark:bg-zinc-700">
                <h2 id="auth-title" class="text-2xl font-bold text-zinc-800 dark:text-zinc-100">تسجيل الدخول</h2>
                <!-- (تعديل) زر الإغلاق سيتم إخفاؤه/إظهاره عبر JS -->
                <button id="btn-close-auth" class="absolute top-3 left-4 text-zinc-500 hover:text-zinc-800 dark:text-zinc-400 dark:hover:text-zinc-100 transition text-2xl hidden">&times;</button>
            </header>
            
            <!-- نموذج الإدخال -->
            <form id="auth-form" class="p-8">
                <div class="mb-4">
                    <label for="auth-email" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">البريد الإلكتروني</label>
                    <input type="email" id="auth-email" required class="w-full px-3 py-2 border border-zinc-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white">
                </div>
                
                <!-- (جديد) حقل اسم المستخدم (يظهر عند إنشاء حساب) -->
                <div id="auth-username-field" class="mb-4 hidden">
                    <label for="auth-username" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">اسم المستخدم (سيظهر للجميع)</label>
                    <input type="text" id="auth-username" minlength="3" class="w-full px-3 py-2 border border-zinc-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white">
                </div>

                <div class="mb-6">
                    <label for="auth-password" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">كلمة المرور (6 أحرف على الأقل)</label>
                    <input type="password" id="auth-password" required minlength="6" class="w-full px-3 py-2 border border-zinc-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white">
                    <!-- (جديد) زر نسيت كلمة المرور -->
                    <button type="button" id="btn-show-forgot-password" class="text-sm text-blue-600 hover:underline mt-1 dark:text-blue-400">نسيت كلمة المرور؟</button>
                </div>

                <!-- (جديد) حقول إعادة تعيين كلمة المرور (مخفي) -->
                <div id="auth-reset-fields" class="mb-6 hidden">
                    <div class="mb-4">
                        <label for="auth-new-password" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">كلمة المرور الجديدة</label>
                        <input type="password" id="auth-new-password" minlength="6" class="w-full px-3 py-2 border border-zinc-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white">
                    </div>
                    <div>
                        <label for="auth-confirm-password" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">تأكيد كلمة المرور</label>
                        <input type="password" id="auth-confirm-password" minlength="6" class="w-full px-3 py-2 border border-zinc-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white">
                    </div>
                </div>

                <!-- (جديد) حقل الموافقة على الشروط (يظهر عند إنشاء حساب) -->
                <div id="auth-terms-field" class="mb-6 hidden">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="auth-terms-agree" class="h-4 w-4 text-blue-600 rounded border-zinc-300 focus:ring-blue-500 dark:bg-zinc-700 dark:border-zinc-600">
                        <label for="auth-terms-agree" class="text-sm text-zinc-700 dark:text-zinc-300">أوافق على
                            <button type="button" id="btn-show-terms-from-auth" class="text-blue-600 hover:underline dark:text-blue-400">شروط الاستخدام والخصوصية</button>
                        </label>
                    </div>
                </div>
                
                <!-- رسالة الخطأ -->
                <div id="auth-error" class="hidden text-red-600 text-center text-sm mb-4"></div>
                <!-- رسالة النجاح -->
                <div id="auth-success" class="hidden text-green-600 text-center text-sm mb-4"></div>

                <!-- الأزرار -->
                <div class="flex flex-col gap-4">
                    <button type="submit" id="btn-login-submit" class="w-full bg-blue-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-blue-700 transition shadow-lg active:scale-95">
                        تسجيل الدخول
                    </button>
                    <button type="submit" id="btn-signup-submit" class="w-full bg-green-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-green-700 transition shadow-lg active:scale-95">
                        إنشاء حساب جديد
                    </button>
                    <!-- (جديد) أزرار استعادة كلمة المرور -->
                    <button type="button" id="btn-forgot-password-submit" class="w-full bg-yellow-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-yellow-700 transition shadow-lg active:scale-95 hidden">
                        إرسال رابط التحقق
                    </button>
                    <button type="button" id="btn-reset-password-submit" class="w-full bg-blue-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-blue-700 transition shadow-lg active:scale-95 hidden">
                        حفظ كلمة المرور الجديدة
                    </button>
                </div>

                <!-- (جديد) زر التبديل بين تسجيل الدخول وإنشاء الحساب -->
                <div class="mt-6 text-center">
                    <button type="button" id="btn-show-signup-view" class="text-sm text-blue-600 hover:underline dark:text-blue-400">
                        ليس لديك حساب؟ أنشئ واحداً
                    </button>
                    <button type="button" id="btn-show-login-view" class="text-sm text-blue-600 hover:underline dark:text-blue-400 hidden">
                        لديك حساب بالفعل؟ سجّل الدخول
                    </button>
                    <!-- (جديد) زر العودة من شاشة نسيت كلمة المرور -->
                    <button type="button" id="btn-back-to-login-from-forgot" class="text-sm text-zinc-500 hover:underline dark:text-zinc-400 hidden">
                        العودة لتسجيل الدخول
                    </button>
                </div>

                <!-- (جديد) زر المتابعة كضيف -->
                <div class="mt-4 text-center border-t border-zinc-200 dark:border-zinc-700 pt-4">
                    <button type="button" id="btn-show-guest-warning" class="text-sm text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200 hover:underline">
                        المتابعة كضيف
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- ======================= -->
    <!-- (جديد) شاشة التحذير للضيف -->
    <!-- ======================= -->
    <div id="guest-warning-modal" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-75" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl w-11/12 max-w-md overflow-hidden 
                    dark:bg-zinc-800">
            <!-- رأس الشاشة -->
            <header class="bg-zinc-100 p-5 text-center relative dark:bg-zinc-700">
                <h2 class="text-2xl font-bold text-zinc-800 dark:text-zinc-100">تنبيه: وضع الضيف</h2>
            </header>
            
            <!-- المحتوى -->
            <div class="p-8">
                <p class="text-lg text-center text-zinc-700 dark:text-zinc-300 mb-6">
                    بالمتابعة كضيف، ستتمكن من تصفح الألعاب، لكنك
                    <strong class="text-red-600 dark:text-red-400">لن تتمكن</strong>
                    من حفظ نتائجك، أو تخصيص إعداداتك، أو المشاركة في الميزات التفاعلية.
                </p>

                <!-- (جديد) حقل الموافقة على الشروط للضيف -->
                <div id="guest-terms-field" class="mb-6">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="guest-terms-agree" class="h-4 w-4 text-blue-600 rounded border-zinc-300 focus:ring-blue-500 dark:bg-zinc-700 dark:border-zinc-600">
                        <label for="guest-terms-agree" class="text-sm text-zinc-700 dark:text-zinc-300">أوافق على
                            <button type="button" id="btn-show-terms-from-guest" class="text-blue-600 hover:underline dark:text-blue-400">شروط الاستخدام والخصوصية</button>
                        </label>
                    </div>
                </div>

                <!-- (جديد) رسالة الخطأ للضيف -->
                <div id="guest-error" class="hidden text-red-600 text-center text-sm mb-4"></div>

                <div class="flex flex-col gap-4">
                    <button id="btn-guest-continue" class="w-full bg-blue-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-blue-700 transition shadow-lg active:scale-95">
                        المتابعة كضيف
                    </button>
                    <button id="btn-guest-go-back-to-login" class="w-full bg-zinc-200 text-zinc-700 font-bold py-3 px-10 rounded-lg hover:bg-zinc-300 dark:bg-zinc-700 dark:text-zinc-200 dark:hover:bg-zinc-600 transition active:scale-95">
                        العودة لتسجيل الدخول
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- ======================= -->
    <!-- (جديد) شاشة الإعدادات -->
    <!-- ======================= -->
    <div id="settings-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-75" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl w-11/12 max-w-lg overflow-hidden 
                    dark:bg-zinc-800">
            <!-- رأس الشاشة -->
            <header class="bg-zinc-100 p-5 text-center relative dark:bg-zinc-700">
                <h2 id="settings-title" class="text-2xl font-bold text-zinc-800 dark:text-zinc-100">الإعدادات</h2>
                <button id="btn-close-settings" class="absolute top-3 left-4 text-zinc-500 hover:text-zinc-800 dark:text-zinc-400 dark:hover:text-zinc-100 transition text-2xl">&times;</button>
            </header>
            
            <!-- (جديد) نظام التبويبات -->
            <div class="border-b border-zinc-200 dark:border-zinc-700">
                <nav class="flex justify-center -mb-px">
                    <button id="btn-settings-tab-account" class="px-6 py-3 border-b-2 border-blue-500 text-blue-600 dark:text-blue-400 font-medium">الحساب</button>
                    <button id="btn-settings-tab-general" class="px-6 py-3 border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200">عام</button>
                </nav>
            </div>
            
            <!-- نموذج الإعدادات -->
            <form id="settings-form" class="p-8">
                <!-- ================== -->
                <!-- (جديد) تبويب الحساب -->
                <!-- ================== -->
                <div id="settings-tab-account">
                    <!-- قسم: تعديل اسم المستخدم -->
                    <div class="mb-6">
                        <label for="settings-username" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">تعديل اسم المستخدم</label>
                        <div class="flex gap-2">
                            <input type="text" id="settings-username" minlength="3" class="w-full px-3 py-2 border border-zinc-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white">
                            <button type="submit" id="btn-update-username" class="px-5 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition active:scale-95 text-sm font-medium">حفظ</button>
                        </div>
                    </div>

                    <!-- قسم: تغيير كلمة المرور -->
                    <div class="mb-6 border border-zinc-200 rounded-lg p-4 dark:border-zinc-700">
                        <h3 class="font-bold text-zinc-800 dark:text-zinc-200 mb-2">تغيير كلمة المرور</h3>
                        <p class="text-sm text-zinc-600 dark:text-zinc-400 mb-4">
                            لضمان أمان حسابك، يتم تغيير كلمة المرور عن طريق إرسال رابط تحقق إلى بريدك الإلكتروني.
                        </p>
                        <button type="button" id="btn-settings-reset-password" class="w-full px-5 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition active:scale-95 text-sm font-medium">
                            إرسال رابط تغيير كلمة المرور
                        </button>
                    </div>
                    
                    <!-- (جديد) قسم: حذف الحساب -->
                    <div class="mt-8 border-t border-zinc-200 dark:border-zinc-700 pt-6">
                        <label class="block text-sm font-medium text-red-600 dark:text-red-400 mb-2">منطقة الخطر</label>
                        <button type="button" id="btn-show-delete-account" class="w-full px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 dark:bg-red-900/50 dark:text-red-400 dark:hover:bg-red-900/80 transition text-sm font-medium">
                            حذف الحساب نهائياً...
                        </button>
                    </div>
                </div>
                
                <!-- ================== -->
                <!-- (جديد) تبويب عام -->
                <!-- ================== -->
                <div id="settings-tab-general" class="hidden">
                    <p class="text-zinc-600 dark:text-zinc-400 text-center">
                        سيتم إضافة إعدادات عامة وتفضيلات العرض هنا قريباً.
                    </p>
                </div>
                
                <!-- رسالة الخطأ -->
                <div id="settings-error" class="hidden text-red-600 text-center text-sm mt-4"></div>
                <!-- رسالة النجاح -->
                <div id="settings-success" class="hidden text-green-600 text-center text-sm mt-4"></div>
            </form>
        </div>
    </div>
    
    <!-- ======================= -->
    <!-- (جديد) شاشة تأكيد حذف الحساب -->
    <!-- ======================= -->
    <div id="delete-account-modal" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-75" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl w-11/12 max-w-md overflow-hidden 
                    dark:bg-zinc-800">
            <!-- رأس الشاشة -->
            <header class="bg-red-100 p-5 text-center relative dark:bg-red-900/50">
                <h2 class="text-2xl font-bold text-red-700 dark:text-red-300">تأكيد حذف الحساب</h2>
            </header>
            
            <!-- المحتوى -->
            <div class="p-8">
                <p class="text-lg text-center text-zinc-700 dark:text-zinc-300 mb-6">
                    هل أنت متأكد؟ هذا الإجراء
                    <strong class="text-red-600 dark:text-red-400">نهائي ولا يمكن التراجع عنه.</strong>
                    سيتم حذف جميع بياناتك، بما في ذلك قائمة المفضلة.
                </p>
                
                <div class="mb-4">
                    <label for="delete-confirm-username" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">
                        لتأكيد الحذف، يرجى كتابة اسم المستخدم الخاص بك:
                        <strong id="delete-confirm-username-label" class="text-blue-600 dark:text-blue-400">...</strong>
                    </label>
                    <input type="text" id="delete-confirm-username" class="w-full px-3 py-2 border border-zinc-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white">
                </div>

                <!-- (جديد) رسالة الخطأ للحذف -->
                <div id="delete-error" class="hidden text-red-600 text-center text-sm mb-4"></div>

                <div class="flex flex-col gap-4">
                    <button id="btn-delete-account-confirm" class="w-full bg-red-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-red-700 transition shadow-lg active:scale-95 disabled:opacity-50" disabled>
                        أنا أفهم العواقب، احذف حسابي
                    </button>
                    <button id="btn-delete-account-cancel" class="w-full bg-zinc-200 text-zinc-700 font-bold py-3 px-10 rounded-lg hover:bg-zinc-300 dark:bg-zinc-700 dark:text-zinc-200 dark:hover:bg-zinc-600 transition active:scale-95">
                        إلغاء
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ======================= -->
    <!-- (جديد) شاشة المفضلة -->
    <!-- ======================= -->
    <div id="favorites-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-75" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl w-11/12 max-w-lg overflow-hidden 
                    dark:bg-zinc-800">
            <!-- رأس الشاشة -->
            <header class="bg-zinc-100 p-5 text-center relative dark:bg-zinc-700">
                <h2 id="favorites-title" class="text-2xl font-bold text-zinc-800 dark:text-zinc-100">المفضلة</h2>
                <button id="btn-close-favorites" class="absolute top-3 left-4 text-zinc-500 hover:text-zinc-800 dark:text-zinc-400 dark:hover:text-zinc-100 transition text-2xl">&times;</button>
            </header>
            
            <!-- محتوى المفضلة -->
            <div id="favorites-container" class="p-8 max-h-[60vh] overflow-y-auto">
                <!-- سيتم ملء هذا القسم ديناميكياً -->
                <p class="text-zinc-500 dark:text-zinc-400 text-center">جاري تحميل المفضلة...</p>
            </div>
        </div>
    </div>

    <!-- ================================== -->
    <!-- (جديد) شاشة مزايا وتحديثات -->
    <!-- ================================== -->
    <div id="updates-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-75" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl w-11/12 max-w-2xl overflow-hidden 
                    dark:bg-zinc-800">
            <!-- رأس الشاشة -->
            <header class="bg-zinc-100 p-5 text-center relative dark:bg-zinc-700">
                <h2 id="updates-title" class="text-2xl font-bold text-zinc-800 dark:text-zinc-100">مزايا وتحديثات</h2>
                <button id="btn-close-updates" class="absolute top-3 left-4 text-zinc-500 hover:text-zinc-800 dark:text-zinc-400 dark:hover:text-zinc-100 transition text-2xl">&times;</button>
            </header>
            
            <!-- محتوى التحديثات (جدول) -->
            <div class="p-6 max-h-[60vh] overflow-y-auto">
                <div class="overflow-x-auto rounded-lg border border-zinc-200 dark:border-zinc-700">
                    <table class="min-w-full divide-y divide-zinc-200 dark:divide-zinc-700">
                        <thead class="bg-zinc-50 dark:bg-zinc-700">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-zinc-500 uppercase tracking-wider dark:text-zinc-300">
                                    الرقم
                                </th>
                                <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-zinc-500 uppercase tracking-wider dark:text-zinc-300">
                                    التاريخ
                                </th>
                                <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-zinc-500 uppercase tracking-wider dark:text-zinc-300">
                                    الوصف
                                </th>
                            </tr>
                        </thead>
                        <tbody id="updates-table-body" class="bg-white divide-y divide-zinc-200 dark:bg-zinc-800 dark:divide-zinc-700">
                            <!-- التحديث الأول (الذي طلبته) -->
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-zinc-900 dark:text-zinc-100">
                                    1.0
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-zinc-500 dark:text-zinc-400">
                                    11-11-2025
                                </td>
                                <td class="px-4 py-4 text-sm text-zinc-700 dark:text-zinc-300 whitespace-normal">
                                    تم إطلاق الموقع وإضافة قائمة "مزايا وتحديثات" لعرض آخر التغييرات.
                                </td>
                            </tr>
                            
                            <!-- يمكنك إضافة المزيد من التحديثات هنا مستقبلاً -->
                             
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-zinc-900 dark:text-zinc-100">
                                    1.1
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-zinc-500 dark:text-zinc-400">
                                    11-11-2025
                                </td>
                                <td class="px-4 py-4 text-sm text-zinc-700 dark:text-zinc-300 whitespace-normal">
                                    تم اضافة لعبة تنافسية جديدة "من سيربح المليون" إلى منصة التنافس.
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-zinc-900 dark:text-zinc-100">
                                    1.2
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-zinc-500 dark:text-zinc-400">
                                    11-14-2025
                                </td>
                                <td class="px-4 py-4 text-sm text-zinc-700 dark:text-zinc-300 whitespace-normal">
                                    تم اضافة لعبة إربع تربح في قسم الألعاب الإجتماعية، تم إضافة قسم الإعلانات.
                                </td>
                            </tr>

                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-zinc-900 dark:text-zinc-100">
                                    1.3
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-zinc-500 dark:text-zinc-400">
                                    11-20-2025
                                </td>
                                <td class="px-4 py-4 text-sm text-zinc-700 dark:text-zinc-300 whitespace-normal">
                                    إصلاح لعبة "فكر تربح"، وتحسين وتعديل أسئلة لعبة "من سيربح المليون"، وزيادة سرعة استجابة الموقع.
                                </td>
                            </tr>

                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-zinc-900 dark:text-zinc-100">
                                    1.4
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-zinc-500 dark:text-zinc-400">
                                    11-30-2025
                                </td>
                                <td class="px-4 py-4 text-sm text-zinc-700 dark:text-zinc-300 whitespace-normal">
                                    إطلاق النسخة الثانية من منصة "عبقر" (شاملة الإصلاحات)، وتحسين قوائم الموقع الداخلية لتتناسب مع التطبيقات.
                                </td>
                            </tr>

                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-zinc-900 dark:text-zinc-100">
                                    1.5
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-zinc-500 dark:text-zinc-400">
                                    12-10-2025
                                </td>
                                <td class="px-4 py-4 text-sm text-zinc-700 dark:text-zinc-300 whitespace-normal">
                                    إطلاق النسخة الثانية من لعبة "حرب البحار" مع تحسين شامل للبرمجة والتصاميم، وإضافة زر "ملئ الشاشة" لتحسين تجربة اللعب.
                                </td>
                            </tr>

                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-zinc-900 dark:text-zinc-100">
                                    2.0
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-zinc-500 dark:text-zinc-400">
                                    12-25-2025
                                </td>
                                <td class="px-4 py-4 text-sm text-zinc-700 dark:text-zinc-300 whitespace-normal">
                                    الإطلاق الثاني للعبة "مافيا" بتحسينات شاملة، وإطلاق هوية الموقع الجديدة (نظام الحسابات، الوضع الليلي، والمفضلة).
                                </td>
                            </tr>
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- ======================= -->
    <!--     الصفحة الرئيسية       -->
    <!-- (style="display: none;" سيتم تعديله بواسطة JS) -->
    <!-- ======================= -->
    <div id="page-welcome" class="page container mx-auto p-4 md:p-6 min-h-screen flex-grow flex flex-col">

        <!-- القسم العلوي المرن (للتوسيط) -->
        <div class="flex-grow flex flex-col justify-center items-center py-2">
            
            <!-- (جديد) بوكس العنوان المصمم -->
            <div class="w-full max-w-5xl mb-6 mx-auto px-2">
                <!-- Light Mode Logo -->
                <img src="images/PROF5.png" alt="عنوان منصة عبقر" class="w-full h-auto object-contain hover:scale-105 transition-transform duration-500 drop-shadow-lg dark:hidden">
                <!-- Dark Mode Logo -->
                <img src="images/PROF5D.png" alt="عنوان منصة عبقر" class="w-full h-auto object-contain hover:scale-105 transition-transform duration-500 drop-shadow-lg hidden dark:block">
            </div>

            <!-- اختيارات الأقسام (تصميم الشبكة الذكية - Bento Grid) -->
            <main class="grid grid-cols-1 md:grid-cols-3 md:grid-rows-2 gap-4 w-full max-w-5xl mx-auto px-2">
                
                <!-- 1. منصة التنافس (العنصر الرئيسي - كبير) -->
                <div id="btn-competitions" class="app-card md:col-span-2 md:row-span-2 rounded-2xl overflow-hidden flex flex-col items-center justify-center p-6 text-center group">
                    <div class="absolute inset-0 bg-gradient-to-br from-green-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <img src="images/icon-competition.webp" alt="منصة التنافس" class="w-16 h-16 md:w-24 md:h-24 mx-auto mb-4 object-contain transform group-hover:scale-110 transition-transform duration-500">
                    <h2 class="text-2xl md:text-3xl font-black text-green-600 mb-2 dark:text-green-400">منصة التنافس</h2>
                    <p class="text-base text-zinc-600 dark:text-zinc-300 max-w-md mx-auto leading-relaxed">
                        قوالب جاهزة ومسابقات تفاعلية جماعية. اصنع التحدي وأشعل روح المنافسة.
                    </p>
                    <div class="mt-4 px-6 py-2 rounded-full bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-300 text-sm font-bold opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition-all duration-300">
                        ابدأ المنافسة 🏆
                    </div>
                </div>

                <!-- 2. أدوات المقدم (مربع جانبي) -->
                <div id="btn-tools" class="app-card md:col-span-1 md:row-span-1 rounded-2xl overflow-hidden flex flex-col items-center justify-center p-4 text-center group">
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <img src="images/icon-presenter.webp" alt="أدوات المقدم" class="w-12 h-12 mx-auto mb-2 object-contain transform group-hover:rotate-12 transition-transform duration-300">
                    <h2 class="text-lg font-bold text-blue-600 mb-1 dark:text-blue-400">أدوات المقدم</h2>
                    <p class="text-xs text-zinc-600 dark:text-zinc-400">أدوات احترافية لإدارة المسابقات والفعاليات.</p>
                </div>

                <!-- 3. ألعاب اجتماعية (مربع جانبي) -->
                <div id="btn-games" class="app-card md:col-span-1 md:row-span-1 rounded-2xl overflow-hidden flex flex-col items-center justify-center p-4 text-center group">
                    <div class="absolute inset-0 bg-gradient-to-br from-red-700/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <img src="images/icon-social.webp" alt="ألعاب اجتماعية" class="w-12 h-12 mx-auto mb-2 object-contain transform group-hover:-rotate-12 transition-transform duration-300">
                    <h2 class="text-lg font-bold text-red-700 mb-1 dark:text-red-400">ألعاب اجتماعية</h2>
                    <p class="text-xs text-zinc-600 dark:text-zinc-400">مجموعة مميزة من الألعاب التفاعلية.</p>
                </div>

            </main>
        </div>

        <!-- تذييل الصفحة - تم التغيير إلى zinc -->
        <footer class="text-center text-zinc-600 mt-4 pt-2 border-t border-zinc-200 
                       dark:text-zinc-400 dark:border-zinc-700">
            <p class="text-sm">
                جميع الحقوق محفوظة &copy; 2026 منصة عبقر الرقمية
                <span class="mx-2">|</span>
                <!-- هذا الزر سيفتح صفحة السياسة المدمجة -->
                <a href="#" class="btn-policy hover:text-blue-500 transition-all duration-100 active:scale-95 dark:hover:text-blue-400">سياسة الاستخدام والخصوصية</a>
            </p>
        </footer>

    </div>

    <!-- ======================= -->
    <!--     صفحة أدوات المقدم    -->
    <!-- (style="display: none;" سيتم تعديله بواسطة JS) -->
    <!-- ======================= -->
    <div id="page-tools" class="page container mx-auto p-6 md:p-12 min-h-screen">
        <!-- رأس الصفحة - تم تخفيف اللون -->
        <header class="flex justify-between items-center mb-12">
            <h2 class="text-3xl font-bold border-r-4 border-blue-500 pr-4">أدوات المقدم</h2>
            <button class="btn-back ml-24 bg-blue-100 text-blue-600 font-bold py-2 px-6 rounded-lg hover:bg-blue-200 transition-all duration-100 active:scale-95 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800">
                العودة للرئيسية
            </button>
        </header>

        <!-- شبكة عرض البطاقات - تم التغيير إلى zinc - تم تخفيف اللون -->
        <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 flex-grow">
            <!-- (جديد) بطاقة 1: صدفة (أصبحت زراً داخلياً) -->
            <div data-appid="tool-sodfa" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/app-sodfa.webp" alt="صورة غلاف تطبيق صدفة" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=صدفة';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-blue-600 dark:text-blue-400">1. صدفة</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">موقع يجمع 6 أنواع مختلفة من القرع تساعد الميسر في شتى المجالات.</p>
                    
                </div>
            </div>
            <!-- (جديد) بطاقة 2: صناديق الأسئلة (أصبحت زراً داخلياً) -->
            <div data-appid="tool-questions" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/app-questions.webp" alt="صورة تطبيق صناديق الأسئلة" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=صناديق+الأسئلة';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-blue-600 dark:text-blue-400">2. صناديق الأسئلة</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">بنك ضخم تفاعلي فيه 500 سؤال مع خيارات وتأثيرات مختلفة ونظام منافسة.</p>
                    
                </div>
            </div>
            <!-- (جديد) بطاقة 3: حروف رحال (أصبحت زراً داخلياً) -->
            <div data-appid="tool-letters" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/app-letters.webp" alt="صورة تطبيق حروف رحال" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=حروف+رحال';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-blue-600 dark:text-blue-400">3. حروف رحال</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">بنك أسئلة ضخم بأكثر من 800 سؤال مقسمة على الحروف مع نظام منافسة.</p>
                    
                </div>
            </div>
            <!-- بطاقة 4: ريموت (أصبحت زراً داخلياً) -->
            <div data-appid="tool-remote" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/app-remote.webp" alt="صورة تطبيق ريموت" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=ريموت';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-blue-600 dark:text-blue-400">4. ريموت</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">موقع جاهز لإظهار شاشة صحيحة (خضراء) أو خاطئة (حمراء) بشكل تفاعلي.</p>
                    
                </div>
            </div>
            
            <!-- === (جديد) بطاقة "قريباً" لقسم الأدوات === -->
            <div class="app-card block bg-white rounded-lg shadow-lg overflow-hidden dark:bg-zinc-800 opacity-60 cursor-not-allowed">
                <div class="relative">
                    <!-- استخدام صورة Placeholder رمادية -->
                    <img src="https://placehold.co/600x400/e5e7eb/a1a1aa?text=+" alt="تطبيق قادم" class="w-full h-auto">
                </div>
                <div class="p-6 app-card-body">
                    <!-- استخدام لون أزرق باهت ليناسب القسم -->
                    <h3 class="text-2xl font-bold mb-2 text-blue-400 dark:text-blue-700">قريباً...</h3>
                    <p class="text-zinc-500 mb-4 dark:text-zinc-400">سيتم إضافة أداة جديدة هنا مستقبلاً.</p>
                    
                </div>
            </div>
            <!-- === (نهاية البطاقة) === -->
            
        </main>
        <!-- تذييل الصفحة - تم التغيير إلى zinc -->
        <footer class="text-center text-zinc-600 mt-16 pt-6 border-t border-zinc-200 
                       dark:text-zinc-400 dark:border-zinc-700">
            <p class="text-sm">
                جميع الحقوق محفوظة &copy; 2025 احمد ابراهيم الذبياني
                <span class="mx-2">|</span>
                <a href="#" class="btn-policy hover:text-blue-500 transition-all duration-100 active:scale-95 dark:hover:text-blue-400">سياسة الاستخدام والخصوصية</a>
            </p>
        </footer>
    </div>

    <!-- ======================= -->
    <!--    صفحة منصة التنافس     -->
    <!-- (style="display: none;" سيتم تعديله بواسطة JS) -->
    <!-- ======================= -->
    <div id="page-competitions" class="page container mx-auto p-6 md:p-12 min-h-screen">
        <!-- رأس الصفحة - تم تخفيف اللون -->
        <header class="flex justify-between items-center mb-12">
            <h2 class="text-3xl font-bold border-r-4 border-green-500 pr-4">منصة التنافس</h2>
            <button class="btn-back ml-24 bg-green-100 text-green-600 font-bold py-2 px-6 rounded-lg hover:bg-green-200 transition-all duration-100 active:scale-95 dark:bg-green-900 dark:text-green-200 dark:hover:bg-green-800">
                العودة للرئيسية
            </button>
        </header>
        
        <!-- شبكة عرض البطاقات - تم التغيير إلى zinc - تم تخفيف اللون -->
        <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 flex-grow">
            <!-- (جديد) بطاقة 1: خزنة ربان (أصبحت زراً داخلياً) -->
            <div data-appid="game-captain" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/game-rubban.webp" alt="صورة مسابقة خزنة ربان" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-green-600 dark:text-green-400">1. مسابقة خزنة ربان</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">قالب مسابقة جاهز مكون من 50 خزنة قابل للهيكلة بشكل كامل.</p>
                    
                </div>
            </div>
            <!-- (جديد) بطاقة 2: حرب البحار (أصبحت زراً داخلياً) -->
            <div data-appid="game-seawar" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/game-seawar.webp" alt="صورة مسابقة حرب البحار" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-green-600 dark:text-green-400">2. حرب البحار</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">لعبة تنافسية بين ثلاثة فرق لإخفاء وكشف السفن مع تخصيص كامل.</p>
                    
                </div>
            </div>
            <!-- (جديد) بطاقة 3: الترتيب العاشر (أصبحت زراً داخلياً) -->
            <div data-appid="game-topten" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/game-topten.webp" alt="صورة مسابقة الترتيب العاشر" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-green-600 dark:text-green-400">3. الترتيب العاشر</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">مسابقة توقع إجابات وكلما كان المركز أبعد كانت النقاط أعلى.</p>
                    
                </div>
            </div>
            <!-- (جديد) بطاقة 4: فكر تربح (أصبحت زراً داخلياً) -->
            <div data-appid="game-thinkwin" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/game-thinkwin.jpg" alt="صورة لعبة فكر تربح" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-green-600 dark:text-green-400">4. فكر تربح</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">لعبة "اربع تربح" ولكن بنسخة خماسية مع أسئلة ثقافية ومنافسة.</p>
                    
                </div>
            </div>
            
             <!-- ======================= -->
             <!-- ==== (الإصلاح 1) ==== -->
             <!-- ======================= -->
             <!-- (جديد) بطاقة 5: من سيربح المليون (أصبحت زراً داخلياً) -->
             <!-- تم تغيير data-appid من "mileon-app" إلى "game-mileon" ليتطابق مع الجافاسكربت -->
            <div data-appid="page-game-mileon" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
    <div class="relative">
        <img src="images/game-million.webp" alt="صورة مسابقة من سيربح المليون" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
        <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
        </button>
    </div>
    <div class="p-6 app-card-body">
        <h3 class="text-2xl font-bold mb-2 text-violet-600 dark:text-violet-400">5. من سيربح المليون</h3>
        <p class="text-zinc-600 mb-4 dark:text-zinc-400">بطريقة جديدة ومبتكرة وبنظام الفرق والمجموعات</p>
        
    </div>
</div>
            <!-- بطاقة 6: حروف عبقر -->
            <div data-appid="game-hrof" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/HROF.webp" alt="صورة لعبة حروف عبقر" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-green-600 dark:text-green-400">6. حروف عبقر</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">لعبة حروف تفاعلية لرفع الحماس بين الفرق على طريقة عبقر.</p>
                </div>
            </div>
            
        </main>
        <!-- تذييل الصفحة - تم التغيير إلى zinc -->
        <footer class="text-center text-zinc-600 mt-16 pt-6 border-t border-zinc-200 
                       dark:text-zinc-400 dark:border-zinc-700">
            <p class="text-sm">
                جميع الحقوق محفوظة &copy; 2025 احمد ابراهيم الذبياني
                <span class="mx-2">|</span>
                <a href="#" class="btn-policy hover:text-blue-500 transition-all duration-100 active:scale-95 dark:hover:text-blue-400">سياسة الاستخدام والخصوصية</a>
            </p>
        </footer>
    </div>

    <!-- ======================= -->
    <!--    صفحة ألعاب اجتماعية   -->
    <!-- (style="display: none;" سيتم تعديله بواسطة JS) -->
    <!-- ======================= -->
    <div id="page-games" class="page container mx-auto p-6 md:p-12 min-h-screen">
        <!-- رأس الصفحة - تم تخفيف اللون -->
        <header class="flex justify-between items-center mb-12">
            <h2 class="text-3xl font-bold border-r-4 border-pink-500 pr-4">ألعاب اجتماعية</h2>
            <button class="btn-back ml-24 bg-pink-100 text-pink-600 font-bold py-2 px-6 rounded-lg hover:bg-pink-200 transition-all duration-100 active:scale-95 dark:bg-pink-900 dark:text-pink-200 dark:hover:bg-pink-800">
                العودة للرئيسية
            </button>
        </header>

        <!-- شبكة عرض البطاقات - تم التغيير إلى zinc - تم تخفيف اللون -->
        <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 flex-grow">
            <!-- (جديد) بطاقة 1: مين الملقوف (أصبحت زراً داخلياً) -->
            <div data-appid="game-malkoof" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/game-malkoof.webp" alt="صورة لعبة مين الملقوف" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-pink-600 dark:text-pink-400">1. مين الملقوف</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">لعبة لتحديد كلمة يعلمها الجميع عدى "الملقوف" الذي يحاول توقعها.</p>
                    
                </div>
            </div>
            <!-- (جديد) بطاقة 2: مافيا (أصبحت زراً داخلياً) -->
            <div data-appid="game-mafia" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/game-mafia.webp" alt="صورة لعبة مافيا" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-pink-600 dark:text-pink-400">2. مافيا</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">لعبة مافيا المعروفة بطريقة سهلة وبسيطة وواجهة جميلة لا تحتاج للورق.</p>
                    
                </div>
            </div>
            
            <!-- === (جديد) بطاقة "قريباً" لقسم الألعاب === -->
             <div data-appid="page-4to-won" class="app-card block bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95 dark:bg-zinc-800 cursor-pointer">
                <div class="relative">
                    <img src="images/game-connect4.webp" alt="صورة لعبة اربع تربح" class="w-full h-auto" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                    <!-- (جديد) زر المفضلة -->
                    <button class="favorite-btn absolute top-3 right-3 p-2 rounded-full bg-black/30 text-white/70 hover:text-white active:scale-90 transition-all">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                </div>
                <div class="p-6 app-card-body">
                    <h3 class="text-2xl font-bold mb-2 text-pink-600 dark:text-pink-400">3. اربع تربح</h3>
                    <p class="text-zinc-600 mb-4 dark:text-zinc-400">اربع تربح لعبة تعتمد على الاستراتيجية والحنكة ،العب ضد لاعب او ضد الكمبيوتر.</p>
                    
                </div>
            </div>
            <!-- === (نهاية البطاقة) === -->
            
        </main>
        <!-- تذييل الصفحة - تم التغيير إلى zinc -->
        <footer class="text-center text-zinc-600 mt-16 pt-6 border-t border-zinc-200 
                       dark:text-zinc-400 dark:border-zinc-700">
            <p class="text-sm">
                جميع الحقوق محفوظة &copy; 2025 احمد ابراهيم الذبياني
                <span class="mx-2">|</span>
                <a href="#" class="btn-policy hover:text-blue-500 transition-all duration-100 active:scale-95 dark:hover:text-blue-400">سياسة الاستخدام والخصوصية</a>
            </p>
        </footer>
    </div>
    
    <!-- ============================================== -->
    <!-- (جديد) صفحات التطبيقات المدمجة (IFRAMES) -->
    <!-- *** تعديل: تم حذف الهيدر (Header) من جميع الصفحات التالية *** -->
    <!-- ============================================== -->

    <!-- صفحة أداة ريموت (المدمجة) -->
    <div id="page-tool-remote" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center 
                       fixed top-11 left-11 z-[9999] 
                       w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <main>
            <iframe id="remote-iframe" src="about:blank"></iframe>
        </main>
    </div>
    
    <!-- (جديد) صفحة أداة صدفة -->
    <div id="page-tool-sodfa" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center 
                       fixed top-11 left-11 z-[9999] 
                       w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="sodfa-iframe" src="about:blank"></iframe>
        </main>
    </div>
    
    <!-- (جديد) صفحة أداة صناديق الأسئلة -->
    <div id="page-tool-questions" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="questions-iframe" src="about:blank"></iframe>
        </main>
    </div>
    
    <!-- (جديد) صفحة أداة حروف رحال -->
    <div id="page-tool-letters" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="letters-iframe" src="about:blank"></iframe>
        </main>
    </div>
    
    <!-- (جديد) صفحة لعبة خزنة ربان -->
    <div id="page-game-captain" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="captain-iframe" src="about:blank"></iframe>
        </main>
    </div>

    <!-- (جديد) صفحة لعبة حرب البحار -->
    <div id="page-game-seawar" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="seawar-iframe" src="about:blank"></iframe>
        </main>
    </div>
    
    <!-- (جديد) صفحة لعبة الترتيب العاشر -->
    <div id="page-game-topten" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="topten-iframe" src="about:blank"></iframe>
        </main>
    </div>
    
    <!-- (جديد) صفحة لعبة فكر تربح -->
    <div id="page-game-thinkwin" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="thinkwin-iframe" src="about:blank"></iframe>
        </main>
    </div>
    
     <!-- ======================= -->
     <!-- ==== (الإصلاح 2) ==== -->
     <!-- ======================= -->
     <!-- (جديد) صفحة لعبة من سيربح المليون -->
     <!-- تم تغيير id الـ iframe من "thinkwin-iframe" إلى "mileon-iframe" ليتطابق مع الجافاسكربت -->
    <div id="page-game-mileon" class="page min-h-screen page-iframe-container">
    <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
    </button>
        
    <main>
        <iframe id="mileon-iframe" src="about:blank"></iframe>
    </main>
</div>

    <!-- (جديد) صفحة لعبة مين الملقوف -->
    <div id="page-game-malkoof" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="malkoof-iframe" src="about:blank"></iframe>
        </main>
    </div>
    
    <!-- (جديد) صفحة لعبة مافيا -->
    <div id="page-game-mafia" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="mafia-iframe" src="about:blank"></iframe>
        </main>
    </div>

    <!-- صفحة لعبة حروف عبقر -->
    <div id="page-game-hrof" class="page min-h-screen page-iframe-container">
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        <main>
            <iframe id="hrof-iframe" src="about:blank"></iframe>
        </main>
    </div>

    <!-- (جديد) صفحة لعبة اربع تربح -->
    <div id="page-4to-won" class="page min-h-screen page-iframe-container">
        <!-- (إصلاح) زر الخروج العائم (مخفي على الجوال) -->
        <button class="btn-close-iframe flex items-center justify-center fixed top-11 left-11 z-[9999] w-10 h-10 bg-black/30 text-white rounded-full hover:bg-black/50 transition-all active:scale-90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <main>
            <iframe id="page-4to-won-iframe" src="about:blank"></iframe>
        </main>
    </div>

    <!-- ======================= -->
    <!-- صفحة سياسة الاستخدام (مدمجة) -->
    <!-- (style="display: none;" سيتم تعديله بواسطة JS) -->
    <!-- ======================= -->
    <div id="page-policy" class="page container mx-auto p-6 md:p-12 min-h-screen">
        <!-- رأس الصفحة - تم التغيير إلى zinc -->
        <header class="flex justify-between items-center mb-12">
            <h2 class="text-3xl font-bold border-r-4 border-zinc-500 pr-4">سياسة الاستخدام والخصوصية</h2>
            <button class="btn-back bg-zinc-200 text-zinc-700 font-bold py-2 px-6 rounded-lg hover:bg-zinc-300 transition-all duration-100 active:scale-95 dark:bg-zinc-700 dark:text-zinc-200 dark:hover:bg-zinc-600">
                العودة للرئيسية
            </button>
        </header>

        <!-- (جديد) المحتوى الرئيسي للسياسة - مأخوذ من الشاشة المنبثقة -->
        <main class="flex-grow bg-white rounded-xl shadow-lg p-6 md:p-10 max-w-4xl mx-auto 
                     dark:bg-zinc-800">
            
            <!-- (تحديث) تم استبدال المحتوى بالكامل -->
            <p class="text-lg leading-relaxed mb-6">
                مرحبًا بك في <strong>"منصة عبقر"</strong> المملوك لـ <strong>أحمد بن إبراهيم الذبياني</strong>.<br>
                يُعد دخولك إلى الموقع، أو إنشاء حساب، أو استخدام أي من خدماته موافقة صريحة منك على الالتزام الكامل بجميع الشروط والأحكام الواردة أدناه.<br>
                خصوصيتك تهمنا، لذا يُرجى قراءة هذه السياسة بعناية لفهم كيفية جمع واستخدام وحماية بياناتك.<br>
                إذا لم تكن موافقًا على هذه الشروط، يُرجى التوقف فورًا عن استخدام الموقع وجميع خدماته.
            </p>

            <h2 class="text-2xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-4 mt-8 dark:text-blue-400">1. البيانات التي نجمعها</h2>

            <p class="font-bold text-lg mb-2"><strong>أ. البيانات التي تقدمها طوعًا (بيانات الحساب):</strong></p>
            <ul class="list-disc pr-6 space-y-2 mb-4">
                <li>عند إنشاء حساب، نطلب منك: البريد الإلكتروني، اسم المستخدم، وكلمة المرور.</li>
                <li>يتم تخزين كلمة المرور بشكل مشفر وآمن، ولا يمكننا الاطلاع عليها ولكن انصحك أنا أحمد بشكل شخصي ان تسخدم كلمة مرور جديدة لا علاقة لها بالتي تستخدمها في ايميلك الشخصي.</li>
                <li>يتم استخدام البريد الإلكتروني لغرض المصادقة وتأكيد الهوية فقط (مثل إعادة تعيين كلمة المرور).</li>
            </ul>

            <p class="font-bold text-lg mb-2"><strong>ب. البيانات التي تنشئها أثناء الاستخدام (بيانات التخصيص):</strong></p>
            <ul class="list-disc pr-6 space-y-2 mb-4">
                <li>تخزين التفضيلات المرتبطة بحسابك، مثل قائمة "المفضلة".</li>
                <li>تمكين الوصول إلى اختياراتك المحفوظة من أي جهاز عند تسجيل الدخول.</li>
            </ul>

            <p class="font-bold text-lg mb-2"><strong>ج. بيانات الاستخدام التي نجمعها تلقائيًا (بيانات التحليلات):</strong></p>
            <ul class="list-disc pr-6 space-y-2 mb-4">
                <li>نستخدم خدمات تحليلية مثل Google Analytics لجمع معلومات مجهولة المصدر حول تفاعلك مع الموقع.</li>
                <li>تشمل: الصفحات التي تزورها في موقعنا، والوقت الذي تقضيه، ونوع المتصفح، بهدف تحسين الأداء وتجربة المستخدم.</li>
                <li>هذه البيانات لا ترتبط بهويتك الشخصية.</li>
            </ul>

            <h2 class="text-2xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-4 mt-8 dark:text-blue-400">2. كيفية استخدام بياناتك</h2>
            <ul class="list-disc pr-6 space-y-2 mb-4">
                <li>تشغيل الخدمة: تسجيل الدخول، الحفاظ على الجلسة آمنة، وحفظ الإعدادات.</li>
                <li>تحسين الخدمة: تحليل بيانات الاستخدام المجهولة المصدر لتطوير ميزات جديدة وإصلاح الأخطاء.</li>
                <li>التواصل معك: إرسال إشعارات ضرورية متعلقة بالحساب (مثل تأكيد الحساب أو تغيير كلمة المرور).</li>
            </ul>
            <p>نحن لا نبيع أو نؤجر أو نشارك بياناتك الشخصية مع أي جهة خارجية لأغراض تسويقية.</p>

            <h2 class="text-2xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-4 mt-8 dark:text-blue-400">3. ملفات تعريف الارتباط (Cookies)</h2>
            <ul class="list-disc pr-6 space-y-2 mb-4">
                <li>ملفات تعريف ارتباط أساسية: ضرورية لعمل الموقع، للحفاظ على حالة تسجيل دخولك عبر خدمة Supabase.</li>
                <li>ملفات تعريف ارتباط للتحليلات: تستخدمها خدمة Google Analytics لجمع بيانات الاستخدام المجهولة المصدر.</li>
            </ul>

            <h2 class="text-2xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-4 mt-8 dark:text-blue-400">4. حقوقك وسياسة حذف البيانات</h2>
            <ul class="list-disc pr-6 space-y-2 mb-4">
                <li>يمكنك تعديل اسم المستخدم في أي وقت من "الإعدادات".</li>
                <li>يمكنك حذف حسابك نهائيًا في أي وقت من "الإعدادات".</li>
                <li>عند حذف الحساب، سيتم حذف جميع بياناتك الشخصية وبيانات التخصيص بشكل دائم ولا يمكن التراجع عن ذلك.</li>
            </ul>

            <h2 class="text-2xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-4 mt-8 dark:text-blue-400">5. الملكية الفكرية (الاستخدام المحظور)</h2>
            <p>جميع المحتويات، الأكواد المصدرية، التصاميم، الرسومات، الشعارات، والنصوص، وواجهات المستخدم، والأفكار المضمنة في "منصة عبقر" وتطبيقاتها (بما في ذلك على سبيل المثال لا الحصر: "صدفة"، "صناديق الأسئلة"، "حروف رحال"، "ريموت"، "خزنة ربان"، "حرب البحار"، "الترتيب العاشر"، "فكر تربح"، "مين الملقوف"، "مافيا")  هي ملكية فكرية حصرية لـ <strong>أحمد بن إبراهيم الذبياني</strong> ومحميّة بموجب قوانين حقوق النشر والعلامات التجارية.</p>
            <p>يُحظر تمامًا:</p>
            <ul class="list-disc pr-6 space-y-2 mb-4">
                <li>نسخ أو تعديل أو توزيع أو بيع أو تأجير أو إعادة نشر أي جزء من الأكواد أو المحتوى.</li>
                <li>تحليل أو تفكيك أو إجراء هندسة عكسية لأي جزء من برمجيات الموقع.</li>
                <li>استغلال الخدمات لأغراض تجارية أو لإنشاء منتج منافس.</li>
                <li>إزالة أو إخفاء أي إشعارات متعلقة بحقوق النشر أو العلامات التجارية.</li>
            </ul>

            <h2 class="text-2xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-4 mt-8 dark:text-blue-400">6. ترخيص الاستخدام</h2>
            <p>يُمنح المستخدم (المسجل أو الضيف) ترخيصًا محدودًا، شخصيًا، غير حصري، غير قابل للتحويل، وقابلًا للإلغاء لاستخدام الخدمات لأغراض شخصية وغير تجارية فقط، وفقًا لشروط هذه الاتفاقية.</p>

            <h2 class="text-2xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-4 mt-8 dark:text-blue-400">7. تعديل الشروط</h2>
            <p>يحتفظ المالك بالحق في تعديل أو تحديث هذه الشروط في أي وقت. سيتم نشر النسخة المحدثة على الموقع، ويُعتبر استمرارك في استخدام الخدمات بعد التحديث قبولًا صريحًا منك بالشروط المعدلة.</p>

            <h2 class="text-2xl font-bold text-blue-600 border-r-4 border-blue-500 pr-3 mb-4 mt-8 dark:text-blue-400">8. التواصل</h2>
            <p>للاستفسارات حول هذه السياسة، يُرجى التواصل عبر البريد الإلكتروني:<br>
            <a href="mailto:contact@tryabqar.com" class="text-blue-600 hover:underline dark:text-blue-400">contact@tryabqar.com</a></p>
            
        </main>

        <!-- تذييل الصفحة - تم التغيير إلى zinc -->
        <footer class="text-center text-zinc-600 mt-16 pt-6 border-t border-zinc-200 
                       dark:text-zinc-400 dark:border-zinc-700">
            <p class="text-sm">
                جميع الحقوق محفوظة &copy; 2026 منصة عبقر الرقمية
            </p>
        </footer>
    </div>


    <!-- ======================= -->
    <!-- (جديد) شاشة الإعلانات المنبثقة -->
    <!-- ======================= -->
    <div id="announcement-modal" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-75 p-4" style="display: none;">
        
        <!-- (جديد) خلفية قابلة للنقر لإغلاق النافذة -->
        <div id="announcement-modal-overlay" class="absolute inset-0"></div>

        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden 
                    dark:bg-zinc-800 transform transition-all scale-95 opacity-0" 
             id="announcement-modal-box" role="dialog" aria-modal="true">
            
            <!-- المحتوى -->
            <div class="p-2 relative">
                <!-- زر الإغلاق -->
                <button id="btn-close-announcement" class="absolute top-3 left-3 z-10 p-1.5 rounded-full bg-black/40 text-white hover:bg-black/60 transition" aria-label="إغلاق">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                
                <!-- الصورة (ستُضاف من الجافاسكربت) -->
                <img id="announcement-image" src="" alt="إعلان" class="w-full h-auto object-contain rounded-lg">
            </div>
        </div>
    </div>
    <!-- (نهاية شاشة الإعلانات) -->


    <!-- ============================================== -->
    <!-- كود الجافاسكربت للتنقل... -->
    <!-- ============================================== -->
    <script>
        // === (تعديل جذري) الكشف المبكر جداً عن وضع استعادة كلمة المرور ===
        // يتم هذا الفحص قبل أي شيء آخر لضمان التقاط الرابط قبل أن تقوم أي مكتبة بتغييره
        const isRecoveryUrl = window.location.hash.includes('type=recovery') || 
                              window.location.search.includes('type=recovery') ||
                              window.location.href.includes('type=recovery');
        
        // التحقق من التخزين المؤقت (للحماية من التحديث)
        const isStoredRecovery = sessionStorage.getItem('supabase_recovery_mode') === 'true';

        // متغير عام للتحكم في الوضع - يكون صحيحاً إذا كان الرابط موجوداً أو الحالة مخزنة
        let isRecoveryMode = isRecoveryUrl || isStoredRecovery;
        
        // إذا اكتشفنا الرابط لأول مرة، نقوم بتخزين الحالة فوراً
        if (isRecoveryUrl) {
            sessionStorage.setItem('supabase_recovery_mode', 'true');
        }

        // --- 0. تهيئة Supabase ---
        // استبدل بالقيم الخاصة بك!
        const SUPABASE_URL = 'https://yrhjqzbmycjrmmjmpltq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlyaGpxemJteWNqcm1tam1wbHRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2OTEzNjAsImV4cCI6MjA3ODI2NzM2MH0.nB3S9nVL7xUrFoNCIKDnaDGnVza1dc77J68KLelxEOs';
        
        // (إصلاح) تم نقل المعرف إلى هنا لمنع تعريفه مرتين
        const GA_MEASUREMENT_ID = 'G-X3CFQ7QJ6R';

        // === (جديد) معرّف الإعلان الحالي ===
        //
        // !! لتحديث الإعلان، فقط غيّر هذا الرابط !!
        //
        const CURRENT_ANNOUNCEMENT_URL = 'images/announcement-maintenance.webp';
        //
        // === (نهاية الإضافة) ===

        let supabase;
        
        // --- (جديد) تهيئة Google Analytics (gtag) ---
        // (ملاحظة: الدالة نفسها معرّفة في الهيد)
        
        // --- بدء الكود الرئيسي ---
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                if (window.supabase && window.supabase.createClient) {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                } else {
                    const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
                    supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                }
            } catch (e) {}
            
            // --- 1. تعريف العناصر ---
            
            // شاشة الموافقة
            const termsModal = document.getElementById('terms-modal');
            const acceptTermsButton = document.getElementById('btn-accept-terms');
            
            // عناصر المصادقة
            const authModal = document.getElementById('auth-modal');
            const authForm = document.getElementById('auth-form');
            const authTitle = document.getElementById('auth-title');
            const btnCloseAuth = document.getElementById('btn-close-auth');
            const btnLoginSubmit = document.getElementById('btn-login-submit');
            const btnSignupSubmit = document.getElementById('btn-signup-submit');
            const authError = document.getElementById('auth-error');
            const authSuccess = document.getElementById('auth-success');
            
            // حقول اسم المستخدم
            const authUsernameField = document.getElementById('auth-username-field');
            const authUsernameInput = document.getElementById('auth-username');
            
            // حقل الموافقة على الشروط
            const authTermsField = document.getElementById('auth-terms-field');
            const authTermsCheckbox = document.getElementById('auth-terms-agree');
            const btnShowTermsFromAuth = document.getElementById('btn-show-terms-from-auth');
            
            // أزرار تبديل عرض المصادقة
            const btnShowSignupView = document.getElementById('btn-show-signup-view');
            const btnShowLoginView = document.getElementById('btn-show-login-view');
            
            // (جديد) عناصر استعادة كلمة المرور
            const btnShowForgotPassword = document.getElementById('btn-show-forgot-password');
            const btnForgotPasswordSubmit = document.getElementById('btn-forgot-password-submit');
            const btnResetPasswordSubmit = document.getElementById('btn-reset-password-submit');
            const btnBackToLoginFromForgot = document.getElementById('btn-back-to-login-from-forgot');
            const authResetFields = document.getElementById('auth-reset-fields');
            const authNewPasswordInput = document.getElementById('auth-new-password');
            const authConfirmPasswordInput = document.getElementById('auth-confirm-password');
            const authPasswordInput = document.getElementById('auth-password'); // موجود بالفعل لكن نعيد تعريفه للوضوح إذا لزم الأمر
            
            // (جديد) عناصر وضع الضيف
            const btnShowGuestWarning = document.getElementById('btn-show-guest-warning');
            const guestWarningModal = document.getElementById('guest-warning-modal');
            const btnGuestContinue = document.getElementById('btn-guest-continue');
            const btnGuestGoBackToLogin = document.getElementById('btn-guest-go-back-to-login');
            // (جديد) عناصر شروط الضيف
            const guestTermsCheckbox = document.getElementById('guest-terms-agree');
            const btnShowTermsFromGuest = document.getElementById('btn-show-terms-from-guest');
            const guestError = document.getElementById('guest-error');


            // عناصر القائمة الجانبية
            const btnOpenSidebar = document.getElementById('btn-open-sidebar');
            const btnCloseSidebar = document.getElementById('btn-close-sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const sidebarMenu = document.getElementById('sidebar-menu');
            const sidebarLoggedOut = document.getElementById('sidebar-logged-out');
            const sidebarLoggedIn = document.getElementById('sidebar-logged-in');
            const sidebarUsername = document.getElementById('sidebar-username');
            const btnSidebarLogin = document.getElementById('btn-sidebar-login');
            const btnSidebarSignup = document.getElementById('btn-sidebar-signup');
            const btnSidebarSettings = document.getElementById('btn-sidebar-settings');
            const btnSidebarFavorites = document.getElementById('btn-sidebar-favorites'); // (جديد)
            // (جديد) تعريف زر التحديثات
            const btnSidebarUpdates = document.getElementById('btn-sidebar-updates');
            const btnSidebarLogout = document.getElementById('btn-sidebar-logout');

            // عناصر شاشة الإعدادات
            const settingsModal = document.getElementById('settings-modal');
            const btnCloseSettings = document.getElementById('btn-close-settings');
            const settingsForm = document.getElementById('settings-form');
            const settingsUsernameInput = document.getElementById('settings-username');
            const btnUpdateUsername = document.getElementById('btn-update-username');
            const settingsError = document.getElementById('settings-error');
            const settingsSuccess = document.getElementById('settings-success');
            // (جديد) عناصر تبويب الإعدادات
            const btnSettingsTabAccount = document.getElementById('btn-settings-tab-account');
            const btnSettingsTabGeneral = document.getElementById('btn-settings-tab-general');
            const settingsTabAccount = document.getElementById('settings-tab-account');
            const settingsTabGeneral = document.getElementById('settings-tab-general');
            // (جديد) عناصر تغيير كلمة المرور
            // تم حذف btnShowPasswordFields و passwordFieldsContainer لأننا غيرنا التصميم
            // const btnShowPasswordFields = document.getElementById('btn-show-password-fields');
            // const passwordFieldsContainer = document.getElementById('password-fields-container');
            // const settingsNewPassword = document.getElementById('settings-new-password');
            // const settingsConfirmPassword = document.getElementById('settings-confirm-password');
            // const btnUpdatePassword = document.getElementById('btn-update-password');
            const btnSettingsResetPassword = document.getElementById('btn-settings-reset-password');
            // (جديد) عناصر حذف الحساب
            const btnShowDeleteAccount = document.getElementById('btn-show-delete-account');
            const deleteAccountModal = document.getElementById('delete-account-modal');
            const btnDeleteAccountCancel = document.getElementById('btn-delete-account-cancel');
            const btnDeleteAccountConfirm = document.getElementById('btn-delete-account-confirm');
            const deleteConfirmUsername = document.getElementById('delete-confirm-username');
            const deleteConfirmUsernameLabel = document.getElementById('delete-confirm-username-label');
            const deleteError = document.getElementById('delete-error');
            
            // (جديد) عناصر شاشة المفضلة
            const favoritesModal = document.getElementById('favorites-modal');
            const btnCloseFavorites = document.getElementById('btn-close-favorites');
            const favoritesContainer = document.getElementById('favorites-container');
            
            // === (جديد) عناصر شاشة التحديثات ===
            const updatesModal = document.getElementById('updates-modal');
            const btnCloseUpdates = document.getElementById('btn-close-updates');
            // === (نهاية العناصر الجديدة) ===

            // === (جديد) عناصر شاشة الإعلانات ===
            const announcementModal = document.getElementById('announcement-modal');
            const announcementModalBox = document.getElementById('announcement-modal-box');
            const announcementModalOverlay = document.getElementById('announcement-modal-overlay');
            const btnCloseAnnouncement = document.getElementById('btn-close-announcement');
            const announcementImage = document.getElementById('announcement-image');
            // === (نهاية الإضافة) ===
            
            // (جديد) كل بطاقات التطبيقات وأزرار المفضلة
            const allAppCards = document.querySelectorAll('.app-card');
            const allFavoriteButtons = document.querySelectorAll('.favorite-btn');

            // جلب عناصر الصفحات
            const pageWelcome = document.getElementById('page-welcome');
            const pageTools = document.getElementById('page-tools');
            const pageCompetitions = document.getElementById('page-competitions');
            const pageGames = document.getElementById('page-games');
            const pagePolicy = document.getElementById('page-policy');
            
            const pageToolRemote = document.getElementById('page-tool-remote');
            const pageToolSodfa = document.getElementById('page-tool-sodfa');
            const pageToolQuestions = document.getElementById('page-tool-questions');
            const pageToolLetters = document.getElementById('page-tool-letters');
            const pageGameCaptain = document.getElementById('page-game-captain');
            const pageGameSeaWar = document.getElementById('page-game-seawar');
            const pageGameTopTen = document.getElementById('page-game-topten');
            
            // ================== (الإصلاح 1) ==================
            // تم تغيير المعرف من 'mileon-app' إلى 'game-mileon' ليتطابق مع الـ HTML
            // === (الإصلاح 4: توحيد المعرّف) ===
            const pageGameMileon = document.getElementById('page-game-mileon');
            // ================== (نهاية الإصلاح 1) ==================
            
            const pageGameThinkWin = document.getElementById('page-game-thinkwin');
            const pageGameMalkoof = document.getElementById('page-game-malkoof');
            const pageGameMafia = document.getElementById('page-game-mafia');
            const page4toWon = document.getElementById('page-4to-won');
            const pageGameHrof = document.getElementById('page-game-hrof');

            // جلب كل الصفحات
            const allPages = document.querySelectorAll('.page');

            // جلب أزرار الاختيار من الصفحة الرئيسية
            const btnTools = document.getElementById('btn-tools');
            const btnCompetitions = document.getElementById('btn-competitions');
            const btnGames = document.getElementById('btn-games');
            
            // (تعديل) تم حذف الأزرار القديمة، سيتم استخدام '.app-card'
            
            // جلب جميع IFrames
            const iframes = {
                'tool-remote': document.getElementById('remote-iframe'),
                'tool-sodfa': document.getElementById('sodfa-iframe'),
                'tool-questions': document.getElementById('questions-iframe'),
                'tool-letters': document.getElementById('letters-iframe'),
                'game-captain': document.getElementById('captain-iframe'),
                'game-seawar': document.getElementById('seawar-iframe'),
                'game-topten': document.getElementById('topten-iframe'),
                'game-thinkwin': document.getElementById('thinkwin-iframe'),
                'page-game-mileon': document.getElementById('mileon-iframe'), // تم تحديث هذا السطر ليشير إلى ID الصحيح
                'game-malkoof': document.getElementById('malkoof-iframe'),
                'game-mafia': document.getElementById('mafia-iframe'),
                'page-4to-won': document.getElementById('page-4to-won-iframe'),
                'game-hrof': document.getElementById('hrof-iframe')
            };

            // ماب لأسماء ملفات IFrames
            const iframeSrcMap = {
                'tool-remote': 'remot-app.html',
                'tool-sodfa': 'sodfa-app.html',
                'tool-questions': 'questions-bank-app.html',
                'tool-letters': 'letters-trip-app.html',
                'game-captain': 'captain-safe-app.html',
                'game-seawar': 'sea-war-app.html',
                'game-topten': 'top-ten-app.html',
                'game-thinkwin': 'think-win-app.html', // (إصلاح) تصحيح خطأ مطبعي
                
                // ================== (الإصلاح 2) ==================
                // تم تغيير اسم الملف ليتطابق مع الملف الذي أرفقته
                'page-game-mileon': 'game-mileon.html', // (إصلاح) تم تغيير اسم الملف ليتطابق مع الملف المرفق
                // ================== (نهاية الإصلاح 2) ==================
                
                'game-malkoof': 'malkoof-app.html',
                'game-mafia': 'mafia-app.html',
                'page-4to-won': '4to-won.html',
                'game-hrof': 'HROF-ABQAR-APP.HTML'
            };
            
            // (جديد) ماب لبيانات التطبيقات (للمفضلة)
            const appInfoMap = {
                'tool-sodfa': { title: '1. صدفة', img: 'images/app-sodfa.webp' },
                'tool-questions': { title: '2. صناديق الأسئلة', img: 'images/app-questions.webp' },
                'tool-letters': { title: '3. حروف رحال', img: 'images/app-letters.webp' },
                'tool-remote': { title: '4. ريموت', img: 'images/app-remote-alt.webp' },
                'game-captain': { title: '1. مسابقة خزنة ربان', img: 'images/game-rubban-alt.webp' },
                'game-seawar': { title: '2. حرب البحار', img: 'images/game-seawar-alt.webp' },
                'game-topten': { title: '3. الترتيب العاشر', img: 'images/game-topten-alt.webp' },
                'game-thinkwin': { title: '4. فكر تربح', img: 'images/game-thinkwin-alt.webp' },
                'page-game-mileon': { title: '5. من سيربح المليون', img: 'images/game-million-alt.webp' },
                'game-malkoof': { title: '1. مين الملقوف', img: 'images/game-malkoof-alt.webp' },
                'game-mafia': { title: '2. مافيا', img: 'images/game-mafia-alt.webp' },
                'page-4to-won': { title: '3. من سيربح الأربعة', img: 'images/game-million-alt.webp' },
                'game-hrof': { title: 'حروف عبقر', img: 'images/HROF.WEBP' }
            };

            // جلب أزرار "العودة" للصفحات العادية
            const backButtons = document.querySelectorAll('.btn-back');
            
            // جلب أزرار الخروج العائمة (X)
            const closeIframeButtons = document.querySelectorAll('.btn-close-iframe');
            
            // جلب جميع أزرار "سياسة الاستخدام"
            const policyButtons = document.querySelectorAll('.btn-policy');

            // عناصر الوضع الليلي
            const themeToggle = document.getElementById('theme-toggle');
            
            // (جديد) زر ملئ الشاشة
            const fullscreenToggle = document.getElementById('fullscreen-toggle');
            const fullscreenIconEnter = document.getElementById('fullscreen-icon-enter');
            const fullscreenIconExit = document.getElementById('fullscreen-icon-exit');

            // (جديد) متغير لتتبع الخروج اليدوي من ملئ الشاشة
            let isManualFullscreenExit = false;

            // (جديد) منطق ملئ الشاشة
            fullscreenToggle.addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        isManualFullscreenExit = true;
                        document.exitFullscreen();
                    }
                }
            });

            // (جديد) تحديث أيقونة ملئ الشاشة عند التغيير
            document.addEventListener('fullscreenchange', () => {
                if (document.fullscreenElement) {
                    fullscreenIconEnter.classList.add('hidden');
                    fullscreenIconExit.classList.remove('hidden');
                } else {
                    fullscreenIconEnter.classList.remove('hidden');
                    fullscreenIconExit.classList.add('hidden');
                    
                    // معالجة زر الرجوع في الجوال: إذا لم يكن الخروج يدوياً، نرجع للخلف
                    if (!isManualFullscreenExit) {
                         // التحقق من أنه جهاز محمول (لمس) لتجنب التأثير على سطح المكتب (ESC)
                         const isMobile = window.matchMedia('(pointer:coarse)').matches || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                         if (isMobile) {
                             history.back();
                         }
                    }
                    isManualFullscreenExit = false;
                }
            });
            const darkIcon = document.getElementById('theme-toggle-dark-icon'); // قمر
            const lightIcon = document.getElementById('theme-toggle-light-icon'); // شمس
            
            // (جديد) متغيرات لحالة المستخدم
            let currentUser = null;
            let userFavorites = [];

            // --- 7. دالة لتبديل الأيقونات (الوضع الليلي 2 حالة) ---
            function updateThemeIcons() {
                const isDark = document.documentElement.classList.contains('dark');
                darkIcon.style.display = isDark ? 'none' : 'block';
                lightIcon.style.display = isDark ? 'block' : 'none';
            }

            // --- 8. ربط حدث النقر لزر الوضع الليلي (2 حالة) ---
            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.theme = isDark ? 'dark' : 'light';
                updateThemeIcons();
            });

            // --- 2. (تعديل) منطق شاشة الموافقة ---
            // (تعديل) هذا الزر الآن يغلق النافذة ويؤشر على الموافقة
            acceptTermsButton.addEventListener('click', () => {
                termsModal.classList.add('opacity-0'); // (تعديل) استخدام كلاس
                setTimeout(() => {
                    termsModal.style.display = 'none';
                }, 300); // مطابقة مدة الانتقال
                authTermsCheckbox.checked = true; // تفعيل موافقة إنشاء الحساب
                guestTermsCheckbox.checked = true; // (جديد) تفعيل موافقة الضيف
            });
            
            // (جديد) دالة لفتح نافذة الشروط
            function openTermsModal() {
                termsModal.style.display = 'flex'; // (تعديل) إظهار
                void termsModal.offsetWidth; // Trigger reflow
                termsModal.classList.remove('opacity-0'); // (تعديل) استخدام كلاس للظهور
            }
            
            // (جديد) زر فتح الشروط من داخل شاشة المصادقة
            btnShowTermsFromAuth.addEventListener('click', openTermsModal);
            // (جديد) زر فتح الشروط من داخل شاشة الضيف
            btnShowTermsFromGuest.addEventListener('click', openTermsModal);


            // --- 3. منطق التنقل بين الصفحات (مع History API وتأثير الفيد) ---
            let currentPage = null;

            const pageMap = {
                'welcome': { element: pageWelcome },
                'tools': { element: pageTools },
                'competitions': { element: pageCompetitions },
                'games': { element: pageGames },
                'policy': { element: pagePolicy },
                'tool-remote': { element: pageToolRemote, iframe: iframes['tool-remote'], src: iframeSrcMap['tool-remote'] },
                'tool-sodfa': { element: pageToolSodfa, iframe: iframes['tool-sodfa'], src: iframeSrcMap['tool-sodfa'] },
                'tool-questions': { element: pageToolQuestions, iframe: iframes['tool-questions'], src: iframeSrcMap['tool-questions'] },
                'tool-letters': { element: pageToolLetters, iframe: iframes['tool-letters'], src: iframeSrcMap['tool-letters'] },
                'game-captain': { element: pageGameCaptain, iframe: iframes['game-captain'], src: iframeSrcMap['game-captain'] },
                'game-seawar': { element: pageGameSeaWar, iframe: iframes['game-seawar'], src: iframeSrcMap['game-seawar'] },
                'game-topten': { element: pageGameTopTen, iframe: iframes['game-topten'], src: iframeSrcMap['game-topten'] },
                'game-thinkwin': { element: pageGameThinkWin, iframe: iframes['game-thinkwin'], src: iframeSrcMap['game-thinkwin'] },
                'page-game-mileon': { element: pageGameMileon, iframe: iframes['page-game-mileon'], src: iframeSrcMap['page-game-mileon'] },
                'game-malkoof': { element: pageGameMalkoof, iframe: iframes['game-malkoof'], src: iframeSrcMap['game-malkoof'] },
                'game-mafia': { element: pageGameMafia, iframe: iframes['game-mafia'], src: iframeSrcMap['game-mafia'] },
                'page-4to-won': { element: page4toWon, iframe: iframes['page-4to-won'], src: iframeSrcMap['page-4to-won'] },
                'game-hrof': { element: pageGameHrof, iframe: iframes['game-hrof'], src: iframeSrcMap['game-hrof'] }
            };

            allAppCards.forEach(card => {
                const appId = card.dataset.appid;
                const info = appInfoMap[appId];
                card.setAttribute('role', 'button');
                card.tabIndex = 0;
                if (info && info.title) {
                    card.setAttribute('aria-label', `فتح ${info.title}`);
                }
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        if (e.target.closest('.favorite-btn')) return;
                        e.preventDefault();
                        if (appId && pageMap[appId]) {
                            showPage(appId, true);
                        }
                    }
                });
            });
            function showPage(pageId, updateHistory = false) {
                
                // (جديد) إرسال حدث لـ Google Analytics
                if (typeof gtag === 'function') {
                    gtag('event', 'page_view', {
                        page_path: `/${pageId}`,
                        page_title: pageId, 
                    });
                }
                
                let pageConfig = pageMap[pageId] || pageMap['welcome'];
                if (pageId === 'welcome' || !pageConfig) {
                    pageConfig = pageMap['welcome'];
                    pageId = 'welcome';
                }
                
                const pageToShow = pageConfig.element;
                if (!pageToShow || pageToShow === currentPage) return;

                // إخفاء/إظهار الواجهة الرئيسية
                const isUserOrGuest = currentUser || sessionStorage.getItem('isGuest') === 'true';
                if (pageConfig.iframe) {
                    btnOpenSidebar.classList.add('hidden');
                    themeToggle.classList.add('hidden');
                    
                    if (typeof fullscreenToggle !== 'undefined') {
                        fullscreenToggle.classList.remove('hidden');
                        fullscreenToggle.style.display = '';
                        fullscreenToggle.classList.add('fade-out-enabled');
                        fullscreenToggle.classList.remove('fade-out');
                        
                        if (fullscreenToggle.hideTimeout) clearTimeout(fullscreenToggle.hideTimeout);
                        fullscreenToggle.hideTimeout = setTimeout(() => {
                            fullscreenToggle.classList.add('fade-out');
                        }, 5000);
                    }
                    
                    btnOpenSidebar.style.display = 'none';
                    themeToggle.style.display = 'none';
                } else if (isUserOrGuest) {
                    btnOpenSidebar.classList.remove('hidden');
                    themeToggle.classList.remove('hidden');
                    
                    if (typeof fullscreenToggle !== 'undefined') {
                        fullscreenToggle.classList.remove('hidden');
                        fullscreenToggle.style.display = '';
                        fullscreenToggle.classList.remove('fade-out-enabled');
                        fullscreenToggle.classList.remove('fade-out');
                        if (fullscreenToggle.hideTimeout) clearTimeout(fullscreenToggle.hideTimeout);
                    }
                    
                    btnOpenSidebar.style.display = '';
                    themeToggle.style.display = '';
                }

                // كشف الجوال (Mobile Detection)
                const isMobile = window.innerWidth <= 768;

                // إخفاء الصفحة الحالية
                if (currentPage) {
                    const oldPage = currentPage;
                    oldPage.style.opacity = '0';
                    const oldPageConfig = Object.values(pageMap).find(p => p && p.element === oldPage);
                    
                    if (oldPageConfig && oldPageConfig.iframe) {
                        const clearDelay = isMobile ? 100 : 300;
                        setTimeout(() => {
                            if (oldPageConfig.iframe) {
                                oldPageConfig.iframe.src = 'about:blank'; 
                            }
                        }, clearDelay);
                    }
                    
                    if (!isMobile) {
                        setTimeout(() => {
                             oldPage.style.display = 'none';
                        }, 300);
                    }
                    // (Mobile) Hide logic moved to requestAnimationFrame for sync
                }

                // دالة لإظهار الصفحة الجديدة
                const showNewPage = () => {
                    pageToShow.style.display = 'flex'; 
                    void pageToShow.offsetWidth;
                    pageToShow.style.opacity = '1';

                    const closeBtn = pageToShow.querySelector('.btn-close-iframe');
                    if (closeBtn) {
                        closeBtn.classList.remove('fade-out');
                        if (closeBtn.hideTimeout) clearTimeout(closeBtn.hideTimeout);
                        closeBtn.hideTimeout = setTimeout(() => {
                            closeBtn.classList.add('fade-out');
                        }, 3000);
                    }

                    if (pageConfig.iframe && pageConfig.iframe.src === 'about:blank') {
                        pageConfig.iframe.src = pageConfig.src;
                    }
                    
                    currentPage = pageToShow;
                    if (updateHistory) {
                        try {
                            if (window.location.hash !== `#${pageId}`) {
                                history.pushState({ page: pageId }, '', `#${pageId}`);
                            }
                        } catch (e) {
                            console.warn("History API (pushState) not available.", e);
                        }
                    }
                };

                // تنفيذ الانتقال
                if (isMobile) {
                    requestAnimationFrame(() => {
                        // (Mobile UX) إخفاء الصفحة القديمة في نفس اللحظة لمنع الوميض
                        if (currentPage && currentPage !== pageToShow) {
                            currentPage.style.display = 'none';
                        }
                        showNewPage();
                    });
                } else {
                    setTimeout(() => {
                        showNewPage();
                    }, 300);
                }
            }

            // ربط أحداث النقر على أزرار اختيار الأقسام
            btnTools.addEventListener('click', () => showPage('tools', true));
            btnCompetitions.addEventListener('click', () => showPage('competitions', true));
            btnGames.addEventListener('click', () => showPage('games', true));
            
            // (جديد) ربط النقر على بطاقات التطبيقات (بدلاً من الأزرار القديمة)
            allAppCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    
                    // (تعديل) التأكد من أن البطاقة ليست "قريباً"
                    if (card.classList.contains('cursor-not-allowed')) {
                        return;
                    }
                    
                    // التأكد من أن النقر لم يكن على زر المفضلة
                    if (e.target.closest('.favorite-btn')) {
                        return;
                    }
                    const appId = card.dataset.appid;
                    if (appId && pageMap[appId]) {
                        showPage(appId, true);
                    }
                });
            });


            // (إصلاح) ربط أزرار "العودة" و "X" للعودة المباشرة للرئيسية
            backButtons.forEach(button => {
                button.addEventListener('click', () => showPage('welcome', true));
            });
            
            closeIframeButtons.forEach(button => {
                button.addEventListener('click', () => showPage('welcome', true));
            });


            // ربط أزرار "سياسة الاستخدام"
            policyButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault(); 
                    showPage('policy', true);
                });
            });

            // --- 4. معالجة زر الرجوع وتحميل الصفحة المباشر ---
            window.addEventListener('popstate', async (event) => {
                let pageId = 'welcome'; 
                if (event.state && event.state.page) {
                    pageId = event.state.page;
                } else if (window.location.hash) {
                    pageId = window.location.hash.substring(1) || 'welcome';
                }
                
                let session = null;
                if (supabase) {
                    const result = await supabase.auth.getSession();
                    session = result.data.session;
                }
                const isGuest = sessionStorage.getItem('isGuest') === 'true';

                if ((session && session.user) || isGuest) { // (إصلاح) التحقق من الجلسة أو الضيف
                    showPage(pageId, false);
                } else if (!supabase) {
                    showPage(pageId, false);
                }
                // إذا لم يكن مسجلاً دخوله وليس ضيفاً، لا تفعل شيئاً (تبقى شاشة المصادقة ظاهرة)
            });
            
            // تحديث أيقونات الوضع عند التحميل الأولي
            updateThemeIcons();
            
            
            // --- 9. منطق المصادقة (Auth) ---
            
            // دوال المساعدة للرسائل
            function showAuthError(message) {
                authSuccess.classList.add('hidden');
                authError.classList.remove('hidden');
                authError.textContent = message;
            }
            function showAuthSuccess(message) {
                authError.classList.add('hidden');
                authSuccess.classList.remove('hidden');
                authSuccess.textContent = message;
            }
            function showSettingsError(message) {
                settingsSuccess.classList.add('hidden');
                settingsError.classList.remove('hidden');
                settingsError.textContent = message;
            }
            function showSettingsSuccess(message) {
                settingsError.classList.add('hidden');
                settingsSuccess.classList.remove('hidden');
                settingsSuccess.textContent = message;
            }
            // (جديد) إخفاء رسائل الإعدادات
            function hideSettingsMessages() {
                settingsError.classList.add('hidden');
                settingsSuccess.classList.add('hidden');
            }

            // === (جديد) دوال شاشة الإعلانات ===
            
            /**
             * يتحقق إذا كان يجب عرض الإعلان (لم يُرَ من قبل + نحن في الصفحة الرئيسية)
             */
            function checkAndShowAnnouncement() {
                // (جديد) لا تعرض الإعلان إذا كنا في وضع استعادة كلمة المرور
                if (isRecoveryMode) return;

                // نتأكد أننا في الصفحة الرئيسية
                if (currentPage !== pageWelcome) {
                    return;
                }
            
                const seenURL = localStorage.getItem('seenAnnouncementURL');
                
                // إذا لم يرَ المستخدم هذا الرابط تحديداً
                if (seenURL !== CURRENT_ANNOUNCEMENT_URL) {
                    announcementImage.src = CURRENT_ANNOUNCEMENT_URL;
                    announcementModal.style.display = 'flex';
                    // تفعيل الأنيميشن
                    setTimeout(() => {
                        announcementModalBox.classList.remove('scale-95', 'opacity-0');
                    }, 10); // تأخير بسيط لبدء التحريك
                }
            }
            
            /**
             * إخفاء شاشة الإعلان وتسجيل الرابط كـ "مرئي"
             */
            function hideAnnouncementModal() {
                // بدء أنيميشن الإخفاء
                announcementModalBox.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    announcementModal.style.display = 'none';
                    // تسجيل أن المستخدم رأى هذا الإعلان
                    localStorage.setItem('seenAnnouncementURL', CURRENT_ANNOUNCEMENT_URL);
                }, 200); // مدة الأنيميشن
                
                // (اختياري) تشغيل صوت النقر
                // playClickSound(); 
            }
            
            // === (نهاية الإضافة) ===

            // دوال فتح/إغلاق القائمة الجانبية
            function openSidebar() {
                sidebarOverlay.classList.remove('hidden');
                void sidebarOverlay.offsetWidth; // Trigger reflow
                sidebarOverlay.classList.remove('opacity-0');
                sidebarMenu.classList.remove('translate-x-full');
            }

            function closeSidebar() {
                sidebarOverlay.classList.add('opacity-0');
                sidebarMenu.classList.add('translate-x-full');
                setTimeout(() => {
                    sidebarOverlay.classList.add('hidden');
                }, 300); // مطابقة مدة الانتقال
            }

            // (جديد) دالة لإظهار عرض تسجيل الدخول
            function showLoginView() {
                authTitle.textContent = 'تسجيل الدخول';
                btnLoginSubmit.classList.remove('hidden');
                btnSignupSubmit.classList.add('hidden');
                btnForgotPasswordSubmit.classList.add('hidden'); // (جديد)
                btnResetPasswordSubmit.classList.add('hidden'); // (جديد)
                
                authUsernameField.classList.add('hidden');
                authTermsField.classList.add('hidden');
                authResetFields.classList.add('hidden'); // (جديد)
                
                // إظهار حقول الدخول الأساسية
                document.querySelector('label[for="auth-email"]').parentElement.classList.remove('hidden');
                document.querySelector('label[for="auth-password"]').parentElement.classList.remove('hidden');
                
                btnShowSignupView.classList.remove('hidden');
                btnShowLoginView.classList.add('hidden');
                btnBackToLoginFromForgot.classList.add('hidden'); // (جديد)
                btnShowForgotPassword.classList.remove('hidden'); // (جديد)
                
                authError.classList.add('hidden');
                authSuccess.classList.add('hidden');
            }

            // (جديد) دالة لإظهار عرض إنشاء الحساب
            function showSignupView() {
                authTitle.textContent = 'إنشاء حساب جديد';
                btnLoginSubmit.classList.add('hidden');
                btnSignupSubmit.classList.remove('hidden');
                btnForgotPasswordSubmit.classList.add('hidden'); // (جديد)
                btnResetPasswordSubmit.classList.add('hidden'); // (جديد)

                authUsernameField.classList.remove('hidden');
                authTermsField.classList.remove('hidden');
                authResetFields.classList.add('hidden'); // (جديد)
                
                // إظهار حقول الدخول الأساسية
                document.querySelector('label[for="auth-email"]').parentElement.classList.remove('hidden');
                document.querySelector('label[for="auth-password"]').parentElement.classList.remove('hidden');

                btnShowSignupView.classList.add('hidden');
                btnShowLoginView.classList.remove('hidden');
                btnBackToLoginFromForgot.classList.add('hidden'); // (جديد)
                btnShowForgotPassword.classList.add('hidden'); // (جديد) - لا نعرض نسيت كلمة المرور في التسجيل

                authError.classList.add('hidden');
                authSuccess.classList.add('hidden');
            }

            // (جديد) دالة لإظهار عرض "نسيت كلمة المرور"
            function showForgotPasswordView() {
                authTitle.textContent = 'استعادة كلمة المرور';
                btnLoginSubmit.classList.add('hidden');
                btnSignupSubmit.classList.add('hidden');
                btnForgotPasswordSubmit.classList.remove('hidden');
                btnResetPasswordSubmit.classList.add('hidden');

                authUsernameField.classList.add('hidden');
                authTermsField.classList.add('hidden');
                authResetFields.classList.add('hidden');
                
                // إظهار الايميل وإخفاء الباسورد
                document.querySelector('label[for="auth-email"]').parentElement.classList.remove('hidden');
                document.querySelector('label[for="auth-password"]').parentElement.classList.add('hidden');

                btnShowSignupView.classList.add('hidden');
                btnShowLoginView.classList.add('hidden');
                btnBackToLoginFromForgot.classList.remove('hidden');
                btnShowForgotPassword.classList.add('hidden');

                authError.classList.add('hidden');
                authSuccess.classList.add('hidden');
            }

            // (جديد) دالة لإظهار عرض "تعيين كلمة المرور الجديدة"
            function showResetPasswordView() {
                authTitle.textContent = 'تعيين كلمة المرور الجديدة';
                btnLoginSubmit.classList.add('hidden');
                btnSignupSubmit.classList.add('hidden');
                btnForgotPasswordSubmit.classList.add('hidden');
                btnResetPasswordSubmit.classList.remove('hidden');

                authUsernameField.classList.add('hidden');
                authTermsField.classList.add('hidden');
                authResetFields.classList.remove('hidden');
                
                // إخفاء الايميل والباسورد القديم
                document.querySelector('label[for="auth-email"]').parentElement.classList.add('hidden');
                document.querySelector('label[for="auth-password"]').parentElement.classList.add('hidden');

                btnShowSignupView.classList.add('hidden');
                btnShowLoginView.classList.add('hidden');
                btnBackToLoginFromForgot.classList.add('hidden');
                btnShowForgotPassword.classList.add('hidden');
                
                authError.classList.add('hidden');
                authSuccess.classList.add('hidden');
            }

            // (جديد) ربط أزرار التبديل
            btnShowSignupView.addEventListener('click', showSignupView);
            btnShowLoginView.addEventListener('click', showLoginView);
            btnShowForgotPassword.addEventListener('click', showForgotPasswordView);
            btnBackToLoginFromForgot.addEventListener('click', showLoginView);
            
            // (جديد) دالة لتحديث حالة "وضع الضيف" في الواجهة
            function setGuestMode(isGuest) {
                if (isGuest) {
                    sessionStorage.setItem('isGuest', 'true');
                    document.body.classList.remove('user-logged-in'); // إزالة كلاس المسجلين
                } else {
                    sessionStorage.removeItem('isGuest');
                    document.body.classList.add('user-logged-in'); // إضافة كلاس المسجلين
                }
            }


            // (جديد) ربط أحداث وضع الضيف
            btnShowGuestWarning.addEventListener('click', () => {
                guestError.classList.add('hidden'); // (جديد) إخفاء الخطأ عند الفتح
                guestTermsCheckbox.checked = false; // (جديد) إلغاء تحديد المربع
                guestWarningModal.style.display = 'flex';
            });
            btnGuestGoBackToLogin.addEventListener('click', () => {
                guestWarningModal.style.display = 'none';
            });
            btnGuestContinue.addEventListener('click', () => {
                // (جديد) التحقق من الموافقة على الشروط
                if (!guestTermsCheckbox.checked) {
                    guestError.textContent = 'يجب الموافقة على شروط الاستخدام أولاً.';
                    guestError.classList.remove('hidden');
                    return; // إيقاف المتابعة
                }

                guestError.classList.add('hidden'); // إخفاء الخطأ إذا تم الموافقة
                setGuestMode(true); // (تعديل) استخدام الدالة الجديدة
                guestWarningModal.style.display = 'none';
                authModal.style.display = 'none';
                
                // إظهار واجهة التطبيق يدوياً (لأن onAuthStateChange لن يفعل ذلك)
                btnOpenSidebar.classList.remove('hidden');
                themeToggle.classList.remove('hidden');
                fullscreenToggle.classList.remove('hidden'); // (جديد)
                showPage('welcome', false);
                // === (جديد) التحقق من الإعلان هنا أيضاً للضيف ===
                // setTimeout(checkAndShowAnnouncement, 500); // (تم التعطيل لاستخدام النظام الديناميكي)
                if (typeof fetchAndDisplayAds === 'function') fetchAndDisplayAds();
                // === (نهاية الإضافة) ===
                try {
                    history.replaceState({ page: 'welcome' }, '', `#welcome`);
                } catch(e) {}
            });


            // ربط أحداث القائمة الجانبية
            btnOpenSidebar.addEventListener('click', openSidebar);
            btnCloseSidebar.addEventListener('click', closeSidebar);
            sidebarOverlay.addEventListener('click', closeSidebar);

            // ربط أزرار *داخل* القائمة الجانبية
            btnSidebarLogin.addEventListener('click', () => {
                setGuestMode(false); // (تعديل) استخدام الدالة الجديدة
                showLoginView();
                btnCloseAuth.classList.remove('hidden'); // إظهار زر الإغلاق
                authModal.style.display = 'flex';
                closeSidebar(); 
            });

            btnSidebarSignup.addEventListener('click', () => {
                setGuestMode(false); // (تعديل) استخدام الدالة الجديدة
                showSignupView();
                btnCloseAuth.classList.remove('hidden'); // إظهار زر الإغلاق
                authModal.style.display = 'flex';
                closeSidebar(); 
            });

            btnSidebarSettings.addEventListener('click', async () => {
                // (تعديل) التأكد من جلب المستخدم الحالي
                if (!currentUser) {
                    const { data: { user } } = await supabase.auth.getUser();
                    currentUser = user;
                }
                
                if (currentUser && currentUser.user_metadata?.username) {
                    settingsUsernameInput.value = currentUser.user_metadata.username;
                }
                hideSettingsMessages();
                // (جديد) إعادة تعيين التبويبات
                showSettingsTab('account'); 
                
                settingsModal.style.display = 'flex';
                closeSidebar(); 
            });
            
            // === (تعديل) ربط زر التحديثات ===
            if (btnSidebarUpdates) {
                btnSidebarUpdates.addEventListener('click', () => {
                    updatesModal.style.display = 'flex'; // إظهار نافذة التحديثات
                    closeSidebar(); // إغلاق القائمة الجانبية
                });
            }
            // === (نهاية التعديل) ===

            btnSidebarLogout.addEventListener('click', async () => {
                setGuestMode(false); // (تعديل) استخدام الدالة الجديدة
                await supabase.auth.signOut();
                closeSidebar(); 
            });
            
            // (جديد) فتح نافذة المفضلة
            btnSidebarFavorites.addEventListener('click', () => {
                renderFavoritesModal();
                favoritesModal.style.display = 'flex';
                closeSidebar();
            });

            // --- منطق النوافذ المنبثقة (Modals) ---
            
            // إغلاق نافذة المصادقة
            btnCloseAuth.addEventListener('click', () => {
                authModal.style.display = 'none';
            });

            // إغلاق نافذة الإعدادات
            btnCloseSettings.addEventListener('click', () => {
                settingsModal.style.display = 'none';
            });
            
            // (جديد) إغلاق نافذة المفضلة
            btnCloseFavorites.addEventListener('click', () => {
                favoritesModal.style.display = 'none';
            });

            // === (جديد) إغلاق نافذة التحديثات ===
            btnCloseUpdates.addEventListener('click', () => {
                updatesModal.style.display = 'none';
            });
            // === (نهاية الإضافة) ===

            // (جديد) منطق تبويبات الإعدادات
            function showSettingsTab(tabName) {
                hideSettingsMessages();
                if (tabName === 'account') {
                    settingsTabAccount.classList.remove('hidden');
                    settingsTabGeneral.classList.add('hidden');
                    btnSettingsTabAccount.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                    btnSettingsTabAccount.classList.remove('border-transparent', 'text-zinc-500', 'hover:text-zinc-700', 'dark:text-zinc-400', 'dark:hover:text-zinc-200');
                    btnSettingsTabGeneral.classList.add('border-transparent', 'text-zinc-500', 'hover:text-zinc-700', 'dark:text-zinc-400', 'dark:hover:text-zinc-200');
                    btnSettingsTabGeneral.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                } else {
                    settingsTabAccount.classList.add('hidden');
                    settingsTabGeneral.classList.remove('hidden');
                    btnSettingsTabGeneral.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                    btnSettingsTabGeneral.classList.remove('border-transparent', 'text-zinc-500', 'hover:text-zinc-700', 'dark:text-zinc-400', 'dark:hover:text-zinc-200');
                    btnSettingsTabAccount.classList.add('border-transparent', 'text-zinc-500', 'hover:text-zinc-700', 'dark:text-zinc-400', 'dark:hover:text-zinc-200');
                    btnSettingsTabAccount.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                }
            }
            btnSettingsTabAccount.addEventListener('click', () => showSettingsTab('account'));
            btnSettingsTabGeneral.addEventListener('click', () => showSettingsTab('general'));
            
            // (جديد) إرسال رابط تغيير كلمة المرور من الإعدادات
            btnSettingsResetPassword.addEventListener('click', async () => {
                hideSettingsMessages();
                if (!currentUser || !currentUser.email) {
                    showSettingsError('لا يمكن العثور على البريد الإلكتروني للمستخدم.');
                    return;
                }
                
                if (!supabase || !supabase.auth || !supabase.auth.resetPasswordForEmail) {
                    showSettingsError('خدمة المصادقة غير متاحة حالياً.');
                    return;
                }
                
                showSettingsSuccess('جاري إرسال رابط التحقق...');
                const { data, error } = await supabase.auth.resetPasswordForEmail(currentUser.email, {
                    redirectTo: 'https://www.tryabqar.com',
                });
                
                if (error) {
                    showSettingsError(error.message);
                } else {
                    showSettingsSuccess('تم إرسال رابط تغيير كلمة المرور إلى بريدك الإلكتروني.');
                }
            });

            // (جديد) زر إرسال رابط نسيت كلمة المرور (من شاشة الدخول)
            btnForgotPasswordSubmit.addEventListener('click', async (e) => {
                e.preventDefault();
                const email = document.getElementById('auth-email').value;
                if (!email) {
                    showAuthError('يرجى إدخال البريد الإلكتروني.');
                    return;
                }
                
                showAuthSuccess('جاري إرسال الرابط...');
                if (!supabase || !supabase.auth || !supabase.auth.resetPasswordForEmail) {
                    showAuthError('خدمة المصادقة غير متاحة حالياً.');
                    return;
                }

                const { data, error } = await supabase.auth.resetPasswordForEmail(email, {
                        redirectTo: 'https://www.tryabqar.com',
                    });
                
                if (error) {
                    showAuthError(error.message);
                } else {
                    showAuthSuccess('تم إرسال رابط استعادة كلمة المرور إلى بريدك الإلكتروني.');
                }
            });

            // (جديد) زر حفظ كلمة المرور الجديدة (بعد النقر على الرابط)
            btnResetPasswordSubmit.addEventListener('click', async (e) => {
                e.preventDefault();
                const newPassword = authNewPasswordInput.value;
                const confirmPassword = authConfirmPasswordInput.value;
                
                if (newPassword.length < 6) {
                    showAuthError('كلمة المرور يجب أن تكون 6 أحرف على الأقل.');
                    return;
                }
                if (newPassword !== confirmPassword) {
                    showAuthError('كلمتا المرور غير متطابقتين.');
                    return;
                }
                
                showAuthSuccess('جاري تحديث كلمة المرور...');
                const { data, error } = await supabase.auth.updateUser({ password: newPassword });
                
                if (error) {
                    showAuthError(error.message);
                } else {
                    showAuthSuccess('تم تحديث كلمة المرور بنجاح! جاري تسجيل الخروج...');
                    
                    // (تعديل هام) تسجيل الخروج بعد التحديث لفرض الدخول بكلمة المرور الجديدة
                    setTimeout(async () => {
                        await supabase.auth.signOut();
                        authModal.style.display = 'none';
                        isRecoveryMode = false;
                        sessionStorage.removeItem('supabase_recovery_mode'); // تنظيف حالة الاستعادة
                        
                        // إعادة تهيئة الواجهة
                        authModal.style.backgroundColor = ''; // إزالة لون الخلفية المخصص
                        btnCloseAuth.classList.remove('hidden'); // إعادة زر الإغلاق
                        showLoginView(); // العودة لشاشة الدخول
                        showAuthSuccess('تم تغيير كلمة المرور. يرجى تسجيل الدخول الآن.');
                        authModal.style.display = 'flex'; // إظهار النافذة مرة أخرى للدخول
                        
                        // تنظيف الرابط
                        try { history.replaceState(null, null, window.location.pathname); } catch(e) {}
                    }, 1500);
                }
            });


            // تحديث اسم المستخدم
            btnUpdateUsername.addEventListener('click', async (e) => {
                e.preventDefault(); 
                hideSettingsMessages();
                const newUsername = settingsUsernameInput.value.trim();
                if (!newUsername || newUsername.length < 3) {
                    showSettingsError('يجب أن يكون اسم المستخدم 3 أحرف على الأقل.');
                    return;
                }
                showSettingsSuccess('يتم تحديث الاسم...');
                if (!supabase || !supabase.auth || !supabase.auth.updateUser) {
                    showSettingsError('خدمة المصادقة غير متاحة حالياً.');
                    return;
                }
                const { data, error } = await supabase.auth.updateUser({ data: { username: newUsername } });
                if (error) {
                    showSettingsError(error.message);
                } else {
                    showSettingsSuccess('تم تحديث اسم المستخدم بنجاح!');
                    sidebarUsername.textContent = newUsername; 
                    // (جديد) تحديث المستخدم الحالي
                    if (currentUser) {
                        currentUser.user_metadata.username = newUsername;
                    }
                }
            });

            // (جديد) منطق حذف الحساب
            btnShowDeleteAccount.addEventListener('click', () => {
                if (!currentUser) return;
                const username = currentUser.user_metadata?.username || currentUser.email;
                deleteConfirmUsernameLabel.textContent = username;
                deleteConfirmUsername.value = '';
                deleteError.classList.add('hidden');
                btnDeleteAccountConfirm.disabled = true;
                deleteAccountModal.style.display = 'flex';
            });

            btnDeleteAccountCancel.addEventListener('click', () => {
                deleteAccountModal.style.display = 'none';
            });
            
            // (جديد) تفعيل زر الحذف عند تطابق الاسم
            deleteConfirmUsername.addEventListener('input', () => {
                const username = currentUser.user_metadata?.username || currentUser.email;
                if (deleteConfirmUsername.value === username) {
                    btnDeleteAccountConfirm.disabled = false;
                } else {
                    btnDeleteAccountConfirm.disabled = true;
                }
            });
            
            // (جديد) تنفيذ الحذف
            btnDeleteAccountConfirm.addEventListener('click', async () => {
                deleteError.classList.add('hidden');
                btnDeleteAccountConfirm.disabled = true;
                btnDeleteAccountConfirm.textContent = 'جاري الحذف...';
                
                try {
                    // هام: يجب استدعاء Edge Function لحذف المستخدم
                    const { data, error } = await supabase.functions.invoke('delete-user');
                    
                    if (error) {
                        throw error;
                    }
                    
                    // إذا نجح الحذف، سيتم تسجيل الخروج تلقائياً
                    // (سيقوم onAuthStateChange بالباقي)
                    await supabase.auth.signOut();
                    deleteAccountModal.style.display = 'none';

                } catch (error) {
                    deleteError.textContent = `خطأ في الحذف: ${error.message}. يرجى المحاولة لاحقاً.`;
                    deleteError.classList.remove('hidden');
                    btnDeleteAccountConfirm.disabled = false;
                    btnDeleteAccountConfirm.textContent = 'أنا أفهم العواقب، احذف حسابي';
                }
            });


            // إرسال نموذج المصادقة (تسجيل الدخول / إنشاء حساب)
            authForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('auth-email').value;
                const password = document.getElementById('auth-password').value;
                const isLogin = e.submitter === btnLoginSubmit;
                
                if (isLogin) {
                    // --- منطق تسجيل الدخول ---
                    showAuthSuccess('يتم تسجيل الدخول...');
                    if (!supabase || !supabase.auth || !supabase.auth.signInWithPassword) {
                        showAuthError('خدمة المصادقة غير متاحة حالياً. يرجى المحاولة لاحقاً أو المتابعة كضيف.');
                        return;
                    }
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password,
                    });
                    if (error) {
                        showAuthError('البريد الإلكتروني أو كلمة المرور غير صحيحة.');
                    } else {
                        showAuthSuccess('تم تسجيل الدخول بنجاح!');
                        setTimeout(() => {
                            authModal.style.display = 'none';
                        }, 1000);
                    }
                } else {
                    // --- منطق إنشاء حساب ---
                    const termsAgreed = authTermsCheckbox.checked;
                    if (!termsAgreed) {
                        showAuthError('يجب الموافقة على شروط الاستخدام أولاً.');
                        return;
                    }
                    
                    const username = authUsernameInput.value.trim();
                    if (!username || username.length < 3) {
                        showAuthError('يجب أن يكون اسم المستخدم 3 أحرف على الأقل.');
                        return;
                    }
                    if (!supabase || !supabase.auth || !supabase.auth.signUp) {
                        showAuthError('خدمة المصادقة غير متاحة حالياً. يرجى المحاولة لاحقاً أو المتابعة كضيف.');
                        return;
                    }
                    showAuthSuccess('يتم إنشاء الحساب...');
                    const { data, error } = await supabase.auth.signUp({
                        email: email,
                        password: password,
                        options: { data: { 'username': username, 'favorites': [] } }
                    });

                    // 1. فحص الأخطاء الصريحة (مثل كلمة مرور ضعيفة)
                    if (error) {
                        const msg = error.message.toLowerCase();
                        if (msg.includes("already registered") || msg.includes("user already exists")) {
                             showAuthError('عذراً، هذا البريد الإلكتروني مسجل لدينا مسبقاً. حاول تسجيل الدخول.');
                        } else {
                             showAuthError('حدث خطأ: ' + error.message);
                        }
                    }
                    // 2. فحص "النجاح الوهمي" (عندما تكون الحماية مفعلة)
                    else if (data?.user && data?.user?.identities && data?.user?.identities.length === 0) {
                        // إذا كانت identities فارغة، فهذا يعني أن الإيميل موجود ولكن النظام يخفي ذلك
                        showAuthError('عذراً، هذا البريد الإلكتروني مسجل لدينا مسبقاً. حاول تسجيل الدخول.');
                    }
                    // 3. النجاح الحقيقي
                    else {
                        showAuthSuccess('نجح! يرجى مراجعة بريدك الإلكتروني لتأكيد الحساب. (تحقق من صندوق الرسائل غير المرغوبة)');
                        // تفريغ الحقول
                        authForm.reset();
                    }
                }
            });
            
            
            // --- (جديد) منطق المفضلة ---
            
            // دالة لحفظ المفضلة في Supabase
            async function saveFavoritesToSupabase() {
                if (!currentUser) return;
                if (!supabase || !supabase.auth || !supabase.auth.updateUser) return;
                
                const { data, error } = await supabase.auth.updateUser({
                    data: { favorites: userFavorites }
                });
                
                if (error) {
                    console.error('خطأ في حفظ المفضلة:', error);
                }
            }
            
            // دالة لتحديث واجهة النجوم
            function updateFavoriteIcons() {
                allFavoriteButtons.forEach(btn => {
                    const card = btn.closest('.app-card');
                    if (card) {
                        const appId = card.dataset.appid;
                        if (userFavorites.includes(appId)) {
                            btn.classList.add('favorited'); // نجمة ممتلئة
                        } else {
                            btn.classList.remove('favorited'); // نجمة فارغة
                        }
                    }
                });
            }
            
            // دالة لربط أحداث النقر على النجوم
            allFavoriteButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const card = btn.closest('.app-card');
                    if (!card) return;
                    
                    const appId = card.dataset.appid;
                    if (userFavorites.includes(appId)) {
                        // إزالة من المفضلة
                        userFavorites = userFavorites.filter(id => id !== appId);
                    } else {
                        // إضافة للمفضلة
                        userFavorites.push(appId);
                    }
                    
                    // تحديث الواجهة فوراً
                    updateFavoriteIcons();
                    // حفظ التغييرات في قاعدة البيانات
                    saveFavoritesToSupabase();
                });
            });
            
            // دالة لعرض محتوى نافذة المفضلة
            function renderFavoritesModal() {
                if (userFavorites.length === 0) {
                    favoritesContainer.innerHTML = '<p class="text-zinc-500 dark:text-zinc-400 text-center">لم تقم بإضافة أي تطبيقات إلى المفضلة بعد. اضغط على أيقونة ⭐️ لإضافتها.</p>';
                    return;
                }
                
                let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
                userFavorites.forEach(appId => {
                    const info = appInfoMap[appId];
                    if (info) {
                        html += `
                            <button data-appid="${appId}" class="favorite-item-btn flex items-center gap-3 p-4 bg-zinc-100 dark:bg-zinc-700 rounded-lg hover:bg-zinc-200 dark:hover:bg-zinc-600 transition">
                                <img src="${info.img}" class="w-10 h-10 rounded object-cover" onerror="this.src='https://placehold.co/40x40/cccccc/ffffff?text=App';">
                                <span class="font-medium">${info.title}</span>
                            </button>
                        `;
                    }
                });
                html += '</div>';
                favoritesContainer.innerHTML = html;
                
                // ربط الأزرار داخل النافذة
                document.querySelectorAll('.favorite-item-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const appId = btn.dataset.appid;
                        showPage(appId, true);
                        favoritesModal.style.display = 'none';
                    });
                });
            }

            // === (جديد) ربط أحداث إغلاق شاشة الإعلانات ===
            btnCloseAnnouncement.addEventListener('click', hideAnnouncementModal);
            announcementModalOverlay.addEventListener('click', hideAnnouncementModal);
            // === (نهاية الإضافة) ===
            
            // (إزالة) تم نقل تعريف isRecoveryMode للأعلى
            // let isRecoveryMode = window.location.href.includes('type=recovery');

            if (supabase) {
            supabase.auth.onAuthStateChange((event, session) => {
                
                // التحقق من الرابط كخطة احتياطية 
                let currentPageId = window.location.hash.substring(1); 
                const isRecoveryHash = currentPageId.includes('type=recovery') || window.location.href.includes('type=recovery'); 
            
                // === التصحيح هنا: الاستماع للحدث هو الأهم === 
                if (event === 'PASSWORD_RECOVERY' || isRecoveryHash) { 
                    isRecoveryMode = true; 
                    sessionStorage.setItem('supabase_recovery_mode', 'true'); // تثبيت الحالة
                    
                    // إجبار النافذة على الظهور فوراً 
                    console.log("Password Recovery Mode Detected!"); // للتأكد في الكونسول 
                    
                    // تجهيز الحقول 
                    if (authResetFields) authResetFields.classList.remove('hidden'); 
                    
                    // استدعاء دالة عرض واجهة الاستعادة 
                    showResetPasswordView(); 
                    
                    // إظهار النافذة فوق كل شيء 
                    authModal.style.display = 'flex'; 
                    authModal.style.zIndex = '99999'; // لضمان ظهورها فوق أي شيء آخر 
                }

                const isAuthHash = currentPageId.includes('access_token=') || currentPageId.includes('error=');
                let isGuest = sessionStorage.getItem('isGuest') === 'true'; // (جديد) التحقق من وضع الضيف

                if (session && session.user) {
                    // المستخدم مسجل دخوله
                    currentUser = session.user; // (جديد) تخزين المستخدم
                    setGuestMode(false); // (جديد) إلغاء وضع الضيف
                    
                    // (جديد) جلب المفضلة الخاصة بالمستخدم
                    userFavorites = session.user.user_metadata?.favorites || [];
                    updateFavoriteIcons();

                    // === (جديد) وضع الاستعادة الصارم: إخفاء التطبيق تماماً ===
                    if (isRecoveryMode) {
                        console.log("Strict Recovery Mode: Hiding App UI");
                        
                        // إخفاء عناصر التحكم الرئيسية
                        btnOpenSidebar.classList.add('hidden');
                        themeToggle.classList.add('hidden');
                        fullscreenToggle.classList.add('hidden');
                        
                        // إخفاء كل الصفحات
                        allPages.forEach(p => { 
                            p.style.display = 'none'; 
                            p.style.opacity = '0'; 
                        });
                        
                        // ضمان ظهور نافذة الاستعادة وإزالة زر الإغلاق
                        if (authResetFields) authResetFields.classList.remove('hidden');
                        showResetPasswordView();
                        
                        // إجبار النافذة لتكون خلفية كاملة
                        authModal.style.display = 'flex';
                        authModal.style.zIndex = '999999';
                        authModal.style.backgroundColor = '#18181b'; // خلفية داكنة (zinc-900) لإخفاء أي شيء خلفها
                        btnCloseAuth.classList.add('hidden'); // إخفاء زر الإغلاق
                        
                        return; // توقف هنا ولا تكمل تحميل التطبيق
                    }
                    
                    // 1. إظهار واجهة التطبيق الرئيسية
                    btnOpenSidebar.classList.remove('hidden');
                    themeToggle.classList.remove('hidden');
                    fullscreenToggle.classList.remove('hidden'); // (جديد)
                    
                    // 2. إخفاء نوافذ المصادقة (مع مراعاة استعادة كلمة المرور)
                    if (isRecoveryMode) {
                        // (هام) التأكد من إظهار النافذة وتجهيزها
                        if (authResetFields) authResetFields.classList.remove('hidden');
                        showResetPasswordView();
                        authModal.style.display = 'flex';
                        // (جديد) رفع الطبقة لضمان الظهور فوق أي نافذة أخرى
                        authModal.style.zIndex = '9999';
                    } else {
                        authModal.style.display = 'none';
                        authModal.style.zIndex = ''; // إعادة الوضع الطبيعي
                    }
                    guestWarningModal.style.display = 'none';
                    
                    // 3. تحديث القائمة الجانبية
                    sidebarLoggedOut.classList.add('hidden');
                    sidebarLoggedIn.classList.remove('hidden');
                    const displayName = session.user.user_metadata?.username || session.user.email;
                    sidebarUsername.textContent = displayName;
                    
                    // 4. تحديد الصفحة المراد عرضها
                   // 4. تحديد الصفحة المراد عرضها
            if (isAuthHash || currentPageId === '' || !pageMap[currentPageId]) {
                showPage('welcome', false);
                
                // === (جديد) أضف هذا السطر لتشغيل الإعلان ===
                setTimeout(checkAndShowAnnouncement, 500);
                // === (نهاية الإضافة) ===
                
                // (تعديل) لا تمسح الرابط إذا كنا في وضع الاستعادة أو إذا كان هناك رموز وصول (للسماح لـ Supabase بالمعالجة)
                if (!isRecoveryMode && !window.location.hash.includes('access_token') && !window.location.hash.includes('type=recovery')) {
                    try {
                        history.replaceState({ page: 'welcome' }, '', `#welcome`);
                    } catch(e) { console.warn("History API (replaceState) not available.", e); }
                }
            } else {
                showPage(currentPageId, false);
            }
                    
                } else {
                    // المستخدم سجل خروجه (أو زائر جديد)
                    currentUser = null; // (جديد)
                    userFavorites = []; // (جديد)
                    updateFavoriteIcons(); // (جديد)
                    
                    // 1. إخفاء واجهة التطبيق الرئيسية
                    btnOpenSidebar.classList.add('hidden');
                    themeToggle.classList.add('hidden');
                    fullscreenToggle.classList.add('hidden'); // (جديد)
                    
                    // 2. إخفاء جميع الصفحات
                    allPages.forEach(p => { 
                        p.style.display = 'none'; 
                        p.style.opacity = '0'; 
                    });
                    currentPage = null;
                    
                    // 3. تحديث القائمة الجانبية (للحالة غير المسجلة)
                    sidebarLoggedIn.classList.add('hidden');
                    sidebarLoggedOut.classList.remove('hidden');
                    sidebarUsername.textContent = '';
                    
                    // 4. إظهار نافذة المصادقة أو واجهة الضيف
                    if (isAuthHash) {
                        // لا تفعل شيئاً، انتظر معالجة الرابط
                  } else if (isGuest) {
                // (جديد) المستخدم اختار أن يكون ضيفاً
                btnOpenSidebar.classList.remove('hidden');
                themeToggle.classList.remove('hidden');
                fullscreenToggle.classList.remove('hidden'); // (جديد)
                showPage('welcome', false);

                // === (جديد) أضف هذا السطر لتشغيل الإعلان للضيف العائد ===
                setTimeout(checkAndShowAnnouncement, 500);
                // === (نهاية الإضافة) ===

                setGuestMode(true); // (إصلاح) التأكد من تفعيل وضع الضيف
            } else {
                        // (جديد) مستخدم جديد أو سجل خروج، أظهِر المصادقة الإجبارية
                        setGuestMode(false); // (إصلاح) التأكد من إلغاء وضع الضيف
                        showLoginView();
                        btnCloseAuth.classList.add('hidden');
                        authModal.style.display = 'flex';
                    }
                }
            });
            } else {
                setGuestMode(true);
                btnOpenSidebar.classList.remove('hidden');
                themeToggle.classList.remove('hidden');
                showPage('welcome', false);
                // setTimeout(checkAndShowAnnouncement, 500);
                if (typeof fetchAndDisplayAds === 'function') fetchAndDisplayAds();
                try { history.replaceState({ page: 'welcome' }, '', `#welcome`); } catch(e) {}
            }

        });
    </script>

    <!-- (جديد) سكربتات إدارة المحتوى والأدمن -->
    <script src="dynamic_content.js?v=2.1"></script>
    <script src="admin_manager.js?v=2.1"></script>
</body>

</html>










